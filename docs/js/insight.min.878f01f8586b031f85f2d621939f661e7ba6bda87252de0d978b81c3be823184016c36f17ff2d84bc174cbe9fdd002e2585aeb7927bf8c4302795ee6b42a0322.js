(function(a,h){var b=a('.ins-search'),m=b.find('.ins-search-input'),c=b.find('.ins-section-wrapper'),f=b.find('.ins-section-container');b.parent().remove('.ins-search'),a('body').append(b);function u(b){return a('<section>').addClass('ins-section').append(a('<header>').addClass('ins-section-header').text(b))}function k(e,b,c,d,f){return a('<div>').addClass('ins-selectable').addClass('ins-search-item').append(a('<header>').append(a('<i>').addClass('icon').addClass('icon-'+e)).append(b!=null&&b!=''?b:h.TRANSLATION.UNTITLED).append(c?a('<span>').addClass('ins-slug').text(c):null)).append(d?a('<p>').addClass('ins-search-preview').text(d):null).attr('data-url',f)}function t(a,b){var d,c;if(b.length===0)return null;switch(d=h.TRANSLATION[a],a){case'POSTS':c=b.map(function(a){return k('file',a.title,null,a.content.slice(0,150),a.uri)});break;case'CATEGORIES':case'TAGS':c=b.map(function(b){return k(a==='CATEGORIES'?'folder':'tag',b.title,'',null,b.uri)});break;default:return null}return u(d).append(c)}function j(a){return a.split(' ').filter(function(a){return!!a}).map(function(a){return a.toUpperCase()})}function d(c,a,d){var f=!1,b=j(c),e=b.filter(function(b){var c=d.filter(function(c){if(!a.hasOwnProperty(c))return!1;if(a[c].toUpperCase().indexOf(b)>-1)return!0});return c.length>0});return e.length===b.length}function v(a){return{POST:function(b){return d(a,b,['title','content'])},PAGE:function(b){return d(a,b,['title','content'])},CATEGORY:function(b){return d(a,b,['title'])},TAG:function(b){return d(a,b,['title'])}}}function e(c,a,d,e){var b=0;return j(c).forEach(function(c){var f=new RegExp(c,'img');d.forEach(function(c,g){if(a.hasOwnProperty(c)){var d=a[c].match(f);b+=d?d.length*e[g]:0}})}),b}function s(a){return{POST:function(b){return e(a,b,['title','content'],[3,1])},PAGE:function(b){return e(a,b,['title','content'],[3,1])},CATEGORY:function(b){return e(a,b,['title'],[1])},TAG:function(b){return e(a,b,['title'],[1])}}}function r(b,d){var a=s(d),c=v(d),e=b.posts,f=b.tags,g=b.categories;return{posts:e.filter(c.POST).sort(function(b,c){return a.POST(c)-a.POST(b)}).slice(0,5),categories:g.filter(c.CATEGORY).sort(function(b,c){return a.CATEGORY(c)-a.CATEGORY(b)}).slice(0,5),tags:f.filter(c.TAG).sort(function(b,c){return a.TAG(c)-a.TAG(b)}).slice(0,5)}}function p(a){f.empty();for(var b in a)f.append(t(b.toUpperCase(),a[b]))}function q(a){var d,e,b;if(a.length===0)return;d=c[0].clientHeight,e=a.position().top-c.scrollTop(),b=a[0].clientHeight+a.position().top,b>d+c.scrollTop()&&c.scrollTop(b-c[0].clientHeight),e<0&&c.scrollTop(a.position().top)}function i(e){var b=a.makeArray(f.find('.ins-selectable')),c=-1,d;b.forEach(function(b,d){if(a(b).hasClass('active')){c=d;return}}),d=(b.length+c+e)%b.length,a(b[c]).removeClass('active'),a(b[d]).addClass('active'),q(a(b[d]))}function n(a){a&&a.length&&(location.href=a.attr('data-url'))}a.getJSON(h.CONTENT_URL,function(c){location.hash.trim()==='#ins-search'&&b.addClass('show'),m.on('input',function(){var b=a(this).val();p(r(c,b))}),m.trigger('input')});let g=0,l=null;function o(a){if(g===0){g+=1,l=setTimeout(()=>g=0,500);return}g=0,clearTimeout(l),a==='show'?b.addClass('show'):b.removeClass('show')}a(document).on('click focus','.search-form-input',function(){b.addClass('show'),b.find('.ins-search-input').focus()}).on('click','.ins-search-item',function(){n(a(this))}).on('click','.ins-close',function(){b.removeClass('show')}).on('keydown',function(a){if(!b.hasClass('show')){switch(a.code){case'Shift','ShiftRight','ShiftLeft':o('show')}return}switch(a.code){case'Escape':b.removeClass('show');break;case'ArrowUp':i(-1);break;case'ArrowDown':i(1);break;case'Enter':n(f.find('.ins-selectable.active').eq(0));break;case'Shift','ShiftRight','ShiftLeft':o('close')}})})(jQuery,window.INSIGHT_CONFIG)
{"categories":[],"posts":[{"content":"Raycast Raycast æ˜¯ä¸€å€‹æ··åˆå½¢çš„å·¥å…·ï¼Œå¯ä»¥ç°¡å–®çš„èªè­˜ä»–æ˜¯ä¸€å€‹å¼·åŒ–ç‰ˆçš„ Soptlight search\né€™äº›é€²éšåŠŸèƒ½æœ‰æ•ˆçš„æé«˜å·¥ä½œæ•ˆç‡ï¼Œå€¼å¾—èªè­˜èªè­˜\nå®‰è£å’Œè¨­å®š å®‰è£ç›¸ç•¶å®¹æ˜“ï¼Œåœ¨å®˜æ–¹ç¶²é çš„å³ä¸Šè§’é»æ“Š Download å°±å¯ä»¥æˆåŠŸä¸‹è¼‰äº†ï½\nå¦‚æœæ˜¯ Homebrew ä½¿ç”¨è€…\nbrew install --cask raycast General æŒ‰ä¸‹ Cmd + , å¯ä»¥é–‹å•Ÿ Raycast Settings çš„ç•«é¢ï½\nåœ¨ç¬¬äºŒå€‹ Tab çš„ Extensions è£¡é¢åˆ—èˆ‰äº†å¾ˆå¤š built-in çš„ Applicationsï¼ æ¥ä¸‹ä¾†çš„æ®µè½æœƒä»‹ç´¹ä¸€äº›æˆ‘æ¯”è¼ƒå¸¸ç”¨çš„ Applications ğŸ«¡\né–‹æ©Ÿå•Ÿå‹• Startup å‹¾èµ·ä¾†ï¼Œåœ¨é–‹æ©Ÿçš„æ™‚å€™æœƒè‡ªå‹•å¹«ä½ æŠŠ Raycast æ‰“é–‹ï½\nå–ä»£ Spotlight ç‚ºäº†å®Œå…¨å–ä»£ Spotlightï¼Œæˆ‘å€‘å¯ä»¥è·Ÿéš¨å®˜æ–¹æŒ‡å—\nå°‡ Raycast Hotkey ä¿®æ”¹æˆ Cmd + Space é—œé–‰ macOS built-in çš„ spotlight System Preferences \u0026gt; Keyboard \u0026gt; Shortcuts \u0026gt; Spotlight Extensions Extensions æ˜¯ä½ æœƒåœ¨ Raycast èƒ½çœ‹åˆ°çš„å·¥å…·å€‘ï¼Œåˆ†æˆ Apps, Commands, Scripts, Quicklinks\næ¯å€‹åˆ†é¡éƒ½æœ‰ä¸€äº›ä¸€æ¨£çš„æ¬„ä½ï¼š Name, Type, Alias, Hotkey, Enabledã€‚\nåœ¨æœå°‹æ™‚ï¼Œæœƒæ‰¾å‡ºç¬¦åˆ Name å’Œ Alias çš„ Extensionsï¼Œä»¥ä¸Šé¢çš„æˆªåœ–ä¾†èªªä½ å¯ä»¥è¼¸å…¥ Activity æˆ–æ˜¯ top å°±å¯ä»¥é–‹å•Ÿä½ çš„ mac æ´»å‹•ç›£è¦–å™¨ï¼\nè€Œ Hotkey ä¹Ÿç›¸ç•¶å®¹æ˜“ç†è§£ï¼Œå³ä½¿ä½ ä¸é–‹å•Ÿ Raycast ä¹Ÿèƒ½é€éå¿«æ·éµç¶å®šç›´æ¥å¿«é€Ÿå•Ÿå‹•è©² Appã€‚ å¦å¦‚ä½ å¯èƒ½æœƒå¸Œæœ›åƒæ˜¯ Ubuntu é è¨­çš„é‚£æ¨£å­ï¼Œä¾†å€‹ Cmd + Shift + T ç›´æ¥å°±é–‹å•Ÿ Terminal ğŸ‘ã€‚\nApps åŸºæœ¬ä¸Šå°±æ˜¯ä½ çš„ mac ä¸­æ‰€æœ‰çš„ Applicationsã€‚\nä¾‹å¦‚å¦‚æœèªªä½ æƒ³é–‹å€‹ Air Drop é‚£ç›´æ¥åœ¨ Raycast è¼¸å…¥å°±å¥½äº†ï¼Œå¾ˆå¿« XD\nCommands é€™é‚Šå°±æ˜¯ Raycast æä¾›çš„æ“´å……åŠŸèƒ½äº†ï¼Œæƒ³çŸ¥é“æœ‰å“ªäº›æ±è¥¿å¯ä»¥ç”¨å°±åœ¨é€™é‚Šå°‹æ‰¾ï¼ åŒ…å«é è¨­ built-in çš„æ“´å……åŠŸèƒ½ï¼Œå’Œæ‰‹å‹•ä¸‹è¼‰çš„æ“´å……åŠŸèƒ½\nä¸‹ä¸€æ®µæœƒä»‹ç´¹ä¸€äº›ç²¾é¸çš„åŠŸèƒ½ä»‹ç´¹ ï¼šï¼‰\nScripts Scripts å¯ä»¥èªªæ˜¯ Raycast æœ€å¯¦ç”¨çš„åŠŸèƒ½äº†ï¼Œèƒ½è®“ä½ ç·¨è¼¯ç°¡å–®çš„ Script åŸºæœ¬ä¸Šå¯ä»¥åšåˆ°ä»»ä½•äº‹æƒ…ã€‚ æ”¯æ´çš„èªè¨€æœ‰ Bash/App Script/Swift/Python/Ruby/Node.jsï¼Œè€Œä¸”åŸºæœ¬ä¸Šä½ åªæœ‰æœ‰ Bash å°±å¯ä»¥åšåˆ°ä»»ä½•äº‹æƒ…äº† ğŸ‘\né–‹é ­çš„ Shebang æˆ‘æŒ‡å®šåŸ·è¡Œ fishï¼Œé€™æ¨£å­æ‰åƒå¾—åˆ°æˆ‘é è¨­å¥½çš„ aliasã€‚\nè€Œä¸­é–“é‚£ä¸€é•·ä¸²è¨»è§£æ˜¯çµ¦ Raycast çœ‹çš„ï¼Œä»–æœƒåˆ©ç”¨é€™äº›å…§å®¹ä¾†å®šç¾©æ€éº¼åŸ·è¡Œé€™å€‹ Scriptã€‚\nä¾‹å¦‚ @raycast.icon æˆ–æ˜¯ @raycast.argument1 è¡¨ç¤ºå¯ä»¥æ¥å—çš„åƒæ•¸ï¼Œè€Œ @raycast.mode å‰‡è¡¨ç¤ºç•¶ Script åŸ·è¡Œå¾Œå¦‚ä½•è™•ç†å›å‚³çš„çµæœ\n#!/usr/bin/env fish # Required parameters: # @raycast.schemaVersion 1 # @raycast.title cht # @raycast.mode fullOutput # Optional parameters: # @raycast.icon ğŸ“– # @raycast.argument1 { \u0026quot;type\u0026quot;: \u0026quot;text\u0026quot;, \u0026quot;placeholder\u0026quot;: \u0026quot;Directory\u0026quot; } # Documentation: # @raycast.author XiaoXiao # @raycast.authorURL https://github.com/xiaoxiaosn # source ~/.config/fish/functions/cht.fish cht $argv[1] å€‹äººå¸¸ç”¨çš„ Scripts: https://github.com/XiaoXiaoSN/dotfiles/tree/main/raycast\nQuicklinks æœ‰æ™‚å€™æœ‰äº›éœ€æ±‚æ¯”è¼ƒå–®ç´”ï¼Œä¾‹å¦‚èªªåªæ˜¯æƒ³è¦å¿«é€Ÿé–‹å•Ÿç‰¹å®šé é¢é€™æ™‚å€™æ¯”èµ· Scripts æ›´é©åˆä½¿ç”¨ Quicklinks\nä¾‹å¦‚èªªä½¿ç”¨ finder é–‹å•Ÿ Download è³‡æ–™å¤¾ï¼š\næˆ–æ˜¯ç”¨ VSCode é–‹å•Ÿç‰¹å®šå°ˆæ¡ˆä½ç½®ï¼š\nç•¶ç„¶ä¹Ÿå¯ä»¥å¸¶åƒæ•¸ï¼Œä¾‹å¦‚èªª Google Searchï¼š\nå¸¸ç”¨æŒ‡ä»¤ å¿«é€Ÿè½‰æ› (Calculator History) å’Œ macOS å…§å»ºçš„ Spotlight ä¸€æ¨£æä¾›å„å¼å–®ä½è½‰æ›ï¼Œæ›´æ˜¯æ“´å……äº†å¾ˆå¤šä¸åŒçš„å–®ä½ï¼ŒæŒ‰ä¸‹ Enter å°±å¯ä»¥å¿«é€Ÿè¤‡è£½çµæœï½\nä¹Ÿå¯ä»¥è¼¸å…¥ Calculator History ä¾†çœ‹çœ‹éƒ½ç®—éäº†äº›ä»€éº¼ï½\næ—¥å¸¸å–®ä½ é‡é‡ è·é›¢ æº«åº¦ è²¨å¹£ ç®—æ•¸ Raycast ä¹Ÿå¯ä»¥å®Œæˆä¸€äº›ç°¡å–®çš„ç®—æ•¸\nClipboard è¼¸å…¥ Clipboard History é–‹å•Ÿå‰ªè²¼ç°¿çš„æ­·å²ç´€éŒ„ï¼Œé‚„å¯ä»¥æœå°‹ï¼ ä½¿ç”¨ Ctrl + n å’Œ Ctrl + p é¸å–ä½ è¦çš„æ­·å²ç´€éŒ„ï¼ŒæŒ‰ä¸€ä¸‹ Enter å¾Œå°±åˆè¤‡è£½èµ·ä¾†å•¦ï½\nå¦å¤–è¦å¼·èª¿ä¸€å€‹å¾ˆè®šçš„åŠŸèƒ½ï¼ŒClipboard History é é¢è£¡é¢å¯ä»¥ç‚ºä½ è¤‡è£½éçš„åœ–ç‰‡ç›´æ¥åš OCR\nå…ˆæŒ‰ Cmd + k é–‹å•Ÿ Actions é¸å–®ï¼Œå†é¸æ“‡ Copy Text from Image å°±å¯ä»¥æŠŠåœ–ç‰‡ä¸­çš„æ–‡å­—ç›´æ¥æŠ“å‡ºä¾†äº†å–”ï½\nSchedule åªè¦è¼¸å…¥ My Schedule å°±å¯ä»¥é–‹å•Ÿï¼Œç¬¬ä¸€æ¬¡æœƒè©¢å•æ˜¯å¦è¦çµ¦äºˆå­˜å–æ—¥æ›†çš„æ¬Šé™\nå¯ä»¥å¿«é€Ÿçœ‹åˆ°ä»Šå¤©å®‰æ’è¡Œè¡Œç¨‹ï¼Œéå¸¸å¯¦ç”¨\nSwitch Windows æ˜¯å¦æœ‰æ™‚å€™é–‹äº†è¶Šä¾†è¶Šå¤šçš„è¦–çª—ï¼Œè¦æ‰¾æ±è¥¿çš„æ™‚å€™éå¸¸éº»ç…©å‘¢ï¼Ÿ\nè¼¸å…¥ switch æŒ‰ä¸‹ Tab æˆ–æ˜¯ Enterï¼Œå°±æœƒè·³å‡ºé€™äº›è¦–çª—çš„åå­—ï¼Œé¸ä¸‹å»å°±æœƒè·³åˆ°é‚£å€‹è¦–çª—å›‰ã€‚\nSnippet Raycast Snippet è®“ä½ å®šç¾©è‡ªå·±çš„ keyword å’Œæƒ³ç”¢ç”Ÿçš„ snippet ç‰‡æ®µï¼Œç•¶ä½ è¼¸å…¥äº†é‚£å€‹ keycloak æ™‚å°±æœƒè‡ªå‹•çš„å–ä»£æ‰\nä¾‹å¦‚èªªé€™å€‹è¨­å®šï¼Œæˆ‘åªè¦åœ¨ä»»ä½•åœ°æ–¹ï¼ŒåŒ…å«ç€è¦½å™¨ã€VSCodeã€Slack éƒ½å¯ä»¥ï¼Œè¼¸å…¥ !@fstnetwork ä»–å°±æœƒå¹«æˆ‘æŠŠé€™å€‹é—œéµå­—å–ä»£æˆå…¬å¸çµ±ç·¨ï¼š\næˆ–æ˜¯è¼¸å…¥ !@eth ä»–å°±æœƒå¹«æˆ‘å–ä»£æˆæˆ‘çš„éŒ¢åŒ…åœ°å€ï¼š\nå¦å¤–ä»–ä¹Ÿæä¾› placeholder çš„åŠŸèƒ½ï¼Œåªè¦åœ¨ snippet ä¸­è¼¸å…¥ç”¨å¤§æ‹¬è™ŸåŒ…èµ·ä¾†çš„æ±è¥¿ {} ç•¶ snippet è½‰æ›å®Œå¾Œæ¸¸æ¨™å°±æœƒè·³åˆ°é‚£å€‹ä½ç½®\nâ•­â—œâ— Í¡ â—œ Í¡ â•® â•­â—œâ—â— Í¡ Í¡â—œâ— Í¡ â—â•® ( å¥½æƒ³è¦ ) ( ç™¼å»¢æ–‡ ) â•°â—Ÿâ— Íœ â•­â—œâ— Í¡ â—œâ— Í¡ â— Í¡ â•®â—â—Ÿâ— â•¯ ( ç™¼ä¸€æ•´å¤© ) â•°â—Ÿâ— Íœ â—Ÿâ— Íœ â—Ÿâ— â•¯ â‚á¢..á¢â‚á ä¹Ÿæ­¡è¿åƒè§€å®˜æ–¹æä¾›çš„ Snippet çœ‹çœ‹å…¶ä»–äººæœ‰ä»€éº¼å¥‡æ€ªçš„æƒ³æ³• https://snippets.ray.so/\nå¯¦ç”¨æ“´å…… GIF æ˜¯å¦æœ‰æ™‚å€™è‡¨æ™‚æƒ³æ‰¾ä¸€å¼µ GIF ä¾†åœ–æˆ°ï¼Œä½†åˆè¦èŠ±æ™‚é–“å» Google å‘¢ï¼Ÿ\nå®‰è£ Search for GIFsï¼Œä¸¦æœå°‹é—œéµå­—ï¼ŒæŒ‰ä¸€ä¸‹ Enter å°±å¯ä»¥ç›´æ¥è¤‡è£½åˆ°å‰ªè²¼ç°¿ä¸Šé¢å›‰ï¼\nShorten URL Shortener å¯ä»¥å¹«ä½ å¿«é€ŸæŠŠä¸€ä¸²ç¶²å€çµ¦ç°¡çŸ­åŒ–ã€‚ åªéœ€è¦ç°¡å–®çš„å¡«ä¸Šä½ æƒ³è¦ shorten çš„ç¶²å€ï¼ŒæŒ‰ä¸‹ Enter å°±æœƒç›´æ¥å¹«ä½ è¤‡è£½åˆ°å‰ªè²¼ç°¿ä¸Šäº†ï¼\nç›´æ¥è²¼ä¸Šï¼š https://tinyurl.com/2fcpre6\nå¿«æ¨‚å€ æœ€å¾Œå¿«æ¨‚çš„æ…¶ç¥ä¸€ä¸‹å§ï½ï½ Ref https://blog.justin0u0.com/Raycast-%E8%B6%85%E8%A9%B3%E7%B4%B0%E4%BB%8B%E7%B4%B9%EF%BC%81%E5%BF%AB%E9%80%9F%E6%8F%90%E5%8D%87%E7%94%9F%E7%94%A2%E5%8A%9B%E7%9A%84%E8%B6%85%E5%A5%BD%E7%94%A8%E5%B7%A5%E5%85%B7%EF%BC%81/\n","id":0,"section":"posts","summary":"Raycast Raycast æ˜¯ä¸€å€‹æ··åˆå½¢çš„å·¥å…·ï¼Œå¯ä»¥ç°¡å–®çš„èªè­˜ä»–æ˜¯ä¸€å€‹å¼·åŒ–ç‰ˆçš„ Soptlight search é€™äº›é€²éšåŠŸèƒ½æœ‰æ•ˆçš„æé«˜å·¥ä½œæ•ˆç‡ï¼Œå€¼å¾—èªè­˜èªè­˜ å®‰è£å’Œè¨­å®š å®‰è£ç›¸ç•¶å®¹æ˜“ï¼Œåœ¨å®˜æ–¹ç¶²é çš„å³","tags":["macos","raycast"],"title":"macOS ç”Ÿç”¢åŠ›å·¥å…· - Raycast çœŸçš„å¾ˆè®š","uri":"https://blog.10oz.tw/20230830-raycast/","year":"2023"},{"content":" Elasticsearch version: 8.x\nèªè­˜ Data Stream Data Stream æ˜¯ Elasticsearch å®˜æ–¹å¹«å¸¸ç”¨æ¨¡å¼å»ºç«‹çš„ä¸€å€‹æ¨¡æ¿ã€‚ å°±å¦‚ä»–çš„åå­— Streamï¼Œä»–è¢«ç”¨ä¾†ç®¡ç†è·¨å¤šå€‹ indexes çš„ time series è³‡æ–™ã€‚å› æ­¤é¡ä¼¼ logs, events, metrics é€™é¡çš„æ™‚åºè³‡æ–™å°±å¯ä»¥ä½¿ç”¨ Data Stream ä¾†ç®¡ç†ï¼Œ\nData Stream æœ¬èº«å…¶å¯¦æ˜¯å¤šå€‹çš„ indexes æ‰€çµ„æˆï¼ŒåŒ…å«äº† index alias, index lifecycle manager é‚„æœ‰ä¸€äº›é è¨­çš„ constraintsã€‚\nè¦å»ºç«‹ä¸€å€‹ Data Stream æœ‰ä¸‰å€‹ä¸»è¦æ¬„ä½éœ€è¦è¨­å®šï¼Œé€™å€‹ Data Stream çš„å‘½åå°‡æœƒè¢«çµ„åˆæˆ {type}-{dataset}-{namespace}\ntype å¯ä»¥é¸ logs, metricsï¼Œæœªä¾†å¯èƒ½æœƒæ”¯æ´ traces, synthetics dataset ä¸»è¦çš„åå­—ï¼Œç”¨ä¾†æè¿°é€™å€‹ Data Stream æ”¾çš„æ˜¯ä»€éº¼è³‡æ–™ã€‚ä¾‹å¦‚èªª nginx.accessã€prometheusï¼Œé è¨­å€¼æ˜¯ generic ä»¥æˆ‘çš„ä½¿ç”¨å ´æ™¯ä¾†çœ‹çš„è©±ï¼Œç³»çµ±è¦å­˜ application logs å’Œ eventsï¼Œæ‰€ä»¥æˆ‘å°±æœ‰å…©å€‹ dataset åˆ†åˆ¥å«åš application å’Œ event namespace å–®ç´”ç”¨ä¾†åšè³‡æ–™åˆ†çµ„ï¼Œé è¨­å€¼æ˜¯ default ä¾‹å¦‚èªª logs-apm.app-default å°±æ˜¯ä¸€å€‹ dataset=logs, namespace=apm.app, type=logs çš„ Data Streamï¼Œè€Œé€™å€‹ Data Stream æœƒå»ºç«‹ä»¥ .ds-\u0026lt;data-stream\u0026gt;-\u0026lt;yyyy.MM.dd\u0026gt;-\u0026lt;generation\u0026gt; å‘½åçš„ indexesã€‚\nåœ¨ Kibana çš„ Web UI ä¸­ï¼Œé€™äº›ç´¢å¼•é è¨­æ˜¯éš±è—çš„ã€‚å¦‚æœæ‰“é–‹é¡¯ç¤ºå°±æœƒçœ‹åˆ°é¡ä¼¼ .ds-logs-apm.app-default-2023.07.10-000006 çš„ç´¢å¼•åç¨±ã€‚\nå’Œä¹‹å‰çš„ Index Alias åŠŸèƒ½ä¸€æ¨£ï¼Œè®€å–æ™‚æœƒè®€å–åº•ä¸‹çš„æ‰€æœ‰ Indexes ä½†åªæœƒæœ‰ä¸€å€‹ Index æ˜¯ write only çš„ï¼ Step by Step å»ºç«‹ Data Stream https://www.elastic.co/guide/en/elasticsearch/reference/current/set-up-a-data-stream.html\nå»ºç«‹ä¸€å€‹ ILM å®˜æ–¹å»ºè­°ä½¿ç”¨ Index Lifecycle Manager(ILM) ä¾†å¹«åŠ©ç®¡ç† Data Stream ä¸‹çš„ indexes\næ‰€ä»¥æˆ‘å€‘é¦–å…ˆæ–°å¢ä¸€å€‹ ILM Policy loc-logs-policy\næ¯ 30 GB æ»¾å‹•åˆ°ä¸‹ä¸€å€‹ index ç•¶è³‡æ–™åˆ° 14 days æ™‚è½‰åˆ° warn phaseï¼Œä¸¦ä¸”åˆä½µæˆ 1 å€‹ primary shard ç•¶è³‡æ–™åˆ° 60 days æ™‚åˆªé™¤èˆŠè³‡æ–™ PUT _ilm/policy/loc-logs-policy { \u0026quot;policy\u0026quot;: { \u0026quot;phases\u0026quot;: { \u0026quot;hot\u0026quot;: { \u0026quot;actions\u0026quot;: { // rollover when the size exceeds 10GB \u0026quot;rollover\u0026quot;: { \u0026quot;max_size\u0026quot;: \u0026quot;10gb\u0026quot;, \u0026quot;max_age\u0026quot;: \u0026quot;1d\u0026quot; } } }, // After 14 days, move to the 'warm' phase \u0026quot;warm\u0026quot;: { \u0026quot;min_age\u0026quot;: \u0026quot;14d\u0026quot;, \u0026quot;actions\u0026quot;: { // shrink the index to 1 primary shard \u0026quot;shrink\u0026quot;: { \u0026quot;number_of_shards\u0026quot;: 1 }, // force merge index segments to reduce fragment count to 1 // This action makes the index read-only. \u0026quot;forcemerge\u0026quot;: { \u0026quot;max_num_segments\u0026quot;: 1 } } }, // After 60 days, delete index \u0026quot;delete\u0026quot;: { \u0026quot;min_age\u0026quot;: \u0026quot;60d\u0026quot;, \u0026quot;actions\u0026quot;: { \u0026quot;delete\u0026quot;: {} } } } } } å»ºç«‹ Index Template Data Stream å¯¦éš›ä¸Šæ˜¯ç”±å¤šå€‹ Indexes çµ„æˆçš„ï¼Œç‚ºäº†ç®¡ç†é€™äº› Indexes æˆ‘å€‘å»ºç«‹ä¸€å€‹ Index Templateï¼Œç•¶ ILM é”åˆ°æ™‚é–“æˆ–æ˜¯ Size çš„æ¢ä»¶ Rollover æ™‚ï¼Œæ–°ç”¢ç”Ÿçš„ Index æœƒè‡ªå‹• Match åˆ° Index Template ä¸Š\nPUT _index_template/loc-logs-template { \u0026quot;index_patterns\u0026quot;: [\u0026quot;logs-application-dev*\u0026quot;], // æŒ‡å®šé€™å€‹ Index Template æ˜¯ Data Stream type \u0026quot;data_stream\u0026quot;: { }, // ç‚ºäº†é¿å…è¡çªï¼Œå®˜æ–¹å»ºè­°è¨­ç½® 200 ä»¥ä¸Šçš„ priority \u0026quot;priority\u0026quot;: 500, // ç¶å®šå‰›å‰›çš„ ILM \u0026quot;template\u0026quot;: { \u0026quot;settings\u0026quot;: { \u0026quot;index.lifecycle.name\u0026quot;: \u0026quot;loc-logs-policy\u0026quot; } }, // å¯«ä¸€äº›æœ‰å¹«åŠ©çš„è¨Šæ¯ \u0026quot;_meta\u0026quot;: { \u0026quot;description\u0026quot;: \u0026quot;Manage application logs in our Dev environment\u0026quot;, \u0026quot;last_update\u0026quot;: \u0026quot;2023-08-24T17:25:24.254+08:00\u0026quot; } } å»ºç«‹ä¸€å€‹ Data Stream å¿…é ˆè¦ç¬¦åˆ Data Stream è¦ç¯„ä¾†å‘½å {type}-{dataset}-{namespace}\nPUT _data_stream/logs-application-dev ç”±æ–¼æˆ‘å€‘å‰›å‰›æœ‰æŒ‡å®šäº† logs-application-dev çš„ Index Templateï¼Œåœ¨ Create ä»–æœƒä¾ç…§é€™å€‹ Template çš„å®šç¾©ç”¢ç”Ÿ Data Stream\nå›å‚³çœ‹èµ·ä¾†æœƒåƒæ˜¯é€™å€‹æ¨£å­ï½ï½\n{ \u0026quot;data_streams\u0026quot;: [ { \u0026quot;name\u0026quot;: \u0026quot;logs-application-dev\u0026quot;, \u0026quot;timestamp_field\u0026quot;: { \u0026quot;name\u0026quot;: \u0026quot;@timestamp\u0026quot; }, \u0026quot;indices\u0026quot;: [ { \u0026quot;index_name\u0026quot;: \u0026quot;.ds-logs-application-dev-2023.08.24-000001\u0026quot;, \u0026quot;index_uuid\u0026quot;: \u0026quot;bDB2EfrJTnCg-lXtVXk31A\u0026quot; } ], \u0026quot;generation\u0026quot;: 1, \u0026quot;_meta\u0026quot;: { \u0026quot;description\u0026quot;: \u0026quot;Manage application logs in our Dev environment\u0026quot;, \u0026quot;last_update\u0026quot;: \u0026quot;2023-08-24T17:25:24.254+08:00\u0026quot; }, \u0026quot;status\u0026quot;: \u0026quot;GREEN\u0026quot;, \u0026quot;template\u0026quot;: \u0026quot;loc-logs-template\u0026quot;, \u0026quot;ilm_policy\u0026quot;: \u0026quot;loc-logs-policy\u0026quot;, \u0026quot;hidden\u0026quot;: false, \u0026quot;system\u0026quot;: false, \u0026quot;allow_custom_routing\u0026quot;: false, \u0026quot;replicated\u0026quot;: false } ] } Ref https://www.elastic.co/guide/en/ecs/master/ecs-data_stream.html\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/set-up-a-data-stream.html#create-index-lifecycle-policy\n","id":1,"section":"posts","summary":"Elasticsearch version: 8.x èªè­˜ Data Stream Data Stream æ˜¯ Elasticsearch å®˜æ–¹å¹«å¸¸ç”¨æ¨¡å¼å»ºç«‹çš„ä¸€å€‹æ¨¡æ¿ã€‚ å°±å¦‚ä»–çš„åå­— Streamï¼Œä»–è¢«ç”¨ä¾†ç®¡ç†è·¨å¤šå€‹ indexes çš„ time series è³‡æ–™ã€‚å› æ­¤é¡ä¼¼ logs, events, metrics é€™é¡çš„æ™‚åºè³‡æ–™å°±","tags":["elasticsearch"],"title":"How to create an Elasticsearch Data Stream","uri":"https://blog.10oz.tw/20230817-how-to-create-elasticsearch-data-stream/","year":"2023"},{"content":"è¨è«–ä¸ä»˜éŒ¢çµ¦ GitHub çš„ä½¿ç”¨è€…ï¼Œåœ¨ Organization ä¸‹çš„æ¬Šé™æ§åˆ¶\næ¬Šé™ Organization Teams GitHub æ¡ RBAC æ¬Šé™æ§ç®¡ï¼Œåœ¨ Organization åº•ä¸‹æœ‰ teamsï¼Œteams åº•ä¸‹ä¹Ÿå¯ä»¥å†æœ‰ä¸€å±¤ teamsã€‚\nå¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œteam name åœ¨ Organization ä¸‹æ˜¯å”¯ä¸€çš„ï¼Œå³ä½¿æ˜¯å…©å±¤çš„ teams ä¹Ÿæ˜¯ã€‚\nèˆ‰å€‹ä¾‹å­ï¼Œé€™æ¨£å­ dev, be, fe, operator æ˜¯å››å€‹ Unique nameã€‚\nteams ---- dev â”œâ”€â”€ be â””â”€â”€ fe operator æ­¤æ™‚å¦‚æœæƒ³åœ¨ dev åº•ä¸‹ç›´æ¥æ–°å¢ä¸€å€‹ team operator æ˜¯ä¸è¡Œçš„ï¼Œå› ç‚ºé€™å€‹åå­—å·²ç¶“è¢«ä½¿ç”¨äº†ï¼Œæœƒè®Šæˆå°‡ operator ç§»å‹•åˆ° dev åº•ä¸‹ã€‚ æ­¤æ™‚ GitHub æœƒè©¢å•ä½ æ˜¯å¦è¦ç§»å‹•é€™å€‹ team çš„ parentï¼Œé€™å¯èƒ½æœƒå½±éŸ¿åˆ°æ“æœ‰ dev team çš„æˆå“¡ã€‚\nRepository \u0026gt; Settings \u0026gt; Collaborators and teams\nRepository Permissions æœ‰ä»¥ä¸‹é€™å¹¾ç¨®æ¬Šé™ï¼Œè¶Šä¸‹é¢çš„æ¬Šé™è¶Šå¤§åŒæ™‚ä¹ŸåŒ…å«ä¸Šä¸€ç´šåˆ¥çš„æ¬Šé™\nRead Can read and clone this repository. Can also open and comment on issues and pull request. å¯ä»¥é–‹ PR å¯ä»¥ comment, reviewer PR ä¸èƒ½ close PR ï¼ˆè‡ªå·±é–‹çš„å¯ä»¥ï¼‰ ä¸èƒ½ assign reviewer Triage Can also manage issues and pull requests. å¯ä»¥ assign reviewer èƒ½ close PR ä¸å¯ä»¥ merge PR åªå¯ä»¥ push branch åˆ° forked repository Write Can read, clone, and push to this repository. Can also manage issues and pull requests. å¯ä»¥ merge PR å¯ä»¥ push branch åˆ°é€™å€‹ repository Maintain They can also manage issues, pull requests, and some repository settings. ä¸å¯ä»¥æ“ä½œ Settings ä¸‹çš„ Secrets/Variables ä¸å¯ä»¥æ“ä½œ Settings ä¸‹çš„æˆå“¡ Admin é è¨­ create repository çš„äººæœƒæˆç‚º admin å¯ä»¥æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåŒæ™‚æœ‰ teams å’Œå€‹äººæ¬Šé™ç™¼ç”Ÿè¡çªæ™‚ï¼Œæœƒä»¥æ¬Šé™è¼ƒå¤§çš„é‚£ä¸€å€‹ç‚ºä¸»ã€‚ GitHub ä¹Ÿæœƒåœ¨æœ‰è¡çªçš„è¨­ç½®æ—å¯«ä¸Šä¸€å€‹é»ƒè‰²ä¸‰è§’å½¢ï½ï½\n","id":2,"section":"posts","summary":"è¨è«–ä¸ä»˜éŒ¢çµ¦ GitHub çš„ä½¿ç”¨è€…ï¼Œåœ¨ Organization ä¸‹çš„æ¬Šé™æ§åˆ¶ æ¬Šé™ Organization Teams GitHub æ¡ RBAC æ¬Šé™æ§ç®¡ï¼Œåœ¨ Organization åº•ä¸‹æœ‰ teamsï¼Œteams åº•ä¸‹ä¹Ÿå¯ä»¥å†æœ‰ä¸€å±¤ teamsã€‚ å¦å¤–è¦æ³¨æ„çš„æ˜¯","tags":["github"],"title":"GitHub Permission å…è²»æ–¹æ¡ˆæ¬Šé™å¯¦é©—","uri":"https://blog.10oz.tw/20230612-github-permission-for-free-user/","year":"2023"},{"content":"è·Ÿé€™å€‹å°ˆæ¡ˆæ¶æ§‹ç›¸åŒ kubelivedï¼Œä»–çš„æ›´è©³ç´°ï¼Œå¯ä»¥åƒè€ƒä»–çš„ä»‹ç´¹\nç°¡å–®ä¾†èªªå°±æ˜¯ Keepalived(VRRP) + HAProxy\nVRRP (Virtual Router Redundancy Protocol) è¨­è¨ˆä¸Šç”¨ä¾†é¿å…å–®é»æ•…éšœï¼Œç•¶ä¸»è¦æœå‹™æ©Ÿå™¨å¤±å»é€£ç·šæ™‚å¯ä»¥åˆ‡æ›åˆ°å¦ä¸€å°å‚™æ´æ©Ÿå™¨ä¸Šã€‚ ç¶­è­·ä¸€çµ„ Virtual IP æŒ‡å‘å¾Œé¢çš„æœå‹™å€‘ï¼Œä½¿ç”¨è€…åªéœ€è¦å°‡ Request ç™¼åˆ°é€™çµ„ VIP å°±æœƒè¢«è½‰ç™¼åˆ°å…¶ä¸­ä¸€å° Real Server ä¸Šã€‚\né¸èˆ‰ Master ç•¶æœ‰å¤šå° nodes æ™‚ï¼Œé¸èˆ‰å…¶ä¸­ä¸€å°ä½œç‚º Master å…¶ä»–ä½œç‚º Backupï¼Œä¾ç…§ä»¥ä¸‹æ¢ä»¶ç«¶çˆ­\nPriority æœ€é«˜è€…å„ªå…ˆ VIP å’Œè‡ªèº« IP ä¸€è‡´è€… é¸ IP åœ°å€æœ€å¤§çš„ é¸èˆ‰å‡º Master å¾Œï¼ŒMaster node æœƒå»£æ’­ ARP å°åŒ…å°‡ VIP çš„ MAC/IP è¨­å®šåˆ°è‡ªå·±èº«ä¸Š\nMaster å¤±æ•— / Backup æ¶ä½” VRRP Master node æœƒå®šæ™‚ç™¼å¿ƒè·³åŒ…çµ¦å…¶ä»– nodesï¼Œå¦‚æœå¤±å»é€£ç·šå…¶ä»–å¹¾å° node æœƒé‡æ–°é¸å‡º Masterï¼Œä¸¦ä¸”ç™¼é€å»£æ’­ ARP å°åŒ…å°‡ VIP é‡æ–°å®šä½åˆ°æ–°çš„ Master ä¸Šã€‚\nå¯ä»¥è¨­ç½® nopreempt (No Preempt)ï¼Œé¿å…åŸæœ¬çš„ Master Node æ¢å¾©ç‹€æ…‹å¾Œé‡æ–°æ¶ä½”å› Masterã€‚ ä½¿ç”¨å ´æ™¯ï¼šå‡è¨­ Master Node å‡ºå•é¡Œäº†ï¼Œä¸æ–·é–‹é–‹é—œé—œå°è‡´é »ç¹åˆ‡æ›ï¼Œä¸­é–“å¯èƒ½ç™¼ç”Ÿä¸é æœŸçš„èµ°éŒ¯è·¯ã€æ‰å°åŒ…å•é¡Œ\nKeepalived å¯¦éš›ä¸Šç”¨ä¾†è¨­å®š VRRP çš„ç®¡ç†å“¡ä»¶ï¼Œè¨­å®šäº† VRRP ID, VIP, ç¶²å¡\u0026hellip;ï¼Œä¹ŸåŒ…å«ç”¨ä¾†æª¢æŸ¥å¾Œç«¯ K8s API Server æ˜¯å¦å¥åº·çš„ scriptï¼Œé€£çºŒæª¢æŸ¥ä¸éå°±æœƒè§¸ç™¼åˆ‡æ› Master node\nè¨­ç½®å®Œæˆå¾Œæœƒçœ‹èµ·ä¾†åƒé€™æ¨£ï¼š\né Master node ç¶²å¡ä¸Šåªæœ‰è‡ªå·±çš„ IP\n$ ip address show enp5s0 2: enp5s0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 9000 qdisc fq state UP group default qlen 1000 link/ether 7c:10:c9:d2:70:c3 brd ff:ff:ff:ff:ff:ff inet 192.168.97.17/24 metric 100 brd 192.168.97.255 scope global dynamic enp5s0 valid_lft 241387sec preferred_lft 241387sec ... Master node ç¶²å¡ä¸Šå¤šä¸€ç­† VIPï¼Œé€™è£¡æ˜¯ 192.168.97.200\n$ ip address show enp5s0 2: enp5s0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 9000 qdisc fq state UP group default qlen 1000 link/ether 7c:10:c9:d2:71:8c brd ff:ff:ff:ff:ff:ff inet 192.168.97.16/24 metric 100 brd 192.168.97.255 scope global dynamic enp5s0 valid_lft 189537sec preferred_lft 189537sec inet 192.168.97.200/32 scope global enp5s0 valid_lft forever preferred_lft forever ... HAProxy å‰é¢é€é Keepalived åšåˆ°å‚™æ´åˆ‡æ›å¾Œï¼Œå¯¦éš›é€é HAProxy (port 8443) å°‡æµé‡å°å‘å…¶ä»– K8s Control Plane (port 6443)\nRef https://github.com/clastix/kubelived https://www.qikqiak.com/post/use-kube-vip-ha-k8s-lb/ https://zhuanlan.zhihu.com/p/537216766\n","id":3,"section":"posts","summary":"è·Ÿé€™å€‹å°ˆæ¡ˆæ¶æ§‹ç›¸åŒ kubelivedï¼Œä»–çš„æ›´è©³ç´°ï¼Œå¯ä»¥åƒè€ƒä»–çš„ä»‹ç´¹ ç°¡å–®ä¾†èªªå°±æ˜¯ Keepalived(VRRP) + HAProxy VRRP (Virtual Router Redundancy Protocol) è¨­è¨ˆä¸Šç”¨ä¾†é¿å…å–®é»æ•…éšœï¼Œç•¶ä¸»è¦æœå‹™æ©Ÿå™¨å¤±å»é€£ç·š","tags":["kubernetes","ha","vrrp"],"title":"Kubernetes HA - Keepalived(VRRP) + HAProxy","uri":"https://blog.10oz.tw/20230609-kubernetes-ha-keepalived-haproxy/","year":"2023"},{"content":"Step by Step éƒ¨ç½² Elasticsearch å› ç‚ºæ¥ä¸‹ä¾†æœƒè®“å‚™ä»½æª”æ¡ˆå„²å­˜åœ¨ File System å…§ï¼Œæ‰€ä»¥å…ˆæº–å‚™ä¸€å€‹ PVC çµ¦ Elasticsearch\nkind: PersistentVolumeClaim apiVersion: v1 metadata: name: elasticsearch-snapshot spec: accessModes: - ReadWriteMany resources: requests: storage: 20Gi storageClassName: \u0026quot;fs-sc\u0026quot; é€™é‚Šç”¨ ECK (Elastic Cloud on Kubernetes) ä¾†å¬å–šä¸€çµ„æ–°çš„ Elasticsearchã€‚ åœ¨éƒ¨ç½² Elasticsearch CR æ™‚å¤š mount ä¸€å€‹ path.repo é€™å€‹ PV æ˜¯ç­‰ç­‰è¦ç”¨ä¾†å­˜ snapshot çš„åœ°æ–¹\napiVersion: elasticsearch.k8s.elastic.co/v1 kind: Elasticsearch metadata: name: backup-es spec: nodeSets: - config: path.repo: \u0026quot;/backup\u0026quot; count: 1 name: default podTemplate: spec: containers: - name: elasticsearch volumeMounts: - mountPath: \u0026quot;/backup\u0026quot; name: backup volumes: - name: backup persistentVolumeClaim: claimName: elasticsearch-snapshot volumeClaimTemplates: - metadata: name: backup spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi version: 8.6.0 åœ¨ Elasticsearch å»ºç«‹ Snapshot éƒ¨ç½²å¥½ä¹‹å¾Œï¼Œå»ºç«‹ä¸€ç­† snapshot repository åå­—å«åš my_backupã€‚ æ³¨æ„èªªé€™é‚Šå¦‚æœä½¿ç”¨ fs ä¸€å®šè¦æŒ‡å®š path.repo åŒ…å«çš„è·¯å¾‘\nPUT /_snapshot/my_backup { \u0026quot;type\u0026quot;: \u0026quot;fs\u0026quot;, \u0026quot;settings\u0026quot;: { \u0026quot;location\u0026quot;: \u0026quot;/backup/loc\u0026quot; } } æˆ–æ˜¯ä½ æœ‰ä¸€å€‹ s3 å¯ä»¥ç”¨ä¾†å­˜å‚™ä»½æª” \u0026gt; u \u0026lt;\nPUT _snapshot/my_backup { \u0026quot;type\u0026quot;: \u0026quot;s3\u0026quot;, \u0026quot;settings\u0026quot;: { \u0026quot;client\u0026quot;: \u0026quot;secondary\u0026quot;, \u0026quot;bucket\u0026quot;: \u0026quot;name-of-bucket\u0026quot;, \u0026quot;region\u0026quot;: \u0026quot;region-of-bucket-same-as-cluster\u0026quot; } } æŒ‡å®šè¦åœ¨é€™å€‹ snapshot repository ä¸­å‚™ä»½çš„ indexï¼Œé€™é‚ŠæŠŠ index system_search å‚™ä»½åˆ° snapshot system_search_snapshot è£¡é¢\nPUT /_snapshot/my_backup/system_search_snapshot { \u0026quot;indices\u0026quot;: \u0026quot;system_search\u0026quot;, \u0026quot;ignore_unavailable\u0026quot;: true, \u0026quot;include_global_state\u0026quot;: false } æ¸¬è©¦ä¸€ä¸‹å®ƒæœ‰æ•ˆ - åˆªé™¤åŠå¾©åŸ å¦‚æœæƒ³æ¸¬è©¦çš„è©±ï¼Œæ•²ä¸€ç­†è³‡æ–™é€²å»\nPOST /system_search/_doc { \u0026quot;data_process_permanent_identity\u0026quot;: \u0026quot;26bd375d-9be7-4c1c-9846-5cd187fd9b5d\u0026quot;, \u0026quot;data_process_revision\u0026quot;: 2, \u0026quot;data_process_name\u0026quot;: \u0026quot;TEST-BACKUP\u0026quot;, \u0026quot;logic_permanent_identity\u0026quot;: \u0026quot;10b785f5-f833-4c94-9dfb-eeacc8ea88bf\u0026quot;, \u0026quot;logic_revision\u0026quot;: 2, \u0026quot;logic_name\u0026quot;: \u0026quot;TEST-BACKUP-LOGIC\u0026quot;, \u0026quot;execution_id\u0026quot;: \u0026quot;Y3NtSqO4eboPm_oD_puy2A\u0026quot;, \u0026quot;task_id\u0026quot;: \u0026quot;WSCRLsEwGFGh6oAV4EqciA\u0026quot;, \u0026quot;timestamp\u0026quot;: 1668566827117, \u0026quot;sequence\u0026quot;: 2, \u0026quot;type\u0026quot;: \u0026quot;default\u0026quot;, \u0026quot;meta\u0026quot;: \u0026quot;\u0026quot;, \u0026quot;source_digital_identity\u0026quot;: \u0026quot;sourceDID\u0026quot;, \u0026quot;target_digital_identity\u0026quot;: \u0026quot;TargetDID\u0026quot;, \u0026quot;label_id\u0026quot;: \u0026quot;b428b5d9-df19-5bb9-a1dc-115e071b836c\u0026quot;, \u0026quot;label_name\u0026quot;: \u0026quot;test\u0026quot; } æŸ¥ä¸€ä¸‹ç¢ºèªä»–å¯«é€²å»äº†ï¼Œä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹ total\nPOST /system_search/_search ç›´æ¥è®“é€™å€‹ index æ¶ˆå¤±\nDELETE /system_search ç„¶å¾Œ restore ä»–å°±å›ä¾†äº†ï¼Œå¯ä»¥å† search ç¢ºèªè³‡æ–™ç„¡èª¤\nPOST /_snapshot/my_backup/system_search_snapshot/_restore?wait_for_completion=true Other notions ECK åœ¨ Latest 2.6 ç‰ˆæœ¬ï¼Œå®˜æ–¹æä¾›çš„ Kubernetes ç‰ˆæœ¬åªæœ‰ 1.21-1.25 æœ€æ–°çš„ 1.26 å‘¢ QQ\nhttps://www.elastic.co/guide/en/cloud-on-k8s/current/k8s_supported_versions.html\n","id":4,"section":"posts","summary":"Step by Step éƒ¨ç½² Elasticsearch å› ç‚ºæ¥ä¸‹ä¾†æœƒè®“å‚™ä»½æª”æ¡ˆå„²å­˜åœ¨ File System å…§ï¼Œæ‰€ä»¥å…ˆæº–å‚™ä¸€å€‹ PVC çµ¦ Elasticsearch kind: PersistentVolumeClaim apiVersion: v1 metadata: name: elasticsearch-snapshot spec: accessModes: - ReadWriteMany resources: requests: storage: 20Gi storageClassName: \u0026quot;fs-sc\u0026quot; é€™é‚Šç”¨ ECK (Elastic Cloud on Kubernetes) ä¾†å¬å–šä¸€çµ„æ–°çš„ Elas","tags":["elasticsearch"],"title":"Backup Elasticsearch index in File System","uri":"https://blog.10oz.tw/20230215-backup-elasticsearch-index-in-file-system/","year":"2023"},{"content":"æˆ‘çš„è¨­å®šæª”åœ¨é€™ æ–°çš„Neovim çš„è¨­å®šæª”ï¼Œæœ‰é™„ä¸Šä½¿ç”¨èªªæ˜æ­¡è¿çµ¦å»ºè­°æˆ–æ˜¯å¹«å¿™ Debug (?\né‚„æœ‰ä¸€å€‹ä»¥å‰ç”¨çš„ Vim è¨­å®šæª”ï¼Œä¸éæ²’æ€éº¼æ›´æ–°äº†\nåŸºæœ¬æ“ä½œ ç§»å‹•ä½ çš„æ¸¸æ¨™ w, W å¾€å‰åˆ°ä¸‹ä¸€å€‹å­—çš„å­—é¦–ï¼Œe, E ä¸‹ä¸€å€‹å­—çš„å­—å°¾ b, B å¾€å›åˆ°å‰ä¸€å€‹å­—çš„å­—é¦– $ è·³åˆ°è¡Œå°¾ 0 è·³åˆ°è¡Œé¦–ï¼Œ^ è·³åˆ°è©²è¡Œç¬¬ä¸€å€‹æ–‡å­—ï¼ˆä¸ç®— TAB æˆ–æ˜¯ç©ºç™½ï¼‰ {, } å¾€å‰/å¾Œè·³ä¸€å€‹æ®µè½ f ä¹‹å¾ŒæŒ‰ä»»æ„å­—å…ƒï¼Œè·³åˆ°è©²è¡Œä¸‹ä¸€å€‹çš„é‚£å€‹å­—å…ƒ f ä¹‹å¾ŒæŒ‰ä»»æ„å­—å…ƒï¼ŒæŒ‰ ; å†ä¸‹ä¸€å€‹ï¼ŒæŒ‰ , å›ä¸Šä¸€å€‹ C_o è·³å›ä¸Šä¸€å€‹éŠæ¨™çš„ä½ç½®ï¼Œ C_i è·³åˆ°ä¸‹ä¸€å€‹ C_d å‘ä¸‹æ»¾å‹•ï¼ŒC_u å‘ä¸Šæ»¾å‹• * æœå°‹ä¸¦å‰å¾€ä¸‹ä¸€å€‹ç›®å‰éŠæ¨™ä¸Šçš„å­—ï¼Œ:noh å–æ¶ˆ # æœå°‹ä¸¦å‰å¾€ä¸Šä¸€å€‹ç›®å‰éŠæ¨™ä¸Šçš„å­—ï¼Œ:noh å–æ¶ˆ è¤‡è£½è²¼ä¸Š p å¾€å¾Œè²¼ä¸Šï¼ŒP å¾€æ¸¸æ¨™å‰è²¼ä¸Š u æ˜¯ undo, C_r å† Redo å›å» ä¹Ÿå¯ä»¥ç”¨ \u0026quot; ç„¶å¾Œ a~z ä¾†æŒ‡å®šæš«å­˜å™¨ï¼Œä¾‹å¦‚ \u0026quot;ay è¤‡è£½ \u0026quot;ap è²¼ä¸Š d æ˜¯å‰ªä¸‹ï¼Œx å¯ä»¥å‰ªä¸‹éŠæ¨™ä¸Šçš„é‚£ä¸€å€‹å­— c å¯ä»¥åˆªé™¤é¸å–ä¸¦åŸåœ°é€²å…¥æ’å…¥æ¨¡å¼ï¼ŒC åˆªé™¤è©²è¡Œä»¥å¾Œä¸¦é€²å…¥æ’å…¥æ¨¡å¼ \u0026gt;\u0026gt; \u0026lt;\u0026lt; å¯ä»¥ç¸®æ’è©²è¡Œ å¯«å­—å›‰ i æ’å…¥æ¨¡å¼ I åœ¨è©²è¡Œç¬¬ä¸€å€‹å­—é€²å…¥æ’å…¥æ¨¡å¼ a åœ¨éŠæ¨™å¾Œé¢é€²å…¥æ’å…¥æ¨¡å¼ A åœ¨è¡Œæœ«é€²å…¥æ’å…¥æ¨¡å¼ o å‘ä¸‹ç”¢ç”Ÿæ–°ä¸€è¡Œé€²å…¥æ’å…¥æ¨¡å¼ O å‘ä¸Š s substitute ä»£æ›¿ï¼Œå‰ªä¸‹éŠæ¨™ä¸Šçš„å­—ä¸¦é€²å…¥æ’å…¥æ¨¡å¼ r å–ä»£ä¸€å€‹å­—å…ƒ æ’å…¥æ¨¡å¼ä¸‹çš„æ“ä½œ C-w åˆªé™¤éŠæ¨™å¾€å›çš„ä¸€å€‹å­— C-u åˆªé™¤éŠæ¨™å¾€å›çš„æ‰€æœ‰å­— Note: åœ¨ Bash ä¸‹å¾ˆå¤šæ“ä½œä¹Ÿé€šç”¨å–” https://github.com/tpope/vim-rsi åœ¨æª”æ¡ˆå–ä»£ %s %s/foo/bar/gc g æ˜¯å…¨éƒ¨ã€c æ˜¯ç¢ºèª æ¯”å‰›å‰›æ›´æœƒç§»å‹• æ¨™è¨˜æ¨¡å¼ m{a-zA-Z} æŒ‰ä¸€ä¸‹ m åŠ ä¸Šè‹±æ–‡å­—å°±å¯ä»¥åœ¨é‚£å€‹å­—ä¸Šæ¨™ç±¤ '{a-zA-Z} å–®å¼•è™ŸåŠ ä¸Šæ¨™ç±¤å°±é£›éå»é‚£ä¸€è¡Œå›‰ `{a-zA-Z} å–®å¼•è™ŸåŠ ä¸Šæ¨™ç±¤å°±é£›éå»æ¨™è¨˜çš„å­—å›‰ ä¸Šé¢å…©å€‹ä¹Ÿå¯ä»¥çµ„åˆåˆªé™¤ï¼Œd'a å°±æ˜¯åˆªé™¤åˆªåˆ° 'a çš„åœ°æ–¹ åˆªæ‰ä»– delm aA delete mark a and A é¸å–å¤§å¸« é¸å–æŠ€èƒ½ä¹‹æ’åˆ—çµ„åˆ å‹•ä½œé¡å‹ï¼š v visual é¸å– d delete å‰ªä¸‹ c change å‰ªä¸‹å¾Œæ’å…¥ y yank è¤‡è£½ ç¯„åœï¼š i inner é¸å–ç‰©ä»¶æ¢ä»¶ a around åŒ…å«é¸å–æ¢ä»¶ åè©æ¢ä»¶ï¼š w word s sentence p paragraph t tag (HTML, XML tags) '\u0026quot; å¼•è™Ÿ )]}\u0026gt; æ‹¬è™Ÿ viw é¸å–éŠæ¨™ä¸Šçš„å­— i=inner w=word ciw åŒä¸Šå‰ªä¸‹éŠæ¨™ä¸Šçš„å­—ä¸¦é€²å…¥æ’å…¥æ¨¡å¼ vi\u0026quot; é¸å– \u0026quot; ä¸­é–“çš„å­—ï¼Œ' ä¹Ÿå¯ä»¥ va\u0026quot; å·®åˆ¥æ˜¯æœƒåŒ…å«é›™å¼•è™Ÿ a=around åˆ‡åˆ†é (Tab) å›‰ vim -p æª”æ¡ˆå€‘ï¼ŒæŠŠä»–å€‘é–‹åˆ°æ–°åˆ†é  :e file.txt åœ¨åŒä¸€å€‹åˆ†é é–‹å•Ÿæ–°æª”æ¡ˆ :tabe é–‹æ–°åˆ†é  (å¯ä»¥ :w å­˜èµ·ä¾†) gt ä¸‹ä¸€å€‹åˆ†é ï¼Œ gT ä¸Šä¸€å€‹åˆ†é  :new åœ¨ä¸Šæ–¹ç”¢ç”Ÿæ°´å¹³åˆ†å‰² Windowsï¼Œ :vnew å‚ç›´åˆ†å‰² ä½ çš„ Buffer :ls 4 h \u0026quot;plugin-config.vim\u0026quot; line 3 5 %a \u0026quot;prelude.vim\u0026quot; line 50 6 h \u0026quot;[No Name]\u0026quot; line 1 7 #h \u0026quot;init.vim\u0026quot; line 5 14 h \u0026quot;filetypes.vim\u0026quot; line 0 15 h \u0026quot;clipboard.vim\u0026quot; line 1 16 h \u0026quot;[No Name]\u0026quot; line 0 Press ENTER or type command to continue :ls æŸ¥çœ‹åˆ†é å…§çš„ buffer å€‘ åˆ‡æ›åˆ†é  :b + æ•¸å­— å¯ä»¥åˆ‡æ›åˆ°æŒ‡å®š Bufferï¼Œä¾‹å¦‚ :b4 :b + éƒ¨åˆ†æª”æ¡ˆå ä¹Ÿå¯ä»¥åˆ‡æ›ï¼Œä¾‹å¦‚ :b init :bn go next buffer :bp go previous buffer :bl go last :bf go first :bd delete buffer å¸¸ç”¨æŒ‡ä»¤ æƒ³çœ‹ key mapping ä½ æ˜¯ä¸æ˜¯è¨­å®šäº†å¾ˆå¤š key mapping ä½†å¿˜è¨˜äº†å‘€ï¼Ÿ\n:map æˆ–æ˜¯æƒ³æŒ‡å®šæ¨¡å¼ä¹Ÿå¯ä»¥\n:nmap for normal mode mappings :vmap for visual mode mappings :imap for insert mode mappings è¼¸å‡ºå‡ºä¾†çœ‹çš„æ–¹æ³•\n:redir! \u0026gt; vim_keys.txt :silent verbose map :redir END ref: https://stackoverflow.com/a/15756785\nNerdTree è¦–çª—åˆ‡æ› C_w + [ä¸Šä¸‹å·¦å³] åˆ‡æ›åˆ° [ä¸Šä¸‹å·¦å³] çš„åˆ†å‰²è¦–çª— C_w + w åˆ‡æ›åˆ°ä¸‹ä¸€å€‹åˆ†å‰²è¦–çª— NerdTree è¦–çª— å°æª”æ¡ˆ t é–‹å•Ÿæ–°åˆ†é  å°æª”æ¡ˆ o é–‹å•Ÿæ–°åˆ†é ï¼Œä¸¦è·³éå» å°è³‡æ–™å¤¾ o å±•é–‹ / ç¸®åˆè³‡æ–™å¤¾ æŒ‰ä¸‹ m æœƒé€²å…¥æª”æ¡ˆç®¡ç†æ¨¡å¼ å†ä¾†æŒ‰ a å¯ä»¥æ–°å¢æª”æ¡ˆï¼ˆè³‡æ–™å¤¾çš„è©±å°±åœ¨å¾Œé¢åŠ ä¸€å€‹ /ï¼‰ Easy Motion é€™è£¡çš„ \u0026lt;leader\u0026gt;\u0026lt;Plug\u0026gt; éƒ½ç”¨ , ä¾†ç¤ºç¯„ï¼Œå› æ­¤æŒ‡ä»¤éƒ½æ˜¯ ,, é–‹é ­\nè·³åˆ°å­—å…ƒ ,,s search è·³åˆ°æœå°‹æ­¤å­—å…ƒçš„ä½ç½® ,,f å¾æ¸¸æ¨™å¾€ä¸‹ searchï¼Œè·³åˆ°æœå°‹æ­¤å­—å…ƒçš„ä½ç½® ,,F å¾æ¸¸æ¨™å¾€ä¸Š searchï¼Œè·³åˆ°æœå°‹æ­¤å­—å…ƒçš„ä½ç½® è·³åˆ°å­—é¦– ,,b å¾æ¸¸æ¨™å¾€ä¸‹ searchï¼Œè·³åˆ°æœå°‹æ­¤å­—é¦–çš„ä½ç½® ,,w å¾æ¸¸æ¨™å¾€ä¸Š searchï¼Œè·³åˆ°æœå°‹æ­¤å­—é¦–çš„ä½ç½® fzf.vim :Files æœå°‹æª”æ¡ˆåç¨± (ç¶å®šåˆ° \u0026lt;leader\u0026gt;ff) :Commands æœå°‹æŒ‡ä»¤åå¯èƒ½æ²’ä»€éº¼ç”¨XDD (ç¶å®šåˆ° \u0026lt;c-P\u0026gt;) vim-visual-multi c-n é¸å–éŠæ¨™ä¸Šçš„å­— æŒ‰ n N é¸å–ä¸‹/ä¸Šä¸€å€‹ç›¸åŒçš„å­— q è·³éä¸‹ä¸€å€‹é¸æ“‡ Q åˆªé™¤ç›®å‰é¸æ“‡ 3c-n é¸å–æ¥ä¸‹ä¾†çš„ 3 å€‹ \\\\A é¸å–æ–‡ä»¶ä¸Šå…¨éƒ¨éŠæ¨™ä¸Šçš„é‚£å€‹å­— C-mouseleft é¸å–é»æ“Šå­—å…ƒ C-mouseright é¸å–é»æ“Šå­— vim-fugitive æ›´æ–¹ä¾¿ä½¿ç”¨ Git çš„æ’ä»¶ï¼ŒGithub é€£çµ\nç”¨ :G ä¾†å‘¼å« git æŒ‡ä»¤ï¼Œä¾‹å¦‚èªª :G commit -m init commit :Git blame blame ä¸€ä¸‹éƒ½æ˜¯èª°å¯«äº†äº›ä»€éº¼ :Gvdiff å‘¼å«å‡ºæª”æ¡ˆæ›´æ–°å·®ç•° (å¥½åƒä¹Ÿå¯ä»¥è§£ Confilet) tpope/vim-surround å¿«é€Ÿæ·»åŠ å¼•è™Ÿ é¸å–å¾Œ S\u0026quot; ysiw\u0026quot; (yank surround inner word \u0026ldquo;) ç§»é™¤å¼•è™Ÿ ds\u0026quot; (delete surround \u0026ldquo;) æ›´æ”¹å¼•è™Ÿ cs'\u0026quot; (change surround \u0026rsquo; to \u0026ldquo;) å®‰è£ tpop/vim-repeat é”æˆç”¨ . é‡è¤‡æ“ä½œ Note: æ­é… visual multi çœŸé¦™ XDD https://youtu.be/wjoSbLGZTao?list=PLBd8JGCAcUAH56L2CYF7SmWJYKwHQYUDI\u0026amp;t=782 tomtom/tcomment_vim \u0026lt;C-/\u0026gt; \u0026lt;C-/\u0026gt; è¨»è§£æ‰æˆ–æ˜¯è§£é–‹ telescope.nvim Github Link\nRef https://github.com/wsdjeg/vim-galore-zh_cn Cheat Sheet https://vim.rtorr.com/lang/zh_tw\n","id":5,"section":"posts","summary":"æˆ‘çš„è¨­å®šæª”åœ¨é€™ æ–°çš„Neovim çš„è¨­å®šæª”ï¼Œæœ‰é™„ä¸Šä½¿ç”¨èªªæ˜æ­¡è¿çµ¦å»ºè­°æˆ–æ˜¯å¹«å¿™ Debug (? é‚„æœ‰ä¸€å€‹ä»¥å‰ç”¨çš„ Vim è¨­å®šæª”ï¼Œä¸éæ²’æ€éº¼æ›´æ–°äº† åŸºæœ¬æ“ä½œ ç§»å‹•ä½ çš„æ¸¸æ¨™ w,","tags":["vim","neovim"],"title":"å…¥å‘ Vim å­¸ç¿’ä½¿ç”¨ç­†è¨˜","uri":"https://blog.10oz.tw/20230103-use-vim/","year":"2023"},{"content":"æè¿° ç§æœ‰ AWS ECR ç™»å…¥æŒ‡ä»¤å¾ˆå¥½æ‰¾ï¼Œæ–‡ä»¶ä¸Šåˆ°è™•æœ‰\n$ aws ecr get-login-password \\ --region us-west-2 | docker login \\ --username AWS \\ --password-stdin \\ 000000000000.dkr.ecr.us-west-2.amazonaws.com ä½†æ˜¯ä½ çŸ¥é“å—ï¼Ÿ AWS çš„ Public Registry æ²’æœ‰åˆ†å€åŸŸï¼Œæ‰€ä»¥ä½ å¿…é ˆè¦æŒ‡å®š --region us-east-1 æ‰å¯ä»¥å”·\n$ aws ecr-public get-login-password \\ --region us-east-1 | docker login \\ --username AWS \\ --password-stdin \\ public.ecr.aws å¯«éŒ¯æˆ–æ˜¯æ²’å¯«ç”¨åˆ°é è¨­çš„è©±\n$ aws ecr get-login-password \\ --region us-west-2 | docker -l \u0026quot;debug\u0026quot; login \\ --username AWS \\ --password-stdin \\ public.ecr.aws Error response from daemon: login attempt to https://public.ecr.aws/v2/ failed with status: 400 Bad Request Ref https://stackoverflow.com/a/69274999/6695274\n","id":6,"section":"posts","summary":"æè¿° ç§æœ‰ AWS ECR ç™»å…¥æŒ‡ä»¤å¾ˆå¥½æ‰¾ï¼Œæ–‡ä»¶ä¸Šåˆ°è™•æœ‰ $ aws ecr get-login-password \\ --region us-west-2 | docker login \\ --username AWS \\ --password-stdin \\ 000000000000.dkr.ecr.us-west-2.amazonaws.com ä½†æ˜¯ä½ çŸ¥é“å—ï¼Ÿ AWS çš„ Public Registry æ²’æœ‰åˆ†å€åŸŸï¼Œæ‰€ä»¥ä½ å¿…é ˆè¦æŒ‡å®š --region us-east-1 æ‰å¯ä»¥å”· $ aws","tags":["aws","ecr","docker"],"title":"Hey! æˆ‘æƒ³ç™»å…¥ AWS ECR","uri":"https://blog.10oz.tw/20221028-logic-public-ecr/","year":"2022"},{"content":"å‰æƒ…æè¦ é€™æ˜¯ä¸€å°æ¶è¨­åœ¨ Kubernetes ä¸Šï¼Œä½¿ç”¨ Postgres Operator éƒ¨ç½²çš„å–®ç¯€é»è³‡æ–™åº«ï¼ŒSRE å¤§å¤§ç™¼ç¾ä»–çš„ç¡¬ç¢Ÿç©ºé–“æ»¿äº†ï¼Œè¶•å¿«ä¾†çœ‹ä¸€ä¸‹ ç”±æ–¼ç¡¬ç¢Ÿæ»¿äº† SQL Query ä¹Ÿä¸‹ä¸äº†ï¼Œæ–¼æ˜¯å…ˆå¹«ä»–åŠ äº† 2 GB çš„ pvã€‚\né€™æ˜¯ä»–çš„ log\n2022-01-27 03:09:49,785 INFO: Lock owner: None; I am MY_DB_NAME-0 2022-01-27 03:09:49,786 INFO: starting as a secondary 2022-01-27 03:09:50 UTC [413]: [1-1] 61f20cfe.19d 0 FATAL: could not write lock file \u0026quot;postmaster.pid\u0026quot;: No space left on device 2022-01-27 03:09:50,085 INFO: postmaster pid=413 /var/run/postgresql:5432 - no response 2022-01-27 03:09:50,102 WARNING: Postgresql is not running. 2022-01-27 03:09:50,102 INFO: Lock owner: None; I am MY_DB_NAME-0 2022-01-27 03:09:50,107 INFO: pg_controldata: pg_control version number: 1300 Catalog version number: 202007201 Database system identifier: 7024396656819753043 Database cluster state: in archive recovery pg_control last modified: Thu Jan 27 02:04:18 2022 Latest checkpoint location: 10/C800AA10 Latest checkpoint's REDO location: 10/C800A9D8 Latest checkpoint's REDO WAL file: 0000000900000010000000C8 Latest checkpoint's TimeLineID: 9 Latest checkpoint's PrevTimeLineID: 9 Latest checkpoint's full_page_writes: on Latest checkpoint's NextXID: 0:52538 Latest checkpoint's NextOID: 50198 Latest checkpoint's NextMultiXactId: 1 Latest checkpoint's NextMultiOffset: 0 Latest checkpoint's oldestXID: 479 Latest checkpoint's oldestXID's DB: 1 Latest checkpoint's oldestActiveXID: 52538 Latest checkpoint's oldestMultiXid: 1 Latest checkpoint's oldestMulti's DB: 1 Latest checkpoint's oldestCommitTsXid: 0 Latest checkpoint's newestCommitTsXid: 0 Time of latest checkpoint: Thu Jan 27 00:10:32 2022 Fake LSN counter for unlogged rels: 0/3E8 Minimum recovery ending location: 10/C9000000 Min recovery ending loc's timeline: 9 Backup start location: 0/0 Backup end location: 0/0 End-of-backup record required: no wal_level setting: replica wal_log_hints setting: on max_connections setting: 100 max_worker_processes setting: 8 max_wal_senders setting: 10 max_prepared_xacts setting: 0 max_locks_per_xact setting: 64 track_commit_timestamp setting: off Maximum data alignment: 8 Database block size: 8192 Blocks per segment of large relation: 131072 WAL block size: 8192 Bytes per WAL segment: 16777216 Maximum length of identifiers: 64 Maximum columns in an index: 32 Maximum size of a TOAST chunk: 1996 Size of a large-object chunk: 2048 Date/time type storage: 64-bit integers Float8 argument passing: by value Data page checksum version: 0 Mock authentication nonce: da09cd91aff4fc04822b4475aa0944dee4f3a297badcac611f47ff91071988b9 å¥åº·æª¢æŸ¥æ™‚é–“ ç¸½ä¹‹å…ˆ psql é€²å»è³‡æ–™åº« Query ä¸€äº›è³‡è¨Šå‡ºä¾†çœ‹çœ‹å§!\npg_database_size 9009 kB è€Œå·²å‘€å°‘å°‘\nSELECT pg_size_pretty(pg_database_size('YOUR_DB_NAME')); é€€å‡º psql ç›´æ¥çœ‹ä¸€ä¸‹å„²å­˜ç©ºé–“ï¼Œç™¼ç¾æ˜¯ WAL log å ç”¨æ‰äº†è³‡æºã€‚\ndu -h | sort -h å›åˆ° psql å†ä¾†æŸ¥çœ‹ä¸€ä¸‹ WAL çš„ç›¸é—œè¨­å®š\nSHOW ALL; -- æˆ–æ˜¯ SELECT * FROM pg_settings WHERE name LIKE '%wal%' æ³¨æ„åœ¨ PostgreSQL 13 å°‡ wal_keep_segments æ›æˆäº† wal_keep_sizeï¼Œä¸éåŸºæœ¬ä¸Šé‚„æ˜¯é¡ä¼¼åŠŸèƒ½çš„æ±è¥¿\nwal_keep_size = wal_keep_segments * wal_segment_size (typically 16MB) WAL çš„ SIZE è¨­å®šçœ‹ä¸Šå»æ²’æœ‰ç”šéº¼å•é¡Œï¼Œä¸éå¦å¤–ç™¼ç¾äº†ä»–çš„åŒæ­¥æ©Ÿåˆ¶æ˜¯é–‹å•Ÿçš„ï¼Œå› æ­¤åªé–‹äº†å–®å°çš„ Postgres æ²’è¾¦æ³•åŒæ­¥è®Šæ›´åˆ°å¦å¤–ä¸€å° Replicate\næŒ‰ç…§ Postgres Operator Issue é€™é‚Šå¯«çš„ï¼ŒæŠŠ archive_mode é—œæ‰å§!!!\næœŸå¾…æœ‰å¤§å¤§å¹«ä¿®é€™å¼µ Issueï¼Œåœ¨é€™ä¹‹å‰éƒ½è¦è‡ªå·±è¨˜å¾—å–” ğŸ‘\nRef https://isdaniel.github.io/postgresql-wal-introduce/\nhttps://kknews.cc/zh-tw/code/g4b4nny.html\nhttps://www.slideshare.net/wenchen3/postgre-sql-wal\nhttps://www.postgresql.fastware.com/blog/how-to-solve-the-problem-if-pg_xlog-is-full\nhttps://github.com/zalando/postgres-operator/issues/1664#issuecomment-961761544\n","id":7,"section":"posts","summary":"å‰æƒ…æè¦ é€™æ˜¯ä¸€å°æ¶è¨­åœ¨ Kubernetes ä¸Šï¼Œä½¿ç”¨ Postgres Operator éƒ¨ç½²çš„å–®ç¯€é»è³‡æ–™åº«ï¼ŒSRE å¤§å¤§ç™¼ç¾ä»–çš„ç¡¬ç¢Ÿç©ºé–“æ»¿äº†ï¼Œè¶•å¿«ä¾†çœ‹ä¸€ä¸‹ ç”±æ–¼ç¡¬ç¢Ÿæ»¿äº† SQL Query ä¹Ÿä¸‹ä¸äº†ï¼Œæ–¼æ˜¯å…ˆå¹«ä»–åŠ äº†","tags":["kubernetes","postgres"],"title":"ç­†è¨˜ Debug PostgreSQL WAL æ»¿ã„Œ","uri":"https://blog.10oz.tw/20220713-k8s-postgresql-wal-full/","year":"2022"},{"content":"ä¸€æ­¥ä¸€æ­¥çš„é–‹å§‹ å®‰è£ kuberbuilder https://github.com/kubernetes-sigs/kubebuilder/issues/2642 kuberbuilder åœ¨æ”¯æ´ 1.18 å‰çš„æº–å‚™\né¦–å…ˆä¸‹è¼‰ kuberbuilder\ncurl -L -o kubebuilder https://go.kubebuilder.io/dl/latest/$(go env GOOS)/$(go env GOARCH) chmod +x kubebuilder \u0026amp;\u0026amp; mv kubebuilder /usr/local/bin/ æˆ–æ˜¯ä½ ç™¼ç¾ Release ç‰ˆé‚„æ²’æ”¯æ´ Go version 1.18ï¼Œå¾ GitHub è‡ªå·±ç·¨è­¯æœ€æ–°ç‰ˆçš„ä¾†ç”¨\ngit clone https://github.com/kubernetes-sigs/kubebuilder.git cd kubebuilder make install Note: å¾Œä¾†ä¸ç”¨è·‘ make install å¯ä»¥ç”¨ make deploy å°±å¥½ï¼Œä»–æœƒåšæ›´å¤šçš„äº‹æƒ…ã€‚ä¸¦ä¸”æˆ‘æ³¨æ„åˆ°é€™å€‹ç‰ˆæœ¬çš„ make install ä¸æœƒå¹«ä½ å–ä»£ Cert manager çš„è®Šæ•¸ï¼Œä»–å¯ä»¥æç ¸ä½ çš„ CRD xDDD\né–‹æ–°å°ˆæ¡ˆå›‰ mkdir unagi cd unagi kubebuilder init --domain xiao.xiao --repo github.com/xiaoxiaosn/unagi Get controller runtime: $ go get sigs.k8s.io/controller-runtime@v0.12.1 Update dependencies: $ go mod tidy æ–°å¢ä½ è¦çš„ CRD go codeï¼Œæœƒå•ä½ è¦ä¸è¦å»º Resource è·Ÿ Controllerï¼Œæˆ‘å€‘ç•¶ç„¶é¸å€‹ y\nkubebuilder create api --group unagi --version v1 --kind UnagiLive Create Resource [y/n] y Create Controller [y/n] y æŠŠ CRD YAML å»ºç«‹å‡ºä¾†ï¼Œæœ‰ä¿®æ”¹ CRD å®šç¾©çš„è©±è¨˜å¾—é‡æ–°è·‘å€‹\nmake manifests åˆ° config/crd/bases/unagi.xiao.xiao_unagilives.yaml å¯ä»¥çœ‹åˆ°ä½ çš„ CRDï¼Œåœ¨ patches è£¡é¢ç”šè‡³æœ‰ conversion webhook å’Œ Cert Manager CA injection çš„ç¯„ä¾‹ï¼Œé€™éƒ¨åˆ†æ™šé»ç©\nåˆ° config/samples/unagi_v1_unagilive.yaml å¯ä»¥çœ‹åˆ°ç¯„ä¾‹ CR\napiVersion: unagi.xiao.xiao/v1 kind: UnagiLive metadata: name: unagilive-sample spec: # TODO(user): Add fields here æº–å‚™å¥½å¾Œé–‹å§‹å®‰è£ CRD åˆ° K8s ä¸­ï¼Œå¦‚æœç™¼ç¾ Kustomize å¤ªèˆŠäº†ä¸‹è¼‰ä¸åˆ°é‚£å¯ä»¥åƒè€ƒé€™é‚Šæ”¹å€‹æ•¸å­—\nexport KUSTOMIZE_VERSION=4.5.5 # or other version you want make install ä½ å¯ä»¥åœ¨ K8s ä¸­çœ‹åˆ°å‰›å‰›åŠ ä¸Šå»çš„ CRD\n$ kubectl get crd unagilives.unagi.xiao.xiao NAME CREATED AT unagilives.unagi.xiao.xiao 2022-06-26T15:42:17Z ä½ é‚„å¯ä»¥éƒ¨ç½² CR ä¸Šå»ç©ï¼Œç„¶å¾Œç”¨ kubectl get unagilive çœ‹ä»–\nkubectl apply -f config/samples/unagi_v1_unagilive.yaml ç‚ºäº†å°‡ Controller æ”¾åˆ° K8s ä¸­ï¼Œæˆ‘å€‘éœ€è¦åš docker image\n# make docker-build docker-push IMG=\u0026lt;some-registry\u0026gt;/\u0026lt;project-name\u0026gt;:tag make docker-build docker-push IMG=xiaoxiaosn/unagi:latest ç„¶å¾Œéƒ¨ç½²ä¸Šå»\n# make deploy IMG=\u0026lt;some-registry\u0026gt;/\u0026lt;project-name\u0026gt;:tag make deploy IMG=xiaoxiaosn/unagi:latest å¦‚æœä½ ç”¨ kind ä¹Ÿå¯ä»¥æä¾›ä¸€å€‹ä¸ç”¨ push çš„æ–¹æ³•ç›´æ¥ load\n# kind load docker-image \u0026lt;your-image-name\u0026gt;:tag --name \u0026lt;your-kind-cluster-name\u0026gt; kind load docker-image xiaoxiaosn/unagi:latest å°±é•·å‡ºä¾†å•¦\n$ kubectl get all -n unagi-system NAME READY STATUS RESTARTS AGE pod/unagi-controller-manager-7c99bd7fb7-9t6gr 2/2 Running 0 114s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/unagi-controller-manager-metrics-service ClusterIP 10.96.251.167 \u0026lt;none\u0026gt; 8443/TCP 114s NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/unagi-controller-manager 1/1 1 1 114s NAME DESIRED CURRENT READY AGE replicaset.apps/unagi-controller-manager-7c99bd7fb7 1 1 1 114s èªè­˜å°ˆæ¡ˆé–‹å§‹è·‘ æˆ‘å€‘ç¢ºå¯¦æœ‰äº†ä¸€å€‹æ¶æ§‹ï¼Œå†ä¾†æˆ‘å€‘è¦é–‹å§‹åŠ ä¸€äº›è‡ªå®šç¾©çš„è¡Œç‚ºï¼\nä¿®æ”¹ CRD é¦–å…ˆåˆ° api/v1/unagilive_type.go é€™é‚Šæœƒå®šç¾© UnagiLive é€™å€‹ CRD çš„ Specï¼Œæˆ‘å€‘åœ¨é€™é‚ŠåŠ å€‹å–œæ­¡çš„æ¬„ä½\næˆ‘å€‘å¸Œæœ›æˆ‘å€‘é¤Šçš„ Unagi æœ‰é¡è‰²è·Ÿå°ºå¯¸å¤§å°ï¼Œä¿®æ”¹ä¸€ä¸‹\n// UnagiLiveSpec defines the desired state of UnagiLive type UnagiLiveSpec struct { Color string `json:\u0026quot;color,omitempty\u0026quot;` Size string `json:\u0026quot;size,omitempty\u0026quot;` HasHorn bool `json:\u0026quot;hasHorn,omitempty\u0026quot;` } é‚„å¸Œæœ›çŸ¥é“é€™å€‹ CRD è¢« Controller è™•ç†çš„ç‹€æ³å¦‚ä½•\ntype UnagiLiveStatus struct { Status string `json:\u0026quot;status,omitempty\u0026quot;` // +optional ReconciledTime *metav1.Time `json:\u0026quot;reconciledTime,omitempty\u0026quot;` } å†åŠ å€‹ additionalPrinterColumns å› ç‚ºæƒ³ç”¨ kubectl çœ‹åˆ°æ›´å¤šè³‡è¨Šï½ Status å¤šäº†å€‹ priority å¤§æ–¼ 1 çš„ï¼Œå°±è¦ç”¨ -o wide æ‰çµ¦çœ‹\n// UnagiLive is the Schema for the unagilives API // +kubebuilder:printcolumn:name=\u0026quot;Status\u0026quot;,type=string,JSONPath=`.status.status`,description=\u0026quot;Unagi Status\u0026quot; // +kubebuilder:printcolumn:name=\u0026quot;Color\u0026quot;,type=string,JSONPath=`.spec.color`,description=\u0026quot;Unagi Color\u0026quot;,priority=1 type UnagiLive struct { metav1.TypeMeta `json:\u0026quot;,inline\u0026quot;` metav1.ObjectMeta `json:\u0026quot;metadata,omitempty\u0026quot;` Spec UnagiLiveSpec `json:\u0026quot;spec,omitempty\u0026quot;` Status UnagiLiveStatus `json:\u0026quot;status,omitempty\u0026quot;` } ä¿®æ”¹ Controller ä¾†åˆ° controllers/unagilive_controller.go\næˆ‘å€‘è¦æŠŠæ”¶åˆ°çš„ Unagi çµ¦è¨­å®š Statusï¼Œå¦å¤–ä¹Ÿå¢åŠ ä¸€äº› log æ–¹ä¾¿è§€å¯Ÿ\nfunc (r *UnagiLiveReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) { log := log.FromContext(ctx) log.Info(fmt.Sprintf(\u0026quot;Request: %+v\\n-----\\n\u0026quot;, req)) // Load the named UnagiLive object var unagiLive unagiv1.UnagiLive if err := r.Get(ctx, req.NamespacedName, \u0026amp;unagiLive); err != nil { log.Error(err, \u0026quot;unable to fetch unagiLive\u0026quot;) // we'll ignore not-found errors, since they can't be fixed by an immediate // requeue (we'll need to wait for a new notification), and we can get them // on deleted requests. return ctrl.Result{}, client.IgnoreNotFound(err) } log.Info(fmt.Sprintf(\u0026quot;Request unagiLive: %#v\\n-----\\n\u0026quot;, unagiLive)) unagiLive.Status.Status = \u0026quot;Reconciled\u0026quot; unagiLive.Status.ReconciledTime = \u0026amp;metav1.Time{Time: time.Now()} if err := r.Status().Update(ctx, \u0026amp;unagiLive); err != nil { log.Error(err, \u0026quot;unable to update unagiLive status\u0026quot;) return ctrl.Result{}, err } log.Info(\u0026quot;----- END -----\\n\\n\u0026quot;) return ctrl.Result{}, nil } é‡æ–°éƒ¨ç½² CRD å’Œ Controller\nmake manifest make docker-build docker-push IMG=xiaoxiaosn/unagi:latest kubectl rollout restart deploy -n unagi-system ç­‰ä»–è·‘å®Œå¾Œå¯ä»¥çœ‹åˆ°æˆ‘å€‘æ–°çš„ Controller è¨­å®šå¥½ Status äº†ï½\nkubectl get unagilive -oyaml apiVersion: v1 items: - apiVersion: unagi.xiao.xiao/v1 kind: UnagiLive metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026quot;apiVersion\u0026quot;:\u0026quot;unagi.xiao.xiao/v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;UnagiLive\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;name\u0026quot;:\u0026quot;unagilive-sample\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;unagi-system\u0026quot;},\u0026quot;spec\u0026quot;:null} creationTimestamp: \u0026quot;2022-06-26T16:20:15Z\u0026quot; generation: 3 name: unagilive-sample namespace: unagi-system resourceVersion: \u0026quot;3228189\u0026quot; uid: 0dfaee8d-4396-42e5-9df2-112c1c330f86 spec: color: meow status: reconciledTime: \u0026quot;2022-06-26T19:34:27Z\u0026quot; status: Reconciled kind: List metadata: resourceVersion: \u0026quot;\u0026quot; selfLink: \u0026quot;\u0026quot; å¬å–š Admission webhook å¯ä»¥å¾ kuberbuilder create webhook --help çœ‹åˆ°ç”¨æ³•ï¼ˆdefaulting webhook ä»–å°±æ˜¯ mutating webhookï¼‰\n--defaulting if set, scaffold the defaulting webhook --programmatic-validation if set, scaffold the validating webhook kubebuilder create webhook --group unagi --version v1 --kind UnagiLive --defaulting --programmatic-validation æˆ‘å€‘å»ºç«‹å¥½äº†å…©ä¹‹ Admission webhooks (mutating and validation)ï¼Œå¯ä»¥åˆ° api/v1/unagilive_webhook.go å»çœ‹ä¸€ä¸‹ä¸»è¦çš„é‚è¼¯\næˆ‘å€‘ä¿®æ”¹ Mutating webhook çš„ Default functionï¼Œè®“æˆ‘å€‘çš„ resource é€²ä¾†æ™‚ï¼Œæœƒå…ˆç…§æˆ‘å€‘çš„é‚è¼¯åšä¸€æ¬¡æ”¹è®Š\n// Default implements webhook.Defaulter so a webhook will be registered for the type func (r *UnagiLive) Default() { unagilivelog.Info(\u0026quot;default\u0026quot;, \u0026quot;name\u0026quot;, r.Name) // æ²’æœ‰å¡«å¯«çš„è©±é è¨­æ˜¯ `m` å°ºå¯¸ if r.Spec.Size == \u0026quot;\u0026quot; { r.Spec.Size = \u0026quot;m\u0026quot; } // æ²’æœ‰å¡«å¯«çš„è©±é è¨­æ˜¯é»ƒè‰² if r.Spec.Color == \u0026quot;\u0026quot; { r.Spec.Color = \u0026quot;yellow\u0026quot; } } validating çš„ Admission webhook å‰‡æœ‰ Create, Update and Delete ä¸‰ç¨®ï¼Œåˆ†åˆ¥å°æ‡‰åˆ°è³‡æºçš„æ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤ï¼Œæª¢æŸ¥æ–°çš„ resource ä»¥åŠè®ŠåŒ–æ˜¯å¦ç¬¦åˆé æœŸï½\nä¾‹å¦‚æˆ‘å€‘å¯ä»¥é™åˆ¶å°ºå¯¸æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼\n// ValidateUpdate implements webhook.Validator so a webhook will be registered for the type func (r *UnagiLive) ValidateUpdate(old runtime.Object) error { unagilivelog.Info(\u0026quot;validate update\u0026quot;, \u0026quot;name\u0026quot;, r.Name) oldSize := old.(*UnagiLive).Spec.Size newSize := r.Spec.Size if newSize != oldSize { return fmt.Errorf(\u0026quot;cannot change size after creation. try from `%s` update to `%s`\u0026quot;, oldSize, newSize) } return nil } å†ä¾†ä¾†åˆ° config/webhook/manifests.yaml çœ‹ä¸€ä¸‹ resource çš„å®šç¾©ï¼ŒåŒ…å«äº†èªªè¦ç›£è½å“ªä¸€äº› resource çš„å“ªä¸€äº›è¡Œç‚ºï¼Œç„¶å¾Œè¦æ›å“ªè£¡çš„ webhook\n--- apiVersion: admissionregistration.k8s.io/v1 kind: MutatingWebhookConfiguration metadata: creationTimestamp: null name: mutating-webhook-configuration webhooks: - admissionReviewVersions: - v1 clientConfig: service: name: webhook-service namespace: system path: /mutate-unagi-xiao-xiao-v1-unagilive failurePolicy: Fail name: munagilive.kb.io rules: - apiGroups: - unagi.xiao.xiao apiVersions: - v1 operations: - CREATE - UPDATE resources: - unagilives sideEffects: None --- apiVersion: admissionregistration.k8s.io/v1 kind: ValidatingWebhookConfiguration metadata: creationTimestamp: null name: validating-webhook-configuration webhooks: - admissionReviewVersions: - v1 clientConfig: service: name: webhook-service namespace: system path: /validate-unagi-xiao-xiao-v1-unagilive failurePolicy: Fail name: vunagilive.kb.io rules: - apiGroups: - unagi.xiao.xiao apiVersions: - v1 operations: - CREATE - UPDATE resources: - unagilives sideEffects: None æº–å‚™éƒ¨ç½²ä¸Šå»ç©ç© è¨˜å¾—ç¢ºä¿ä½ æœ‰ Cert Manager å–”ï¼Œæˆ‘å€‘æœƒç”¨åˆ°å®ƒçš„ webhook ä¾†å¹«å¿™ä½ æ³¨å…¥ CA Bundle\nåˆ° config/default/kustomization.yaml ç¢ºèªä¸€ä¸‹ï¼Œé€™äº›é¸é …è¦é–‹ (ä¸»è¦éƒ½æ˜¯ Cert Manager \u0026amp;\u0026amp; Webhook çš„éƒ¨åˆ†)\nbases: # [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in # crd/kustomization.yaml - ../webhook # [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'. 'WEBHOOK' components are required. - ../certmanager patchesStrategicMerge: # [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in # crd/kustomization.yaml - manager_webhook_patch.yaml # [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'. # Uncomment 'CERTMANAGER' sections in crd/kustomization.yaml to enable the CA injection in the admission webhooks. # 'CERTMANAGER' needs to be enabled to use ca injection - webhookcainjection_patch.yaml # the following config is for teaching kustomize how to do var substitution vars: # [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER' prefix. - name: CERTIFICATE_NAMESPACE # namespace of the certificate CR objref: kind: Certificate group: cert-manager.io version: v1 name: serving-cert # this name should match the one in certificate.yaml fieldref: fieldpath: metadata.namespace - name: CERTIFICATE_NAME objref: kind: Certificate group: cert-manager.io version: v1 name: serving-cert # this name should match the one in certificate.yaml - name: SERVICE_NAMESPACE # namespace of the service objref: kind: Service version: v1 name: webhook-service fieldref: fieldpath: metadata.namespace - name: SERVICE_NAME objref: kind: Service version: v1 name: webhook-service é‚„æœ‰ config/crd/kustomization.yaml çš„é€™äº›\npatchesStrategicMerge: # [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix. # patches here are for enabling the conversion webhook for each CRD - patches/webhook_in_unagilives.yaml #+kubebuilder:scaffold:crdkustomizewebhookpatch # [CERTMANAGER] To enable cert-manager, uncomment all the sections with [CERTMANAGER] prefix. # patches here are for enabling the CA injection for each CRD - patches/cainjection_in_unagilives.yaml #+kubebuilder:scaffold:crdkustomizecainjectionpatch æ”¹å¥½ kustomizate å¾Œï¼Œä¾†éƒ¨ç½²åŸºæœ¬è·Ÿå‰›å‰›ä¸€æ¨£\n# make docker-build docker-push IMG=\u0026lt;some-registry\u0026gt;/\u0026lt;project-name\u0026gt;:tag make docker-build docker-push IMG=xiaoxiaosn/unagi:latest # make deploy IMG=\u0026lt;some-registry\u0026gt;/\u0026lt;project-name\u0026gt;:tag make deploy IMG=xiaoxiaosn/unagi:latest çœ‹ä¸€ä¸‹æˆæœï¼Œå¤šäº†ä¸€å€‹ service å¾åŒä¸€å€‹ controller-manager å°å‡ºåˆ° admission webhook é è¨­çš„ 443 port\n$ kubectl get po,svc NAME READY STATUS RESTARTS AGE pod/unagi-controller-manager-6c779679c6-w266v 2/2 Running 0 98s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/unagi-controller-manager-metrics-service ClusterIP 10.96.251.167 \u0026lt;none\u0026gt; 8443/TCP 3d23h service/unagi-webhook-service ClusterIP 10.96.96.235 \u0026lt;none\u0026gt; 443/TCP 98s æˆæœé©—æ”¶ ä¾†éƒ¨ç½²é€™å€‹ï¼Œé æœŸå¯ä»¥çœ‹åˆ° mutating webhook çµ¦æˆ‘å€‘ä¸Š default æ•¸å€¼\napiVersion: unagi.xiao.xiao/v1 kind: UnagiLive metadata: name: try-admission-webhook namespace: unagi-system spec: {} ä½¿ç”¨ kubectl get unagilive try-admission-webhook -oyaml æ‹¿å›ä¾†çœ‹ï¼Œæœƒç™¼ç¾ spec è¢«è²¼ä¸Šé è¨­å€¼å•¦ï½ ä¸”åŸæœ¬åœ¨è¢«ä¿®æ”¹å‰çš„æ•¸å€¼ä¹Ÿè¢«æ›´æ–°åˆ° annotations.kubectl.kubernetes.io/last-applied-configuration è£¡é¢\napiVersion: unagi.xiao.xiao/v1 kind: UnagiLive metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026quot;apiVersion\u0026quot;:\u0026quot;unagi.xiao.xiao/v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;UnagiLive\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;name\u0026quot;:\u0026quot;try-admission-webhook\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;unagi-system\u0026quot;},\u0026quot;spec\u0026quot;:{}} creationTimestamp: \u0026quot;2022-06-30T15:46:03Z\u0026quot; generation: 1 name: try-admission-webhook namespace: unagi-system resourceVersion: \u0026quot;3718189\u0026quot; uid: 77c4d9c1-ef32-49d9-b106-ebdf8889baee spec: color: red size: m hasHorn: true status: reconciledTime: \u0026quot;2022-06-30T15:46:03Z\u0026quot; status: Reconciled å†ä¾†çœ‹èˆŠçš„ resourceï¼Œç”±æ–¼ä»–æ—©å°±åœ¨ Kubernetes å…§äº†ï¼Œå› æ­¤æ²’æœ‰ç¶“é webhookï¼Œé‚„æ˜¯ä¿æŒåŸæœ¬çš„æ¨¡æ¨£\nå…ˆæŠŠå®ƒæ‹¿å‡ºä¾†çœ‹ kubectl get unagilive unagilive-sample -oyamlï¼Œé€™æ˜¯ä¸€å€‹æ²’æœ‰å¡«å¯« size çš„ CRï¼Œå¾Œé¢\napiVersion: unagi.xiao.xiao/v1 kind: UnagiLive metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026quot;apiVersion\u0026quot;:\u0026quot;unagi.xiao.xiao/v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;UnagiLive\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;name\u0026quot;:\u0026quot;unagilive-sample\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;unagi-system\u0026quot;},\u0026quot;spec\u0026quot;:null} creationTimestamp: \u0026quot;2022-06-26T16:20:15Z\u0026quot; generation: 3 name: unagilive-sample namespace: unagi-system resourceVersion: \u0026quot;3717289\u0026quot; uid: \u0026quot;0dfaee8d-4396-42e5-9df2-112c1c330f86\u0026quot; spec: color: meow status: reconciledTime: \u0026quot;2022-06-30T15:39:37Z\u0026quot; status: Reconciled ç„¶å¾Œæ”¹ä»– kubectl edit unagilive unagilive-sampleï¼Œçµæœç™¼ç¾ç„¡æ³•ä¿®æ”¹ï¼ï¼\nerror: unagilives.unagi.xiao.xiao \u0026quot;unagilive-sample\u0026quot; could not be patched: admission webhook \u0026quot;vunagilive.kb.io\u0026quot; denied the request: cannot change size after creation. try from `` update to `m` åŸä¾†æ˜¯æˆ‘å€‘å‰›å‰›çš„ mutating webhook çš„é è¨­å€¼è·Ÿ validation webhook çš„ä¸å¯è®Šæ›´æª¢æŸ¥è¡çªäº†å‘€\næš«æ™‚æŠŠ validating webhook çµ¦åˆªäº† (? webhook é‚è¼¯æ‡‰è©²ä¿®æ”¹ä¸€ä¸‹ï¼Œç‰¹ä¾‹å…è¨±å¾ç©ºå€¼æ›´æ”¹æˆé è¨­å€¼ m æˆ‘å€‘å¯èƒ½éœ€è¦è¿­ä»£æ–°ç‰ˆæœ¬çš„ CRD Multiple versions CRD ä½¿ç”¨å’Œç”¢ç”Ÿç¬¬ä¸€å€‹ v1 æ™‚ç›¸åŒçš„æ–¹å¼ä¾†ç”¢ç”Ÿ v2ï¼Œé€™æ¬¡ Resource é¸ y è€Œç¬¬äºŒå€‹é¸é …çš„ Controller å› ç‚ºå·²ç¶“æœ‰äº†æ‰€ä»¥è¦é¸ nï¼Œä¸ç„¶æœƒå¤±æ•—ï¼\nkubebuilder create api --group unagi --version v2 --kind UnagiLive Create Resource [y/n] y Create Controller [y/n] n æ¥ä¸‹ä¾†æ¯”è¼ƒéº»ç…©ï¼Œæœ‰ä¸å°‘åœ°æ–¹è¦ç•™æ„\né¦–å…ˆæˆ‘å€‘è¦ç‚ºæˆ‘å€‘æ–°ç‰ˆæœ¬çš„ UnagiLive å®šç¾©çµæ§‹å½¢ç‹€ï¼Œç§»å‹•åˆ°api/v2/unagilive_type.goï¼Œåƒè€ƒ v1 æ›´æ”¹é è¨­ç”¢ç”Ÿçš„ Spec, Statusï¼Œé€™æ¬¡æˆ‘å¢åŠ äº†ä¸€å€‹ Speed æ¬„ä½ï¼Œæˆ‘å¸Œæœ› Unagi æœ‰ç§»å‹•é€Ÿåº¦å¯ä»¥è¨­å®šï½\n// UnagiLiveSpec defines the desired state of UnagiLive type UnagiLiveSpec struct { Color string `json:\u0026quot;color,omitempty\u0026quot;` Size string `json:\u0026quot;size,omitempty\u0026quot;` HasHorn bool `json:\u0026quot;hasHorn,omitempty\u0026quot;` Speed int `json:\u0026quot;speed\u0026quot;` } // UnagiLiveStatus defines the observed state of UnagiLive type UnagiLiveStatus struct { Status string `json:\u0026quot;status,omitempty\u0026quot;` // +optional ReconciledTime *metav1.Time `json:\u0026quot;reconciledTime,omitempty\u0026quot;` } å› ç‚ºæˆ‘å€‘çš„ CRD æœ‰äº†å¤šç‰ˆæœ¬ï¼Œæˆ‘å€‘è¦æŒ‡å®šåœ¨ etcd ä¸­çš„å¯¦éš›å„²å­˜ç‰ˆæœ¬ï¼Œæˆ‘å€‘åœ¨api/v2/unagilive_types.go åŠ ä¸Šé€™è¡Œï¼ˆæˆ–æ˜¯ä½ æƒ³åŠ åœ¨ v1 ä¹Ÿå¯ä»¥çš„ï¼‰\n//+kubebuilder:storageversion æ›´å¤š kubebuilder çš„é¸é …å¯ä»¥åƒè€ƒæ–‡ä»¶\né€™æ¨£å­åŸºæœ¬çš„å®šç¾©å°±å®Œæˆäº†ï¼Œä¸éç‰ˆæœ¬ç™¼ç”Ÿæ”¹è®Šæ™‚è¦æ€éº¼åŒæ™‚å…¼å®¹æ–°ç‰ˆå’ŒèˆŠç‰ˆï¼Ÿ æ‰€ä»¥éœ€è¦æœ‰äººä¾†è² è²¬åšé€™å€‹ä¸åŒç‰ˆæœ¬ä¹‹é–“çš„è½‰æ›å™¨ï¼Œé€™å€‹è§’è‰²å°±æ˜¯ conversion webhook\nç„¶è€Œæˆ‘å€‘é¦¬ä¸Šå°±æœƒé‡åˆ°ä¸€å€‹å•é¡Œï¼šå¦‚æœæˆ‘å€‘æœ‰ $n$ å€‹ versionsï¼Œå…¼å®¹æ‰€æœ‰è½‰æ›æ˜¯ä¸æ˜¯è¡¨ç¤ºæˆ‘å€‘å°±è¦æœ‰ $n* (n-1)$ é€™éº¼å¤šå€‹å‘¢ï¼Ÿ\nåœ¨ kubebuilder çš„æ¦‚å¿µä¸­å¤šæº–å‚™äº†ä¸€å€‹ Hub çš„è§’è‰²ï¼Œæ‰€æœ‰çš„è½‰æ›éƒ½å…ˆç¶“é Hub åœ¨è½‰æ›æˆå…¶ä»–çš„ç‰ˆæœ¬ ä¾‹å¦‚èªªæƒ³è¦å¾ v2 è½‰æˆ v3ï¼Œè€Œç›®å‰çš„å„²å­˜ç‰ˆæœ¬æ˜¯ v1 çš„æ™‚å€™æœƒåƒæ˜¯ v2 -\u0026gt; hub(v1) -\u0026gt; v3 ç†è§£å®Œå¾Œæˆ‘å€‘ä¾†å¯¦ä½œï¼Œä½¿ç”¨ kubebuilder å»ºç«‹ storaged version æ˜¯ v1 çš„ webhook æœå‹™ Code\nkubebuilder create webhook --group unagi --version v1 --kind UnagiLive --conversion ä¾†é–‹ä¸€å€‹ api/v1/unagilive_convetion.go æˆ‘å€‘è¦åœ¨é€™é‚Šå®£å‘Šä»–æ˜¯ Hub æˆ–æ˜¯ä¸€å€‹ Convertibleï¼Œåœ¨é€™è£¡å› ç‚º v1 æ˜¯ storaged version æ‰€ä»¥çµ¦ä»–å€‹ Hub\npackage v1 /* Implementing the hub method is pretty easy -- we just have to add an empty method called `Hub()` to serve as a [marker](https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/conversion?tab=doc#Hub). We could also just put this inline in our `cronjob_types.go` file. */ // Hub marks this type as a conversion hub. func (*UnagiLive) Hub() {} å†ä¾†åˆ° api/v2/unagilive_convetion.go å¹«å¥¹å¯¦ä½œå¾ Hub éä¾†çš„é‚è¼¯ï¼Œä»–æ˜¯ä¸€å€‹ Convertible\npackage v2 /* For imports, we'll need the controller-runtime [`conversion`](https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/conversion?tab=doc) package, plus the API version for our hub type (v1), and finally some of the standard packages. */ import ( \u0026quot;sigs.k8s.io/controller-runtime/pkg/conversion\u0026quot; v1 \u0026quot;github.com/xiaoxiaosn/unagi/api/v1\u0026quot; ) // +kubebuilder:docs-gen:collapse=Imports /* Our \u0026quot;spoke\u0026quot; versions need to implement the [`Convertible`](https://pkg.go.dev/sigs.k8s.io/controller-runtime/pkg/conversion?tab=doc#Convertible) interface. Namely, they'll need `ConvertTo` and `ConvertFrom` methods to convert to/from the hub version. */ /* ConvertTo is expected to modify its argument to contain the converted object. Most of the conversion is straightforward copying, except for converting our changed field. */ // ConvertTo converts this UnagiLive to the Hub version (v1). func (src *UnagiLive) ConvertTo(dstRaw conversion.Hub) error { dst := dstRaw.(*v1.UnagiLive) // Spec dst.Spec.Color = src.Spec.Color dst.Spec.Size = src.Spec.Size dst.Spec.HasHorn = src.Spec.HasHorn // Status dst.Status.Status = src.Status.Status dst.Status.ReconciledTime = src.Status.ReconciledTime // +kubebuilder:docs-gen:collapse=rote conversion return nil } /* ConvertFrom is expected to modify its receiver to contain the converted object. Most of the conversion is straightforward copying, except for converting our changed field. */ // ConvertFrom converts from the Hub version (v1) to this version. func (dst *UnagiLive) ConvertFrom(srcRaw conversion.Hub) error { src := srcRaw.(*v1.UnagiLive) // Spec dst.Spec.Color = src.Spec.Color dst.Spec.Size = src.Spec.Size dst.Spec.HasHorn = src.Spec.HasHorn if src.Spec.Color == \u0026quot;red\u0026quot; \u0026amp;\u0026amp; src.Spec.HasHorn { dst.Spec.Speed = 3 } else { dst.Spec.Speed = 1 } // Status dst.Status.Status = src.Status.Status dst.Status.ReconciledTime = src.Status.ReconciledTime // +kubebuilder:docs-gen:collapse=rote conversion return nil } åœ¨ä¸Šè¿°çš„è½‰æ›é‚è¼¯ä¸­ï¼Œå› ç‚º v2 å¤šäº†ä¸€å€‹ Speed æ¬„ä½ï¼Œè€Œ v1 åˆ° v2 åˆæ²’æœ‰é€™å€‹æ¬„ä½ï¼Œå› æ­¤çµ¦ä»–ä¸€å€‹é‚è¼¯ï¼Œç•¶ä½ æ˜¯ç´…è‰²æœ‰è§’æ™‚ï¼Œä½ çš„é€Ÿåº¦å°±æ˜¯ 3 å€ã€‚\næº–å‚™éƒ¨ç½² ä¾†åˆ° config é€™é‚ŠæŠŠè¨»è§£æ‰çš„éƒ¨åˆ†æ‰“é–‹\nåˆ° config/crd/kustomization.yaml æ‰“é–‹ patches/webhook_in_\u0026lt;kind\u0026gt;.yaml å’Œ patches/cainjection_in_\u0026lt;kind\u0026gt;.yamlï¼Œä½ ä¹Ÿå¯èƒ½å·²ç¶“åœ¨ Admission webhook ä¸­é–‹éäº† åˆ° config/default/kustomization.yaml æ‰“é–‹ bases åº•ä¸‹çš„ ../certmanager å’Œ ../webhook æ‰“é–‹ patchesStrategicMerge åº•ä¸‹çš„ manager_webhook_patch.yaml å’Œ webhookcainjection_patch.yaml æ‰“é–‹ CERTMANAGER ä¸‹çš„æ‰€æœ‰åƒæ•¸ å®‰è£ä¸‹å»\nmake docker-build docker-push IMG=xiaoxiaosn/unagi:latest make deploy IMG=xiaoxiaosn/unagi:latest # kubectl rollout restart deployment.apps/unagi-controller-manager è¦‹è­‰æ›´æ”¹ é¦–å…ˆç›´æ¥ get æœƒç™¼ç¾ä»–çµ¦çš„ v2 çš„ç‰ˆæœ¬ï¼Œkubectl æœƒè‡ªå‹•å»æŠ“å„ªå…ˆç´šæœ€é«˜çš„ç‰ˆæœ¬ï¼Œ\nkubectl get unagilive kubectl get UnagiLive.v1.unagi.xiao.xiao å¦‚é æœŸèˆ¬æ‹¿åˆ°è½‰æ›éå¾Œçš„ç‰ˆæœ¬ ï¼šï¼‰\nRef https://book.kubebuilder.io/quick-start.html https://mp.weixin.qq.com/s/Y0GwLgz9o2HONkl4FJdlVQ https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum\u0026amp;album_id=1851829124558848001\nTutorial https://github.com/kubernetes-sigs/kubebuilder/tree/master/docs/book/src\nhttps://www.cnblogs.com/charlieroro/p/15960829.html\n","id":8,"section":"posts","summary":"ä¸€æ­¥ä¸€æ­¥çš„é–‹å§‹ å®‰è£ kuberbuilder https://github.com/kubernetes-sigs/kubebuilder/issues/2642 kuberbuilder åœ¨æ”¯æ´ 1.18 å‰çš„æº–å‚™ é¦–å…ˆä¸‹è¼‰ kuberbuilder curl -L -o kubebuilder https://go.kubebuilder.io/dl/latest/$(go env GOOS)/$(go env GOARCH) chmod +x kubebuilder \u0026amp;\u0026amp; mv kubebuilder /usr/local/bin/ æˆ–æ˜¯ä½ ç™¼ç¾ Release ç‰ˆé‚„æ²’æ”¯æ´ Go version 1.18ï¼Œå¾ GitHub è‡ªå·±ç·¨è­¯æœ€æ–°ç‰ˆçš„ä¾†","tags":["kubernetes","crd","operator"],"title":"kubebuilder æ—…ç¨‹","uri":"https://blog.10oz.tw/20220723-kubebuilder/","year":"2022"},{"content":"ç‰ˆæœ¬å„ªå…ˆç´š åœ¨ K8s è£¡é¢æœ‰ preferred versionï¼Œæœƒé¸å„ªå…ˆå€¼æœ€é«˜çš„ä¾†åšç‚ºé è¨­å€¼\nè¦å‰‡ \u0026quot;^v([\\\\d]+)(?:(alpha|beta)([\\\\d]+))?$\u0026quot;\nv{ä¸»ç‰ˆæœ¬}alpha|beta{å‰¯ç‰ˆæœ¬}\nåªæœ‰ v é–‹é ­çš„ç©©å®šç‰ˆ(GA)æœ€å…ˆå„ªå…ˆï¼Œä¸»è¦ç‰ˆæœ¬å¤§çš„å„ªå…ˆåº¦æœ€é«˜ã€‚ å†ä¾†æ˜¯ beta å’Œ alpha ç¬¬ä¸‰å€‹æ¯”è¼ƒ beta alpha ä¸‹çš„å‰¯ç‰ˆæœ¬ æœ€å¾Œå…¶ä»–çš„ case å°±æ˜¯æŒ‰ç…§å­—æ¯æ’åº strings.Compare (lexicographically)\nåƒè€ƒé€™å€‹ç¯„ä¾‹å¯ä»¥æ›´å®¹æ˜“ç†è§£\n- v10 // GA(General availability) 10 - v2 // GA 2 - v1 // GA 1 - v11beta2 // GA 11 + beta 2 - v10beta3 // GA 10 + beta 3 - v3beta1 // GA 3 + beta 1 - v12alpha1 // GA 12 + alpha 1 - v11alpha2 // GA 11 + alpha 2 - foo1 // ç”¨å­—å…¸é †åºæ’ - foo10 // ç”¨å­—å…¸é †åºæ’ è¦å‰‡ Code https://github.com/kubernetes/kubernetes/blob/v1.24.2/staging/src/k8s.io/apimachinery/pkg/version/helpers.go#L34\nAPIGroup version æˆ‘å€‘æœ‰ä¸€å€‹ group å«åš group.nameï¼Œå¯ä»¥çœ‹åˆ°ä»–æœƒå„ªå…ˆæ¡ç”¨ v2\nkc proxy \u0026amp; curl localhost:8001/apis/group.name { \u0026quot;kind\u0026quot;: \u0026quot;APIGroup\u0026quot;, \u0026quot;apiVersion\u0026quot;: \u0026quot;v1\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;group.name\u0026quot;, \u0026quot;versions\u0026quot;: [ { \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v2\u0026quot;, \u0026quot;version\u0026quot;: \u0026quot;v2\u0026quot; }, { \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v1\u0026quot;, \u0026quot;version\u0026quot;: \u0026quot;v1\u0026quot; } ], \u0026quot;preferredVersion\u0026quot;: { \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v2\u0026quot;, \u0026quot;version\u0026quot;: \u0026quot;v2\u0026quot; } } æœƒç›´æ¥å½±éŸ¿åˆ° kubectl çš„çµæœï¼Œç›´æ¥ get æœƒæ‹¿åˆ° v2 æˆ‘å€‘çš„ group.name åº•ä¸‹æœ‰ kind Cat\n$ kc get cats my-cat -oyaml apiVersion: group.name/v2 kind: Cat metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026quot;apiVersion\u0026quot;:\u0026quot;group.name/v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;Cat\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;name\u0026quot;:\u0026quot;my-cat\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;default\u0026quot;},\u0026quot;spec\u0026quot;:{\u0026quot;age\u0026quot;:18,\u0026quot;color\u0026quot;:\u0026quot;#009920\u0026quot;}} creationTimestamp: \u0026quot;2022-07-11T17:35:17Z\u0026quot; generation: 1 name: my-cat namespace: default resourceVersion: \u0026quot;5111716\u0026quot; uid: 388993d7-2075-406d-9668-4baec92d1562 spec: color: '#009920' ä¸éæˆ‘å€‘ä¹Ÿå¯ä»¥æŒ‡å®š kind.version.group å»æ‹¿æŒ‡å®šç‰ˆæœ¬çš„è³‡æº\n$ kc get cats.v1.group.name my-cat -oyaml apiVersion: group.name/v1 kind: Cat metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026quot;apiVersion\u0026quot;:\u0026quot;group.name/v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;Cat\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;name\u0026quot;:\u0026quot;my-cat\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;default\u0026quot;},\u0026quot;spec\u0026quot;:{\u0026quot;age\u0026quot;:18,\u0026quot;color\u0026quot;:\u0026quot;#009920\u0026quot;}} creationTimestamp: \u0026quot;2022-07-11T17:35:17Z\u0026quot; generation: 1 name: my-cat namespace: default resourceVersion: \u0026quot;5111716\u0026quot; uid: 388993d7-2075-406d-9668-4baec92d1562 spec: age: 18 color: '#009920' å¦å¤–ï¼Œkubectl æœ‰ cache æˆ‘å€‘ä¹Ÿå¯ä»¥å»æ¬ºé¨™ä»–ï¼ˆï¼Ÿ\nvim ~/.kube/cache/discovery/127.0.0.1_58359/servergroups.json { \u0026quot;name\u0026quot;: \u0026quot;group.name\u0026quot;, \u0026quot;versions\u0026quot;: [ { \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v2\u0026quot;, \u0026quot;version\u0026quot;: \u0026quot;v2\u0026quot; }, { \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v1\u0026quot;, \u0026quot;version\u0026quot;: \u0026quot;v1\u0026quot; } ], \u0026quot;preferredVersion\u0026quot;: { - \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v2\u0026quot;, - \u0026quot;version\u0026quot;: \u0026quot;v2\u0026quot; + \u0026quot;groupVersion\u0026quot;: \u0026quot;group.name/v1\u0026quot;, + \u0026quot;version\u0026quot;: \u0026quot;v1\u0026quot; } }, ç„¶å¾Œå†å» kubectl get ä¸æŒ‡å®šç‰ˆæœ¬\nkc get cats my-cat -oyaml apiVersion: group.name/v1 kind: Cat metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026quot;apiVersion\u0026quot;:\u0026quot;group.name/v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;Cat\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;name\u0026quot;:\u0026quot;my-cat\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;default\u0026quot;},\u0026quot;spec\u0026quot;:{\u0026quot;age\u0026quot;:18,\u0026quot;color\u0026quot;:\u0026quot;#009920\u0026quot;}} creationTimestamp: \u0026quot;2022-07-11T17:35:17Z\u0026quot; generation: 1 name: my-cat namespace: default resourceVersion: \u0026quot;5111716\u0026quot; uid: 388993d7-2075-406d-9668-4baec92d1562 spec: age: 18 color: '#009920' çœ‹ä¸€çœ¼ etcd ä¾†è­‰æ˜ sudo apt update sudo apt install etcd-client alias ec='ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key' ec get / --prefix --keys-only etcd çš„ key è¦å‰‡é¡ä¼¼ /registry/{group}/{kind}/{namespace}/{name}\n# ç”¨ json æ ¼å¼æ‹¿å‡ºä¾†çœ‹ï¼Œç™¼ç¾æ˜¯ Base64 $ ec get /registry/unagi.xiao.xiao/unagilives/unagi-system/unagilive-sample -wjson | jq . # è§£é–‹ä¾†çœ‹åˆ°åŸå‘³å…§å®¹ $ ec get /registry/unagi.xiao.xiao/unagilives/unagi-system/unagilive-sample -wjson | jq -r .kvs[0].value | base64 -d | jq '.metadata.name, .spec, .status' \u0026quot;unagilive-sample\u0026quot; { \u0026quot;color\u0026quot;: \u0026quot;meow\u0026quot; } { \u0026quot;reconciledTime\u0026quot;: \u0026quot;2022-07-07T09:14:56Z\u0026quot;, \u0026quot;status\u0026quot;: \u0026quot;Reconciled\u0026quot; } Ref https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/#version-priority\n","id":9,"section":"posts","summary":"ç‰ˆæœ¬å„ªå…ˆç´š åœ¨ K8s è£¡é¢æœ‰ preferred versionï¼Œæœƒé¸å„ªå…ˆå€¼æœ€é«˜çš„ä¾†åšç‚ºé è¨­å€¼ è¦å‰‡ \u0026quot;^v([\\\\d]+)(?:(alpha|beta)([\\\\d]+))?$\u0026quot; v{ä¸»ç‰ˆæœ¬}alpha|beta{å‰¯ç‰ˆæœ¬} åªæœ‰ v é–‹é ­çš„ç©©å®šç‰ˆ(GA)","tags":["kubernetes","crd"],"title":"CRD Version Priority","uri":"https://blog.10oz.tw/20220713-crd-version-priority/","year":"2022"},{"content":"ä»‹ç´¹ å›°æ“¾è¨±ä¹…çµ‚æ–¼åœ¨é€™è£¡æ‰¾åˆ°è§£æ³•\nInstall yarnâ€™s IDE SDK for VSCode (the dlx command runs yarn in a separate environment, distinct from the workspace)\nyarn dlx @yarnpkg/sdks vscode Ref https://community.grafana.com/t/cannot-find-modules-or-corresponding-type-declarations-after-fresh-install/56498\n","id":10,"section":"posts","summary":"ä»‹ç´¹ å›°æ“¾è¨±ä¹…çµ‚æ–¼åœ¨é€™è£¡æ‰¾åˆ°è§£æ³• Install yarnâ€™s IDE SDK for VSCode (the dlx command runs yarn in a separate environment, distinct from the workspace) yarn dlx @yarnpkg/sdks vscode Ref https://community.grafana.com/t/cannot-find-modules-or-corresponding-type-declarations-after-fresh-install/56498","tags":["typescript","vscode"],"title":"TypeScript workspace Cannot find module or its corresponding type declarations.ts(2307)","uri":"https://blog.10oz.tw/20220628-typescript-2307/","year":"2022"},{"content":"Introduction (Agenda) Hi å¤§å®¶å¥½æˆ‘æ˜¯ XiaoXiaoï¼Œç¾è·æ–¼ FST Network æ“”ä»»è»Ÿé«”å·¥ç¨‹å¸« é€™æ¬¡ä¸»è¦æ˜¯è¦åˆ†äº« Kubernetes å¦‚ä½•åœ¨çš„è‡ªå®šç¾©æ“´å±•å®šç¾©çš„ CRD ä¸­åšåˆ°åŒæ™‚æ”¯æ´å¤šå€‹ç‰ˆæœ¬ï¼Œ é€™å ´ä¸æœƒè¬›å¾—å¤ªæ·±å…¥ä¸»è¦æœƒé—œæ³¨åœ¨ä½¿ç”¨ Conversion webhook çš„ç¶“é©—å’Œä¸€äº›å®¹æ˜“å¿½ç•¥æ‰çš„å°åœ°æ–¹\nä¸€ã€ä½¿ç”¨å‹•æ©Ÿ (Motivation) åœ¨é€™è£¡æœƒå…ˆé–“å–®èªªæ˜ç‚ºä»€éº¼æˆ‘ç‚ºä»€éº¼æœƒé–‹å§‹ç ”ç©¶ conversion webhookï¼Œä»¥åŠåœ¨ä»€éº¼æƒ…æ³ä¸‹å¯ä»¥ä½¿ç”¨ conversion webhook å®šç¾©ä¸€å€‹ Proxy çš„ CRD ä½œç‚ºç¯„ä¾‹ï¼Œèƒ½åœ¨æœ‰å¯¦éš›æ¡ˆä¾‹çš„å¹«åŠ©ä¸‹æ›´å¥½ç†è§£æ–‡ç«  äºŒã€å¿«é€Ÿèªè­˜ CRD (Get to know the CRD quickly) é¦–å…ˆæœƒä»‹ç´¹å¦‚ä½•åœ¨ Kubernetes ä¸­å®šç¾© CRD ä¸¦ä¸”è¨­å®šè‡ªå·±çš„å¾Œç«¯ä¾†è™•ç† CR çš„è®ŠåŒ– (Controller \u0026amp; Operator Pattern) ä¸‰ã€å¤šç‰ˆæœ¬çš„ CRD å’Œ Conversion webhook (Multiple versions CRD and conversion webhook) Kubernetes ä¸­çš„ç‰ˆæœ¬é—œä¿‚ åŒæ™‚é…ç½®å¤šå€‹ç‰ˆæœ¬çš„è³‡æºæ›´æ–°æ™‚æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ ä»‹ç´¹ CRD çš„è½‰æ›ç­–ç•¥é¸æ“‡ æ–¼æ˜¯æœƒåŠ å…¥ Conversion webhook ä»¥åŠå¦‚ä½•é…ç½® Conversion webhook å¯¦éš›é‡åˆ°çš„å•é¡Œä»¥åŠå»ºè­°æ–¹å¼ ä»¥ annotations å„²å­˜æ¶ˆå¤±çš„æ¬„ä½ æ¬„ä½æ›´æ–°æ™‚ ConversionReview objects ä¸æœƒå¸¶å®Œæ•´çš„ resource é€²ä¾†ï¼ˆç‰¹åˆ¥æ˜¯é Golang ä½¿ç”¨è€…éœ€è¦æ³¨æ„ï¼‰ å››ã€è§€å¯Ÿå¯¦éš›æ¡ˆä¾‹ (Case demo) https://github.com/XiaoXiaoSN/conversion-webhook-example\näº”ã€è£œå……ç¯‡ï¼šèˆ‡ Admission Webhook ä¸€èµ·ç©è€ Admission webhook ä¹Ÿæ˜¯ä¸€å€‹ç¶“å¸¸è¢«æåŠçš„ Resourceï¼Œå› æ­¤ä¹Ÿçœ‹ä¸€ä¸‹ CRD conversion webhook èˆ‡ Admission webhook ä¹‹é–“çš„å·¥ä½œæµç¨‹ ä½¿ç”¨å‹•æ©Ÿ (Motivation) é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹ä»€éº¼æ™‚å€™æœƒéœ€è¦ä½¿ç”¨åˆ° CRD çš„ Conversion webhook\nç©©å®šçš„æ¨é€²ç‰ˆæœ¬ (v1alpha1, v1)ï¼ŒåŒæ™‚å‘ä¸‹ç›¸å®¹ æ”¯æ´æ–°çš„æ¬„ä½ï¼Œæˆ–æ˜¯å°‡èˆŠæ¬„ä½æ”¹åã€æ”¹çµæ§‹ åŒä¸€å€‹ Cluster ä¸‹ï¼Œä¸åŒçš„ Namespace åŒæ™‚é–“æ”¯æ´è‘—ä¸åŒç‰ˆæœ¬çš„ Controller ç¬¬ä¸‰é …å°±æ˜¯æˆ‘å€‘åœ¨é–‹ç™¼æ™‚å¯¦éš›é‡åˆ°çš„å›°é›£ï¼\nåœ¨æˆ‘å€‘çš„é–‹ç™¼ç’°å¢ƒä¸­åŒæ™‚å­˜åœ¨æœ‰é–‹ç™¼ç’°å¢ƒã€ä¸²æ¥ç’°å¢ƒã€æ¸¬è©¦ç’°å¢ƒä¸‰å¥—å®Œæ•´çš„ç³»çµ±å„è‡ªåœ¨ä¸‰å€‹ä¸åŒçš„ namespace ä¸‹ï¼Œä¹Ÿå°±åŒæ™‚æœ‰ä¸‰çµ„ Operator ç®¡ç†è‘—å„è‡ª namespace ä¸‹çš„ CRDs\nç„¶è€Œï¼ŒCRD åœ¨ Kubernetes Cluster ä¸‹æ˜¯å…±ç”¨çš„ï¼Œç•¶é–‹ç™¼ç’°å¢ƒç™¼ç”Ÿæ›´æ–°æ™‚ï¼Œä¸å¯é¿å…çš„ä¹Ÿæœƒå½±éŸ¿åˆ°å…¶ä»–äººåœ¨ä½¿ç”¨çš„ç©©å®šç’°å¢ƒï¼Œå› æ­¤æ›´å¥½çš„åšæ³•æ˜¯åœ¨æ¨å‡ºæ–°çš„ CRD ç‰ˆæœ¬ä¸”åŒæ™‚æ”¯æ´èˆŠçš„ç‰ˆæœ¬ï¼\nç°¡ä»‹ä¸€å€‹ Demo æ¡ˆä¾‹ æˆ‘å€‘å»ºç«‹ä¸€å€‹ Proxy çš„ CRD ä½œç‚ºç¯„ä¾‹ï¼Œä¸¦ç”¨é€™å€‹ç¯„ä¾‹å¸¶å…¥å¾Œé¢çš„ä»‹ç´¹\nç›®æ¨™é€éé€™å€‹ CRD ç”¢ç”Ÿä¸€å€‹èƒ½å¤ é€é IP é˜»æ“‹ä½¿ç”¨è€… HTTP è«‹æ±‚çš„ Proxyï¼Œé€šé Proxy çš„æª¢æŸ¥èƒ½çœ‹åˆ°å¾Œé¢çš„ç¶²é ï¼Œæ²’æœ‰é€šéå‰‡æœƒå¾—åˆ° 403 çš„éŒ¯èª¤è¨Šæ¯\nAbout Kubernetes CRD CRD çš„å…¨åæ˜¯ Custom Resource Definitionï¼Œä»–æœ¬èº«ä¹Ÿæ˜¯ä¸€å€‹ Kubernetes çš„ Resource\nåœ¨ K8s ä¸­æœ‰è¨±å¤š built-in çš„è³‡æºã€API å®šç¾©ï¼ŒCRD æä¾›ä½¿ç”¨è€…ç·¨å¯«è‡ªå·±çš„å®šç¾©ä¾†æ“´å±• Kubernetes çš„ Declarative API (å®£å‘Šå¼ API)ã€‚ CRD åœ¨æ•´å€‹ Kubernetes ç”Ÿæ…‹ä¸­è¢«éå¸¸å»£æ³›çš„ä½¿ç”¨ï¼\nDeclarative API (å®£å‘Šå¼ API)ï¼š\nAPI å®£å‘Šä»–æƒ³è¦çš„ç‹€æ…‹ï¼Œè€Œä¸æ˜¯ç›´æ¥è¦æ±‚å¯¦æ™‚ç‹€æ…‹ API represents a desired state, not an exact state é€šå¸¸æ˜¯ CRUD é¢¨æ ¼å°±å·²ç¶“è¶³å¤  CRD æ˜¯å®šç¾©ï¼Œè€Œä¾ç…§ CRD è¦æ ¼å®šç¾©ç”¢ç”Ÿçš„è³‡æºç¨±ç‚º CR\nå®˜æ–¹ CRD å®šç¾©æ–‡ä»¶\nCRD ç·¨å¯«æ ¼å¼ åœ¨å®šç¾©å¥½ CRD ä¹‹å¾Œï¼Œä½¿ç”¨è€…åƒ…éœ€è¦ç·¨å¯« YAMLï¼Œå°±èƒ½ä»¥å®£å‘Šå¼çš„æ–¹å¼å®šç¾©æœå‹™çš„æ¨¡æ¨£ è€Œæ­¤å¾Œ CR ä»»å‹™çš„æ’ç¨‹èˆ‡è³‡æºçš„èª¿åº¦éƒ½èƒ½è—‰ç”± K8s ä¾†å¹«ä½ å®Œæˆ\næ–‡ä»¶ä¸Šé¡å¤–è¦å®šçš„ 4 å€‹è¦å‰‡ï¼ŒåŒ…å«ä¿ç•™å­—æˆ–æ˜¯ properties æ“ºæ”¾æ–¹å¼\nå¯¦éš›ä¸Šæˆ‘å€‘å¯ä»¥é€é CRD æä¾›çš„ openAPIV3Schema æ¬„ä½å®šç¾©é€™å€‹ Resource çš„æ¬„ä½ï¼Œä»–æä¾›äº†æ›´åš´æ ¼çš„ OpenAPI V3 Schema å¯«æ³•ï¼Œä¸¦ä¸”åŠ ä¸Šäº†ä¸€äº› x-kubernetes- é–‹é ­çš„æ“´å……åŠŸèƒ½\nä¾‹å¦‚èªªï¼š x-kubernetes-int-or-string èƒ½åŒæ™‚æ”¯æ´æ•¸å­—å’Œå­—ä¸²ï¼Œé€™æ¨£ä½ å°±èƒ½è¼•é¬†è¾¦åˆ° cpu: 5 or cpu: \u0026quot;5000m\u0026quot; äº†ï¼\nä¾†å€‹ç¯„ä¾‹\napiVersion: apiextensions.k8s.io/v1 kind: CustomResourceDefinition metadata: name: proxies.example.group spec: group: example.group names: kind: Proxy listKind: ProxyList plural: proxies singular: proxy scope: Namespaced versions: - name: v1 schema: openAPIV3Schema: properties: apiVersion: type: string kind: type: string metadata: type: object spec: description: ProxySpec defines the desired state of Proxy properties: CIDR: type: string upstream: type: string type: object status: description: ProxyStatus defines the observed state of Proxy type: object type: object served: true storage: true å…ˆä¾†èªè­˜ä¸€ä¸‹ CRD åœ¨ Kubernetes çš„è¡Œç‚º ç§ç§ä½ çš„ CRD\nkubectl api-resources # ç§ç§æœ‰ä»€éº¼æ¬„ä½å¯ä»¥ç”¨ kubectl explain proxy --recursive=true # ä¹Ÿå¯ä»¥æŒ‡å®šç‰ˆæœ¬ kubectl explain proxy --api-version='example.group/v3' --recursive=true # ç§ç§æˆ‘å€‘çš„çš„æ–°ç‰ˆæœ¬ :) kubectl api-versions # æˆ–æ˜¯ `kubectl proxy` ç„¶å¾Œç›´æ¥ä½¿ç”¨ RESTful API curl 127.0.0.1:8001 # æˆ–æ˜¯ `/apis/{group}`, `/apis/{group}/{version}` curl 127.0.0.1:8001/apis/example.group curl 127.0.0.1:8001/apis/example.group/v1 Custom Controller æˆ‘å€‘é¦–å…ˆå¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ Kubernetes Controllerï¼\nController çš„å·¥ä½œæ˜¯è² è²¬å°‡æŒ‡å®šçš„è³‡æºè£½é€ æˆå’Œå®£å‘Šçš„ä¸€æ¨£ï¼Œé€™å€‹å‹•ä½œç¨±ç‚º Reconcile (å”èª¿ã€èª¿å’Œï¼Ÿ)\næˆ‘å€‘ä»¥æ–°å¢ä¸€ç­† ReplicaSet ä¾†çœ‹ï¼Œ\n(é€é kubectl) ç™¼é€æ–°å¢ Request çµ¦ kube-apiserver kube-apiserver é©—è­‰ä½¿ç”¨è€…çš„æ¬Šé™ã€æ¬„ä½çš„æ­£ç¢ºæ€§ kube-apiserver åœ¨ etcd ä¸­å­˜å…¥ ReplicaSet record Controller watch kube-apiserver ç™¼ç¾ etcd çš„è®ŠåŒ–ï¼Œä¸¦å»å–å¾—å®Œæ•´çš„ ReplicaSet Controller æª¢æŸ¥ Cluster å…§çš„ç‹€æ³ï¼Œç¢ºä»» current state æ˜¯å¦å’Œ desired state ç›¸åŒ Controller ç¢ºä¿ Cluster å…§çš„ pods, rs ç­‰ç‹€æ³å’Œå®£å‘Šçš„ç›¸åŒ ï¼ˆå°±æ˜¯ Reconcileï¼‰ 6.1 å¦‚æœç›¸åŒï¼ŒReconcile å®Œæˆï¼Œç­‰å¾…ä¸‹ä¸€ç­†è®Šæ›´ 6.2 ä¸åŒçš„è©±ï¼ŒReconcile å°‡ç‹€æ…‹è¨­ç‚º requeueï¼Œéå¹¾ç§’å†ä¾†é‡æ–° Reconcile ä¸€æ¬¡ Data Flow å®˜æ–¹ç¯„ä¾‹ kubernetes/sample-controller ä¸­çš„åœ– https://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md From https://lihaoquan.me/posts/k8s-crd-develop/ ä»‹ç´¹ CRD Controller Difference between Operator Pattern æœ¬è³ªä¸Š Operator å°±æ˜¯ Custom Controllerã€‚\nController åœ¨ Kubernetes ä¸­çš„æ ¸å¿ƒå…ƒä»¶ï¼Œåœ¨ Kubernetes ä¸­å…§å»ºçš„ Resources ä¹Ÿæ˜¯ç¶“é Controller ä¾†é”åˆ° Desired state çš„ã€‚\nå› æ­¤å¯ä»¥èªª Operator æ˜¯ CRD + Controller ä»¥å€åˆ¥ Kubernetes built-in çš„ Controllerã€‚\nConversion Webhook ä¸€èµ·çœ‹å®Œå‰ç½®çš„ä¸€äº›çŸ¥è­˜ï¼Œå†ä¾†å¯ä»¥ä¾†çœ‹çœ‹ Conversion webhook\nWhat is it ç§ç§è¨»è§£\na Webhook strategy instruct API server to call an external webhook for any conversion between custom resources.\nWith CRDs, however, each Kind will correspond to a single resource. \u0026ndash; kubebuilder\nStoraged version and Served Version\nèª’å˜¿ï½ï¼ kubectl æœƒå»æŠ“ä½ ç›®å‰å­˜çš„æœ€é«˜çš„ç‰ˆæœ¬ç•¶ä½œç›®æ¨™ç‰ˆæœ¬ (è¦éƒ¨ç½²éä¸€æ¬¡æ˜¯å“ªæ‹›ï¼Ÿ) ä¸éæˆ‘å€‘é‚„æ˜¯å¯ä»¥åœ¨ annotations ä¸Šçœ‹è¦‹ä»–å¯¦éš›çš„å‹ç‹€ kubectl.kubernetes.io/last-applied-configuration\nå„²å­˜é€² etcd ä¹‹å‰æœƒå…ˆç¶“éè½‰æ›ï¼Œå¯¦éš›åœ¨æ˜¯ä»¥ etcd çš„å½¢ç‹€å­˜åœ¨ï¼Œå› æ­¤é›–ç„¶å‰µå»º v1 çš„æ™‚å€™æœ‰ age æ¬„ä½ï¼Œä½†è®€å–å‡ºä¾†æ™‚ä¸æœƒæœ‰\n# æ¯ä¸ª version å¯ä»¥é€šè¿‡ served æ ‡å¿—å¯ç”¨æˆ–ç¦æ­¢ served: true # æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª version å¿…é¡»è¢«æ ‡è®°ä¸ºå­˜å‚¨ç‰ˆæœ¬ storage: true # æ­¤å±æ€§æ ‡æ˜æ­¤å®šåˆ¶èµ„æºçš„ v1alpha1 ç‰ˆæœ¬å·²è¢«å¼ƒç”¨ã€‚ # å‘ç»™æ­¤ç‰ˆæœ¬çš„ API è¯·æ±‚ä¼šåœ¨æœåŠ¡å™¨å“åº”ä¸­æ”¶åˆ°è­¦å‘Šæ¶ˆæ¯å¤´ã€‚ deprecated: true # æ­¤å±æ€§è®¾ç½®ç”¨æ¥è¦†ç›–è¿”å›ç»™å‘é€ v1alpha1 API è¯·æ±‚çš„å®¢æˆ·ç«¯çš„é»˜è®¤è­¦å‘Šä¿¡æ¯ã€‚ deprecationWarning: \u0026quot;example.com/v1alpha1 CronTab is deprecated; see http://example.com/v1alpha1-v1 for instructions to migrate to example.com/v1 CronTab\u0026quot; Kubernetes functions by reconciling desired state (Spec) with actual cluster state (other objectsâ€™ Status) and external state, and then recording what it observed (Status). \u0026ndash; kubebuilder\nç‚ºä»€éº¼éœ€è¦å’Œä»€éº¼æ™‚å€™ç”¨ ä½ çš„æœå‹™è¶³å¤ ç©©å®šæƒ³è¦æ¨é€²ç‰ˆæœ¬ (v1, v1alpha1)ï¼ŒåŒæ™‚é–“å…©ç¨®æˆ‘éƒ½è¦ æƒ³æ”¯æ´çš„æ–°çš„æ¬„ä½ ä¸æƒ³ç ´å£åŸæœ¬ä½¿ç”¨è€…çš„é«”é©—ï¼Œæƒ³è¦é †æš¢çš„å‡ç´š ä½ çš„åŒä¸€å€‹ Cluster ä¸‹ï¼Œä¸åŒ Namespace åŒæ™‚æœ‰è‘—æ”¯æ´ä¸åŒç‰ˆæœ¬çš„ Controller é‚£éº¼æˆ‘å€‘ä»€éº¼æ™‚å€™æœƒéœ€è¦ Conversion webhook å‘¢ï¼Ÿ\næˆ‘å€‘æƒ³è¦å°‡èˆŠçš„æ¬„ä½ä¿®æ”¹ï¼Œä½†ä¸æƒ³å½±éŸ¿åˆ°ä½¿ç”¨ä¸­çš„ç”¨æˆ¶ï¼Œ æƒ³è¦ç©©å®šçš„å»æ¨é€²ç‰ˆæœ¬ä¸¦ä¸”èƒ½å¤ å‘ä¸‹ç›¸å®¹ï¼Œåœ¨ç™¼å‡ºæ–°ç‰ˆæœ¬ v1 å¾Œï¼Œéå»ä½¿ç”¨ v1alpha1 çš„ä½¿ç”¨è€…ä¹Ÿèƒ½ç¹¼çºŒä½¿ç”¨\næœ€å¾Œä¸€é»ï¼ŒåŒä¸€å€‹ Cluster ä¸‹ï¼Œæœ‰è‘—æ”¯æ´ä¸åŒ CR ç‰ˆæœ¬çš„ Controller æ˜¯æˆ‘å€‘åœ¨é–‹ç™¼ä¸Šå¯¦éš›é‡åˆ°çš„å•é¡Œã€‚ å…©å€‹ Controller ä¸€å€‹æƒ³è¦ v1 ç‰ˆæœ¬ä¸€å€‹æƒ³è¦ v2 ç‰ˆæœ¬æ™‚ï¼Œå°±æœƒéœ€è¦ Conversion webhook ä¾†å¹«å¿™åšç‰ˆæœ¬ä¹‹é–“çš„è½‰æ›\næ€éº¼ç”¨ å¦‚æœæ²’æœ‰è¨­å®š conversion webhook çš„è©±ï¼Œé‚£éº¼æœƒå°‡ç›®å‰å„²å­˜çš„ç›´æ¥å¥—ç”¨åˆ°æ–°ç‰ˆä¸Šï¼Œä¸¦å°‡å®ƒæ”¹æˆå°æ‡‰ç‰ˆæœ¬\nå¦‚æœå„²å­˜ç‰ˆæœ¬æœ‰å¿…å¡«æ¬„ä½æ˜¯å¦å°±æœƒå¤±æ•—?\nçœ‹ä¸€çœ¼ etcd ä¾†è­‰æ˜ sudo apt update sudo apt install etcd-client alias ec='ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key' ec get / --prefix --keys-only etcd çš„ key è¦å‰‡é¡ä¼¼ /registry/{group}/{kind}/{namespace}/{name}\n# ç”¨ json æ ¼å¼æ‹¿å‡ºä¾†çœ‹ï¼Œç™¼ç¾æ˜¯ Base64 $ ec get /registry/unagi.xiao.xiao/unagilives/unagi-system/unagilive-sample -wjson | jq . # è§£é–‹ä¾†çœ‹åˆ°åŸå‘³å…§å®¹ $ ec get /registry/unagi.xiao.xiao/unagilives/unagi-system/unagilive-sample -wjson | jq -r .kvs[0].value | base64 -d | jq '.metadata.name, .spec, .status' \u0026quot;unagilive-sample\u0026quot; { \u0026quot;color\u0026quot;: \u0026quot;meow\u0026quot; } { \u0026quot;reconciledTime\u0026quot;: \u0026quot;2022-07-07T09:14:56Z\u0026quot;, \u0026quot;status\u0026quot;: \u0026quot;Reconciled\u0026quot; } ç°¡åŒ–æˆè…³æœ¬æ–¹ä¾¿æˆªåœ–\nETCDCTL_API=3 etcdctl \\ --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --cert=/etc/kubernetes/pki/etcd/peer.crt \\ --key=/etc/kubernetes/pki/etcd/peer.key \\ get $1 -wjson | jq -r .kvs[0].value | base64 -d | jq '{\u0026quot;name\u0026quot;: .metadata.name, \u0026quot;spec\u0026quot;: .spec}' Conversion Strategy ä¸éå…¶å¯¦ç­–ç•¥ä¹Ÿåªæœ‰ Webhook æˆ– None å¯ä»¥é¸ï¼Œé è¨­æ˜¯ None\nÏƒ`âˆ€Â´)Ïƒ è§£é‡‹ status.storedVersions ï¼ˆæ›¾ç¶“ç”¨éçš„å„²å­˜ç‰ˆæœ¬ï¼‰\nè¨»å†Š Conversion webhook æ¥ä¸‹ä¾†å¯¦éš›ä¾†çœ‹ conversion webhookï¼Œå¯ä»¥åœ¨ CRD ä¸­é€™æ¨£è¨»å†Š\nspec: conversion: strategy: Webhook webhook: clientConfig: service: namespace: system name: webhook-service path: /convert conversionReviewVersions: - v1 æ³¨æ„é€™é‚Šçš„ conversionReviewVersions æŒ‡çš„æ˜¯ ConversionReview çš„ç‰ˆæœ¬ï¼ŒæœƒæŒ‰ç…§ Array çš„é †åºå»æ”¯æ´ï¼Œå¯é¸çš„æœ‰ v1, v1beta1ï¼Œä¸é v1beta1 åœ¨ 1.16 å°±å·²ç¶“æ£„ç”¨äº†ï¼ŒåŸºæœ¬é€™è£¡åªæœƒæœ‰ v1\nConversion Review example\n{ \u0026quot;apiVersion\u0026quot;: \u0026quot;apiextensions.k8s.io/v1\u0026quot;, \u0026quot;kind\u0026quot;: \u0026quot;ConversionReview\u0026quot;, \u0026quot;request\u0026quot;: { # Random uid uniquely identifying this conversion call \u0026quot;uid\u0026quot;: \u0026quot;705ab4f5-6393-11e8-b7cc-42010a800002\u0026quot;, # The API group and version the objects should be converted to \u0026quot;desiredAPIVersion\u0026quot;: \u0026quot;example.com/v1\u0026quot;, # The list of objects to convert. # May contain one or more objects, in one or more versions. \u0026quot;objects\u0026quot;: [ { \u0026quot;kind\u0026quot;: \u0026quot;CronTab\u0026quot;, \u0026quot;apiVersion\u0026quot;: \u0026quot;example.com/v1beta1\u0026quot;, \u0026quot;metadata\u0026quot;: { \u0026quot;creationTimestamp\u0026quot;: \u0026quot;2019-09-04T14:03:02Z\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;local-crontab\u0026quot;, \u0026quot;namespace\u0026quot;: \u0026quot;default\u0026quot;, \u0026quot;resourceVersion\u0026quot;: \u0026quot;143\u0026quot;, \u0026quot;uid\u0026quot;: \u0026quot;3415a7fc-162b-4300-b5da-fd6083580d66\u0026quot; }, \u0026quot;hostPort\u0026quot;: \u0026quot;localhost:1234\u0026quot; } ] } } æƒ³è¦æ·»åŠ  CRD conversion webhook åªè¦åœ¨ sepc.conversion.webhookClientConfig è¨­å®šå¥½æŒ‡å®šçš„ serverï¼Œå†æ·»åŠ  CA Bundle çš„é…ç½®å°±å¯ä»¥äº†\nè½‰æ›æ–¹æ¡ˆ æ³¨æ„æ‰€æœ‰ (Served) çš„ç‰ˆæœ¬ä¹‹é–“éƒ½è¦èƒ½å¤ è‡ªç”±è½‰æ›ï¼Œä¸”ä¸æœƒéºå¤±è³‡æ–™\nIn Kubernetes, all versions must be safely round-tripable through each other. \u0026ndash; kubebuilder docs\né€é Hubã€ä¸­è½‰ç«™ ä½†æ˜¯ç‚ºäº†é”åˆ°é€™å€‹ç›®æ¨™ï¼Œç•¶æˆ‘å€‘æœ‰ n å€‹ versions æ™‚ï¼Œé›£é“æˆ‘å€‘å°±è¦å¯« $n * (n-1)$ å€‹ç‰ˆæœ¬è½‰æ›é‚è¼¯å—ï¼Ÿ\né€™é¡¯ç„¶æ˜¯æœ‰é»éº»ç…©çš„ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åšä¸€å€‹ä¸­è½‰çš„çµæ§‹ v1 -\u0026gt; Hub(storaged) -\u0026gt; v3\nä¹Ÿå°±èƒ½å°‡åŸæœ¬çš„è½‰æ›æ‹“å¢£ç°¡åŒ–ï¼š\nç‰ˆæœ¬ä¹‹é–“çš„è½‰æ›é—œä¿‚ï¼š ç¶­è­·å‘å‰ã€å‘å¾Œç‰ˆæœ¬ åˆæˆ–è€…æ‰¿ä¸Šé¢æåˆ°çš„ï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½è¦èƒ½è‡ªç”±è½‰æ›ï¼ å› æ­¤æˆ‘å€‘ä¹Ÿå¯ä»¥è®“æ¯å€‹ç‰ˆæœ¬ç¶­è­·ä¸Šä¸€å€‹ç‰ˆæœ¬çš„è½‰æ›è¦å‰‡ v1 -\u0026gt; v2 -\u0026gt; v3\nå› æ­¤ï¼Œç•¶æ–°å¢ v1 ç‰ˆæœ¬è€Œ storage version æ˜¯ v3 æ™‚ï¼Œå°±æœƒå…ˆè½‰æˆ v2 å†è½‰æˆ v3ã€‚ é€™æ¨£çš„æ©Ÿåˆ¶ä¸‹æ¯å€‹ç‰ˆæœ¬åªè¦è² è²¬å‘å‰å’Œå‘å¾Œè½‰æ›çš„è¦å‰‡å°±å¥½ï¼Œæ¸›å°‘æ’°å¯«è½‰æ›é‚è¼¯è¤‡é›œåº¦ä¸”èƒ½å¤ è¼•æ˜“çš„æ–°å¢ã€ç§»é™¤ç‰ˆæœ¬\næ¶ˆå¤±çš„æ¬„ä½ è¨­è¨ˆå¥½äº†è½‰æ›çš„æ¨¡å¼å¾Œï¼Œå†ä¾†æœƒé‡åˆ°ä¸€å€‹å•é¡Œï¼šstorage version ä¸­ä¸å­˜åœ¨çš„æ¬„ä½æ€éº¼æ¨£è½‰æ›å›å»ï¼Ÿ\nå‡è¨­å ´æ™¯ v1 (storage version) ä¸­æœ‰ CIDR æ¬„ä½\napiVersion: example.group/v1 kind: Proxy spec: CIDR: \u0026quot;192.168.0.0/24\u0026quot; upstream: \u0026quot;web:80\u0026quot; è€Œ v2 å¤šäº† CIDRs, timeoutSeconds æ¬„ä½ï¼Œä½†å»å°‡ CIDR æ¬„ä½çµ¦ç§»é™¤äº†\napiVersion: example.group/v2 kind: Proxy spec: CIDRs: - \u0026quot;192.168.0.0/24\u0026quot; - \u0026quot;123.0.0.1/32\u0026quot; upstream: \u0026quot;web:80\u0026quot; timeoutSeconds: 10 ç”±æ–¼è³‡æ–™é‡è¼ƒå°‘çš„ v1 æ˜¯å„²å­˜ç‰ˆæœ¬ï¼Œå› æ­¤æ–°å¢ä¸€ç­† v2 CR æ™‚æœƒå…ˆè½‰æˆ v1 å†å„²å­˜ï¼ŒtimeoutSeconds æ¬„ä½å°±æœƒç„¡å®¶å¯æ­¸ï¼Œå¹«QQ å†æ¬¡å°‡æ–°å¢çš„ CR ä»¥ v2 æ ¼å¼å–å‡ºä¾†æ™‚ä¹Ÿæœƒç™¼ç¾ç¼ºå°‘æ¬„ä½ï¼\nå¯ä»¥è€ƒæ…®ä½¿ç”¨ç¬¬ä¸‰æ–¹è³‡æ–™åº«æˆ–æ˜¯ç›´æ¥ç”¨ Kubernetes metadata.annotations ä¾†å¹«å­˜ç¼ºå°‘çš„æ¬„ä½ï¼Œä¾‹å¦‚èªªæˆ‘å€‘å°‡ v2 è½‰æˆ v1 æ™‚å¦‚ä¸‹\napiVersion: example.group/v1 kind: Proxy metadata: annotations: proxy.v2.example.group/state: | { \u0026quot;CIDRs\u0026quot;: [\u0026quot;192.168.0.0/24\u0026quot;, \u0026quot;123.0.0.1/32\u0026quot;] \u0026quot;timeoutSeconds\u0026quot;: 10 } spec: CIDR: \u0026quot;192.168.0.0/24\u0026quot; upstream: \u0026quot;web:80\u0026quot; é€™æ¨£å­ç·¨å¯« v1 to v2 çš„ conversion é‚è¼¯æ™‚å°±èƒ½å¤ å¾ metadata.annotations ä¸­å–å¾—ç¼ºå°‘çš„æ¬„ä½äº†ï¼\næ’°å¯« API é€™å…¶å¯¦å°±æ˜¯ä¸€éš» HTTPS çš„ JSON APIï¼Œæœƒç”¨ POST ç™¼åˆ°ä½ æŒ‡å®šçš„ webhook ä¸Šï½\nå®˜æ–¹ç¯„ä¾‹å°±æ˜¯è®š\nhttps://kubernetes.io/zh-cn/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/#webhook-%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94\næ¥ä¸‹ä¾†é€™æ®µåœ¨å®˜æ–¹æ–‡ä»¶ä¸­æœ‰æåˆ° æ–°å¢ç‰ˆæœ¬çš„æ­¥é©Ÿ æ³¨æ„ etcd å…§å­˜çš„ç‰ˆæœ¬ï¼Œä¸æœƒç¶“é conversion webhook åˆªé™¤ç‰ˆæœ¬çš„æ­¥é©Ÿ ç¢ºä¿æ‰€æœ‰çš„å®¢æˆ¶ç«¯éƒ½æ²’æœ‰åœ¨ä½¿ç”¨é€™å€‹ç‰ˆæœ¬äº†ï¼Œå¯ä»¥åˆ° kube-apiserver çš„ log å†æ¬¡ç¢ºèª å°‡æ¬²åˆªé™¤çš„ç‰ˆæœ¬ served è¨­ç½®æˆ falseï¼Œä¸¦ç¢ºä¿ä½ çš„å®¢æˆ¶æ²’æœ‰å« åˆ° CRD çš„ status.storedVersions ç¢ºä¿ etcd å…§æ²’æœ‰ä½ æ¬²åˆªé™¤çš„ç‰ˆæœ¬ æŠŠä»–åˆªæ‰å§ï½ è¨˜å¾— conversion webhook çš„è½‰æ›ä¹Ÿå¯ä»¥åˆªäº† kubernetes-sigs/kube-storage-version-migrator é€™å€‹èƒ½ç”¨ï¼Ÿ https://github.com/kubernetes-sigs/kube-storage-version-migrator\nkubectl proxy \u0026amp; curl --header \u0026quot;Content-Type: application/json-patch+json\u0026quot; \\ --request PATCH http://localhost:8001/apis/apiextensions.k8s.io/v1/customresourcedefinitions/\u0026lt;your CRD name here\u0026gt;/status \\ --data '[{\u0026quot;op\u0026quot;: \u0026quot;replace\u0026quot;, \u0026quot;path\u0026quot;: \u0026quot;/status/storedVersions\u0026quot;, \u0026quot;value\u0026quot;:[\u0026quot;v1\u0026quot;]}]' Example ConversionReview å¯ä»¥ç”¨çš„æœ‰å“ªäº› v1 v1alpha1\nç‰ˆæœ¬ä¼˜å…ˆçº§ ä¸è€ƒè™‘ CustomResourceDefinition ä¸­ç‰ˆæœ¬è¢«å®šä¹‰çš„é¡ºåºï¼Œkubectl ä½¿ç”¨ å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„ç‰ˆæœ¬ä½œä¸ºè®¿é—®å¯¹è±¡çš„é»˜è®¤ç‰ˆæœ¬ã€‚ é€šè¿‡è§£æ name å­—æ®µç¡®å®šä¼˜å…ˆçº§æ¥å†³å®šç‰ˆæœ¬å·ï¼Œç¨³å®šæ€§ï¼ˆGAã€Beta æˆ– Alphaï¼‰ çº§åˆ«åŠè¯¥ç¨³å®šæ€§çº§åˆ«å†…çš„åºåˆ—ã€‚\nä»–åœ¨ Kubernetes ä¸­æ€éº¼é‹ä½œæµç¨‹ tail /var/log/kubernetes/audit.log | grep example.group\næœƒæ”¶åˆ° ConversionReview\nå¯¦éš›æ¡ˆä¾‹ Cert manager tag: v1.0.0-alpha.1 pkg/internal/apis/certmanager func Convert_\nCert Manager æœ‰é Conversion Webhook https://github.com/cert-manager/cert-manager/pull/3178 - æ–°å¢ deploy/crds/crd-certificaterequests.yaml ã„‰ - åˆªé™¤ deploy/crds/crd-issuers.yaml ã„‰\nWarning: Do not reuse a CA that is used in a different context unless you understand the risks and the mechanisms to protect the CA\u0026rsquo;s usage. \u0026ndash; from Kubernetes docs\nHTTP Proxy CRD æ¡ˆä¾‹æè¿° æˆ‘å€‘æœ‰ dev, sit namespace ä¸‹çš„å…©å€‹å¾Œç«¯æœå‹™å’Œå…©å€‹ Controller åœ¨ç¨ç«‹çš„ namespace æœ‰è‘— conversion webhook Field Managed Defaulting: Values for fields that appliers do not express explicit interest in should be defaulted. This prevents an applier from unintentionally owning a defaulted field that might cause conflicts with other appliers. If unspecified, the default value is nil or the nil equivalent for the corresponding type. \u0026ndash; https://kubernetes.io/blog/2021/08/06/server-side-apply-ga/#using-server-side-apply-in-a-controller\nç‚ºäº†é¿å…ä¸å°å¿ƒä¿®æ”¹åˆ°ï¼Œå› æ­¤åƒ…æœƒçµ¦æ˜ç¢ºé—œæ³¨çš„æ¬„ä½ï¼Œå…¶ä»–çš„å°±æ˜¯ Default value\nä¸€å•ä¸€ç­” Q: å­˜åœ¨ etcd çš„ v1 è¢«æ›´æ–°å¾Œï¼Œæœƒè®Šæˆ v2 å­˜é€²å»å—\nä¸æœƒï¼Œä»–æœƒä¿æŒåŸæ¨£ã€‚ç”šè‡³å¯èƒ½éä¸äº†æ–°çš„æ¬„ä½æª¢æŸ¥\nQ: åœ¨æ²’æœ‰ Conversion webhook çš„æƒ…æ³ä¸‹æˆ‘éƒ¨ç½²é stored çš„ç‰ˆæœ¬æœƒæ€æ¨£ï¼Ÿ\næœƒä½¿ç”¨ None çš„ç­–ç•¥ for conversion without webhook more precisely: None: The converter only change the apiVersion and would not touch any other field in the custom resource. https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.24/#customresourceconversion-v1-apiextensions-k8s-io\nQ: CRD versions çš„ served è¡¨ç¤ºå•Ÿç”¨èˆ‡å¦ï¼Œä½†ä»–å’Œåˆªé™¤çš„å·®ç•°æ˜¯ä»€éº¼ï¼Ÿ\nä½¿ç”¨ä¸ŠåŸºæœ¬æ²’æœ‰å·®äº†ï¼Œä½†æ˜¯ status.storedVersions é‚„å­˜åœ¨æ™‚ä¸èƒ½å¤ åˆªé™¤ç‰ˆæœ¬ä½†å¯ä»¥åˆ‡æ›æˆä¸ served è£œå…… served: false æ˜¯ç›´æ¥ä¸èƒ½ä½¿ç”¨ï¼Œä½†æ¨™è¨˜ deprecated åªæ˜¯æé†’ä¸èƒ½ç”¨\nQ: æŸå€‹è³‡æºåœ¨ etcd è£¡é¢æ˜¯ v1ï¼Œstorage version å¾ v1 æ”¹æˆ v2 å¾Œï¼Œé€™æ™‚å€™å» get v1 ç‰ˆæœ¬ä»–æœƒç¶“éè½‰æ›å—ï¼Ÿ\né€™æ˜¯å€‹æµç¨‹å•é¡Œï¼Œæ‡‰è©²æ˜¯å…ˆæ‹¿å‡ºä¾†æŒ‡å®šè³‡æºå¾Œï¼Œå†å»æª¢æŸ¥æ˜¯å¦æœ‰æ•ˆæœ å› æ­¤æˆ‘æƒ³ç­”æ¡ˆæ˜¯ä¸æœƒ\næ‹¿ä¾†è·Ÿ Admissions webhook æ¯”è¼ƒ conversion webhook å’Œ admissions webhook çš„å…ˆå¾Œæ¬¡åº æ‡‰è©²æ˜¯ï¼š Aggregator â€“\u0026gt; KubeAPIServer â€“\u0026gt; APIExtensions\næ­é…å‰é¢çš„ Admission Webhook è¬›è§£ https://stackoverflow.com/questions/69198043/what-happens-when-creaing-crd-without-relating-operator\nRef https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/\napiextensions go doc https://pkg.go.dev/k8s.io/apiextensions-apiserver@v0.24.2/pkg/apis/apiextensions\nè§£ækubernetes Aggregated API Servers https://blog.csdn.net/u010278923/article/details/78890533?spm=a2c6h.12873639.article-detail.3.e432294cdAIfpg\nDocker compose -\u0026gt; Kubernetes https://youtu.be/pCXFhCfOAIg\nhttps://speakerdeck.com/david50407/operator-sdk-dai-ni-wan-zhuan-kubernetes?slide=63\nKubernetes CRDå¼€å‘å®è·µ https://lihaoquan.me/posts/k8s-crd-develop/\nOperator pattern https://www.readfog.com/a/1654115901312700416 diff between Controller and Operator https://stackoverflow.com/a/47857073/6695274\nKubebuilder https://book.kubebuilder.io/architecture.html\n","id":11,"section":"posts","summary":"Introduction (Agenda) Hi å¤§å®¶å¥½æˆ‘æ˜¯ XiaoXiaoï¼Œç¾è·æ–¼ FST Network æ“”ä»»è»Ÿé«”å·¥ç¨‹å¸« é€™æ¬¡ä¸»è¦æ˜¯è¦åˆ†äº« Kubernetes å¦‚ä½•åœ¨çš„è‡ªå®šç¾©æ“´å±•å®šç¾©çš„ CRD ä¸­åšåˆ°åŒæ™‚æ”¯æ´å¤šå€‹ç‰ˆæœ¬ï¼Œ é€™å ´ä¸æœƒè¬›å¾—å¤ª","tags":["kubernetes","crd"],"title":"Kubernetes CRD and Conversion Webhook","uri":"https://blog.10oz.tw/20220427-kubernetes-crd-and-conversion-webhook/","year":"2022"},{"content":"é¦–å…ˆ é€™å€‹ç¶²ç«™ä¸Šæ‰¾æ‰¾å–œæ­¡çš„é…è‰² (ï¾‰\u0026gt;Ï‰\u0026lt;)ï¾‰ https://vimcolorschemes.com/\nä¾‹å¦‚èªª vim-sublime-monokai\nå•é¡Œ é€™æ¬¡å•é¡Œæ˜¯è¡Œæ•¸å·¦é‚Šé‚£æ¢ç°è‰²å¤ªè¨å­äº†å§!! é€™æ˜¯å› ç‚º airblade/vim-gitgutter é€™å€‹å¥—ä»¶æœƒæ¨™ç¤ºå‡º git è®Šæ›´çš„é …ç›®ä½†é€™å€‹ theme é¡¯ç„¶æ²’æœ‰æ–™æƒ³åˆ°é€™å€‹å•é¡Œ\nèªè­˜ä¸€ä¸‹ Vim èªæ³•é«˜äº® é¦–å…ˆäº†è§£ä¸€ä¸‹ Vim é¡è‰²è¨­å®šçš„èªæ³•ï¼Œå¯ä»¥åˆ° Vim è£¡é¢è¼¸å…¥\n:h hi \u0026quot; h æ˜¯ helpï¼Œhi æ˜¯ highlight çš„ç°¡å¯« èªæ³•åƒæ˜¯é€™æ¨£\n\u0026quot; hi[ghlight] [default] {group-name} {key}={arg} .. highlight Comment gui=bold hi Comment term=bold ctermfg=Cyan guifg=#80a0ff gui=bold :h highlight-group å¯ä»¥çœ‹åˆ°æ›´å¤šçš„ group-name ä¾‹å¦‚ Cursor =\u0026gt; the character under the cursor LineNr =\u0026gt; Line number Normal =\u0026gt; normal text \u0026hellip;\né¦–å…ˆæœ‰ä¸‰ç¨®é¡å‹çš„ Terminalï¼Œä¸éæˆ‘å¤§æ¦‚åªæœƒç”¨åˆ° cterm å§\nterm (terminal: vt100, xterm\u0026hellip;) cterm (color terminal: MS-DOS console, color-xterm\u0026hellip;) gui (Graphical User Interface) å¯ä»¥æ­é… fg, bg ä¾†æ”¹å­—é«”å’ŒèƒŒæ™¯é¡è‰²ï¼Œæˆ–æ˜¯ä¸åŠ æ±è¥¿è¡¨ç¤ºå±¬æ€§åƒæ˜¯ç²—é«”ã€åº•ç·šé€™é¡çš„\nå¯ç”¨çš„ attr-list æœ‰:\nattribute description bold ç²—é«” underline åº•ç·š reverse åç™½ï¼Œinverse same as reverse italic æ–œé«” standout nocombine override attributes instead of combining them NONE no attributes used (used to reset it) \u0026quot; æ¸¸æ¨™æ‰€åœ¨é‚£è¡Œçš„å­—è®Šæˆç¶ è‰² hi CursorLine ctermfg=green \u0026quot; æ¸¸æ¨™æ‰€åœ¨é‚£è¡Œçš„åç™½ + åº•ç·š hi CursorLine cterm=reverse,underline \u0026quot; æ¸…é™¤æ‰é¡è‰² hi CursorLine clear \u0026quot; æ†¤æ€’å…¨æ¸… hi clear \u0026quot; æŸ¥çœ‹ç›®å‰è¨­å®š verbose hi LineNR å°‹æ‰¾è§£æ±ºæ–¹æ³• å¦‚ä½•æ‰¾åˆ° HighLight Group æŠŠé€™æ®µ function è²¼åˆ°ä½ çš„ .vimrc ä¸‹è¨»å†Šï¼Œå°±å¯ä»¥çœ‹åˆ°æ¸¸æ¨™æ‰€åœ¨çš„é‚£å€‹ä½ç½®æœ‰å“ªäº› highlight-group å›‰!\nç¹¼çºŒæ‰¾å•é¡Œ å¯æ˜¯è¡Œæ•¸å·¦é‚Šé‚£è¡Œæ²’è¾¦æ³•æŠŠæ¸¸æ¨™è²¼ä¸Šå»çœ‹é˜¿QQ\næ–¼æ˜¯ç›´æ¥å»ç¿»è¨­å®šæ‰¾çœ‹çœ‹å“ªè£¡ç”¨åˆ°äº† grey é€™å€‹é¡è‰²XDDD\næ‰¾åˆ°äº† åŸä¾†é‚£ä¸€è¡Œçš„åå­—å«åš SignColumn å‘€!\ncall s:h('SignColumn', { 'fg': s:lightblack, 'bg': s:grey }) SignColumn column where signs are displayed\nçŸ¥é“åå­—å…¶å¯¦å°±å¾ˆå¥½è™•ç†äº†ï¼ŒæŠŠé¡è‰²æ”¹æ‰å°±å¥½å•¦~~\nhi! link SignColumn LineNr ç›¸é—œæƒ…å ± https://stackoverflow.com/a/46636973 æ‰‹å‹•é–‹é—œé‚£æ¢ SignColumn\nIf you are using Vim 8.0 or newer (or NeoVim), this is now a simple setting:\n$ vim \u0026quot;+help signcolumn\u0026quot; \u0026quot;+only\u0026quot; For instance,\n:set scl=no \u0026quot; force the signcolumn to disappear :set scl=yes \u0026quot; force the signcolumn to appear :set scl=auto \u0026quot; return the signcolumn to the default behaviour Ref https://youtu.be/XTdxBreTYdM?list=PLBd8JGCAcUAH56L2CYF7SmWJYKwHQYUDI\nhttps://neovim.io/doc/user/options.html#'signcolumn'\n","id":12,"section":"posts","summary":"é¦–å…ˆ é€™å€‹ç¶²ç«™ä¸Šæ‰¾æ‰¾å–œæ­¡çš„é…è‰² (ï¾‰\u0026gt;Ï‰\u0026lt;)ï¾‰ https://vimcolorschemes.com/ ä¾‹å¦‚èªª vim-sublime-monokai å•é¡Œ é€™æ¬¡å•é¡Œæ˜¯è¡Œæ•¸å·¦é‚Šé‚£æ¢ç°è‰²å¤ªè¨å­äº†å§!! é€™æ˜¯å› ç‚º airblade/vim-gitgutter é€™å€‹å¥—ä»¶æœƒæ¨™ç¤ºå‡º git è®Šæ›´","tags":["vim"],"title":"Vim Color Schemes","uri":"https://blog.10oz.tw/20220205-vim-color-schemes/","year":"2022"},{"content":"é–‹å§‹ä½¿ç”¨ ä¸Šæ¬¡æ›´æ›äº†ä¸€ä¸‹ Blog çš„ hugo themeï¼Œä½†æ˜¯å¾Œä¾†ç™¼ç¾ç›´æ¥ç”¨ git clone ä¸‹è¼‰ä¸‹ä¾†çš„ theme æ²’æœ‰æ›´æ–°åˆ° GitHub ä¸Šé¢ (â•¯â€¢Ì€á½¤â€¢Ì)â•¯ã€‚\næ­çµ¦æ­çµ¦ï¼Œæˆ‘å€‘æ”¹ç”¨ä¸€ä¸‹ Submodule è™•ç†ä¸€ä¸‹\nåŠ å…¥ Submodule é€™æ¬¡ç›®æ¨™è¦æŠŠå¾ Gitee ä¸Š Clone å›ä¾†çš„ Repo XiaoXiaoSN/hugo-theme-pure ä½œç‚º Themeï¼Œ æ”¾åˆ° XiaoXiaoSN/XiaoXiaoBlog çš„ themes/pure è³‡æ–™å¤¾ä¸‹ï¼\ngit rm themes/pure git submodule add git@github.com:XiaoXiaoSN/hugo-theme-pure.git themes/pure å®Œæˆå¾Œæˆ‘å€‘æœƒå¤šä¸€å€‹ .gitmodules æª”æ¡ˆï¼Œè£¡é¢çš„å…§å®¹ä¹Ÿå¾ˆç›´è§€\n[submodule \u0026quot;themes/pure\u0026quot;] path = themes/pure url = git@github.com:XiaoXiaoSN/hugo-theme-pure.git æŠŠæ›´æ–°æ¨å‡ºå»ï½ git push origin master ç¬¬ä¸€æ¬¡ä½¿ç”¨ Submodule çš„è©± ç‚ºäº†æ¸¬è©¦æˆ‘å†å¦å¤–ä¸‹è¼‰ä¸€ä»½\ngit clone --depth 1 git@github.com:XiaoXiaoSN/XiaoXiaoBlog.git testXiaoXiaoBlog é€²å»å¾Œæˆ‘å€‘å¯ä»¥ç”¨ git submodule æŸ¥çœ‹ç›®å‰çš„ç‹€æ…‹\n$ git submodule c97723a02ac3abace65a6433eab381f0acbe2719 themes/pure $ git submodule init å­æ¨¡çµ„ 'themes/pure'ï¼ˆgit@github.com:XiaoXiaoSN/hugo-theme-pure.gitï¼‰å·²å°è·¯å¾‘ 'themes/pure' è¨»å†Š $ git submodule update æ­£è¤‡è£½åˆ° '/Users/arios/Project/XiaoXiaoBlog/themes/pure'... å­æ¨¡çµ„è·¯å¾‘ 'themes/pure'ï¼šç°½å‡º 'c97723a02ac3abace65a6433eab381f0acbe2719' æˆ–æ˜¯ä¹Ÿå¯ä»¥åˆåœ¨ä¸€èµ·åš\ngit submodule update --init æ›´æ–° Submodule è¦æ¸¬è©¦æ›´æ–° Submodule æ‰€ä»¥æˆ‘å€‘å…ˆåˆ°è¢«è¨»å†Šçš„ Submodule è£½é€ ä¸€å€‹ Commit æ¨¡æ“¬ä¾è³´çš„æ¨¡çµ„è¢«æ›´æ–°çš„ç‹€æ…‹ï½\n# cd hugo-theme-pure git commit -m 'chore: just a empty commit' --allow-empty å†ä¾†æˆ‘å€‘å›åˆ°å‰›å‰›çš„å°ˆæ¡ˆå…§ï¼Œä¸¦ä¸” cd åˆ° Submodule çš„è³‡æ–™å¤¾\n# cd themes/pure $ git pull origin master ä¾†è‡ª github.com:XiaoXiaoSN/hugo-theme-pure * branch master -\u0026gt; FETCH_HEAD æ›´æ–° c97723a..afa94b2 Fast-forward å›åˆ°é€™é‚Šç™¼ç¾ Submodule å·²ç¶“æ›´æ–°äº†\n# cd ../.. $ git submodule +afa94b26c59df0c4ce226f173d88fdc8ba9a0246 themes/pure (heads/master) å†é‡æ–°æ¨å‡ºå»å°±å¥½å›‰ï½ï½\ngit add --all git commit -m 'feat: upgrade `themes/pure`' git push origin master çœ‹é‚£å€‹ Commit Hash æ˜¯ä¸æ˜¯ä¸ä¸€æ¨£äº†å‘€ \u0026gt;u\u0026lt; Ref https://blog.wu-boy.com/2011/09/introduction-to-git-submodule/\n","id":13,"section":"posts","summary":"é–‹å§‹ä½¿ç”¨ ä¸Šæ¬¡æ›´æ›äº†ä¸€ä¸‹ Blog çš„ hugo themeï¼Œä½†æ˜¯å¾Œä¾†ç™¼ç¾ç›´æ¥ç”¨ git clone ä¸‹è¼‰ä¸‹ä¾†çš„ theme æ²’æœ‰æ›´æ–°åˆ° GitHub ä¸Šé¢ (â•¯â€¢Ì€á½¤â€¢Ì)â•¯ã€‚ æ­çµ¦æ­çµ¦ï¼Œæˆ‘å€‘æ”¹ç”¨ä¸€ä¸‹ Submodule è™•ç†ä¸€","tags":["git","hugo"],"title":"ç”¨ä¸€ä¸‹ Git Submodule å•¦","uri":"https://blog.10oz.tw/20220124-use-git-submodule/","year":"2022"},{"content":" Ubuntu 18.04 Kubernetes 1.21.4\nå•é¡Œæè¿° å…¶ä¸­ä¸€å° Master æ©Ÿå™¨çªç„¶æ›æ‰é–‹ä¸èµ·ä¾†ï¼Œå› æ­¤æ±ºå®šæŠŠä»–åˆªæ‰å†åŠ ä¸€å°æ–°çš„\n# æ‰¾å‡ºæœ‰å•é¡Œçš„ç¯€é» $ kubectl get node NAME STATUS ROLES AGE VERSION ip-172-16-16-101 NotReady,SchedulingDisabled control-plane,master 2d9h v1.22.1 ip-172-16-16-102 Ready control-plane,master 2d9h v1.21.4 ip-172-16-16-103 Ready control-plane,master 23h v1.21.4 # è™•ç†æ‰ä»–ï¼ï¼ï¼ $ kubectl drain ip-172-16-16-101 --force --ignore-daemonsets --delete-local-data $ kubectl delete node ip-172-16-16-101 ç„¶å¾Œå•é¡Œä¾†æƒ¹ï¼Œæ–°ç¯€é»å† kubeadm join æ™‚ï¼Œç«Ÿç„¶ç­‰ä¸åˆ°å‰›å‰›åˆªæ‰çš„æ©Ÿå™¨ï¼Œå¡åœ¨é€™é‚Šè·‘ä¸ä¸‹å»äº†ï¼ï¼\n[etcd] Checking etcd cluster health é€™è£¡æ˜¯åŠ ä¸Š --v=5 çš„è©³ç´°è³‡æ–™ ç„¶å¾Œçœ‹ kubelet çš„ log\n$ systemctl status kubelet # æ»¿æ»¿çš„æ‰¾ä¸åˆ°å•Š Failed to get etcd status for https://172.16.16.101:2379: failed to dial endpoint https://172.16.16.101:2379 with maintenance client: context deadline exceeded é–‹å§‹è™•ç†å®ƒ åˆ°å…¶ä»–å° Master å»ï¼Œæˆ‘å€‘è¦ç›´æ¥å‹• ETCD è£¡é¢çš„è³‡æ–™ï¼Œ é¦–å…ˆå®‰è£å·¥å…·\nsudo apt install etcd-client jq ä½¿ç”¨ member list æŸ¥çœ‹ç›®å‰çš„ ETCD æˆå“¡ç´€éŒ„\nETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key member list -w=json | jq . æŠ“åˆ°å•é¡Œä»”é‚„å¾…åœ¨è£¡é¢\n{ \u0026quot;header\u0026quot;: { \u0026quot;cluster_id\u0026quot;: 17126876678076365000, \u0026quot;member_id\u0026quot;: 863997665741218400, \u0026quot;raft_term\u0026quot;: 1998 }, \u0026quot;members\u0026quot;: [ { \u0026quot;ID\u0026quot;: 863997665741218400, \u0026quot;name\u0026quot;: \u0026quot;ip-172-16-16-103\u0026quot;, \u0026quot;peerURLs\u0026quot;: [ \u0026quot;https://172.16.16.103:2380\u0026quot; ], \u0026quot;clientURLs\u0026quot;: [ \u0026quot;https://172.16.16.103:2379\u0026quot; ] }, { \u0026quot;ID\u0026quot;: 11409705404260921000, \u0026quot;name\u0026quot;: \u0026quot;ip-172-16-16-102\u0026quot;, \u0026quot;peerURLs\u0026quot;: [ \u0026quot;https://172.16.16.102:2380\u0026quot; ], \u0026quot;clientURLs\u0026quot;: [ \u0026quot;https://172.16.16.102:2379\u0026quot; ] }, { \u0026quot;ID\u0026quot;: 12364568155915485000, \u0026quot;name\u0026quot;: \u0026quot;ip-172-16-16-101\u0026quot;, \u0026quot;peerURLs\u0026quot;: [ \u0026quot;https://172.16.16.101:2380\u0026quot; ], \u0026quot;clientURLs\u0026quot;: [ \u0026quot;https://172.16.16.101:2379\u0026quot; ] } ] } è¦å†å»æ‹¿ä¸€æ¬¡ Hex çš„ ID ç„¶å¾Œå‘¼å« member remove ç äº†ä»–\n$ ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key member list bfd894ca145a242, started, ip-172-16-16-103, https://172.16.16.103:2380, https://172.16.16.103:2379 9e576a9d2cd3b2cc, started, ip-172-16-16-102, https://172.16.16.102:2380, https://172.16.16.102:2379 ab97c53a3e73018b, started, ip-172-16-16-101, https://172.16.16.101:2380, https://172.16.16.101:2379 $ ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key member remove ab97c53a3e73018b å›åˆ°æ–°çš„ç¯€é»å» kubeadm reset æ‰å¾Œé‡è·‘ï¼Œå°±å¯ä»¥å›‰ï¼\nRef https://www.jianshu.com/p/451dc38b1289 https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/\n","id":14,"section":"posts","summary":"Ubuntu 18.04 Kubernetes 1.21.4 å•é¡Œæè¿° å…¶ä¸­ä¸€å° Master æ©Ÿå™¨çªç„¶æ›æ‰é–‹ä¸èµ·ä¾†ï¼Œå› æ­¤æ±ºå®šæŠŠä»–åˆªæ‰å†åŠ ä¸€å°æ–°çš„ # æ‰¾å‡ºæœ‰å•é¡Œçš„ç¯€é» $ kubectl get node NAME STATUS ROLES AGE VERSION ip-172-16-16-101 NotReady,SchedulingDisabled control-plane,master 2d9h v1.22.1 ip-172-16-16-102 Ready control-plane,master 2d9h v1.21.4 ip-172-16-16-103 Ready control-plane,master 23h","tags":["kubernetes"],"title":"K8s master é€€å‡ºä¸ä¹¾æ·¨ä¹‹æ–°çµé»é€²ä¸ä¾†","uri":"https://blog.10oz.tw/20210903-k8s-rejoin-drain-node/","year":"2021"},{"content":"æº–å‚™ deb æª” æº–å‚™å…©å°å¯¦é©—æ©Ÿå™¨ä¸€å°ç•¶ Server ä¸€å°ç•¶åš Client æˆ‘å€‘å…ˆåˆ° Server é€™é‚Šéš¨ä¾¿å¼„å€‹ .deb æª”æ¡ˆå‡ºä¾†ï¼Œé€™æ¬¡å°±æ‹¿ helm ä¾†ç•¶å¯¦é©—å“å§\ncurl https://baltocdn.com/helm/signing.asc | sudo apt-key add - sudo apt-get install apt-transport-https --yes echo \u0026quot;deb https://baltocdn.com/helm/stable/debian/ all main\u0026quot; | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list sudo apt-get update sudo apt-get install helm # æˆ–æ˜¯ç›´æ¥ä¸‹è¼‰ï¼Œæœƒåœ¨ç•¶å‰è³‡æ–™å¤¾ apt-get download helm ä¸‹è¼‰ä¸‹ä¾†çš„ .deb æœƒ Cache åœ¨é€™é‚Š /var/cache/apt/archives\n$ ls -al /var/cache/apt/archives | grep helm -rw-r--r-- 1 root root 13674294 Sep 1 05:25 helm_3.6.3-1_amd64.deb # å¹«å¥¹æ¬å€‹å®¶ï¼Œé–‹ä¸€å€‹ä»»æ„è³‡æ–™å¤¾ä¾†æ”¾ sudo mkdir -p /usr/local/mydebs cp /var/cache/apt/archives/helm_3.6.3-1_amd64.deb /usr/local/mydebs åˆ©ç”¨ dpkg-dev å·¥å…·ä¾†è£½é€ æè¿°æª”\n$ sudo apt-get install dpkg-dev # è·‘çœ‹çœ‹æœƒå‡ºä»€éº¼ $ dpkg-scanpackages debs/amd64 Package: helm Version: 3.6.3-1 Architecture: amd64 Maintainer: Matt Fox \u0026lt;matt@getbalto.com\u0026gt; Installed-Size: 44069 Filename: debs/amd64/helm_3.6.3-1_amd64.deb Size: 13674294 MD5sum: e9f028c0e7fc7253a912f9021abc4e3d SHA1: 12cf12bde1fb05aff129bf61f4bc21c5cadd1bc8 SHA256: 27c1a4822b134a2ae4e4e053a5fbb946ef34a33188cdf8a094c2299c3b8ae67b Section: default Priority: extra Homepage: https://helm.sh/ Description: The package manager for Kubernetes License: unknown Vendor: matt@Foxes-iMac.hitronhub.home dpkg-scanpackages: info: Wrote 1 entries to output Packages file. # æ‰“åŒ…èµ·ä¾†æ”¾ dpkg-scanpackages /usr/local/mydebs | gzip -9c \u0026gt; /usr/local/mydebs/Packages.gz ä»¥ä¸Šå‰ç½®ä½œæ¥­æº–å‚™å¥½äº†ï¼Œå·²ç¶“å¯ä»¥é–‹æœå‹™ä¾†è·‘äº† åœ¨ ubuntu æ©Ÿå™¨è£¡é¢ APT çš„ä¾†æºæª”æ¡ˆå¯«åœ¨ /etc/apt/sources.list æˆ–æ˜¯ /etc/apt/sources.list.d/ è³‡æ–™å¤¾è£¡é¢ï¼Œå¯ä»¥åœ¨é€™é‚ŠåŠ å…¥è‡ªå·±çš„ä¾†æºï¼\næœ¬åœ°æª”æ¡ˆè®€å–æ–¹æ³•ï¼Œä¸éå…¶ä»–å°æ©Ÿå™¨å°±çœ‹ä¸åˆ°å•¦ï½\necho \u0026quot;deb [trusted=yes] file:/usr/local/mydebs ./\u0026quot; \u0026gt;\u0026gt; /etc/apt/sources.list é–‹ HTTP Server ä½ æ‡¶çš„è©± python3 -m http.server ç›´æ¥é–‹èµ·ä¾†ï¼Œæˆ‘è©¦éä¹Ÿå¯ä»¥å‹• haha ä¸éä¸çŸ¥é“æœƒä¸æœƒæœ‰ä»€éº¼é¢¨éšª ğŸ˜‚\nå¯ä»¥æ‰¾ Apache2 ä¾†å¹«å¿™åš Web Server\nsudo apt-get install apache2 Apache Web Server é è¨­è®€å–çš„ä½ç½®åœ¨ /var/www/htmlï¼Œæˆ‘å€‘å¹«ä»–é–‹ä¸€å€‹å­ç›®éŒ„ä¾†åšäº‹\nmkdir /var/www/html/foo cp /usr/local/mydebs/Packages.gz /var/www/html/foo # è¦æä¾›çš„æ©Ÿå™¨æ˜¯ amd64 æ‰€ä»¥å†é–‹ä¸€å€‹è³‡æ–™å¤¾ï¼ŒæŠŠ `deb` æ”¾é€²å» mkdir /var/www/html/foo/amd64 cp /usr/local/mydebs/helm_3.6.3-1_amd64.deb /var/www/html/foo/amd64 ç¾åœ¨çš„ç›®éŒ„æ ¼å¼åƒæ˜¯é€™æ¨£\n/var/www/html$ tree . â”œâ”€â”€ foo â”‚Â â”œâ”€â”€ Packages.gz â”‚Â â””â”€â”€ amd64 â”‚Â â””â”€â”€ helm_3.6.3-1_amd64.deb â””â”€â”€ index.html å‡ºç™¼å»å¦å¤–ä¸€å° Client çš„æ©Ÿå™¨ï¼ŒæŠŠé€™å€‹ APT Repository æ”¾é€²å»ä¾†æºæª”ï½\n# é€™é‚Šçš„ 172.16.16.39 æ˜¯å‰›å‰›é‚£å° Apache Server çš„å…§ç¶² IP echo \u0026quot;deb [trusted=yes] http://172.16.16.39/foo/ /\u0026quot; \u0026gt;\u0026gt; /etc/apt/sources.list # ç„¶å¾Œæ›´æ–° apt-get update # ç„¶å¾Œå°±æŸ¥å¾—åˆ°ï¼ apt-cache search helm é›¢ç·šå®‰è£ deb æª”æ¡ˆ Install\nsudo dpkg -i package_file.deb # or sudo apt install package_file.deb Remove\nsudo apt-get remove package_name Ref https://help.ubuntu.com/community/Repositories/Personal https://medium.com/sqooba/create-your-own-custom-and-authenticated-apt-repository-1e4a4cf0b864 https://askubuntu.com/a/184340/1411904 Debian APT æ ¼å¼ https://wiki.debian.org/DebianRepository/Format https://help.ubuntu.com/kubuntu/desktopguide/C/manual-install.html\n","id":15,"section":"posts","summary":"æº–å‚™ deb æª” æº–å‚™å…©å°å¯¦é©—æ©Ÿå™¨ä¸€å°ç•¶ Server ä¸€å°ç•¶åš Client æˆ‘å€‘å…ˆåˆ° Server é€™é‚Šéš¨ä¾¿å¼„å€‹ .deb æª”æ¡ˆå‡ºä¾†ï¼Œé€™æ¬¡å°±æ‹¿ helm ä¾†ç•¶å¯¦é©—å“å§ curl https://baltocdn.com/helm/signing.asc | sudo apt-key add - sudo apt-get install apt-transport-https --yes echo \u0026quot;deb https://baltocdn.com/helm/stable/debian/ all main\u0026quot; | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list","tags":["ubuntu","apt"],"title":"ä¾†æ¶ä¸€å°ç§æœ‰ APT Repository","uri":"https://blog.10oz.tw/20210901-build-apt-repository/","year":"2021"},{"content":"å®‰è£ åœ¨ docker è£¡é¢å•Ÿå‹• kubernetes çš„å·¥å…·ï¼Œåœ¨ local ç«¯æ¸¬è©¦ç›¸ç•¶å¯¦ç”¨æ–¹ä¾¿!\nå®˜æ–¹æœ‰æä¾›å¤šå€‹å¹³å°çš„å®‰è£æ–¹å¼ï¼Œçœ‹é€™é»æˆ‘\né€™é‚Šç”¨ä¸€å€‹ macOS çš„ HomeBrew ä¾†è£\nbrew install kind kind version # kind v0.11.0 go1.16.3 darwin/amd64 å¸¸ç”¨æŒ‡ä»¤å¯«ä¸‹ä¾† å»ºç«‹æ–°ç¾¤é›† æ³¨æ„è¦æŒ‡å®š kube config çš„ä½ç½®ï¼Œä¸ç„¶ä»–æœƒå¹«ä½ æ”¾åˆ° ~/.kube/config è£¡é¢å–”ï¼Œäº‚äº‚çš„ä¸å¥½æ•´ç†å§!! kind create cluster --kubeconfig $HOME/.kube/kind.conf é‚„å¯ä»¥ç”¨ --name ä¾†æ¶è¨­å¤šå€‹ç¾¤é›† (é è¨­ name æœƒçµ¦ä½  kind) kind create cluster --name kind-2 å–å¾—ç›®å‰å»ºç«‹çš„ kind get clusters åˆªæ‰ç¾¤é›† kind delete cluster Ref https://kind.sigs.k8s.io/\n","id":16,"section":"posts","summary":"å®‰è£ åœ¨ docker è£¡é¢å•Ÿå‹• kubernetes çš„å·¥å…·ï¼Œåœ¨ local ç«¯æ¸¬è©¦ç›¸ç•¶å¯¦ç”¨æ–¹ä¾¿! å®˜æ–¹æœ‰æä¾›å¤šå€‹å¹³å°çš„å®‰è£æ–¹å¼ï¼Œçœ‹é€™é»æˆ‘ é€™é‚Šç”¨ä¸€å€‹ macOS çš„ HomeBrew ä¾†è£ brew install kind kind version # kind v0.11.0 go1.16.3 darwin/amd64 å¸¸ç”¨æŒ‡ä»¤å¯«ä¸‹","tags":["kubernetes","kind"],"title":"kind ç­†è¨˜","uri":"https://blog.10oz.tw/20210821-kind-notes/","year":"2021"},{"content":"ä»‹ç´¹ Nix (Nixpkgs) Nix ä¸€èˆ¬ä¾†èªªæ˜¯æŒ‡ Nixpkgs æ˜¯ä¸€å¥—å¥—ä»¶ç®¡ç†ç³»çµ±ï¼Œåˆ©ç”¨ç¨ç‰¹çš„å‡½æ•¸å¼èª è¨€ä¾†å®šç¾©å®‰è£çš„å¥—ä»¶ã€‚åœ¨å®‰è£å¥—ä»¶ç‚ºæ¯ä¸€å€‹ç¨ç«‹å¥—ä»¶çš„ä¾è³´é …åšç‰ˆæœ¬æ§åˆ¶ï¼Œé¿å…äº†å‚³çµ±å¥—ä»¶ç®¡ç†ç³»çµ±å®‰è£ä¸åŒå¥—ä»¶ç”¨åˆ°ç›¸åŒä¾è³´æ™‚çš„ç‰ˆæœ¬æ›´æ–°å•é¡Œï¼æˆ–æ˜¯ç§»é™¤ã€å®‰è£æŸäº›éœ€è¦è¨±å¤šä¾è³´çš„è»Ÿé«”æ™‚ï¼Œèƒ½ç¯€çœä½ è¨±å¤šæ™‚é–“ï¼ï¼åˆæˆ–è€…ä½ åŒæ™‚éœ€è¦ MySQL 5.5, MySQL 5.7 çš„ Instance æ™‚ä¹Ÿé©ç”¨ï½\nèƒ½å¤ åšåˆ°åŸå­æ€§å®‰è£ã€åˆªé™¤ï¼Œå› æ­¤èƒ½è¼•æ˜“çš„é€€ç‰ˆã€å‡ç´šï¼Œæ›´èƒ½è¼•æ˜“å¾—åšåˆ°é–‹ç™¼ç’°å¢ƒçš„åˆ‡æ›ã€‚ï¼ˆç•¶ç„¶ä»£åƒ¹æ˜¯åŒæ™‚æœƒæœ‰å¤šå€‹ç‰ˆæœ¬çš„è»Ÿé«”ä½”ç”¨å„²å­˜ç©ºé–“ï¼‰\nNixOS NixOS å‰‡æ˜¯åŸºæ–¼ Nixpkgs ä¾†ç®¡ç†æ•´å€‹ Linux Kernel çš„ OSï¼Œæ‰€æœ‰çš„ç³»çµ±è¨­å®šä¹Ÿéƒ½ç”± nix æ”¯æ´ï¼Œèƒ½å¤ é…ç½®çš„åˆ‡æ›æ”œå¸¶åˆ°å¦ä¸€å°æ©Ÿå™¨ä¸Šï¼\nç¼ºé» è‡ªæˆä¸€æ ¼çš„ç®¡ç†æ¨¡å¼å›ºç„¶èƒ½åšåˆ°å¾ˆå¤šäº‹ï¼Œä½†ä¹Ÿå°è‡´è¨±å¤šå¥—ä»¶æœªèƒ½æ”¯æ´ï¼Œéœ€ä»°è³´ç¤¾ç¾¤å…±åŒç¶­è­·çš„åŠ›é‡æŒçºŒæ›´æ–°èˆ‡å®Œå–„æ•´é«”ç”Ÿæ…‹ æ‰€æœ‰çš„ Packages éƒ½åœ¨é€™é‚Šï¼Œå¦‚æœç™¼ç¾æœ‰ç¼ºå°‘çš„è³‡æºå¯ä»¥å¹«ä»–é–‹ PR å”·ï½\nå®‰è£ Nix è·Ÿéš¨å®˜æ–¹ä¸‹è¼‰æ•™å­¸çš„æŒ‡ç¤ºï¼ŒMacOS é€™æ¨£è£\n$ sh \u0026lt;(curl -L https://nixos.org/nix/install) # é è¨­åªæœƒå¹«ä½ åœ¨ `/etc/bashrc` `/etc/zshrc` åšå¥½å¼•ç”¨ï¼Œ # å¦‚æœä½ æƒ³åœ¨ fish ä½¿ç”¨çš„è©±ï¼Œé€™è£¡æœ‰äººå¹«å¿™åšé€£çµ fisher install lilyball/nix-env.fish Nixpkgs å¸¸ç”¨æŒ‡ä»¤ nix-env å®‰è£åŠç®¡ç†å¥—ä»¶å®‰è£ nix-env -i hello Install the package hello nix-env -e hello Remove the package hello nix-env -q List installed packages nix-shell å®‰è£å¥—ä»¶ä¸¦åœ¨æ–°çš„ shell é–‹å•Ÿ é€™åœ¨æ¸¬è©¦ä¸€äº›å¥—ä»¶æ™‚éå¸¸æœ‰ç”¨ï¼Œä¸æœƒå½±éŸ¿åˆ°ä½ å¹³æ™‚ä½¿ç”¨çš„ç’°å¢ƒ\nnix-shell -p pgformatter nix-collect-garbage æ¸…é™¤æ²’æœ‰è¢«ä½¿ç”¨åˆ°çš„å„²å­˜é€£çµ nix-collect-garbage --delete-older-than 30d å°‹æ‰¾ä½ è¦çš„å¥—ä»¶å€‘ https://search.nixos.org/\nåœ¨ NixOS ç’°å¢ƒ\nnix-env -iA nixos.go é NixOS ç’°å¢ƒï¼ˆå–®ç´” Nix Package ç®¡ç†ï¼‰\nnix-env -iA nixpkgs.go åˆ—å‡º(query)å·²å®‰è£å¥—ä»¶å€‘\nnix-env -q è§£é™¤å®‰è£(uninstall)å·²å®‰è£å¥—ä»¶å€‘\nnix-env --uninstall direnv NixOS å¸¸ç”¨æŒ‡ä»¤ nixos-rebuild switch æ›´æ–° configuration.nix å¾Œåˆ‡æ›åˆ°æ–°çš„ç³»çµ±ç’°å¢ƒè¨­å®š nixos-option nixos-option system.stateVersion æŸ¥çœ‹æŸå€‹è¨­å®šå€¼èªªæ˜ï¼ Ref https://www.bobby285271.top/zh/ops/nixos-installation NixOS: How it works and how to install it! https://youtu.be/oPymb2-IXbg https://nix.dev/\n","id":17,"section":"posts","summary":"ä»‹ç´¹ Nix (Nixpkgs) Nix ä¸€èˆ¬ä¾†èªªæ˜¯æŒ‡ Nixpkgs æ˜¯ä¸€å¥—å¥—ä»¶ç®¡ç†ç³»çµ±ï¼Œåˆ©ç”¨ç¨ç‰¹çš„å‡½æ•¸å¼èª è¨€ä¾†å®šç¾©å®‰è£çš„å¥—ä»¶ã€‚åœ¨å®‰è£å¥—ä»¶ç‚ºæ¯ä¸€å€‹ç¨ç«‹å¥—ä»¶çš„ä¾è³´é …åšç‰ˆæœ¬æ§åˆ¶ï¼Œé¿å…äº†å‚³çµ±å¥—","tags":["nix","nixos"],"title":"èªè­˜ä¸€æ¬¡ Nix å¥—ä»¶ç®¡ç†ç³»çµ±","uri":"https://blog.10oz.tw/20210708-first-take-nix-package-manager/","year":"2021"},{"content":"Linux DE Linux çš„ Desktop Environments çœŸçš„å¤šåˆ°ä¸å¯æ€è­°å•¦ï¼Œæ€éº¼é¸æ€éº¼ç©å’§\nKDE Plasma 5 å¤§å®¶ç†ŸçŸ¥çš„ä¸€å€‹è¼•é‡ DEï¼Œæœ‰ç¾ä»£ä¸”å„ªé›…çš„ä»‹é¢å’Œé«˜åº¦å¯è‡ªè¨‚çš„å„ªé»ã€‚ ä¸éä¹Ÿç”±æ–¼é«˜åº¦è‡ªè¨‚çš„é—œä¿‚å°è‡´ä¸Šæ‰‹é›£åº¦æœƒç›¸å°æé«˜ï¼\né è¨­å®‰è£ Plasma çš„æœ‰ openSUSEã€Kubuntu å’Œ KDE Neonï¼Œç•¶ç„¶ä½œç‚ºç†±é–€ DE å¸¸è¦‹çš„ Linux ç™¼è¡Œç‰ˆä¹Ÿå…¶å®‰è£æ•™å­¸\nGNOME çœŸæ­£çš„å¤§ä½¬ä¾†äº†ï¼Œåšç‚ºæœ€å¤š Linux ç™¼è¡Œç‰ˆï¼ˆå’Œå¤šæ•¸çš„ BSD ç³»çµ±ï¼‰é è¨­çš„ DEï¼Œæ›´æœ‰è¨±å¤šçš„ DE éƒ½æ˜¯åŸºæ–¼ä»–ä¿®æ”¹ä¾†çš„ã€‚ ç¼ºé»æ˜¯å¤§å®¶éƒ½èªªä»–èƒ– QQï¼Œå¦‚æœè¦é¸æ“‡å®‰è£åœ¨è¼•é‡å‹æ©Ÿå™¨ä¸Šæ™‚å¯èƒ½ä¸æ˜¯é¦–é¸\nUbuntu ç›®å‰ä¹Ÿæ˜¯ä½¿ç”¨ GNOME ä½œç‚ºå…¶é è¨­ DE\nXfce å…·æœ‰è¶…è¼•é‡ã€ä½è€—ã€ç©©å®šç­‰å„ªé»ï¼Œä¹Ÿæ˜¯ç›®å‰ linux ç™¼è¡Œç‰ˆå¸¸è¦‹çš„é è¨­ DEï¼Œé›–ç„¶è¼ƒæ²’æœ‰é«˜ç´šçš„åŠŸèƒ½è¨­å®šä½†æ˜¯åœ¨æ€§èƒ½å„ªå…ˆçš„ç’°å¢ƒä¸‹å¯ä»¥è€ƒæ…®ä½¿ç”¨ Xfce\nçŸ¥åé è¨­ DE ç‚º Xfce çš„æœ‰ kali linuxå®˜æ–¹ä¹Ÿæœ‰æ•™ä½ è½‰ KDE) ä»¥åŠ Xubuntu\nLXDE \u0026amp;\u0026amp; LXQt è¼•é‡å‹çš„ DEï¼Œå¾åå­—ä¸é›£çœ‹å‡ºæ˜¯ç”± Qt é–‹ç™¼çš„ï¼Œå¾éå»çš„ LXDE ç§»æ¤åˆ° Qt å¾Œè¼•é‡åŒ–äº†ä¸å°‘ï¼ ç„¶å¾Œ LXQt ä½œè€…æ˜¯å€‹å°ç£äººå–”xDDD\nRaspberry Pi OS ä½¿ç”¨çš„ DE PIXEL æ˜¯ç”± LXDE ä¿®æ”¹è€Œä¾†\nPantheon Like macOS è¨­è¨ˆçš„ DEï¼ŒåŸºæ–¼ GNOME é–‹ç™¼è€Œä¾†ã€‚ æˆ‘å€‹äººä½¿ç”¨æ™‚é–“æœ€é•·çš„ç’°å¢ƒï¼Œç›´åˆ°æˆ‘ç”¨æƒ¹çœŸæ­£çš„ macOS æ‰ç™¼ç¾ä»–æ ¹æœ¬ä¸è¡Œå˜› xDDD ä¸éä¹Ÿæ˜¯å¥½å¹¾å¹´ä»¥å‰çš„äº‹æƒ…äº†ï¼Œä»–æŒçºŒæœ‰åœ¨æ›´æ–°å¯ä»¥å†å¤šçœ‹ä¸€ä¸‹ï½ï½\nelementary OS é è¨­ DE\nUnity é€™æ˜¯æˆ‘æœ€æ—©æ¥è§¸åˆ°çš„ä¸€å€‹ DEï¼Œä¹Ÿæ˜¯æ—©æœŸ Ubuntu çš„é è¨­ä»‹é¢ï¼ˆUbuntu 17.04æ˜¯æœ€å¾Œä¸€å€‹é è¼‰ Unity æ¡Œé¢ç’°å¢ƒçš„ç‰ˆæœ¬ï¼‰ å®ƒä¹Ÿæ˜¯ç”± GNOME ä¿®æ”¹è€Œä¾†ã€‚ Ref https://itsfoss.com/best-linux-desktop-environments/ https://github.com/twtrubiks/linux-note/tree/master/linux-de\n","id":18,"section":"posts","summary":"Linux DE Linux çš„ Desktop Environments çœŸçš„å¤šåˆ°ä¸å¯æ€è­°å•¦ï¼Œæ€éº¼é¸æ€éº¼ç©å’§ KDE Plasma 5 å¤§å®¶ç†ŸçŸ¥çš„ä¸€å€‹è¼•é‡ DEï¼Œæœ‰ç¾ä»£ä¸”å„ªé›…çš„ä»‹é¢å’Œé«˜åº¦å¯è‡ªè¨‚çš„å„ªé»ã€‚ ä¸éä¹Ÿç”±æ–¼é«˜åº¦è‡ªè¨‚çš„é—œä¿‚å°","tags":["linux","de"],"title":"èªè­˜ä¸€æ¬¡å¸¸è¦‹ Linux GUI (Desktop Environments)","uri":"https://blog.10oz.tw/20210706-known-popular-linux-de/","year":"2021"},{"content":"æè¿°å•é¡Œ éŒ¯èª¤è¨Šæ¯é¡ä¼¼é€™æ¨£ï¼š èªè­˜å•é¡Œ åŸä¾†å‘¢ï¼Œåœ¨ Rust è£¡é¢çš„ Async åˆ†äº«è®Šæ•¸æ™‚æœƒåƒè€ƒ Send Sync é€™å…©å€‹ Trait\nSend è¡¨ç¤ºä»–èƒ½åœ¨ä¸åŒçš„ Thread ä¸­å‚³é A type is Send if it is safe to send it to another thread.\nSync è¡¨ç¤ºä»–èƒ½åŒæ™‚è¢«å¤šå€‹ç·šç¨‹åˆ†äº«ä½¿ç”¨ (T is Sync if and only if \u0026amp;T is Send) A type is Sync if it is safe to share between threads (T is Sync if and only if \u0026amp;T is Send).\nä¸¦ä¸”è¦æ³¨æ„ï¼Œ Send å’Œ Sync æ˜¯è‡ªå‹•åˆ†é…çš„ Traitsï¼Œå› æ­¤å¤§éƒ¨åˆ†æ¥è§¸åˆ°çš„å…ƒä»¶éƒ½æœƒæ˜¯å¯¦ä½œ Send æˆ– Sync çš„ï¼Œåƒæ˜¯å¯ä»¥æ³¨æ„ä»¥ä¸‹å¹¾é»ä¾‹å¤–ï¼š\nraw pointers are neither Send nor Sync (because they have no safety guards). UnsafeCell isn\u0026rsquo;t Sync (and therefore Cell and RefCell aren\u0026rsquo;t). Rc isn\u0026rsquo;t Send or Sync (because the refcount is shared and unsynchronized). æ›´å¤šçš„å…§å®¹è«‹è®€ å®˜æ–¹èªªæ˜\né‚£éº¼ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦é€™å…©å€‹ Auto Trait å‘¢ï¼Ÿ é€™å°±æ˜¯ Rust å°è¨˜æ†¶é«”ç®¡ç†å²å®³çš„åœ°æ–¹äº†ï½\nèƒ½å¤ åœ¨ Compiler time å°±æŠ“å‡ºå¯èƒ½ç™¼ç”Ÿ race condition çš„ç¨‹å¼ç¢¼ï¼Œç¢ºä¿è®Šæ•¸ä½¿ç”¨çš„å®‰å…¨æ€§ï¼\nRef https://blog.rust-lang.org/inside-rust/2019/10/11/AsyncAwait-Not-Send-Error-Improvements.html https://hexilee.me/2019/11/07/async-block-send/ https://doc.rust-lang.org/nomicon/send-and-sync.html\n","id":19,"section":"posts","summary":"æè¿°å•é¡Œ éŒ¯èª¤è¨Šæ¯é¡ä¼¼é€™æ¨£ï¼š èªè­˜å•é¡Œ åŸä¾†å‘¢ï¼Œåœ¨ Rust è£¡é¢çš„ Async åˆ†äº«è®Šæ•¸æ™‚æœƒåƒè€ƒ Send Sync é€™å…©å€‹ Trait Send è¡¨ç¤ºä»–èƒ½åœ¨ä¸åŒçš„ Thread ä¸­å‚³é A type is Send if it is safe to send it to another thread. Sync è¡¨","tags":["rust","future"],"title":"Rust - Future cannot be sent between threads safely","uri":"https://blog.10oz.tw/20210703-rust-future-cannot-be-sent-between-threads-safely/","year":"2021"},{"content":"å…§å®¹é–‹å§‹ å·²ç¶“æ˜¯å¾ˆå…¬é–‹çš„æ¨™æº–äº†ï¼Œè³‡æ–™å¤šåˆ°ä¸è¡Œï½ï½ é‚„æ˜¯ç­†è¨˜ä¸€ä¸‹\nå–å¾—åº§æ¨™ - getCurrentPosition MDN Doc\nconst successCallback = (position) =\u0026gt; { // position.coords.latitude ç·¯åº¦ // position.coords.longitude ç²¾åº¦ // position.timestamp å–å¾—çš„æ™‚é–“æˆ³ ex:1624703519728 } const errorCallback = (err) =\u0026gt; { // err.code åˆ—è¡¨ // err.PERMISSION_DENIED: 1 // err.POSITION_UNAVAILABLE: 2 // err.TIMEOUT: 3 if (err.code === err.PERMISSION_DENIED) { console.log('ä½ å°±æ˜¯æ²’é–‹å˜›') } } const options = { // false | true enableHighAccuracy: true, // integer (milliseconds) // amount of time before the error callback is invoked, // if 0 it will never invoke. timeout: 5000, // integer (milliseconds) // infinity - maximum cached position age. maximumAge: 0 } navigator.geolocation.getCurrentPosition(successCallback, errorCallback, options) å®šæœŸæŸ¥çœ‹åº§æ¨™ - watchPosition MDN Doc\n// æœƒå›å‚³ä¸€å€‹ id ç”¨ä¾†å–æ¶ˆ watchï¼Œå…¶å®ƒç”¨æ³•è·Ÿ getCurrentPosition ä¸€æ¨£çš„ const wid = navigator.geolocation.watchPosition(successCallback, errorCallback, options) // é€™æ¨£å­é—œï½ navigator.geolocation.clearWatch(wid) ç¢ºèªæ¬Šé™ æœ‰æ™‚å€™æœƒæƒ³è¦æª¢æŸ¥æ¬Šé™ç¾åœ¨çš„ç‹€æ…‹\nnavigator.permissions.query({ name: 'geolocation' }) .then(result =\u0026gt; { // result.state æœ‰ä¸‰ç¨® // granted å…è¨± // prompt è¦è©¢å• // denied å°é– }) è¨ˆç®—å…©é»ä¹‹é–“çš„è·é›¢ æ„Ÿè¦ºæœƒæ”¾åœ¨ä¸€èµ·ç”¨ï½ ç­†è¨˜èµ·ä¾†\nconst getDistance = (lat1, lng1, lat2, lng2, unit) =\u0026gt; { const radLat1 = (Math.PI * lat1) / 180 const radLat2 = (Math.PI * lat2) / 180 const theta = lng1 - lng2 const radTheta = (Math.PI * theta) / 180 let dist = Math.sin(radLat1) * Math.sin(radLat2) + Math.cos(radLat1) * Math.cos(radLat2) * Math.cos(radTheta) if (dist \u0026gt; 1) { dist = 1 } dist = Math.acos(dist) dist = (dist * 180) / Math.PI dist = dist * 60 * 1.1515 if (unit === 'K') { dist *= 1.609344 } if (unit === 'N') { dist *= 0.8684 } return dist // 'M' is statute miles (default) } Ref https://www.pluralsight.com/guides/how-to-use-geolocation-call-in-reactjs https://developer.mozilla.org/zh-TW/docs/Web/API/Navigator/geolocation\n","id":20,"section":"posts","summary":"å…§å®¹é–‹å§‹ å·²ç¶“æ˜¯å¾ˆå…¬é–‹çš„æ¨™æº–äº†ï¼Œè³‡æ–™å¤šåˆ°ä¸è¡Œï½ï½ é‚„æ˜¯ç­†è¨˜ä¸€ä¸‹ å–å¾—åº§æ¨™ - getCurrentPosition MDN Doc const successCallback = (position) =\u0026gt; { // position.coords.latitude ç·¯åº¦ // position.coords.longitude ç²¾åº¦ // position.timestamp å–å¾—çš„æ™‚é–“æˆ³ ex:1624703519728 } const errorCallback = (err) =\u0026gt; { // err.code åˆ—","tags":["javascript","location","geographic"],"title":"JavaScript å–å¾—åº§æ¨™ä½å€","uri":"https://blog.10oz.tw/20210623-get-geo-in-javascript/","year":"2021"},{"content":"ä½ å•é˜¿ç‹—æ˜¯ä»€éº¼ GitOps + Kubernetes çš„ç”¢ç‰©ï¼Œç›¸ç•¶ä¸éŒ¯çš„é‹ç¶­å·¥å…·\nå…ˆä¾†è£ Argo CD æˆ‘å€‘è¦ç”¨ helm å®‰è£è£èµ·ä¾†å–”\nhelm repo add argo-cd https://argoproj.github.io/argo-helm helm repo update ä¾†æº–å‚™å€‹ values.yaml\ninstallCRDs: false global: image: tag: v1.8.6 dex: enabled: false server: extraArgs: - --insecure # å¦‚æœèªªä½ æœ‰éœ€è¦ç”¨åå‘ä»£ç†æŠ“ subpathï¼Œå¯ä»¥åœ¨é€™è£¡è¨­å®š # - --basehref=/argo # - --rootpath=/argo config: # é€™è£¡è¦æŠŠä½ è¦ç›£çœ‹çš„ git repo æ”¾ä¸Šä¾†ï¼Œ # ç¯„ä¾‹æ˜¯ç§æœ‰ Gitlab çš„è¨­å®šæ–¹å¼ repositories: | - name: dev-argo insecure: true insecureIgnoreHostKey: true sshPrivateKeySecret: name: argocd-secret key: webhook.gitlab.secret type: git url: git@gitlab.10oz.tw:self_group/dev-argo.git metrics: enabled: true configs: secret: # é€™è£¡ç”¢ç”Ÿä¸€å€‹ ssh key ä¾†è¨­å®š gitlab repo è£¡é¢çš„ deploy key # ç„¶å¾ŒæŠŠç›¸æ‡‰çš„ private æä¾›çµ¦ Argo ä½¿ç”¨ gitlabSecret: |- first set ssh-public-key in gitlab repo, Settings \u0026gt; Repository \u0026gt; Deploy Keys and replace the field with ssh-private-key PS: å¾Œé¢æœ‰èªªé€™è£çš„ Repository è·Ÿ Secret åœ¨å“ªè£¡å¼„ :) åæ­£å…ˆè£ç­‰ç­‰é‚„èƒ½æ”¹ XDD\nä¸‹å€‹å®‰è£æŒ‡ä»¤\nhelm install argo-cd argo-cd/argo-cd --version 2.11.0 --namespace argocd --values ./values.yaml ä½ å¯ä»¥æŠŠä»– port forward å‡ºä¾†çœ‹ä¸€ä¸‹\nkubectl port-forward svc/argo-cd-argocd-server 8080:443 -n argocd å¸³è™Ÿæ˜¯ adminï¼Œè€Œå¯†ç¢¼æœƒè‡ªå‹•ç”¢ç”Ÿï¼Œé è¨­æ˜¯ Argo-CD server çš„ Pod Name\n# é†¬å­æ‹¿å‡ºä¾†çœ‹ kubectl get pods -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2 å¦å¤–ï¼Œä¹Ÿå¯ä»¥å®‰è£ argo cli ä¾†ä¿®æ”¹å¯†ç¢¼\nbrew install argocd argocd login localhost:8080 argocd account update-password é–‹èµ·ä¾†æœƒçœ‹åˆ°é€™æ¨£çš„ç•«é¢ (PS: é‚£å…©å€‹æ–¹æ¡†æ¡†é‚„ä¸æœƒæœ‰ï¼Œç­‰ä¸€ä¸‹æ‰è¦è£) æŒ‰åˆ°å·¦é‚Šé½’è¼ªçš„ Settings ç„¶å¾Œ Repositoriesï¼Œå¦‚æœèªªä½ çš„ Gitlab Repo é‚„æ²’è¨­å®šçš„è©±ï¼Œé€™è£¡ä¸æœƒæ˜¯ç¶ è‰²å‹¾å‹¾ Success å†ä¾†è¨­å®š ArgoCD å…ˆä¾†æå®š Gitlab Repo å‰›å‰›ä¸Šé¢å¡«äº†ä¸€å€‹ repository çš„åœ°å€ï¼Œç¾åœ¨è¦è®“ä»–æˆçœŸ (? ç¸½ä¹‹å°±é–‹ä¸€å€‹ self_group/dev-argo Repo åœ¨ gitlab.10oz.twï¼Œè«‹è‡ªå·±ä¾ç…§ç’°å¢ƒèª¿æ•´é½ é–‹å¥½äº†ä¹‹å¾Œå°±é»é€²å»å§~~\né¦–å…ˆä½ éœ€è¦é•·ä¸€å€‹ ssh rsa key å‡ºä¾†\nssh-keygen -f ./argo-deploy-key ç„¶å¾ŒæŠŠä½ çš„ Public Key (argo-deploy-key.pub) è¨­åœ¨é€™è£¡ï½ é€™æ™‚å€™ Argo æœ‰èƒ½åŠ›å»çœ‹ä½ çš„ Gitlab Repo äº†ï¼Œä»–æœƒå‘Šè¨´ä½ èªªä½ çš„ Repo è£¡é¢æ˜¯ç©ºã„‰å–”å–”å–”å–”\nè®“æˆ‘å€‘ä¾†å¡ä¸€é»æ±è¥¿é€²å»ã„…ï¼Œä¸€å€‹ application ç”¨ä¾†è¨­å®š Argo çš„ç›£çœ‹ç›®æ¨™ï¼Œè€Œé€™æ¬¡ç›£çœ‹çš„ç›®æ¨™æ˜¯ traefik/ingress-route é€™å€‹è³‡æ–™å¤¾åº•ä¸‹çš„ä¸€èˆ¬ kubernetes è¨­å®šæª”æ¡ˆ\n. â”œâ”€â”€ README.md â”œâ”€â”€ applications â”‚ â”œâ”€â”€ traefik-ingress-route.yaml â””â”€â”€ traefik â””â”€â”€ ingress-route â””â”€â”€ argo-route.yaml applications/traefik-ingress-route.yaml\nkind: Application apiVersion: argoproj.io/v1alpha1 metadata: name: golang-traefik-ingress-route namespace: argocd spec: project: default destination: name: in-cluster namespace: traefik source: path: traefik/ingress-route repoURL: 'git@gitlab.10oz.tw:self_group/dev-argo.git' targetRevision: HEAD syncPolicy: automated: prune: true traefik/ingress-route/argo-route.yaml\nkind: IngressRoute apiVersion: traefik.containo.us/v1alpha1 metadata: name: argocd-server-route namespace: argocd spec: routes: - kind: Rule match: Host(`foo.10oz.tw`) \u0026amp;\u0026amp; PathPrefix(`/argo`) services: - name: argo-cd-argocd-server port: 80 Commit æ¨å‡ºå»ï¼Œå°±é†¬å­å°±èƒ½å‹•äº†å–” ğŸ‘ğŸ‘\nRef https://argoproj.github.io/argo-cd/#quick-start https://www.qikqiak.com/post/gitlab-ci-argo-cd-gitops/\n","id":21,"section":"posts","summary":"ä½ å•é˜¿ç‹—æ˜¯ä»€éº¼ GitOps + Kubernetes çš„ç”¢ç‰©ï¼Œç›¸ç•¶ä¸éŒ¯çš„é‹ç¶­å·¥å…· å…ˆä¾†è£ Argo CD æˆ‘å€‘è¦ç”¨ helm å®‰è£è£èµ·ä¾†å–” helm repo add argo-cd https://argoproj.github.io/argo-helm helm repo update ä¾†æº–å‚™å€‹ values.yaml installCRDs: false global: image: tag: v1.8.6 dex: enabled: false server: extraArgs: - --insecure # å¦‚æœèªªä½ ","tags":["argo","cd","gitlab"],"title":"ç©¶ç«Ÿé˜¿ç‹—èƒ½åšä»€éº¼å‘¢","uri":"https://blog.10oz.tw/20210409-what-can-argocd-do/","year":"2021"},{"content":"ç™¼ç¾ k8s æ©Ÿå™¨çš„ç¡¬ç¢Ÿç©ºé–“æ»¿äº† æ»¿äº†è€¶ï¼ï¼æ€éº¼æœƒé€™æ¨£ è¶é‚„æœ‰ç©ºé–“è¶•å¿« ssh é€²å»çœ‹ä¸€çœ¼\ndev@k8s07:~$ df -h Filesystem Size Used Avail Use% Mounted on udev 5.9G 0 5.9G 0% /dev tmpfs 1.2G 4.5M 1.2G 1% /run /dev/mapper/ubuntu--vg-ubuntu--lv 98G 70G 23G 76% / tmpfs 5.9G 0 5.9G 0% /dev/shm tmpfs 5.0M 0 5.0M 0% /run/lock tmpfs 5.9G 0 5.9G 0% /sys/fs/cgroup /dev/sda2 976M 213M 696M 24% /boot tmpfs 1.2G 0 1.2G 0% /run/user/1000 é–‰çœ¼å…ˆæ¸…ç©ºä¸€æ³¢ Docker image, volume\u0026hellip;\ndocker system prune -a æª¢æŸ¥ä¸€ä¸‹é‚„æœ‰å•¥ç±³æ±è¥¿ä½”ç”¨äº†æˆ‘å€‘çš„ç©ºé–“\nsudo du -ahx / | sort -rh | head -n 20 find /var/lib/docker/ -name \u0026quot;*.log\u0026quot; -exec ls -sh {} \\; | sort -h -r | head -20 ä¸€çœ‹ç™¼ç¾åŸä¾†æˆ‘æœ‰ä¸€å€‹ 30G ä¸€å€‹ 18G çš„ docker logsï¼Œæœ‰å¤ å¤§å•¦ğŸ˜‚ çœ‹ä¸€ä¸‹ log å…§å®¹å°±ç™¼ç¾äº†åŸå› æ˜¯æœ€è¿‘æ–°å¢çš„çˆ¬èŸ²çš„é—œä¿‚ QQ (é‚„æœ‰ fluent-bit ä¹Ÿä¸å°)\nè§£æ±ºä»– æ²’äº‹æ²’äº‹ï¼Œä¹‹å‰å¯èƒ½å¤§æ„äº†æ²’æœ‰æƒ³åˆ°é€™ç¨® Case ç°¡å–®åŠ å€‹è¦å‰‡å°±å¥½äº†\ncat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt;EOF { \u0026quot;exec-opts\u0026quot;: [\u0026quot;native.cgroupdriver=cgroupfs\u0026quot;], \u0026quot;log-driver\u0026quot;: \u0026quot;json-file\u0026quot;, \u0026quot;log-opts\u0026quot;: { \u0026quot;max-size\u0026quot;: \u0026quot;1g\u0026quot;, \u0026quot;max-file\u0026quot;: \u0026quot;3\u0026quot; }, \u0026quot;storage-driver\u0026quot;: \u0026quot;overlay2\u0026quot; } EOF The max-size is a limit on the docker log file, so it includes the json or local log formatting overhead. And the max-file is the number of logfiles docker will maintain. After the size limit is reached on one file, the logs are rotated, and the oldest logs are deleted when you exceed max-file.\nNote: Restart Docker for the changes to take effect for newly created containers. Existing containers do not use the new logging configuration.\n# Restart docker. systemctl restart docker # æ‰‹å‹•åˆªé™¤èˆŠçš„å¤§æª”æ¡ˆ cat /dev/null \u0026gt; å¤§æª”æ¡ˆ.log ä¸€å€‹å°å‘ å¦å¤–è¦æ³¨æ„ï¼Œæˆ‘ç¬¬ä¸€æ¬¡å¯«çš„æ™‚å€™ daemon.json docker cgroup driver è¨­å®šæˆ systemd å°±ç‚¸æ‰äº†XDD\n$ journalctl -xeu kubelet # ....something failed to run Kubelet: misconfiguration: kubelet cgroup driver: \u0026quot;cgroupfs\u0026quot; is different from docker cgroup driver: \u0026quot;systemd\u0026quot; # ...something Ref https://www.linode.com/community/questions/16922/my-disk-is-filling-up-how-can-i-find-the-culprit https://docs.docker.com/config/containers/logging/configure/#configure-the-default-logging-driver https://stackoverflow.com/questions/31829587/docker-container-logs-taking-all-my-disk-space\n","id":22,"section":"posts","summary":"ç™¼ç¾ k8s æ©Ÿå™¨çš„ç¡¬ç¢Ÿç©ºé–“æ»¿äº† æ»¿äº†è€¶ï¼ï¼æ€éº¼æœƒé€™æ¨£ è¶é‚„æœ‰ç©ºé–“è¶•å¿« ssh é€²å»çœ‹ä¸€çœ¼ dev@k8s07:~$ df -h Filesystem Size Used Avail Use% Mounted on udev 5.9G 0 5.9G 0% /dev tmpfs 1.2G 4.5M 1.2G 1% /run /dev/mapper/ubuntu--vg-ubuntu--lv 98G 70G 23G 76% / tmpfs 5.9G 0 5.9G 0% /dev/shm tmpfs","tags":["docker","linux","log"],"title":"å•¥? k8s node ç¡¬ç¢Ÿç©ºé–“æ»¿äº†","uri":"https://blog.10oz.tw/20210402-what-k8s-node-disk-full/","year":"2021"},{"content":"æµæ°´å¸³é–‹å§‹ ğŸ˜‚ Terraform å…ˆè£é»æ±è¥¿å§ ä¾†å®‰è£ terraform\nbrew tap hashicorp/tap brew install hashicorp/tap/terraform é¦–å…ˆç™»å…¥ä½ çš„ aws iam å»ºç«‹ä¸€çµ„ Access key, Secret key\nç›´æ¥ç”¢ä¸€å€‹ main.tf æª”æ¡ˆ~ ä¸‹é¢æœ‰æŒ‡ä»¤ç›´æ¥ä¾†è·‘è·‘çœ‹ï¼Œä½ æ‡‰è©²è¦å¤šä¸€å€‹ ec2 æ©Ÿå™¨ğŸ‘\nprovider \u0026quot;aws\u0026quot; { # access_key = \u0026quot;$AWS_ACCESS_KEY_ID\u0026quot; # secret_key = \u0026quot;$AWS_SECRET_ACCESS_KEY\u0026quot; region = \u0026quot;ap-northeast-1\u0026quot; } data \u0026quot;aws_ami\u0026quot; \u0026quot;ubuntu\u0026quot; { most_recent = true filter { name = \u0026quot;name\u0026quot; values = [\u0026quot;ubuntu/images/hvm-ssd/ubuntu-bionic-18.04-amd64-server-*\u0026quot;] } filter { name = \u0026quot;root-device-type\u0026quot; values = [\u0026quot;ebs\u0026quot;] } filter { name = \u0026quot;virtualization-type\u0026quot; values = [\u0026quot;hvm\u0026quot;] } owners = [\u0026quot;099720109477\u0026quot;] # Canonical } # resource \u0026lt;resource_type\u0026gt; \u0026lt;resource_name\u0026gt; resource \u0026quot;aws_instance\u0026quot; \u0026quot;example\u0026quot; { ami = data.aws_ami.ubuntu.id instance_type = \u0026quot;t2.micro\u0026quot; } ä¸Šé¢é€™ä¸€æ®µé–‹ä¸€å€‹åŸºæœ¬ ec2 instance çš„ç¯„ä¾‹ï¼Œå…¶å¯¦å®˜æ–¹æœ‰æ•™ é»æˆ‘\nç¬¬ä¸€æ¬¡é€²ä¾†è¦å…ˆåˆå§‹åŒ–ä¸€ä¸‹ï¼\nterraform init terraform fmt # æ ¼å¼åŒ–æ–‡ä»¶ terraform plan # æª¢æŸ¥èˆ‡ç·šä¸Šç‰ˆæœ¬çš„å·®ç•° terraform apply # æº–å‚™éƒ¨ç½² æ³¨æ„å–”ï¼Œå†ä¾†å€‹ yes ä½ å°±ç™¼å°„å‡ºå»äº† # terraform destroy kOps å‡ºç¾äº† è·Ÿéš¨å®˜æ–¹è…³æ­¥èµ°ï¼ŒkOps å¸¶ä½ éƒ¨ç½² terraform \u0026raquo; é»æˆ‘ networking é‚£é‚Šå¯ä»¥é¸ä½ éœ€è¦çš„ CNIï¼Œä¸å¡«å¯«ä¹Ÿå¯ä»¥å‹•å•¦ï¼Œä¸éä½ æœƒå¾—åˆ°é è¨­çš„ Kubenet\nkops create cluster \\ --networking calico \\ --name=ptcg.10oz.tw \\ --state=s3://ptcg-bucket-tf \\ --dns-zone=ptcg.10oz.tw \\ --zones=ap-northeast-1a \\ --out=. \\ --target=terraform æœƒçœ‹åˆ°ä»¥ä¸‹çš„ log\nI0331 02:43:11.734871 11785 new_cluster.go:231] Inferred \u0026quot;aws\u0026quot; cloud provider from zone \u0026quot;ap-northeast-1a\u0026quot; I0331 02:43:12.025276 11785 subnets.go:180] Assigned CIDR 172.20.32.0/19 to subnet ap-northeast-1a I0331 02:43:13.000070 11785 create_cluster.go:713] Using SSH public key: /Users/xiaorenhao/.ssh/id_rsa.pub I0331 02:43:17.504798 11785 executor.go:111] Tasks: 0 done / 79 total; 45 can run I0331 02:43:17.521376 11785 dnszone.go:242] Check for existing route53 zone to re-use with name \u0026quot;ptcg.10oz.tw\u0026quot; W0331 02:43:17.904862 11785 vfs_castore.go:604] CA private key was not found I0331 02:43:18.010251 11785 keypair.go:195] Issuing new certificate: \u0026quot;etcd-clients-ca\u0026quot; I0331 02:43:18.017672 11785 keypair.go:195] Issuing new certificate: \u0026quot;etcd-peers-ca-events\u0026quot; I0331 02:43:18.022377 11785 keypair.go:195] Issuing new certificate: \u0026quot;etcd-manager-ca-events\u0026quot; I0331 02:43:18.022427 11785 keypair.go:195] Issuing new certificate: \u0026quot;apiserver-aggregator-ca\u0026quot; W0331 02:43:18.022450 11785 vfs_castore.go:604] CA private key was not found I0331 02:43:18.022474 11785 keypair.go:195] Issuing new certificate: \u0026quot;ca\u0026quot; I0331 02:43:18.029875 11785 keypair.go:195] Issuing new certificate: \u0026quot;master\u0026quot; I0331 02:43:18.034989 11785 keypair.go:195] Issuing new certificate: \u0026quot;etcd-manager-ca-main\u0026quot; I0331 02:43:18.131053 11785 keypair.go:195] Issuing new certificate: \u0026quot;etcd-peers-ca-main\u0026quot; I0331 02:43:18.247347 11785 dnszone.go:249] Existing zone \u0026quot;ptcg.10oz.tw.\u0026quot; found; will configure TF to reuse I0331 02:43:19.689156 11785 executor.go:111] Tasks: 45 done / 79 total; 16 can run I0331 02:43:19.694681 11785 executor.go:111] Tasks: 61 done / 79 total; 16 can run I0331 02:43:20.133663 11785 executor.go:111] Tasks: 77 done / 79 total; 2 can run I0331 02:43:20.134776 11785 executor.go:111] Tasks: 79 done / 79 total; 0 can run I0331 02:43:20.156638 11785 target.go:221] Terraform output is in . I0331 02:43:20.433778 11785 update_cluster.go:313] Exporting kubecfg for cluster kops has set your kubectl context to ptcg.10oz.tw Terraform output has been placed into . Run these commands to apply the configuration: cd . terraform plan terraform apply Suggestions: * validate cluster: kops validate cluster --wait 10m * list nodes: kubectl get nodes --show-labels * ssh to the master: ssh -i ~/.ssh/id_rsa ubuntu@api.ptcg.10oz.tw * the ubuntu user is specific to Ubuntu. If not using Ubuntu please use the appropriate user based on your OS. * read about installing addons at: https://kops.sigs.k8s.io/operations/addons. æœƒçœ‹è¦‹ kOps å¹«ä½ å»ºç«‹å¥½äº†å¯ä»¥é–‹å•Ÿ Kubernetes æœå‹™çš„ terraform æª”æ¡ˆï¼Œç›´æ¥çµ¦ä»–è·‘ä¸‹å»\nterraform plan terraform apply è·‘å®Œå¾Œç”¨é€™å€‹æŒ‡ä»¤ä¾†æª¢æŸ¥ä½ çš„ k8s cluster æ˜¯å¦æœ‰å¥åº·è·‘èµ·ä¾†äº†\nkops validate cluster --wait 10m é–‹å‡ºä¾†çš„ admin token ä¸€å¤©å°±æœƒéæœŸï¼Œå»ºè­°æ˜¯è‡ªå·±å»ºç«‹ä¸€å€‹é©åˆè‡ªå·±ç”¨çš„ Service Accountï¼Œ ä¸éä½ éœ€è¦ admin token çš„æ™‚å€™å¯ä»¥é€™éº¼åš\nkops export kubecfg --admin é™„éŒ„ï¼šæˆ‘æƒ³ä½ æœƒéœ€è¦ Ingress Route\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.44.0/deploy/static/provider/cloud/deploy.yaml æ‰“å®Œæ”¶å·¥ kops delete cluster \\ --name=ptcg.10oz.tw \\ --state=s3://ptcg-bucket-tf \\ --yes terraform destroy ç„¶å¾Œå»ºè­°è¦å¤šäººå·¥æª¢æŸ¥ä¸€ä¸‹ï¼Œå› ç‚ºæˆ‘ä¸‹å®ŒæŒ‡ä»¤å¾Œå¾ˆé–‹å¿ƒçš„æ´—æ´—ç¡äº†ï¼Œéš”å¤©æ‰æ³¨æ„åˆ° Mount çš„ PV æ²’æœ‰å¹«æˆ‘åˆªæ‰QQ ä¸‹æ¬¡è«‹è¨˜å¾—åˆ° EC2 Volume çœ‹çœ‹å–”ï¼ï¼\nRef https://shazi7804.github.io/terraform-manage-guide/command/plan.html https://medium.com/@chihsuan/terraform-%E8%87%AA%E5%8B%95%E5%8C%96%E7%9A%84%E5%9F%BA%E7%A4%8E%E6%9E%B6%E6%A7%8B%E4%BB%8B%E7%B4%B9-f827e8975e98 https://godleon.github.io/blog/DevOps/terraform-getting-started/\n","id":23,"section":"posts","summary":"æµæ°´å¸³é–‹å§‹ ğŸ˜‚ Terraform å…ˆè£é»æ±è¥¿å§ ä¾†å®‰è£ terraform brew tap hashicorp/tap brew install hashicorp/tap/terraform é¦–å…ˆç™»å…¥ä½ çš„ aws iam å»ºç«‹ä¸€çµ„ Access key, Secret key ç›´æ¥ç”¢ä¸€å€‹ main.tf æª”æ¡ˆ~ ä¸‹é¢æœ‰æŒ‡ä»¤ç›´æ¥ä¾†è·‘è·‘çœ‹ï¼Œä½ æ‡‰è©²è¦å¤šä¸€å€‹ ec2 æ©Ÿå™¨","tags":["terraform","kops"],"title":"æƒ³ç”¨ Terraform èˆ‡ kOps ä¹Ÿå¾—å¯«å€‹ç­†è¨˜","uri":"https://blog.10oz.tw/20210331-terraform-and-kops-need-a-note/","year":"2021"},{"content":" é€™æ˜¯ç™¼ç”Ÿåœ¨æ¸¬è©¦éˆ Rinkeby èˆ‡ EIP-1559 çš„æ•…äº‹ ä¹Ÿæ˜¯æ²’æœ‰å¥½å¥½æ›´æ–°ç¯€é»ç‰ˆæœ¬åˆä¸èªçœŸè¿½æ™‚äº‹çš„æ•…äº‹\näº‹ä»¶ç™¼ç”Ÿ å¤§ç´„åœ¨æ™šä¸Š 11 é»ï¼Œåœ¨å®¶è£¡æ¸¬è©¦ SIT ç’°å¢ƒçš„ feature æ™‚ï¼Œå‰›å¥½éœ€è¦å¹«æˆ‘çš„ä»¥å¤ªéŒ¢åŒ…å……å€¼ ç™¼ç¾ï¼ ä¸å¦™ï¼ å……ä¸é€²å»è€¶ï¼Œæ€éº¼æ²’åæ‡‰å’§ï¼Ÿ\næ‰¾ log ä½†ä¸€åˆ‡æ­£å¸¸ï¼Œé€™æ™‚ç™¼ç¾å¡åœ¨ 8,290,928 æƒ³èªªé€™å€‹ä½ç½®æ˜¯ä¸æ˜¯ç™¼ç”Ÿäº†ä»€éº¼å¥‡æ€ªçš„äº¤æ˜“ï¼Œä¾†æŸ¥æŸ¥çœ‹å¥½äº†ï½ google å¾Œç™¼ç¾ï¼Œ EIP 1559 å¯¦è£åœ¨ Rinkeby æƒ¹ï¼ é›–ç„¶ä¹‹å‰æ²’æœ‰èªçœŸé—œæ³¨é€™å€‹ææ¡ˆï¼Œä½†é‚„æ˜¯çŸ¥é“ä»–æ˜¯ä¸€å€‹åµå¾ˆå¤§çš„ç¡¬åˆ†å‰ é¦¬ä¸Š ssh é€£åˆ°æˆ‘å€‘çš„ full node å»çœ‹çœ‹ï¼Œæœ€é«˜ç¯€é»å°±æ˜¯åœ¨ 8,290,928 çš„ä½ç½®\nå¥½å•¦ï¼Œæ‰¾åˆ°åŸå› äº†ï½ï½ æˆ‘å€‘ä¾†è·Ÿä¸€ä¸‹ç¡¬åˆ†å‰å§\næ›´æ–°ä¸€ä¸‹ é¦–å…ˆä¸‹è¼‰æœ€æ–°çš„åŒ…~~\nsudo add-apt-repository -y ppa:ethereum/ethereum -y apt-cache policy ethereum # ç¢ºèªç‰ˆæœ¬ sudo apt-get upgrade ethereal geth version # ç¢ºèªç‰ˆæœ¬ ç„¶å¾Œé‡å•Ÿå°±å¥½å›‰\n# å†é‡æ–°é–‹å›æœå‹™ geth --rinkeby --http --http.addr 0.0.0.0 --ws --ws.addr 0.0.0.0 --ws.origins * --rpcvhosts=* çŸ¥é“å•é¡Œå¾Œå°±ä¹Ÿä¸é›£äº†ï¼Œä½†æ˜¯é–‹ç™¼é€™å€‹çœŸçš„è¦è·Ÿæ™‚äº‹å‘€ğŸ˜‚\nä¸ç„¶æœƒè·Ÿæˆ‘ä¸€æ¨£ï¼Œéƒ½åˆ†å‰ä¸€å¤©äº†æ‰ç™¼ç¾è‡ªå·±çš„æœå‹™æ²’æœ‰æ›´æ–° QQ\n","id":24,"section":"posts","summary":"é€™æ˜¯ç™¼ç”Ÿåœ¨æ¸¬è©¦éˆ Rinkeby èˆ‡ EIP-1559 çš„æ•…äº‹ ä¹Ÿæ˜¯æ²’æœ‰å¥½å¥½æ›´æ–°ç¯€é»ç‰ˆæœ¬åˆä¸èªçœŸè¿½æ™‚äº‹çš„æ•…äº‹ äº‹ä»¶ç™¼ç”Ÿ å¤§ç´„åœ¨æ™šä¸Š 11 é»ï¼Œåœ¨å®¶è£¡æ¸¬è©¦ SIT ç’°å¢ƒçš„ feature æ™‚ï¼Œå‰›å¥½éœ€è¦å¹«æˆ‘çš„ä»¥å¤ªéŒ¢","tags":["blockchain","ethereum","geth"],"title":"å°ç´€éŒ„æ›´æ–° Rinkeby Ethereum ç¯€é»","uri":"https://blog.10oz.tw/20210326-little-bit-update-rinkeby-ethereum/","year":"2021"},{"content":"å•é¡Œæè¿° helm release æ˜æ˜å°±å­˜åœ¨ï¼Œä½†æ˜¯ä»–å°±æ˜¯è·Ÿä½ èªªæ²’æœ‰éƒ¨ç½²çš„ç‰ˆæœ¬\nError: UPGRADE FAILED: \u0026quot;code-server\u0026quot; has no deployed releases è™•ç†ä¸€ä¸‹ åŸä¾†æ˜¯ç‹€æ…‹ä¸å°ï¼Œå¯èƒ½ä¸Šä¸€æ¬¡éƒ¨ç½²çš„æ™‚å€™å¤±æ•—äº†ï¼Œåªè¦ä½ åŠ ä¸Š --force å†çµ¦ä»–è·‘ä¸‹å»å°±å¥½\næˆ–è€…èªªå»æ‰¾åˆ° secrets sh.helm.release.v1.{server_name}.v{version} ä¿®æ”¹ä¸€ä¸‹è£¡é¢çš„ labels statusï¼Œæ”¹æˆ deployed\nmetadata: name: sh.helm.release.v1.code-server.v31 namespace: foo uid: b94b5861-8f98-4e8c-bb81-e715975d8c22 resourceVersion: '46153334' creationTimestamp: '2021-03-04T06:12:08Z' labels: modifiedAt: '1614838331' name: code-server owner: helm status: failed # æ”¹é€™è£æˆ deployed version: '31' å†é‡æ–° Retry ä¸€ä¸‹ helm upgrade å°±å¯ä»¥å›‰\n","id":25,"section":"posts","summary":"å•é¡Œæè¿° helm release æ˜æ˜å°±å­˜åœ¨ï¼Œä½†æ˜¯ä»–å°±æ˜¯è·Ÿä½ èªªæ²’æœ‰éƒ¨ç½²çš„ç‰ˆæœ¬ Error: UPGRADE FAILED: \u0026quot;code-server\u0026quot; has no deployed releases è™•ç†ä¸€ä¸‹ åŸä¾†æ˜¯ç‹€æ…‹ä¸å°ï¼Œå¯èƒ½ä¸Šä¸€æ¬¡éƒ¨ç½²çš„æ™‚å€™å¤±æ•—äº†ï¼Œåªè¦ä½ åŠ ä¸Š --force å†çµ¦ä»–","tags":["kubernetes","helm"],"title":"helm3 èªª has no deployed releases","uri":"https://blog.10oz.tw/20210326-helm3-has-no-deployed-releases/","year":"2021"},{"content":" GitLab Community Edition 12.7.0 go version go1.15 darwin/amd64\nå•é¡Œæè¿° äº‹å¯¦ä¸Šé€™æ¬¡åŒ…å«å…©å€‹å•é¡Œï¼Œä¸€å€‹æ˜¯ Privite Gitlab çš„èªè­‰å¦ä¸€å€‹æ˜¯ Gitlab Subgroup çš„æ”¯æ´\nPrivite Gitlab å­˜å–ç§æœ‰çš„ Gitlab å¯ä»¥ä¿®æ”¹ä½ çš„ go env\nexport GOPRIVATE=gitlab.company.com.tw Subgroup ä½ çš„ go.mod\nmodule example.com/test require gitlab.com/org/subgroup/repo/pkg/foo v0.0.0 replace gitlab.com/org/subgroup/repo/pkg/foo =\u0026gt; gitlab.com/org/subgroup/repo.git/pkg/foo v1.0.0 Ref https://gitlab.com/gitlab-org/gitlab-foss/-/issues/30785\n","id":26,"section":"posts","summary":"GitLab Community Edition 12.7.0 go version go1.15 darwin/amd64 å•é¡Œæè¿° äº‹å¯¦ä¸Šé€™æ¬¡åŒ…å«å…©å€‹å•é¡Œï¼Œä¸€å€‹æ˜¯ Privite Gitlab çš„èªè­‰å¦ä¸€å€‹æ˜¯ Gitlab Subgroup çš„æ”¯æ´ Privite Gitlab å­˜å–ç§æœ‰çš„ Gitlab å¯ä»¥ä¿®æ”¹ä½ çš„ go env export GOPRIVATE=gitlab.company.com.tw Subgroup ä½ çš„ go.mod module example.com/test require gitlab.com/org/subgroup/repo/pkg/foo v0.0.0 replace gitlab.com/org/subgroup/repo/pkg/foo","tags":["golnag","gitlab","subgroup"],"title":"go get èˆ‡ç§æœ‰ Gitlab","uri":"https://blog.10oz.tw/20210316-go-get-privite-gitlab-repo/","year":"2021"},{"content":"å•é¡Œæè¿° é€™å¹¾å¤©å·¥ä½œé‡åˆ° chromedp çˆ¬èŸ²åŸ·è¡Œå®Œå¾Œæ²’æœ‰è¢«é—œé–‰ï¼ å°è‡´ memory ä¸æ–·å †ç©\nå› ç‚ºç›£æ¸¬ metrics çš„æœ€å°å–®ä½æ˜¯ containerï¼Œä¸€é–‹å§‹èª¿æŸ¥ä»¥ç‚ºæ˜¯ç¨‹å¼è¨˜æ†¶é«”éé«˜æ‰€ä»¥å˜—è©¦ç”¨ pprof éŒ„äº†ä¸€æ®µå¾Œç™¼ç¾æ²’æœ‰ç›´æ¥çš„ä¸Šå‡ï¼Œæ–¼æ˜¯ç›´æ¥é€²å…¥å®¹å™¨è£¡é¢è§€å¯Ÿ process ä½”ç”¨çš„è³‡æº\nå“‡å—šï¼Œç™¼ç¾å¥½å¤š chrome çš„å±é«” å¥½äº†ï¼Œé–‹å§‹ç ”ç©¶ç‚ºä»€éº¼ chromedp æ²’å¹«æˆ‘å€‘æŠŠå®ƒé—œæ‰ã€‚ æ­¤æ™‚ç™¼ç¾ä¸€å¼µ Issue æœ‰é€™å€‹å•é¡Œå’Œå…¶ä»–äººçš„ç ”ç©¶æˆæœ\nè§£æ±ºæ–¹æ³• å…¶å¯¦è§£æ±ºæ–¹æ³• chromedp å·²ç¶“çµ¦ä½ äº†\nFROM chromedp/headless-shell:latest ... # Install dumb-init or tini RUN apt install dumb-init # or RUN apt install tini ... ENTRYPOINT [\u0026quot;dumb-init\u0026quot;, \u0026quot;--\u0026quot;] # or ENTRYPOINT [\u0026quot;tini\u0026quot;, \u0026quot;--\u0026quot;] CMD [\u0026quot;/path/to/your/program\u0026quot;] å°±æ˜¯ç¬¬ 7 è¡Œçš„é‚£å€‹ï¼Œåœ¨ docker image ä¸­ä¸è¦ç›´æ¥å»è·‘ä½ çš„ç¨‹å¼è€Œæ˜¯ç”¨ dumb-init å»åŒ…èµ·ä¾†è·‘ï¼ å°±å¯ä»¥é¿å…æ®­å±é€²ç¨‹äº†\nåŸå› æ˜¯é€™æ¨£çš„ï¼Œä¸€èˆ¬ä¾†èªªåœ¨åŸ·è¡Œ OS çš„æ™‚å€™ Pid ç‚º 1 çš„æœå‹™æœƒæ˜¯ç³»çµ±æœå‹™(ex: systemd, launchd)ï¼Œç„¶è€Œåœ¨ Container è£¡é¢ Pid=1 æ˜¯æˆ‘å€‘è‡ªå·±çš„ç¨‹å¼ï¼\n$ man launchd launchd(8) BSD System Manager\u0026rsquo;s Manual launchd(8)\nNAME launchd \u0026ndash; System wide and per-user daemon/agent manager\nç•¶ä¸€å€‹ Process è¢«é—œé–‰æ™‚ï¼Œä»–çš„ SubProcess æœƒè¢«è¨—ç®¡çµ¦ Pid=1 çš„ Processï¼Œä½†æ˜¯æˆ‘å€‘å¯«çš„ç¨‹å¼ä¸¦æ²’æœ‰è¨—ç®¡çš„åŠŸèƒ½æ‰€ä»¥é‚£äº› SubProcess å°±è¢« hang åœ¨é‚£é‚Šæˆç‚ºæ®­å±ã€‚\næ›´å¤šæ·±å…¥äº†è§£å¯ä»¥çœ‹ dumb-init github å’Œ dumb-initï¼šä¸€ä¸ª Docker å®¹å™¨åˆå§‹åŒ–ç³»ç»Ÿ\nRef https://github.com/chromedp/chromedp/issues/752 https://github.com/chromedp/docker-headless-shell#using-as-a-base-image https://github.com/Yelp/dumb-init è©³ç´°èªªæ˜ https://www.infoq.cn/article/2016/01/dumb-init-docker\n","id":27,"section":"posts","summary":"å•é¡Œæè¿° é€™å¹¾å¤©å·¥ä½œé‡åˆ° chromedp çˆ¬èŸ²åŸ·è¡Œå®Œå¾Œæ²’æœ‰è¢«é—œé–‰ï¼ å°è‡´ memory ä¸æ–·å †ç© å› ç‚ºç›£æ¸¬ metrics çš„æœ€å°å–®ä½æ˜¯ containerï¼Œä¸€é–‹å§‹èª¿æŸ¥ä»¥ç‚ºæ˜¯ç¨‹å¼è¨˜æ†¶é«”éé«˜æ‰€ä»¥å˜—","tags":["chromedp","chromium","golang","linux"],"title":"Chromedp æ®­å±é€²ç¨‹","uri":"https://blog.10oz.tw/20210306-chromedp-zombi-process/","year":"2021"},{"content":"GFW (great fire wall) ä¸­åœ‹å¤§é™¸åœ¨ 2008 å¹´å•Ÿå‹•çš„è¨ˆç•«ï¼Œç›£ç®¡æ‰€æœ‰çš„ç¶²è·¯æµé‡ä¸¦ä¸”é˜»æ“‹è¨±å¤šå¢ƒå¤–çš„ç¶²ç«™å’Œä¸å—å…è¨±çš„ IPï¼Œä¾‹å¦‚èªª youtube, google search, facebook éƒ½æ˜¯è¢«ç¦æ­¢çš„ã€‚ä¹Ÿå› æ­¤æœ‰äº†ç¿»ç‰†æ‰¾è‡ªç”±çš„éœ€æ±‚ï¼Œå¹« QQ\nGFW æ“‹æ‰çš„æ–¹æ³•æœ‰åŸŸåæ±¡æŸ“ã€é—œéµå­—é˜»æ–·ã€ç‰¹å¾µæ””æˆª\u0026hellip;ç­‰ç­‰ï¼Œåªè¦ä»–çœ‹è¦‹ä½ çš„å°åŒ…å«æœ‰ä»–ä¸å–œæ­¡çš„é—œéµå­—ï¼Œæˆ–æ˜¯é»‘åå–®çš„ IP å°±ç›´æ¥æ–·æ‰ä½ çš„ç¶²è·¯å°åŒ…ã€‚\nå› æ­¤æƒ³è¦ç¹é GFW çš„å¯©æ ¸ï¼Œå°±éœ€è¦ç”¨ä¸Šå°åŒ…åŠ å¯†ï¼Œä»–çœ‹ä¸æ‡‚çš„æ±è¥¿ä»–ä¸æœƒéš¨ä¾¿çš„å°±æŠŠä½ çµ¦å°é–æ‰ï¼Œä¹Ÿå°±æœ‰æ©Ÿæœƒå¯ä»¥ç¢°è§¸åˆ°å¤–é¢çš„ä¸–ç•Œã€‚ ä¸éé€™æ¨£æœƒé¢è‡¨åˆ°å¦ä¸€å€‹å•é¡Œï¼ŒåŠ å¯†çš„å…§å®¹ GFW çœ‹ä¸æ‡‚ï¼Œgoogle ä¹Ÿä¸€æ¨£çœ‹ä¸æ‡‚ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€å°è·³æ¿æ©Ÿä¾†è§£å¯†ï¼Œç„¶å¾Œè·³æ¿æ©Ÿå¹«ä½ åšåˆ°ä½ çœŸæ­£æƒ³è¦åšçš„äº‹æƒ…ï¼Œå†å°‡çµæœåŠ å¯†å‚³å›å»çµ¦ä½ ã€‚\nå¸¸ç”¨æŠ€è¡“èˆ‡å·¥å…·å€‘ VPS (Virtual Private Server) ä¹Ÿå°±æ˜¯è·³æ¿æ©Ÿå•¦ï¼Œå¸¸ç”¨çš„ä¾›æ‡‰å•†æœ‰ Linode, Vultrï¼Œéƒ½æ˜¯è€ç‰Œç©©å®šåƒ¹æ ¼åˆç†çš„å» å•†ã€‚\nä»–å€‘æœƒç§Ÿå€Ÿä¸€å°è™›æ“¬çš„ä¸»æ©Ÿå’Œ IP çµ¦ä½ ï¼Œå°±å¥½åƒæœ‰ä¸€å°å¯¦éš›çš„é›»è…¦ï¼Œä½ å¯ä»¥é€£ç·šé€²å»åœ¨ä¸Šé¢åšä»»ä½•çš„äº‹æƒ…~~ ç•¶ç„¶ä¹ŸåŒ…å«æ¶è¨­ VPN è·³æ¿å–”\nsocks5 è·‘åœ¨ç¬¬äº”å±¤(Session Layer)çš„ä»£ç†æœå‹™ï¼Œå¾ˆå¸¸è¢«ç”¨ä¾†ä½œç‚º VPN æœå‹™çš„ä»£ç†ï¼Œä¸éé€™å€‹å”å®šä¸åŒ…å«åŠ å¯†ï¼Œå› æ­¤ä¸€èˆ¬æœƒå†æ­é…å…¶ä»–æœå‹™ä¸€èµ·ä½¿ç”¨ã€‚ å¦å¤–ä»–ç„¡æ³•åšåˆ°å…¨å±€ä»£ç†ï¼Œä¾‹å¦‚æ›´ä½å±¤ç´šçš„ TCP, ICMP é€™äº›å”å®šï¼Œä½  ping å›ä¾†é‚„æœƒæ˜¯è‡ªå·±çš„ IP\nå¯ä»¥ä½¿ç”¨é¡ä¼¼ tun2sock é€™é¡å·¥å…·ï¼Œè½‰æ›æ‰€æœ‰çš„æµé‡è‡³ socks5ï¼Œä»¥é”åˆ°å…¨å±€ä»£ç†çš„æ•ˆæœï¼Œç•¶ç„¶åˆ¥å¿˜è¨˜é‚„æ²’åŠ å¯†å˜¿\nShadowSocks (SS, SSR) æœ€æœ‰çŸ¥ååº¦çš„ç¿»ç‰†å·¥å…·ï¼Œå…§å®¹å°±æ˜¯ç°¡å–®çš„å°å°åŒ…åšå°ç¨±åŠ å¯†ï¼Œæ”¯æ´å¤šç¨®åŠ å¯†æ³•ï¼Œä¹Ÿæœ‰å„ç¨®èªè¨€å¯¦ä½œå¥—ä»¶ï¼Œä¸éä¹Ÿå› ç‚ºä»–ç°¡å–®æ‰€ä»¥æœ‰å¾ˆå¤šäººéƒ½è¡¨ç¤ºé€™ç¨®ç¿»ç‰†çš„ç‰¹å¾µå·²ç¶“èƒ½å¤ è¢« GFW è­˜åˆ¥å‡ºä¾†äº†ï¼Œç„¶è€Œç›®å‰çš„ç¿»ç‰†æœ€å¤§å®—é‚„æ˜¯ä½¿ç”¨ ShadowSocks å†åŠ ä¸Š socks5 ä»£ç†\nç„¶å¾Œä½œè€…åœ¨ github ä¸Šçªç„¶çš„æ¶ˆå¤±å¥½å¹¾å€‹æœˆæƒ¹ï¼Œå¤§å®¶éƒ½èªªä»–è¢«ä¸­åœ‹æ”¿åºœæŠ“å»å–èŒ¶æƒ¹\nSSR(ShadowSocksR) æ˜¯ ShadowSocks çš„ fork ä¿®æ”¹ç‰ˆ\nV2Ray ä¾†è‡ª Project Vï¼ŒV2Ray å°ˆæ¡ˆå°±æ˜¯å€‹è¶…ç´šç¶œåˆåŒ…ï¼Œæ”¯æ´è¨±å¤šç¨®ä¸åŒçš„å”è­°(ç•¶ç„¶ä¹ŸåŒ…å« ShasowSocks)ï¼Œå¯ä»¥è‡ªå®šç¾©å‡ºå£å”å®šã€å…¥å£å”å®šã€ç™½åå–®\u0026hellip;ï¼ŒæŠ½è±¡ç¨‹åº¦å¾ˆé«˜å¯ä»¥å½ˆæ€§çš„åšè®ŠåŒ–ï¼Œä¹Ÿå› æ­¤è¤‡é›œåº¦ç›¸ç•¶é«˜\nä¹Ÿæœ‰ç™¼è¡Œè‡ªå·±çš„å”è­° - VMessï¼Œä»–æ˜¯åŸºæ–¼ TLS çš„åŠ å¯†æ¼”ç®—æ³•ï¼Œç”¨æ–¼ä¿è­·å…§å®¹ï¼Œæ··æ·†ç‰¹å¾µã€‚\nå¹³å°ä¸Šæ¨è–¦çš„ç”¨æ³•æ˜¯ VMess + WSSï¼Œä¹Ÿå°±æ˜¯ç”¨ vemss å”è­°åŠ å¯†å†é€é TLS åŠ å¯†éçš„ websocket å‚³è¼¸ï¼ŒåŠ å®Œå¯†åŸºæœ¬ä¸Šå¾å¤–è§€ä¸Šçœ‹å°±æ˜¯ä¸€å€‹è·Ÿæ‰€æœ‰äººéƒ½ä¸€æ¨£çš„æ­£å¸¸ websocket é€£ç·šï¼Œè€Œä¸”è¢« GFW æŠ“èµ°çš„æ¡ˆä¾‹ä¹Ÿç›¸å°å°‘å¾ˆå¤šï¼Œå› æ­¤è¢«èªç‚ºæ˜¯ä¸€å€‹ä¸»æµçš„ç¿»ç‰†æ–¹å¼ï½ï½\nTrojan ä¸å¤ªèªè­˜é€™å€‹QQï¼Œæ˜¯å€‹å¾Œä¾†å‡ºç¾çš„æ˜æ—¥ä¹‹æ˜Ÿ(?\nä»–å’Œ V2Ray ç›¸åŒä¹Ÿæ˜¯è·‘åœ¨ WSS ä¸ŠåšåŠ å¯†ã€æ··æ·†ï¼Œä¸éä»–ä¸åƒ V2Ray æœ‰é€™éº¼å¤šçš„é¸æ“‡ï¼Œä¹Ÿå°±æ›´è¼•é‡æ›´ç°¡å–®ã€‚\nå°ˆç·š(IPLC, IEPL) ä¸­åœ‹å…§éƒ¨çš„ç¶²è·¯æœ‰å¹¾ç¨®ç·šè·¯ï¼Œå¸¸è¦‹çš„ 163, CN2\u0026hellip; é‚„æœ‰å…¶ä»–å¹¾ç¨®éª¨æ„Ÿç¶²è·¯çš„æµé‡ï¼Œä¸æ˜¯å¾ˆäº†è§£ä½†çŸ¥é“ä»–å€‘éƒ½æ˜¯è¦é GFW çš„ã€‚\nIPLC å°±å²å®³å•¦ï¼Œä»–ä¸é GFW æ‰€ä»¥ä¸ç”¨ç¿»ï¼ä¸éé€™ç·šè·¯è²´å¾—å¾ˆï¼ŒåŸºæœ¬ä¸åœ¨é¸é …å…§ XDD\nTODOå— åƒæ˜¯å‚³çµ±çš„ VPN å”è­°å°±æœƒæœ‰æ˜é¡¯çš„ç‰¹å¾µï¼Œ PPTP L2TP openVPN SSTP\u0026hellip;\nRef https://www.v2ray.com/developer/intro/guide.html https://www.youtube.com/watch?v=XKZM_AjCUr0\u0026amp;list=PLqybz7NWybwUgR-S6m78tfd-lV4sBvGFG https://github.com/trojan-gfw/trojan https://wivwiv.com/post/ssr-v2ray-trojan/ https://blog.wongcw.com/2019/07/03/iepl%E3%80%81iplc%E8%A9%B3%E7%B4%B0%E4%BB%8B%E7%B4%B9%E5%8F%8A%E5%8D%80%E5%88%A5/\n","id":28,"section":"posts","summary":"GFW (great fire wall) ä¸­åœ‹å¤§é™¸åœ¨ 2008 å¹´å•Ÿå‹•çš„è¨ˆç•«ï¼Œç›£ç®¡æ‰€æœ‰çš„ç¶²è·¯æµé‡ä¸¦ä¸”é˜»æ“‹è¨±å¤šå¢ƒå¤–çš„ç¶²ç«™å’Œä¸å—å…è¨±çš„ IPï¼Œä¾‹å¦‚èªª youtube, google search, facebook éƒ½æ˜¯è¢«ç¦æ­¢çš„ã€‚ä¹Ÿå› æ­¤æœ‰äº†ç¿»ç‰†æ‰¾è‡ªç”±","tags":["gfw","vpn"],"title":"VPN \u0026 GFW - ç§‘å­¸ä¸Šç¶²","uri":"https://blog.10oz.tw/20210124-vpn-and-gfw/","year":"2021"},{"content":"é—œæ–¼ protobuf null value golang é è¨­å»ºå‡ºä¾†çš„æ˜¯æ²’æœ‰æŒ‡æ¨™çš„ï¼Œä½†æ˜¯æœ‰æ™‚å€™å°±æ˜¯éœ€è¦æŒ‡æ¨™ä¾†åˆ¤æ–·å•Šï¼\noption protobuf v3 å¾ 1.12 é–‹å§‹æ”¯æ´å¯¦é©—æ€§åŠŸèƒ½ optionï¼Œè®“ç”¨æˆ¶å¯ä»¥åƒæ˜¯ v2 æ™‚ä¸€æ¨£ä½¿ç”¨ option å»ç”¢ç”Ÿä¸€å€‹ nullable çš„æ¬„ä½\nsyntax = \u0026quot;proto3\u0026quot;; message Foo { int32 bar = 1; optional int32 baz = 2; } https://stackoverflow.com/a/62566052/6695274\nwrappers ä¸éï¼Œ gogo-proto ä¸¦ä¸æ”¯æ´é˜¿QQï¼Œ\nä½†ä¹Ÿä¸èƒ½å°±é€™éº¼æ¨æ£„ gogo-protoï¼Œå› æ­¤æˆ‘å€‘éœ€è¦é¸æ“‡å¦ä¸€å€‹æ–¹æ¡ˆ\nimport \u0026quot;google/protobuf/wrappers.proto\u0026quot;; message Foo { int32 bar = 1; google.protobuf.Int32Value baz = 2; } https://stackoverflow.com/a/50099927/6695274\nè¨˜å¾—åœ¨ --go-output= å…§åŠ ä¸Š Mgoogle/protobuf/wrappers.proto=github.com/gogo/protobuf/types\nä½†æ˜¯ä½†æ˜¯ï¼Œç„¡æ³•æ”¯æ´ enum æˆ‘é›£é\ncustom wrappers åªå¥½è‡ªå·±å‹•æ‰‹åš (?\nenum Status { STATUS_OK = 0; STATUS_FAIL = 1; } message NullInt32 { bool valid = 1; int32 value = 2; } message NullStatus { bool valid = 1; Status value = 2; } message Foo { int32 bar = 1; NullInt32 baz = 2; NullStatus status = 3; } gen æˆ golang çš„ code ä¹‹å¾Œå°±é€™æ¨£ç”¨ï¼ŒåŸºæœ¬ä¸Šè·Ÿ wrappers çš„ç”¨æ³•æ˜¯ä¸€æ¨£çš„\ntype NullStatus struct { Valid bool `protobuf:\u0026quot;varint,1,opt,name=valid,proto3\u0026quot; json:\u0026quot;valid,omitempty\u0026quot;` Value Status `protobuf:\u0026quot;varint,2,opt,name=value,proto3,enum=blackblock.Status\u0026quot; json:\u0026quot;value,omitempty\u0026quot;` XXX_NoUnkeyedLiteral struct{} `json:\u0026quot;-\u0026quot;` XXX_unrecognized []byte `json:\u0026quot;-\u0026quot;` XXX_sizecache int32 `json:\u0026quot;-\u0026quot;` } func (m *NullStatus) GetValid() bool { if m != nil { return m.Valid } return false } func (m *NullStatus) GetValue() Status { if m != nil { return m.Value } return Status_STATUS_OK } type Foo struct { Bar int32 `protobuf:\u0026quot;varint,1,opt,name=bar,proto3\u0026quot; json:\u0026quot;bar,omitempty\u0026quot;` Baz *NullInt32 `protobuf:\u0026quot;bytes,2,opt,name=baz,proto3\u0026quot; json:\u0026quot;baz,omitempty\u0026quot;` Status *NullStatus `protobuf:\u0026quot;bytes,3,opt,name=status,proto3\u0026quot; json:\u0026quot;status,omitempty\u0026quot;` XXX_NoUnkeyedLiteral struct{} `json:\u0026quot;-\u0026quot;` XXX_unrecognized []byte `json:\u0026quot;-\u0026quot;` XXX_sizecache int32 `json:\u0026quot;-\u0026quot;` } å¥½å•¦ï¼Œå¸Œæœ›ä¸è¦ç”¨åˆ°å•¦ğŸ˜…\n","id":29,"section":"posts","summary":"é—œæ–¼ protobuf null value golang é è¨­å»ºå‡ºä¾†çš„æ˜¯æ²’æœ‰æŒ‡æ¨™çš„ï¼Œä½†æ˜¯æœ‰æ™‚å€™å°±æ˜¯éœ€è¦æŒ‡æ¨™ä¾†åˆ¤æ–·å•Šï¼ option protobuf v3 å¾ 1.12 é–‹å§‹æ”¯æ´å¯¦é©—æ€§åŠŸèƒ½ optionï¼Œè®“ç”¨æˆ¶å¯ä»¥åƒæ˜¯ v2 æ™‚ä¸€æ¨£ä½¿ç”¨ option","tags":null,"title":"gRPC - protobuf v3 ç”¢ç”Ÿ nullable æ¬„ä½","uri":"https://blog.10oz.tw/20201123-nullable-column-in-protobuf-v3/","year":"2020"},{"content":"é–‹å§‹å®‰è£ ä¸‹è¼‰å¾Œæœƒå¾—åˆ°ä¸€å€‹è³‡æ–™å¤¾ istio-1.7.4 æŠŠä»–åŠ å…¥ä½ çš„åŸ·è¡Œæª”ä¸­å§\ncurl -L https://istio.io/downloadIstio | sh - export PATH=$PWD/istio-1.7.4/bin:$PATH istioctl version # æˆåŠŸå°±æ˜¯æœ‰å›‰ é è¨­çš„ Profile å€‘æœ‰å…­å€‹ï¼Œæˆ‘å°±å…ˆç”¨ default å§\ndefault demo minimal remote empty preview Core components istio-egressgateway X istio-ingressgateway X X X istiod X X X X istioctl profile list istioctl install --set profile=default è£å¥½ä¹‹å¾Œä¾†å¯¦é©—ä¸€ä¸‹å–”ï¼Œé–‹ä¸€å€‹æ–°çš„ namespce ä¸¦å®‰è£å®˜æ–¹ç¯„ä¾‹ book infoï¼Œè£¡é¢åŒ…å« 4 å€‹å¾®æœå‹™\nkubectl create namespcae istio-bookinfo # kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml kubectl apply -n istio-bookinfo -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/bookinfo/platform/kube/bookinfo.yaml ç›®å‰çš„ pod è£¡é¢éƒ½åªæœ‰ 1 å€‹ Containerï¼Œæˆ‘å€‘è¦æ³¨å…¥ istio çš„ envoy proxy è®“æ¯å€‹ Pod è£¡é¢å¤šä¸€å€‹ sidecar\n\u0026gt; ~/istio Â» kubectl get po -n istio-bookinfo NAME READY STATUS RESTARTS AGE details-v1-79c697d759-9kvrq 1/1 Running 0 3m41s productpage-v1-65576bb7bf-w9gf6 1/1 Running 0 3m38s ratings-v1-7d99676f7f-tq9kw 1/1 Running 0 3m40s reviews-v1-987d495c-j655s 1/1 Running 0 3m40s reviews-v2-6c5bf657cf-l595s 1/1 Running 0 3m39s reviews-v3-5f7b9f4f77-4qdtb 1/1 Running 0 3m39s kubectl label namespace istio-bookinfo istio-injection=enabled kubectl get namespace -L istio-injection # é‡æ–°éƒ¨ç½²ï¼Œå°±æŠŠ Pod éƒ½åˆªæ‰å§ kubectl delete (kubectl get all | grep pod | awk '{print $1}') å¦‚æœè¦é—œæ‰çš„è©±\nkubectl label namespace default istio-injection- å†ä¾†çœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯æ¯å€‹ Pod è£¡é¢éƒ½å¤šä¸€å€‹ Container å•¦~\n\u0026gt; ~/istio Â» kubectl get pod NAME READY STATUS RESTARTS AGE details-v1-79c697d759-lqt6k 2/2 Running 0 3m15s productpage-v1-65576bb7bf-zwgqd 2/2 Running 0 3m15s ratings-v1-7d99676f7f-fqvvd 2/2 Running 0 3m15s reviews-v1-987d495c-kbc4z 2/2 Running 0 3m14s reviews-v2-6c5bf657cf-749bn 2/2 Running 0 3m14s reviews-v3-5f7b9f4f77-f7wvk 2/2 Running 0 3m14s æˆ‘å€‘çš„æœå‹™ç›®å‰é•·é€™æ¨£ kubectl port-forward svc/productpage 9080:9080 -n istio-bookinfo åˆ©ç”¨ Kaili è¦–è¦ºåŒ– traffic # è©³ç´°å…§å®¹åœ¨ https://github.com/istio/istio/tree/1.7.0/samples/addons kubectl apply -f samples/addons æª¢æŸ¥ namespace istio-system å…§ï¼Œå¤šäº† grafana, kiali, prometheus, tracing, zipkin é€™å¹¾å€‹æœå‹™\nä¾†çœ‹çœ‹ kaili å–”ï½\nport-forward svc/kiali 20001:20001 -n istio-system kaili å¯ä»¥ç”¨æµé‡ç›´æ¥å¹«æˆ‘å€‘ç•«å‡º service ä¹‹é–“çš„é—œä¿‚åœ– Reference https://istio.io/latest/docs/setup/getting-started/ https://istio.io/latest/docs/setup/additional-setup/config-profiles/ https://istio.io/latest/docs/examples/bookinfo/\n","id":30,"section":"posts","summary":"é–‹å§‹å®‰è£ ä¸‹è¼‰å¾Œæœƒå¾—åˆ°ä¸€å€‹è³‡æ–™å¤¾ istio-1.7.4 æŠŠä»–åŠ å…¥ä½ çš„åŸ·è¡Œæª”ä¸­å§ curl -L https://istio.io/downloadIstio | sh - export PATH=$PWD/istio-1.7.4/bin:$PATH istioctl version # æˆåŠŸå°±æ˜¯æœ‰å›‰ é è¨­çš„ Profile å€‘æœ‰å…­å€‹ï¼Œæˆ‘å°±å…ˆç”¨ default å§ default demo minimal remote empty preview Core components istio-egressgateway X istio-ingressgateway","tags":["kubernetes","istio","service-mesh"],"title":"æ–°ç±³ Istio - å®‰è£ç¯‡","uri":"https://blog.10oz.tw/20201115-a-istio-beginner/","year":"2020"},{"content":"æ¶æ§‹ ECS(Elastic Container Service) æ˜¯ AWS ä¸Šçš„å®¹å™¨ç®¡ç†æœå‹™ï¼Œæ¶æ§‹ä¸Šå¯ä»¥ç°¡å–®åˆ†æˆå¹¾å±¤:\nCluster ä¸€å€‹ç¾¤é›† :) Service å¯ä»¥æŠŠå®ƒç•¶ä½œ \u0026ldquo;åŸ·è¡Œä¼åŠƒ\u0026rdquo;ï¼Œå°±åƒæ˜¯ä¸€å€‹ docker-compose å°‡å¤šå€‹ docker æœå‹™åŒ…è£èµ·ä¾† Task ç”± Service ç”¢ç”Ÿçš„å·¥ä½œä»»å‹™ï¼Œè² è²¬ç¶­è­· Container çš„éƒ¨ç½²ï¼Œåœ¨ EC2 æ¨¡å¼å°±æ˜¯ä»–è² è²¬éƒ¨ç½²æœå‹™åˆ°æ©Ÿå™¨ä¸Šçš„ Container ä½ çš„ AP åœ¨é€™è£¡ï¼Œä»–å°±æ˜¯æœ€åº•å±¤çš„å®¹å™¨æœå‹™å•¦ åˆ†æˆå…©ç¨®æ¨¡å¼ï¼Œå·®åˆ¥åœ¨åº•å±¤çš„æ©Ÿå™¨æ˜¯å¦éœ€è¦è‡ªå·±ç®¡ç†ï¼Œ ç„¡è«–æ˜¯å“ªç¨®éƒ½å¯ä»¥åš Auto Scaling ä¾†ç¢ºä¿æœå‹™çš„å¯ç”¨æ€§\nFargate mode ECS çš„é è¨­é¸æ“‡æ¨¡å¼ï¼Œæ˜¯æ¯”è¼ƒå¾Œä¾†æ‰å‡ºä¾†çš„åŠŸèƒ½ã€‚ ä¸éœ€è¦è‡ªå·±ä¾†ç®¡ç†åº•å±¤çš„æ©Ÿå™¨(EC2)ï¼Œé‚„æœƒå¹«å¿™è™•ç†æ‰ Auto Scaling å’Œ loading balanceï¼Œè®“é–‹ç™¼äººå“¡å¯ä»¥å°ˆæ³¨åœ¨æœå‹™ã€ç¶²è·¯å±¤ç´šï¼Œæ¨è–¦ä½¿ç”¨ EC2 mode åº•å±¤çš„æ©Ÿå™¨æ˜¯è‡ªå·±åˆ†é…çš„ EC2 instanceï¼Œä¹Ÿå¯ä»¥è¨­å®š Spot æ¨¡å¼åœ¨ä¸éœ€è¦çš„æ™‚å€™æ˜¯é—œæ©Ÿçš„ï¼Œåƒ¹æ ¼ä½éå¸¸å¤š æŒ‰ç…§å®˜æ–¹æ•™çš„èµ° https://docs.aws.amazon.com/zh_tw/AmazonECS/latest/developerguide/ecs-cli-tutorial-fargate.html\n# ä¸€å€‹æ–°çš„ ECS Cluster ecs-cli configure --cluster silkrode --default-launch-type FARGATE --config-name tutorial --region ap-northeast-1 ecs-cli configure profile --access-key AKIAW5********SDNHKT --secret-key YFFP36xe+b********pnOSlVT1+JLs7Ck07kGYJS --profile-name tutorial-profile ecs-cli up --cluster-config tutorial --ecs-profile tutorial-profile aws ec2 describe-security-groups --filters Name=vpc-id,Values=vpc-0d0b9a2b847dd6eaf --region ap-northeast-1 aws ec2 authorize-security-group-ingress --group-id sg-0a8d7d69bd7302908 --protocol tcp --port 8000 --cidr 0.0.0.0/0 --region ap-northeast-1 docke-compose.yml\nversion: '3' services: web: image: xiao4011/toolbox ports: - \u0026quot;8000:8000\u0026quot; depends_on: - \u0026quot;redis\u0026quot; logging: driver: awslogs options: awslogs-group: tutorial awslogs-region: ap-northeast-1 awslogs-stream-prefix: web redis: image: redis ecs-params.yml\nversion: 1 task_definition: task_execution_role: ecsTaskExecutionRole ecs_network_mode: awsvpc task_size: mem_limit: 0.5GB cpu_limit: 256 run_params: network_configuration: awsvpc_configuration: subnets: - subnet-007b5172614cc7c27 security_groups: - sg-0a8d7d69bd7302908 assign_public_ip: ENABLED ecs-cli compose --project-name tutorial service up --create-log-groups --cluster-config tutorial --ecs-profile tutorial-profile æœå‹™é–‹å®Œå°±é—œæ‰æƒ¹ XDD\nRef AWS ECS vs Kubernetes: https://cloud.netapp.com/blog/aws-ecs-vs-kubernetes-an-unfair-comparison ECSä»‹ç´¹ (EC2 mode \u0026amp; Fargate mode) https://youtu.be/22IsSW3YD0A https://docs.aws.amazon.com/AmazonECS/latest/developerguide/clusters.html\n","id":31,"section":"posts","summary":"æ¶æ§‹ ECS(Elastic Container Service) æ˜¯ AWS ä¸Šçš„å®¹å™¨ç®¡ç†æœå‹™ï¼Œæ¶æ§‹ä¸Šå¯ä»¥ç°¡å–®åˆ†æˆå¹¾å±¤: Cluster ä¸€å€‹ç¾¤é›† :) Service å¯ä»¥æŠŠå®ƒç•¶ä½œ \u0026ldquo;åŸ·è¡Œä¼åŠƒ\u0026rdquo;ï¼Œå°±åƒæ˜¯ä¸€å€‹ docker-compose å°‡å¤šå€‹ docker","tags":["aws"],"title":"æœ‰ä¸€å¤©è·¯é AWS ECS","uri":"https://blog.10oz.tw/20201009-aws-ecs-beginner/","year":"2020"},{"content":"ä»‹ç´¹ä¸€ä¸‹ åœ¨é‡è¦‹ GraphQL çš„æ™‚å€™æœ€å¸¸è¢«æ¯”è¼ƒçš„å°±æ˜¯ Restful APIï¼Œç•¢ç«Ÿ Rustful API æ˜¯ç›®å‰çš„ä¸»æµè¨­è¨ˆï¼Œæ­¤æ™‚æˆ‘å€‘å°±å¿…é ˆäº†è§£åˆ°ä»€éº¼æƒ…æ³ä¸‹ä½¿ç”¨ GraphQL èƒ½å¸¶ä¾†æ•ˆç›Š\nOver Fetch Restful API çš„å›å‚³æœƒæ˜¯ä¸€æ•´å€‹ resourceï¼Œ /user/1 æœƒå›å‚³ id=1 çš„ User çš„å…¨éƒ¨è³‡æ–™ï¼Œç„¶è€Œåœ¨å¾ˆå¤šæƒ…æ³ä¸‹æˆ‘å€‘ä¸éœ€è¦é€™éº¼å¤šçš„è³‡æ–™ï¼Œå¯èƒ½ æˆ‘å€‘åƒ…åƒ…åªéœ€è¦ user çš„åå­—è€Œå·² åœ¨ GraphQL ä½ å¯ä»¥æŒ‡å®šä½ æ‰€éœ€è¦çš„æ¬„ä½ï¼Œå¤§å¤§çš„æ¸›å°‘äº†å‚³è¼¸ç„¡ç”¨è³‡æ–™çš„æ¶ˆè€— Under Fetch ä¹Ÿå°±æ˜¯ n+1 å•é¡Œï¼Œæƒ…æ™¯æ˜¯ user æœ‰å¾ˆå¤šçš„ friendsï¼Œæ¯å€‹æœ‹å‹éƒ½æ˜¯ä¸€å Userï¼Œåœ¨ Restful çš„è¨­è¨ˆä¸­ï¼Œæ¯å€‹ User resource éƒ½æ˜¯ä¸€æ”¯ APIï¼Œæƒ³æƒ³å°±é ­ç—› QQã€‚å› æ­¤æœƒåœ¨å¾Œç«¯å®¢è£½åŒ– API åš eager loadingï¼Œä¸€æ¬¡å›å‚³é€™äº›è³‡æ–™ ä½†åˆ°äº† GraphQL é€™å®Œå…¨ä¸æ˜¯å•é¡Œï¼Œä½ å¯ä»¥å‘ä¸‹å®šç¾©ä½ æ‰€éœ€è¦çš„è³‡æ–™ï¼Œä¸¦åµŒå…¥ User ä¸­ query { User(id: 1) { Name AvatarURL friends { ID Name } } } åœ¨è¨­è¨ˆä¸Šï¼ŒGraphQL é—œæ³¨ æ˜ç¢ºçš„è§£é‡‹æŸ¥è©¢èªè¨€èˆ‡å‹æ…‹ç³»çµ± è€Œä¸å»æè¿°ä¼ºæœå™¨ç«¯å¯¦ä½œï¼Œå‰å¾Œç«¯ä¹‹é–“ä»¥ Schema å®šç¾©æºé€šä»‹é¢ï¼Œé›™æ–¹æœ‰å…±é€šçš„è³‡æ–™å‹æ…‹ä»¥åŠæ˜ç¢ºå®šç¾©çš„è©å½™ä¾†è¨è«–\nè®“ä¸€åˆ‡æ¸…æ¥šä¸”ç°¡å–®ï½\næ€éº¼ç”¨r å·¥å…·æœƒç”¨ä¸€é» - GraphQL Playground èªè­˜ä¸€äº› GraphQL Schema GraphQL å®šç¾©è‡ªå·±çš„èªæ³•æ ¼å¼ï¼Œä»–æ˜¯å€‹ SDL (Schema Define Language)\né¦–å…ˆä¾†å®šç¾©ä¸€å€‹ type ä¹Ÿå°±æ˜¯åŸºæœ¬çš„ç‰©ä»¶ï¼ŒåŸºæœ¬å‹åˆ¥æœ‰ Int Float String Boolean IDï¼Œä¹Ÿå¯ä»¥ç”¨ ! ä¾†å®šç¾©è©²æ¬„ä½æ˜¯å¦æ˜¯ Nullable çš„\ntype Student { id: Int! name: String! \u0026quot;å¯ä»¥å¯«è¨»è§£èªªæ¯å€‹å­¸ç”Ÿéƒ½æœ‰ sid\u0026quot; studentID: String! \u0026quot;\u0026quot;\u0026quot; å¤šè¡Œè¨»è§£èªªï¼š æ¯å€‹å­¸ç”Ÿéƒ½å¯ä»¥å¡«ä¸€å€‹é›»è©± \u0026quot;\u0026quot;\u0026quot; phone: Phone \u0026quot;\u0026quot;\u0026quot; æ¯å€‹äººéƒ½å¯ä»¥ç™¼å¾ˆå¤šæ–‡ \u0026quot;\u0026quot;\u0026quot; articles: [Article!] } type Phone { phoneNumber: String! } type Article { title: String! content: String! } åŸºæœ¬å‹åˆ¥ä¸å¤ ç”¨å—ï¼Œæˆ‘å€‘ä¾†è‡ªå®šç¾©ä¸€ä¸‹ï¼ŒDate ç„¶å¾Œé€™å€‹å‹åˆ¥çš„å¯¦ä½œè¦ä¼ºæœå™¨ç«¯è‡ªå·±ä¾†å–”\nscalar Date # ç”¨æ³•é€™æ¨£ type Article2 { title: String! content: String! date: Date! } ä¹Ÿå¯ä»¥å®šç¾©æšèˆ‰é¡åˆ¥(enumeration)\nenum GradingStatus { INPROGRESS GRADUATED } type Student2 { gradingStatus: GradingStatus! } ç•¶ä½ çš„ç‰©ä»¶å¯èƒ½æ˜¯ä¸åŒçš„çµæ§‹æ™‚ï¼Œä½ å¯ä»¥æ‰¾ union\n\u0026quot;\u0026quot;\u0026quot; union å®šç¾© User å¯èƒ½æ˜¯ Student ä¹Ÿå¯èƒ½æ˜¯ Teacher \u0026quot;\u0026quot;\u0026quot; union User = Student | Teacher æˆ–æ˜¯ interface ä¹Ÿèƒ½æ»¿è¶³ä½ çš„éœ€æ±‚\ninterface User { id: ID! name: String! phone: Phone } type Student implements User { id: ID! name: String! phone: Phone # ä½ é‚„å¯ä»¥å®šç¾©æ›´å¤šæ›´å¤š... } type Teacher implements User { id: ID! name: String! phone: Phone # ä½ é‚„å¯ä»¥å®šç¾©æ›´å¤šæ›´å¤š... } query mutation é©šå˜†è™Ÿ (enum with default)\nèªæ³•çŸ¥é“ä¸€ä¸‹ (query, mutation, subscription) æœ‰ä¸‰ç¨®åŸºæœ¬èªæ³• query, mutation, subscription\nquery å¯ä»¥ç°¡å–®æƒ³åƒä»–æ˜¯ RestfulAPI ä¸­çš„ GETï¼Œç”¨ä¾†æ‹¿å„ç¨®è³‡æ–™\nfragment å¯ä»¥æŠ½å‡ºå¸¸ç”¨çš„çµæ§‹ä¾†ç°¡åŒ–èªæ³•\nquery { me { ...UserBrief } # å¯ä»¥ä¸€æ¬¡å®šç¾©å¤šå€‹ query user(name: \u0026quot;foo\u0026quot;) { id ...UserBrief } } # fragment å¯ä»¥å¹«åŠ©é‡ç”¨åƒæ•¸ fragment UserBrief on User { name email } union æœ‰æ™‚å€™å›å‚³çš„ä¸ä¸€å®šæ˜¯åŒä¸€ç¨®ç‰©ä»¶ï¼Œé€™æ™‚å€™å¯ä»¥é€™éº¼åš\n# ä¸€å€‹ people å¯èƒ½æ˜¯ Teacher æˆ–æ˜¯ Studentï¼Œä¸åŒçš„ type æœƒå›å‚³ä¸åŒçš„å…§å®¹ query people { ...on Teacher { teacherID name } ...on Student { studentID name grade } } # ç­‰åƒ¹çš„ï¼Œä½ ä¹Ÿå¯ä»¥å¯«æˆé€™æ¨£ query people { ...pTeacher ...pStudent } fragment pTeacher on Teacher { teacherID name } fragment pStudent on Student { studentID name grade } mutation å¯ä»¥ç°¡å–®æƒ³åƒä»–æ˜¯ RestfulAPI ä¸­çš„ POSTï¼Œç”¨ä¾†è®Šæ›´è³‡æ–™\nmutation { newUser(name: \u0026quot;foo\u0026quot; email: \u0026quot;bar@mail.tw\u0026quot;) { id # å›å‚³çš„ id ...UserBrief } } fragment UserBrief on User { name email } ä¹Ÿå¯ä»¥ç”¨ $ é–‹é ­å¯«é»è®Šæ•¸\nmutation create($name: String $email: String) { newUser(name: $name email: $email) { id # å›å‚³çš„ id ...UserBrief } } fragment UserBrief on User { name email } subscription å»ºç«‹ websocket é•·é€£ç·šä¾†æ¥æ”¶è³‡æ–™çš„è®Šæ›´ï¼Œç”¨æ³•è·Ÿ query å¾ˆåƒï¼Œåœ¨è³‡æ–™è®Šæ›´æ™‚å°±æ”¶åˆ°è¨Šæ¯å›‰\nsubscription { me { name email } } Introspection è‡ªæˆ‘æŸ¥è©¢ GraphQL å¯ä»¥åˆ©ç”¨è‡ªæˆ‘æŸ¥è©¢ä¾†å–å¾—ç›®å‰çš„ Schema\nquery ListTypes { __schema { # å–å¾— gql å®šç¾©äº†å“ªäº› Types types { kind # Object, InputObject, Enum, Scalar name description # é€™è£¡ä¹Ÿå¯ä»¥ç›´æ¥ fields æ‹¿è©³ç´°è³‡è¨Š } } } query TypeDetail { # æˆ‘å€‘æƒ³è¦æ‹¿ Role é€™å€‹ Type çš„è©³ç´°è³‡æ–™ __type(name: \u0026quot;Role\u0026quot;) { name kind fields { name type { ofType{ name } } } } } query IntrospectionQuery { # æˆ‘è¦æ‹¿å…¨éƒ¨æ“ä½œ(query, mutation, subscription) __schema { queryType { ...OprationDetail } mutationType { ...OprationDetail } subscriptionType { ...OprationDetail } } } fragment OprationDetail on __Type { name fields { name type { ofType{ name } } } } graphQL è‡ªå¸¶æ–‡ä»¶ï¼Œå…·å‚™ä¸€èˆ¬ API Server æ²’æœ‰çš„å„ªå‹¢ï¼Œæ£’æ£’ã„‰\nHASURA https://cloud.hasura.io/project/88f267cd-3f1b-45fa-a1e1-a7ceed6ba10a/env-vars\nRef Think in GraphQL https://ithelp.ithome.com.tw/users/20111997/ironman/1878 https://graphql.org/learn/schema/\n","id":32,"section":"posts","summary":"ä»‹ç´¹ä¸€ä¸‹ åœ¨é‡è¦‹ GraphQL çš„æ™‚å€™æœ€å¸¸è¢«æ¯”è¼ƒçš„å°±æ˜¯ Restful APIï¼Œç•¢ç«Ÿ Rustful API æ˜¯ç›®å‰çš„ä¸»æµè¨­è¨ˆï¼Œæ­¤æ™‚æˆ‘å€‘å°±å¿…é ˆäº†è§£åˆ°ä»€éº¼æƒ…æ³ä¸‹ä½¿ç”¨ GraphQL èƒ½å¸¶ä¾†æ•ˆç›Š Over Fetch Restful API çš„å›å‚³æœƒæ˜¯ä¸€","tags":["graphql","gql"],"title":"GraphQL æ‰“æ‹›å‘¼","uri":"https://blog.10oz.tw/20201009-hello-graphql/","year":"2020"},{"content":"å¥½æ–‡ç« æ¨æ¨ï¼Œç›´æ¥æŠ„çˆ† https://learnku.com/articles/24924\nè¨­å®šé–‹å§‹ æ’°å¯«è¨­å®šæª” é¦–å…ˆ vim ~/.vimrc æ”¹æˆä¸‹é¢é€™æ¨¡æ¨£\n\u0026quot;============================================================================== \u0026quot; vim å†…ç½®é…ç½® \u0026quot;============================================================================== \u0026quot; è®¾ç½® vimrc ä¿®æ”¹ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆï¼Œä¸ç”¨åœ¨é‡æ–°æ‰“å¼€ \u0026quot; å»ºè®®é…ç½®å®Œæˆåå°†è¿™ä¸ªå…³é—­ï¼Œå¦åˆ™é…ç½®å¤šäº†ä¹‹åä¼šå¾ˆå¡ \u0026quot; autocmd BufWritePost $MYVIMRC source $MYVIMRC \u0026quot; å…³é—­å…¼å®¹æ¨¡å¼ set nocompatible set nu \u0026quot; è®¾ç½®è¡Œå· set cursorline \u0026quot;çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ set showmatch \u0026quot; æ˜¾ç¤ºæ‹¬å·åŒ¹é… \u0026quot; tab ç¼©è¿› set tabstop=4 \u0026quot; è®¾ç½®Tabé•¿åº¦ä¸º4ç©ºæ ¼ set shiftwidth=4 \u0026quot; è®¾ç½®è‡ªåŠ¨ç¼©è¿›é•¿åº¦ä¸º4ç©ºæ ¼ set autoindent \u0026quot; ç»§æ‰¿å‰ä¸€è¡Œçš„ç¼©è¿›æ–¹å¼ï¼Œé€‚ç”¨äºå¤šè¡Œæ³¨é‡Š \u0026quot; å®šä¹‰å¿«æ·é”®çš„å‰ç¼€ï¼Œå³\u0026lt;Leader\u0026gt; let mapleader=\u0026quot;,\u0026quot; \u0026quot; ==== ç³»ç»Ÿå‰ªåˆ‡æ¿å¤åˆ¶ç²˜è´´ ==== \u0026quot; v æ¨¡å¼ä¸‹å¤åˆ¶å†…å®¹åˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿ vmap \u0026lt;Leader\u0026gt;c \u0026quot;+yy \u0026quot; n æ¨¡å¼ä¸‹å¤åˆ¶ä¸€è¡Œåˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿ nmap \u0026lt;Leader\u0026gt;c \u0026quot;+yy \u0026quot; n æ¨¡å¼ä¸‹ç²˜è´´ç³»ç»Ÿå‰ªåˆ‡æ¿çš„å†…å®¹ nmap \u0026lt;Leader\u0026gt;v \u0026quot;+p \u0026quot; å¼€å¯å®æ—¶æœç´¢ set incsearch \u0026quot; æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ set ignorecase syntax enable syntax on \u0026quot; å¼€å¯æ–‡ä»¶ç±»å‹ä¾¦æµ‹ filetype plugin indent on \u0026quot; å¯ç”¨è‡ªåŠ¨è¡¥å…¨ \u0026quot; é€€å‡ºæ’å…¥æ¨¡å¼æŒ‡å®šç±»å‹çš„æ–‡ä»¶è‡ªåŠ¨ä¿å­˜ au InsertLeave *.go,*.sh,*.php write \u0026quot;============================================================================== \u0026quot; æ’ä»¶é…ç½® \u0026quot;============================================================================== \u0026quot; æ’ä»¶å¼€å§‹çš„ä½ç½® call plug#begin('~/.vim/plugged') \u0026quot; Shorthand notation; fetches https://github.com/junegunn/vim-easy-align \u0026quot; å¯ä»¥å¿«é€Ÿå¯¹é½çš„æ’ä»¶ Plug 'junegunn/vim-easy-align' \u0026quot; ç”¨æ¥æä¾›ä¸€ä¸ªå¯¼èˆªç›®å½•çš„ä¾§è¾¹æ  Plug 'scrooloose/nerdtree' \u0026quot; å¯ä»¥ä½¿ nerdtree Tab æ ‡ç­¾çš„åç§°æ›´å‹å¥½äº› Plug 'jistr/vim-nerdtree-tabs' \u0026quot; å¯ä»¥åœ¨å¯¼èˆªç›®å½•ä¸­çœ‹åˆ° git ç‰ˆæœ¬ä¿¡æ¯ Plug 'Xuyuanp/nerdtree-git-plugin' \u0026quot; æ”¯æ´æ›´å¤š git çš„åŠŸèƒ½ Plug 'tpope/vim-fugitive' Plug 'tpope/vim-rhubarb' Plug 'shumphrey/fugitive-gitlab.vim' \u0026quot; å¯ä»¥åœ¨æ–‡æ¡£ä¸­æ˜¾ç¤º git ä¿¡æ¯ Plug 'airblade/vim-gitgutter' \u0026quot; æŸ¥çœ‹å½“å‰ä»£ç æ–‡ä»¶ä¸­çš„å˜é‡å’Œå‡½æ•°åˆ—è¡¨çš„æ’ä»¶ï¼Œ \u0026quot; å¯ä»¥åˆ‡æ¢å’Œè·³è½¬åˆ°ä»£ç ä¸­å¯¹åº”çš„å˜é‡å’Œå‡½æ•°çš„ä½ç½® \u0026quot; å¤§çº²å¼å¯¼èˆª, Go éœ€è¦ https://github.com/jstemmer/gotags æ”¯æŒ Plug 'majutsushi/tagbar' \u0026quot; è‡ªåŠ¨è¡¥å…¨æ‹¬å·çš„æ’ä»¶ï¼ŒåŒ…æ‹¬å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œä»¥åŠèŠ±æ‹¬å· Plug 'jiangmiao/auto-pairs' \u0026quot; VimçŠ¶æ€æ æ’ä»¶ï¼ŒåŒ…æ‹¬æ˜¾ç¤ºè¡Œå·ï¼Œåˆ—å·ï¼Œæ–‡ä»¶ç±»å‹ï¼Œæ–‡ä»¶åï¼Œä»¥åŠGitçŠ¶æ€ Plug 'vim-airline/vim-airline' \u0026quot; ä»£ç è‡ªåŠ¨å®Œæˆï¼Œå®‰è£…å®Œæ’ä»¶è¿˜éœ€è¦é¢å¤–é…ç½®æ‰å¯ä»¥ä½¿ç”¨ Plug 'Valloric/YouCompleteMe' \u0026quot; ä¸‹é¢ä¸¤ä¸ªæ’ä»¶è¦é…åˆä½¿ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆä»£ç å— Plug 'SirVer/ultisnips' Plug 'honza/vim-snippets' \u0026quot; é…è‰²æ–¹æ¡ˆ Plug 'fatih/molokai' \u0026quot; go ä¸»è¦æ’ä»¶ Plug 'fatih/vim-go', { 'tag': '*' } \u0026quot; go ä¸­çš„ä»£ç è¿½è¸ªï¼Œè¾“å…¥ gd å°±å¯ä»¥è‡ªåŠ¨è·³è½¬ Plug 'dgryski/vim-godef' \u0026quot; markdown æ’ä»¶ Plug 'iamcco/mathjax-support-for-mkdp' Plug 'iamcco/markdown-preview.vim' \u0026quot; æ¨¡ç³Šæœå°‹ Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' } Plug 'junegunn/fzf.vim' \u0026quot; å¤šè¡Œç·¨è¼¯ Plug 'mg979/vim-visual-multi' \u0026quot; æœå°‹ Plug 'mileszs/ack.vim' let g:ackprg = 'ag --nogroup --nocolor --column' \u0026quot; æ’ä»¶ç»“æŸçš„ä½ç½®ï¼Œæ’ä»¶å…¨éƒ¨æ”¾åœ¨æ­¤è¡Œä¸Šé¢ call plug#end() \u0026quot;============================================================================== \u0026quot; ä¸»é¢˜é…è‰² \u0026quot;============================================================================== let g:rehash256 = 1 let g:molokai_original = 1 colorscheme molokai \u0026quot; colorscheme sublimemonokai \u0026quot;============================================================================== \u0026quot; vim-go æ’ä»¶ \u0026quot;============================================================================== let g:go_fmt_command = \u0026quot;goimports\u0026quot; \u0026quot; æ ¼å¼åŒ–å°†é»˜è®¤çš„ gofmt æ›¿æ¢ let g:go_autodetect_gopath = 1 let g:go_list_type = \u0026quot;quickfix\u0026quot; let g:go_version_warning = 1 let g:go_highlight_types = 1 let g:go_highlight_fields = 1 let g:go_highlight_functions = 1 let g:go_highlight_function_calls = 1 let g:go_highlight_operators = 1 let g:go_highlight_extra_types = 1 let g:go_highlight_methods = 1 let g:go_highlight_generate_tags = 1 let g:go_highlight_format_strings = 1 let g:go_highlight_function_arguments = 1 let g:go_highlight_generate_tags = 1 let g:go_highlight_variable_declarations = 1 let g:godef_split=2 \u0026quot;============================================================================== \u0026quot; NERDTree æ’ä»¶ \u0026quot;============================================================================== \u0026quot; æ‰“å¼€å’Œå…³é—­NERDTreeå¿«æ·é”® map \u0026lt;F10\u0026gt; :NERDTreeToggle\u0026lt;CR\u0026gt; \u0026quot; æ˜¾ç¤ºè¡Œå· let NERDTreeShowLineNumbers=1 \u0026quot; æ‰“å¼€æ–‡ä»¶æ—¶æ˜¯å¦æ˜¾ç¤ºç›®å½• let NERDTreeAutoCenter=1 \u0026quot; æ˜¯å¦æ˜¾ç¤ºéšè—æ–‡ä»¶ let NERDTreeShowHidden=1 \u0026quot; è®¾ç½®å®½åº¦ \u0026quot; let NERDTreeWinSize=31 \u0026quot; å¿½ç•¥ä¸€ä¸‹æ–‡ä»¶çš„æ˜¾ç¤º let NERDTreeIgnore=['\\.pyc', '\\~$', '\\.swp', '.git'] \u0026quot; æ‰“å¼€ vim æ–‡ä»¶åŠæ˜¾ç¤ºä¹¦ç­¾åˆ—è¡¨ let NERDTreeShowBookmarks=2 \u0026quot; åœ¨ç»ˆç«¯å¯åŠ¨vimæ—¶ï¼Œå…±äº«NERDTree let g:nerdtree_tabs_open_on_console_startup=1 \u0026quot;============================================================================== \u0026quot; majutsushi/tagbar æ’ä»¶ \u0026quot;============================================================================== \u0026quot; majutsushi/tagbar æ’ä»¶æ‰“å¼€å…³é—­å¿«æ·é”® nmap \u0026lt;F9\u0026gt; :TagbarToggle\u0026lt;CR\u0026gt; let g:tagbar_type_go = { \\ 'ctagstype' : 'go', \\ 'kinds' : [ \\ 'p:package', \\ 'i:imports:1', \\ 'c:constants', \\ 'v:variables', \\ 't:types', \\ 'n:interfaces', \\ 'w:fields', \\ 'e:embedded', \\ 'm:methods', \\ 'r:constructor', \\ 'f:functions' \\ ], \\ 'sro' : '.', \\ 'kind2scope' : { \\ 't' : 'ctype', \\ 'n' : 'ntype' \\ }, \\ 'scope2kind' : { \\ 'ctype' : 't', \\ 'ntype' : 'n' \\ }, \\ 'ctagsbin' : 'gotags', \\ 'ctagsargs' : '-sort -silent' \\ } \u0026quot;============================================================================== \u0026quot; nerdtree-git-plugin æ’ä»¶ \u0026quot;============================================================================== let g:NERDTreeGitStatusIndicatorMapCustom = { \\ \u0026quot;Modified\u0026quot; : \u0026quot;âœ¹\u0026quot;, \\ \u0026quot;Staged\u0026quot; : \u0026quot;âœš\u0026quot;, \\ \u0026quot;Untracked\u0026quot; : \u0026quot;âœ­\u0026quot;, \\ \u0026quot;Renamed\u0026quot; : \u0026quot;âœ\u0026quot;, \\ \u0026quot;Unmerged\u0026quot; : \u0026quot;â•\u0026quot;, \\ \u0026quot;Deleted\u0026quot; : \u0026quot;âœ–\u0026quot;, \\ \u0026quot;Dirty\u0026quot; : \u0026quot;âœ—\u0026quot;, \\ \u0026quot;Clean\u0026quot; : \u0026quot;âœ”ï¸\u0026quot;, \\ 'Ignored' : 'â˜’', \\ \u0026quot;Unknown\u0026quot; : \u0026quot;?\u0026quot; \\ } let g:NERDTreeGitStatusShowIgnored = 1 \u0026quot;============================================================================== \u0026quot; nerdtree-git-plugin æ’ä»¶ \u0026quot;============================================================================== \u0026quot; [Buffers] Jump to the existing window if possible let g:fzf_buffers_jump = 1 nnoremap \u0026lt;leader\u0026gt;fl :Lines nnoremap \u0026lt;leader\u0026gt;fbl :BLines nnoremap \u0026lt;leader\u0026gt;ff :Files \u0026quot;============================================================================== \u0026quot; Valloric/YouCompleteMe æ’ä»¶ \u0026quot;============================================================================== \u0026quot; make YCM compatible with UltiSnips (using supertab) let g:ycm_key_list_select_completion = ['\u0026lt;C-n\u0026gt;', '\u0026lt;space\u0026gt;'] let g:ycm_key_list_previous_completion = ['\u0026lt;C-p\u0026gt;', '\u0026lt;Up\u0026gt;'] let g:SuperTabDefaultCompletionType = '\u0026lt;C-n\u0026gt;' \u0026quot; better key bindings for UltiSnipsExpandTrigger let g:UltiSnipsExpandTrigger = \u0026quot;\u0026lt;tab\u0026gt;\u0026quot; let g:UltiSnipsJumpForwardTrigger = \u0026quot;\u0026lt;tab\u0026gt;\u0026quot; let g:UltiSnipsJumpBackwardTrigger = \u0026quot;\u0026lt;s-tab\u0026gt;\u0026quot; \u0026quot;============================================================================== \u0026quot; æ”¯æ´æ›´å¤š git \u0026quot;============================================================================== \u0026quot; GBrower gitlab let g:fugitive_gitlab_domains = ['https://gitlab.silkrode.com.tw'] let g:gitlab_api_keys = {'gitlab.silkrode.com.tw': 'é€™å€‹å¯èƒ½ä¸èƒ½å…¬é–‹'} \u0026quot;============================================================================== \u0026quot; å…¶ä»–æ’ä»¶é…ç½® \u0026quot;============================================================================== \u0026quot; markdwon çš„å¿«æ·é”® map \u0026lt;silent\u0026gt; \u0026lt;F5\u0026gt; \u0026lt;Plug\u0026gt;MarkdownPreview map \u0026lt;silent\u0026gt; \u0026lt;F6\u0026gt; \u0026lt;Plug\u0026gt;StopMarkdownPreview \u0026quot; tab æ ‡ç­¾é¡µåˆ‡æ¢å¿«æ·é”® :nn \u0026lt;Leader\u0026gt;1 1gt :nn \u0026lt;Leader\u0026gt;2 2gt :nn \u0026lt;Leader\u0026gt;3 3gt :nn \u0026lt;Leader\u0026gt;4 4gt :nn \u0026lt;Leader\u0026gt;5 5gt :nn \u0026lt;Leader\u0026gt;6 6gt :nn \u0026lt;Leader\u0026gt;7 7gt :nn \u0026lt;Leader\u0026gt;8 8gt :nn \u0026lt;Leader\u0026gt;9 8gt :nn \u0026lt;Leader\u0026gt;0 :tablast\u0026lt;CR\u0026gt; å®‰è£ç›¸é—œæ’ä»¶ Plug - vim å¥—ä»¶ç®¡ç†å·¥å…· æˆ‘å€‘è¦ç”¨ Plug ä¾†è£æ’ä»¶ https://github.com/junegunn/vim-plug\nunix ç‰ˆæœ¬\ncurl -fLo ~/.vim/autoload/plug.vim --create-dirs \\ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim ç„¶å¾Œè¼¸å…¥ vim +PlugInstall é–‹å§‹å®‰è£ å†ä¾†å®‰è£ vim +GoInstallBinaries golang toolsï¼Œé›–ç„¶æ²’æ„å¤–çš„è©±æ—©å°±è£éæƒ¹å‘¢XDD\nä½ å®Œæˆæˆ‘ - è‡ªå‹•è£œé½Šå·¥å…· YouCompleteMe å‰›æ‰å·²ç¶“ç”¨ Plug ä¸‹è¼‰ä¸‹ä¾†äº†ï¼Œä¸éé‚„ä¸èƒ½ç›´æ¥ä½¿ç”¨\ncd .vim/plugged/YouCompleteMe brew install cmake macvim # å¯é¸: python mono go nodejs # å¦‚æœä¸æŒ‡å®š go çš„è©±ï¼Œä»–æœƒå®‰è£ C# Go JavaScript Rust Jaca python3 install.py --go-completer ä½¿ç”¨è€…ç­†è¨˜ æ’ä»¶å€‘ é›–ç„¶å‰›å‰›è£äº†æ»¿æ»¿çš„ plugin ä½†ä¹Ÿè¦æœƒç”¨æ‰è¡Œrrr ğŸ˜‚ğŸ˜‚\nNERDTree - å·¦é‚Šçš„ Sidebar C_w + [ä¸Šä¸‹å·¦å³] åˆ‡æ›åˆ° [ä¸Šä¸‹å·¦å³] çš„åˆ†å‰²è¦–çª— C_w + w åˆ‡æ›åˆ°ä¸‹ä¸€å€‹åˆ†å‰²è¦–çª— åœ¨ NERDTress å°æª”æ¡ˆ t é–‹å•Ÿæ–°åˆ†é  åœ¨ NERDTress å°æª”æ¡ˆ o é–‹å•Ÿæ–°åˆ†é ï¼Œä¸¦è·³éå» åœ¨ NERDTress å°è³‡æ–™å¤¾ o å±•é–‹/ç¸®åˆè³‡æ–™å¤¾ åœ¨ NERDTress æŒ‰ä¸‹ m æœƒé€²å…¥æª”æ¡ˆç®¡ç†æ¨¡å¼ï¼Œå†ä¾†æŒ‰ a å¯ä»¥æ–°å¢æª”æ¡ˆ åˆ‡æ›åˆ°æŒ‡å®šåˆ†é  \u0026lt;Leader\u0026gt;[1-9] æˆ–æ˜¯ä¸Šé¢æœ‰è¨­å®š [1-9]gt vim-fugitive æä¾›äº†å¾ˆå¤šåœ¨ vim ä¸Šé¢æ•´åˆ git çš„åŠŸèƒ½ :Gdiffsplit æ°´å¹³åˆ†å‰² git diff ç•«é¢ (ä¸Šä¸‹) :Gvdiff å‚ç›´åˆ†å‰² git diff ç•«é¢ (çœ‹å·¦å³å¥½åƒæ¯”è¼ƒç¿’æ…£) :GBrowser ç›´æ¥åœ¨ç¶²é (github, gitlab)ä¸Šé–‹å•Ÿç›®å‰çš„æª”æ¡ˆ Vim åŸºæœ¬å¸¸ç”¨æŒ‡ä»¤ å¤šè¡Œä¿®æ”¹: C_V é¸å–ï¼Œ I é€²å…¥ä¿®æ”¹æ¨¡å¼ C_d ä¸‹æ»‘ä¸€é  C_b ä¸Šæ»‘ä¸€é  :set syn=yaml è¨­å®šèªæ³•é«˜äº® Ref https://learnku.com/articles/24924 https://github.com/ycm-core/YouCompleteMe\n","id":33,"section":"posts","summary":"å¥½æ–‡ç« æ¨æ¨ï¼Œç›´æ¥æŠ„çˆ† https://learnku.com/articles/24924 è¨­å®šé–‹å§‹ æ’°å¯«è¨­å®šæª” é¦–å…ˆ vim ~/.vimrc æ”¹æˆä¸‹é¢é€™æ¨¡æ¨£ \u0026quot;============================================================================== \u0026quot; vim å†…ç½®é…ç½® \u0026quot;============================================================================== \u0026quot; è®¾ç½® vimrc ä¿®æ”¹ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆï¼Œä¸ç”¨åœ¨é‡æ–°æ‰“å¼€ \u0026quot; å»ºè®®é…ç½®å®Œæˆåå°†è¿™","tags":["vim","golang"],"title":"æˆ‘è¦è£ vim","uri":"https://blog.10oz.tw/20200926-wanna-install-vim/","year":"2020"},{"content":" é€™æ¬¡ç­†è¨˜å…§å®¹æœƒåœç¹åœ¨æ¯”ç‰¹å¹£é€™å€‹å€å¡ŠéŠåŠ å¯†è²¨å¹£ç³»çµ± ç„¶å¾Œæ¯”ç‰¹å¹£æ˜¯ä¸€ç¨®è®“åŒ—æ¥µç†Šæ²’æœ‰å®¶ä½çš„æŠ€è¡“ (?\nå€å¡Šéˆçš„å®‰å…¨ å€å¡Šéˆéˆçš„æ¨¡å¼ï¼Œä¿è­‰æ–°çš„å€å¡Šæ¥çºŒå‰ä¸€å€‹å€å¡Šï¼Œç•¶å€å¡Šè¶Šå¤šè¶Šé›£è¢«ä¿®æ”¹ å…±è­˜æ©Ÿåˆ¶éœ€è¦å¤šæ•¸ç¯€é»èªåŒä¿è­·è³‡æ–™ä¸æ˜“è¢«ç«„æ”¹ï¼Œä¹Ÿå°±æ˜¯å»ä¸­å¿ƒåŒ–çš„éƒ¨åˆ†å•¦ å¯†ç¢¼å­¸ä¸Šçš„å›°é›£å•é¡Œä¿è­·ä½¿ç”¨è³‡ç”¢ä¸æœƒè¢«ä»»æ„å–ç”¨ï¼Œä¹Ÿåœ¨å»ºç«‹æ–°çš„å€å¡Šæ™‚å¢åŠ é›£åº¦ï¼Œå°±æ˜¯æŒ–ç¤¦çš„éƒ¨åˆ†å•¦ å…±è­˜æ©Ÿåˆ¶ é€™æ˜¯åœ¨åˆ†æ•£å¼ç³»çµ±ä¸­ç›¸ç•¶å¸¸è¦‹çš„å•é¡Œï¼Œç•¶ç¯€é»å¤šäº†ï¼Œåœ¨åŒæ­¥ä¸Šå‡ºç¾åˆ†æ­§æ™‚æ‡‰è©²è¦è½èª°çš„? ç©¶ç«Ÿèª°æ‰‹ä¸­çš„è³‡æ–™æ‰æ˜¯æ­£ç¢ºçš„å‘¢?\næ‹œå åº­å°‡è»å•é¡Œ æè¿°æœ‰æ•¸å€‹å°‡è»å„è‡ªåœ¨ä¸åŒåœ°æ–¹ï¼Œä½†æœ‰è‘—ç›¸åŒçš„ä»»å‹™ï¼Œè€Œé€™å€‹ä»»å‹™éå¸¸è‰±é›£ï¼Œå¿…é ˆè¦æ¯å€‹å°‡è»åŒæ™‚é€²æ”»ã€æˆ–æ˜¯åŒæ™‚æ’¤é€€ï¼Œå¦å‰‡å°±æœƒå¤±æ•—ã€‚\nå› æ­¤åœ¨å‡ºç™¼ä¹‹å‰ï¼Œæ¯ä½å°‡è»æœƒæŠ•ç¥¨æ±ºå®šä¹‹å¾Œæ‰é–‹å§‹è¡Œå‹•ï¼Œ ç„¶è€Œ\u0026hellip;åœ¨é€™æ¨£çš„æ¢ä»¶ä¸‹ï¼Œç«Ÿæœ‰é‚„æœ‰å¹¾ä½å°‡è»æ˜¯éš±è—èº«åˆ†çš„é–“è«œ!?\nåœ¨ç¯€é»ä¸­ï¼ŒåŒæ¨£æœƒé‡åˆ°é€™æ¨£çš„å•é¡Œï¼Œç•¶ç¯€é»ä¸­å‡ºç¾äº†ä¸éµå®ˆè¦å®šçš„æƒ¡æ„ç¯€é»æ™‚ï¼Œè©²å¦‚ä½•å°‡å®ƒçš„å½±éŸ¿é™ä½å‘¢?\næŒ–ç¤¦ ä¹Ÿå°±æ˜¯å¢åŠ é›£åº¦ï¼Œæ¯”ç‰¹å¹£ä½¿ç”¨ PoW(Proof-of-Work)ï¼Œè®“åŒ—æ¥µç†Šæ²’åœ°æ–¹ä½ ï¼Œè®“æ¯å€‹ç¯€é»ç”¨å·¥ä½œé‡ä¾†è­‰æ˜è‡ªå·±ã€‚å¦‚æœä½ æƒ³è¦æç ´å£çš„è©±ï¼Œä½ å¿…é ˆä»˜å‡ºæ¯”æ•´å€‹éˆä¸ŠéåŠçš„è¨ˆç®—èƒ½åŠ›ï¼Œç„¶è€Œåœ¨ç¾åœ¨å»£å¤§çš„æ¯”ç‰¹éˆç”Ÿæ…‹ä¾†èªªï¼Œé€™æ˜¯ä¸å¯èƒ½çš„ã€‚\næ¯å€‹éˆä¸Šçš„å…±è­˜æ©Ÿåˆ¶éƒ½ä¸åŒï¼Œä¾‹å¦‚ä¹™å¤ªéŠä¸Šä½¿ç”¨çš„æ˜¯ PoS\næ¿€å‹µæ©Ÿåˆ¶ åœ¨å‰ä¸€å€‹æ®µè½çš„å€å¡ŠéŠå®‰å…¨é‚£é‚Šæœ‰èªªåˆ°ä½¿ç”¨ PoW ä¾†ä¿è­‰é›£ä»¥éš¨æ„çš„æ·»åŠ å€å¡Šï¼Œä½†æ˜¯èªçœŸæƒ³æƒ³èª°è¦åšé€™éº¼åƒåŠ›çš„äº‹æƒ…? å› æ­¤æ¿€å‹µæ©Ÿåˆ¶çš„éƒ¨åˆ†å°±æ˜¯ çµ¦ä½ éŒ¢å¹«æˆ‘ç®— (*Â´âˆ€`)~â™¥ xdd\nå€å¡Šéˆç¯€é» èº«ç‚ºä¸€å€‹å»ä¸­å¿ƒåŒ–çš„é»å°é»ç³»çµ±ï¼Œç•¶ç„¶ä¸€å®šè¦æœ‰ç¯€é»ã€‚åœ¨æ¯”ç‰¹éˆä¸Šå¯ä»¥å¤§è‡´åˆ†å…©ç¨®ç¯€é»ï¼Œå…¨ç¯€é»(Full Node)èˆ‡è¼•é‡ç¯€é»(Light Node)\nå…¨ç¯€é»: å­˜æ”¾è‘—å®Œæ•´çš„æ¯”ç‰¹éˆè³‡è¨Š(å¥½å¹¾åGB)ï¼Œå·¥ä½œæ˜¯æ‰“åŒ…å€å¡Šä¸Šéˆä»¥åŠé©—è­‰å…¶ä»–äººä¸Šå‚³å€å¡Šçš„åˆæ³•æ€§ è¼•é‡ç¯€é»: ä¹Ÿç¨±ç‚ºç°¡å–®æ”¯ä»˜é©—è­‰ï¼ˆSPVï¼‰ç¯€é»ï¼Œä¸éœ€è¦å„²å­˜æ‰€æœ‰å€å¡Šè³‡è¨Šï¼Œä¹Ÿä¸æœƒå°éˆä¸Šçš„å®‰å…¨æ€§åšå‡ºè²¢ç»ï¼Œå°±åªæ˜¯å€‹ read userã€‚å¯ä»¥æ˜¯æ‰‹æ©Ÿæˆ–æ˜¯é›»è…¦çš„å®¢æˆ¶ç«¯è»Ÿé«”ï¼Œä»–èƒ½å¤ é©—è­‰æŸä¸€ç­†äº¤æ˜“æ˜¯å¦åœ¨å€å¡Šéˆä¸­ ç¤¦å·¥ä»”: æº–ç¢ºä¾†èªªç¤¦å·¥ä¸ä¸€å®šæ˜¯æ¯”ç‰¹ç¶²è·¯çš„ä¸€éƒ¨åˆ†ï¼Œç¤¦å·¥åªéœ€è¦å‘å…¨ç¯€é»è¦æ±‚äº¤æ˜“å›ä¾†æ‰“åŒ…ã€è¨ˆç®—ï¼Œå†å°‡ç¯€é»å»£æ’­å‡ºå»çµ¦æ‰€æœ‰çš„å…¨ç¯€é»é©—è­‰å°±å¥½äº† æŒ–ç¤¦ä»”å¸¸è¦‹å•é¡Œ Q: æŒ–ç¤¦æ˜¯å•¥ç±³?\nç•¶æœ‰ä¸€ç­†äº¤æ˜“è¦é€²è¡Œçš„æ™‚å€™ï¼Œäº¤æ˜“æ–¹æ‹‹å‡ºä»–çš„äº¤æ˜“è³‡è¨Šï¼Œè«‹äººå¹«ä»–ç°½æ ¸ï¼ŒæˆåŠŸå¹«ä»–å®Œæˆä»»å‹™çš„äººæœƒæœ‰çé‡‘\nQ: é€™å€‹ç°½æ ¸ä»»å‹™æœ‰æ˜¯å•¥ç±³?\nç¤¦å·¥å€‘æœƒå°‡äº¤æ˜“å€å¡Šè³‡è¨Š + Nonce æ‹¿å» hashï¼Œä¸æ–·çš„æ›¿æ› Nonce å–å¾—æŸä¸€çµ„ hash å€¼é–‹é ­æ˜¯ n å€‹ bits ç‚º 0 çš„è§£ç­”ï¼Œç¬¬ä¸€å€‹æ‹¿åˆ°è§£ç­”çš„å°±æ˜¯é€™æ¬¡æŒ–ç¤¦çš„æˆåŠŸè€…ã€‚å› æ­¤è¶Šå¤šäººåƒèˆ‡è§£é¡Œå°±è¶Šé›£æŒ–åˆ°ç¤¦\nQ: é€™æ¨£ä¸å°±è¶…é›£æŒ–ç¤¦çš„å—?\næ¯ç¶“é 2016 å€‹äº¤æ˜“èªè­‰å¾Œé›£åº¦æœƒæ”¹è®Š(è¦æ±‚é–‹é ­çš„ 0 è®Šå¤šå€‹æˆ–è®Šå°‘)ï¼Œæ”¹è®Šä¾ç…§ä¹‹å‰çš„äº¤æ˜“èªè­‰æ™‚é–“ï¼Œå¦‚æœå¤ªä¹…å°±è®Šç°¡å–®ä¸€é»ï¼Œåä¹‹äº¦ç„¶ã€‚\nQ: æŒ–ç¤¦æŒ–ä¸å®Œçš„å—?\næœƒæŒ–å®Œçš„ï¼Œæœ€ä¸€é–‹å§‹é©—è­‰ä¸€ç­†äº¤æ˜“ç¤¦å·¥å¯ä»¥æ‹¿åˆ° 50 å¡ŠéŒ¢æ¯”ç‰¹å¹£ï¼Œæ¯æ¬¡ç”¢ç”Ÿå‡º 21è¬å¡ŠéŒ¢æ¯”ç‰¹å¹£å¾Œï¼Œçå‹µå°±æœƒå°‘ä¸€åŠï¼Œç›´åˆ°æœ€å¾Œå°æ–¼æ¯”ç‰¹å¹£å¯ä»¥æ”¯ä»˜çš„æœ€å°å–®ä½ (10çš„-8æ¬¡æ–¹æ¯”ç‰¹å¹£)\näº¤æ˜“æ¨¡å‹ UTXO Model (Unspent Transaction Output)ï¼Œåœ¨æ¯”ç‰¹å¹£éˆä¸Šçš„é¤˜é¡ä¸¦ä¸æ˜¯ç›´æ¥å„²å­˜ä¸€å€‹æ•¸å­—çš„ï¼Œå¦‚æœä½ ä»Šå¤©æƒ³è¦æ‹¿åˆ°æŸå€‹åœ°å€çš„é¤˜é¡çš„è©±ï¼Œå°±éœ€è¦å¾ç¬¬ä¸€å€‹å€å¡Šé–‹å§‹çœ‹ï¼ŒæŠŠæ¯ä¸€ç­†é‚„æ²’æœ‰è¢«æ¶ˆè²»æ‰çš„äº¤æ˜“(Unspent Transaction)åŠ èµ·ä¾†ï¼Œé€™å€‹æ•¸å­—æ‰æœƒæ˜¯ä½ çš„é¤˜é¡ã€‚ ä¾‹å¦‚èªª:\nA è½‰çµ¦ C 100 btc .... (tx1) B è½‰çµ¦ C 120 btc .... (tx2) åˆ°é€™è£¡ C æœ‰ 2 ç­†æœªä½¿ç”¨äº¤æ˜“ï¼Œç¸½å…± 220 btc å¦‚æœ C è¦è½‰çµ¦ A 130 å¡ŠéŒ¢çš„è©±ï¼Œå°±å¿…é ˆå¾ä»–çš„ UTXO è£¡é¢é¸å‡ºä¾†äº¤æ˜“ C -\u0026gt; A 130 btc .... (tx3) C -\u0026gt; C 90 btc .... (tx4) å¤šé¤˜çš„éŒ¢éŒ¢è¦é‚„çµ¦è‡ªå·±å‘€ï¼ å› æ­¤æœ€å¾Œçš„çµæœä¸­ï¼ŒC æ¶ˆè€—äº† tx1, tx2 C å‰©ä¸‹ä¸€ç­† 90 å¡Šçš„æœªä½¿ç”¨äº¤æ˜“ ç²‰å¡µæ”»æ“Š åœ¨ UTXO ç³»çµ±ä¸­æœƒé‡åˆ°çš„èº«åˆ†å•é¡Œï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡å¯«å¾—å¾ˆæ£’ XDD https://iview.sina.com.tw/post/23868182\nåœ¨å€å¡Šä¸Šçš„äº¤æ˜“ç´€éŒ„åŸºæœ¬ä¸Šéƒ½æ˜¯å…¬é–‹é€æ˜çš„ï¼Œå¯ä»¥å…±å¤§çœ¾ä¾†æŸ¥æ‰¾ã€‚\nå…¬æœ‰éˆï¼šå®Œå…¨å»ä¸­å¿ƒåŒ–ï¼Œä¹Ÿå°±æ˜¯å®Œå…¨å…¬é–‹é€æ˜ã€ä»»ä½•äººéƒ½å¯ä»¥åŠ å…¥ï¼Œæ¯å€‹äººéƒ½å¯ä»¥è®€å–ä¸Šé¢çš„è³‡æ–™çš„éˆã€‚ ç§æœ‰éˆï¼šéƒ¨åˆ†å»ä¸­å¿ƒåŒ–ï¼Œæ˜¯å®Œå…¨ç§æœ‰çš„å€å¡Šéˆï¼Œå¯«å…¥æ¬Šé™å…¨è¢«ä¸€è™•ä¸­å¿ƒæ‰€æŠŠæŒï¼Œè€Œè®€å–æ¬Šé™å‰‡è¢«é€™è™•ä¸­å¿ƒé™åˆ¶ï¼Œä½†æ­¤éˆäº¤æ˜“é€Ÿåº¦æ¯”è¼ƒå¿«ä¸¦ä¸”ä¹Ÿä¿æŒäº†ä¸å¯ç¯¡æ”¹æ€§ï¼Œæ˜¯çµ¦ç§æœ‰å…¬å¸ä½¿ç”¨çš„éˆã€‚ è¯ç›Ÿéˆï¼šä»‹æ–¼å…¬æœ‰éˆå’Œç§æœ‰éˆä¹‹é–“ï¼Œå’Œç§æœ‰éˆæœ€å¤§çš„ä¸åŒæ˜¯ï¼Œå®ƒé©ç”¨æ–¼å¤šå€‹æ©Ÿæ§‹å…±åŒä½¿ç”¨ï¼Œæˆ–è€…ä¸€æ•´å€‹è¡Œæ¥­ã€è¯ç›Ÿç”¨çš„ï¼›è€Œç§æœ‰éˆæ˜¯ä¸€å®¶ä¼æ¥­æˆ–å…¬å¸ç”¨çš„\nMerkle Tree ä¸å¯ä¿®æ”¹æ€§ å¦‚æœä»Šå¤©æœ‰äººæƒ³è¦ä¿®æ”¹ä¸€å€‹å€å¡Šçš„äº¤æ˜“ç´€éŒ„ï¼Œæœƒéœ€è¦æŠŠå¾ŒçºŒæ‰€æœ‰çš„ Block éƒ½ä¿®æ”¹æ‰è¡Œï¼Œ\nç”¨æ–¼å¿«é€Ÿé©—è­‰äº¤æ˜“å­˜åœ¨æŸå€‹å€å¡Š\nBIP (Bitcoin Improvement Proposals) BIP-32 HD-Wallet å®šç¾© Hierarchical Deterministic walletï¼Œå¯ä»¥ç”±ä¸€å€‹ Seed ä¾†ç”¢ç”Ÿå¤šçµ„éŒ¢åŒ…åœ°å€(åŒ…å«å…¬é‘°ã€ç§é‘°) å¥½è™•æ˜¯åªéœ€è¦è¨˜å¾— Seed å°±å¯ä»¥å‹•æ…‹éŒ¢åŒ…ï¼Œä¸éœ€è¦è¨˜å¾—å¾ˆé•·çš„å¯†ç¢¼\nBIP-39 åŠ©è¨˜è© åŠ©è¨˜è©(mnemonic)å°‡ Seed ç”¨è‹±æ–‡å–®å­—ä¾†ç·¨ç¢¼è¡¨ç¤ºï¼Œæ›´æ–¹ä¾¿è¨˜æ†¶ã€‚ åšæ³•æ˜¯ seed + checkSum ç„¶å¾Œæ¯ 11bits å…Œæ›å‘ˆä¸€å€‹å°æ‡‰çš„å­—\nBIP-44 å¤šå¸³è™Ÿçš„ HD-Wallet åŸºæ–¼ BIP-32 çš„ç³»çµ±ï¼Œè®“ä»–åŒæ™‚æ”¯æ´å¤šç¨®å¹£åˆ¥ï¼Œ è€Œä¸€çµ„åŠ©è¨˜è©å¯ä»¥ç”¢å‡º N çµ„ç§é‘°ï¼Œæ¯çµ„ç§é‘°å°æ‡‰ä¸€ç¨®å¹£ç¨®(BTC, ETH\u0026hellip;) è¡¨ç¤ºå½¢å¼åƒæ˜¯:\nm / purpose' / coin_type' / account' / change / address_index æ¯å€‹æ¬„ä½æœ‰ä¸åŒæ„ç¾© - purpose' å›ºå®šå¯« 44 è¡¨ç¤ºæ˜¯ä¾ç…§ BIP-44 è¦å‰‡ç”¢ç”Ÿå¾Œé¢çš„æ¨¹è·Ÿå­ç¯€é» - coin_type' ä¸€çµ„ Seed å¯ä»¥ç‚ºä¸åŒå¹£åˆ¥ç”¢ç”Ÿå¤šå€‹å®Œå…¨ç¨ç«‹çš„éŒ¢åŒ…åœ°å€ï¼Œä¾‹å¦‚æ¯”ç‰¹å¹£æ˜¯ 0ï¼Œä»¥å¤ªå¹£æ˜¯ 60 \u0026raquo;\u0026gt; é€™é‚Šæœ‰åˆ—è¡¨ - account' ä¸€çµ„ Seed å¯ä»¥ç‚ºä¸åŒå¸³è™Ÿç”¢ç”Ÿå¤šå€‹å®Œå…¨ç¨ç«‹çš„éŒ¢åŒ…åœ°å€ - change' å›ºå®šç”¨ 0 è¡¨ç¤ºå¤–éƒ¨éŠ(external chain) ç”¨æ–¼å°å¤–éƒ¨æ”¶æ¬¾ä»˜æ¬¾ï¼Œ 1 è¡¨ç¤ºå…§éƒ¨éŠ(internal chain)ï¼Œé€™ä»€éº¼æ„æ€\u0026hellip;æˆ‘çœ‹ä¸æ‡‚QQ - index' å‰›å‰›èªªäº†éº»ï¼Œä¸€å€‹ Seed å¯ä»¥ç”¢å¾ˆå¤šåœ°å€ï¼Œindex è¡¨ç¤ºä½ è¦ç¬¬å¹¾å€‹éŒ¢åŒ…åœ°å€\ncoin account chain address path Bitcoin first external first m / 44\u0026rsquo; / 0\u0026rsquo; / 0\u0026rsquo; / 0 / 0 Bitcoin Testnet first external first m / 44\u0026rsquo; / 1\u0026rsquo; / 0\u0026rsquo; / 0 / 0 å¯ä»¥åˆ°é€™å€‹ç¶²ç«™ä¸Šå¯¦éš›ç”¢ç”Ÿä¸€çµ„è©¦è©¦çœ‹ https://iancoleman.io/bip39/\néŒ¢åŒ…åœ°å€ æ¯”ç‰¹å¹£éŒ¢åŒ…åœ°å€å¯èƒ½æ˜¯ 1, 3, bc1 é–‹é ­ï¼Œæ¸¬è©¦éˆä¸Šçš„åœ°å€æ˜¯ m, n, 2, tb1 é–‹é ­\näº¤æ˜“ æœ‰åˆ†å¹¾ç¨®äº¤æ˜“ç°½ç« æ¨¡å¼ï¼Œå·®åˆ¥åœ¨å¦‚ä½•ä½¿ç”¨ tx outï¼Œæ¯å€‹ tx out ä¸Šéƒ½æœ‰ä¸åŒçš„ lock scriptï¼Œå¯ä»¥æŠŠé€™å€‹é–æƒ³åƒæˆæ˜¯ä¸€å€‹é¡Œç›®ï¼Œä½ å¿…é ˆå°‡é¡Œç›®å®Œæ•´è§£é–ä½ æ‰æœ‰è³‡æ ¼ï¼Œä¾‹å¦‚èªª lock script æ˜¯ + 3 = 5ï¼Œé‚£ä½  tx in çš„ unlock script å°±è¦æ˜¯ 2ï¼Œçµ„åˆèµ·ä¾†é©—è­‰ 2 + 3 = 5 é€™æ¨£æ‰æ˜¯ä¸€å€‹åˆæ³•çš„äº¤æ˜“ç°½ç« \nä¸»è¦åˆ†æˆå¹¾ç¨®æ¨¡å¼ï¼š\nP2PKH (Pay to Pubkey Hash) ç®—æ˜¯æœ€åŸºç¤çš„æ¨¡å¼ï¼Œä½¿ç”¨çš„ lock script æ˜¯\nOP_DUP OP_HASH160 \u0026lt;Public Key Hash\u0026gt; OP_EQUAL OP_CHECKSIG unlock script\n\u0026lt;Signature\u0026gt; \u0026lt;Public Key\u0026gt; P2SH (Pay to Script Hash) åœ¨é€™ä¹‹å‰è¦å…ˆèªè­˜ä¸€ä¸‹å¤šç°½ (Multi-signature)ï¼Œä»–çš„ lock script æ˜¯ç”±å¤šå€‹å…¬é‘°çµ„æˆï¼Œä½ å¿…é ˆå®Œæˆä»–æŒ‡å®šæ•¸é‡çš„ç°½ç« æ‰èƒ½è§£é–ï¼Œ\nä¾‹å¦‚èªª 2-3 å¤šç°½ï¼Œå°±æ˜¯ä½ å¿…é ˆè¦æœ‰é€™ 3 å€‹äººå…¶ä¸­å…©å€‹çš„ç°½ç« \n2 \u0026lt;Public Key A\u0026gt; \u0026lt;Public Key B\u0026gt; \u0026lt;Public Key C\u0026gt; 3 OP_CHECKMULTISIG å‡è¨­ä½ æœ‰ B, C çš„åŒæ„ï¼Œ unlock script æœƒåƒæ˜¯\nOP_0 \u0026lt;Signature B\u0026gt; \u0026lt;Signature C\u0026gt; ä¸éï¼Œé€™æ¨£çš„æ–¹å¼å¦‚æœäººæ•¸ä¸€å¤šæœƒè®“ lock script è®Šå¾—éå¸¸éå¸¸é•·ï¼Œé€™æ¨£å„²å­˜ UTXO æœƒæµªè²»æ‰å¾ˆå¤šçè²´çš„è¨˜æ†¶é«”ï¼Œå› æ­¤ P2SH ä¾†è§£æ±ºå•é¡Œæƒ¹ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯æŠŠé¡Œç›®æ”¾åˆ° lock scriptï¼Œè€Œ unlock script åªå­˜é¡Œç›®çš„ hashï¼Œé©—è­‰æ™‚é¦–å…ˆé©—è­‰ lock script è£¡é¢çš„é¡Œç›® hash å¾Œæ˜¯å¦å’Œ unlock script ç›¸åŒï¼Œç›¸åŒçš„è©±å°±ç›¸ä¿¡ä½ ä¸¦æ¥æ”¶ä½ çš„é©—è­‰\nlock script, è£¡é¢çš„ redeem scriptHash å°±æ˜¯é¡Œç›®çš„ hashï¼Œ\nredeem script(é¡Œç›®): 2 PKA PKB PKC 3 OP_CHECKMULTISIG\nOP_HASH160 \u0026lt;redeem scriptHash\u0026gt; OP_EQUAL unlock script æ¯”è¼ƒä¸€ä¸‹å‰é¢çš„å¤šç°½\n\u0026lt;SigB\u0026gt; \u0026lt;SigC\u0026gt; 2 PKA PKB PKC 3 OP_CHECKMULTISIG example: P2WPKH ( pay to witness public key hash) SegWit (Segregated Witness) éš”é›¢è¦‹è­‰ ç”±æ–¼æ¯å€‹å€å¡Šæœ€å¤šæœ€å¤šåªèƒ½å¤ æœ‰ 1MBï¼Œè€Œæ¯ä¸€ç­†äº¤æ˜“çš„ç°½ç« ä½”ç”¨äº†å¾ˆå¤§çš„æ¯”ä¾‹ï¼Œ å› æ­¤åœ¨ BIP141 æå‡ºäº†è¦‹è­‰éš”é›¢é€™å€‹æ–¹æ¡ˆï¼Œå°‡åŸæœ¬ä¸€å€‹å€å¡Šçš„æœ€å¤§å€¼å¾ 1MB æ”¹æˆ 4MBï¼Œè¨ˆç®—å–®ä½å¾ bytes æ”¹æˆ weightï¼Œä¸¦å°‡åŸæœ¬ç°½ç« çš„éƒ¨ä»½æŠ½å‡ºä¾†å­˜æ”¾ï¼Œé€™è¡¨ç¤ºç™¼ä¸€ç­†äº¤æ˜“éœ€è¦çš„ byte æ›´å°‘æ›´ä¾¿å®œï¼Œç¶“éè¨ˆç®—å¾Œä¸€å€‹å€å¡Šèƒ½å¤ æ”¾æ›´å¤šçš„äº¤æ˜“ï¼Œå› æ­¤äº¤æ˜“é€Ÿåº¦æé«˜ï¼Œè€Œç¤¦å·¥æ‰“åŒ…å€å¡Šä¹Ÿå¯ä»¥æ‹¿åˆ°æ›´å¤šæ‰‹çºŒè²»ï¼Œ\nBech32 encoded segwit addresses start with a human-readable\nå¸³è™Ÿå®‰å…¨ æ©¢åœ“æ›²ç·šç”¨çš„æ˜¯é€™æ¢ secp256k1ï¼Œä»–é•·é€™æ¨£\nsecp256k1.P = fromHex(\u0026quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F\u0026quot;) secp256k1.N = fromHex(\u0026quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141\u0026quot;) secp256k1.B = fromHex(\u0026quot;0000000000000000000000000000000000000000000000000000000000000007\u0026quot;) secp256k1.Gx = fromHex(\u0026quot;79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798\u0026quot;) secp256k1.Gy = fromHex(\u0026quot;483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8\u0026quot;) æ¯”ç‰¹å¹£éŒ¢åŒ…åœ°å€æ€éº¼ä¾†çš„å‘¢?\næŠŠå…¬é‘°æ‹¿å‡ºä¾†æ‰¾åˆ°ä»–åœ¨æ›²ç·šä¸Šçš„ (x, y)ï¼Œå†æ‹¿å» hash 2 æ¬¡ï¼Œ å†å°‡ hash çµæœåšå…©æ¬¡ sha256 å–å¾—å‰å››å€‹ byte ä½œç‚º checkSum æœ€å¾Œ base58 encode å°±æ˜¯äººé¡çœ‹åˆ°çš„åœ°å€å›‰ hash = ripemd160(sha256(pubkey_bits)) checkSum = sha256(sha256(\u0026ldquo;00\u0026rdquo;+hash))[:4] // (0x00 for Main Network) addr = base58(hash + checkSum) è©³ç´°å¯ä»¥åƒè€ƒé€™ç¯‡wiki\nä»¥å¤ªå¹£éŒ¢åŒ…çš„è©±æœ‰é»ä¸åŒ\næŠŠå…¬é‘°æ‹¿å‡ºä¾†å¾Œç”¨çš„æ˜¯ Keccak-256(sha-3) ä¾† hashï¼Œç‰¹é»æ˜¯é•·åº¦æ˜¯ä¸å›ºå®šçš„ æœ€å¾ŒåŠ ä¸Š EIP55 çš„å¤§å°å¯«æª¢æŸ¥ç¢¼ (é€™æ˜¯å¯é¸çš„) è©³ç´°å¯ä»¥åƒè€ƒé€™å€‹ https://git.io/ethAddressHash\nRef ä»€éº¼æ˜¯ç¯€é» https://academy.binance.com/zt/articles/what-are-nodes https://medium.com/taipei-ethereum-meetup/%E8%99%9B%E6%93%AC%E8%B2%A8%E5%B9%A3%E9%8C%A2%E5%8C%85-%E5%BE%9E-bip32-bip39-bip44-%E5%88%B0-ethereum-hd-%EF%BD%97allet-a40b1c87c1f7 https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki æ¯”ç‰¹å¹£å•é¡Œå€‘ https://bitcoin.org/zh_TW/faq#wont-the-finite-amount-of-bitcoins-be-a-limitation é—œæ–¼æ¯”ç‰¹å¹£åœ°å€ https://medium.com/my-blockchain-development-daily-journey/%E9%97%9C%E6%96%BC%E6%AF%94%E7%89%B9%E5%B9%A3%E5%9C%B0%E5%9D%80-%E4%BD%A0%E8%A9%B2%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B-8dd3bbb89ade éš”é›¢è¦‹è­‰ https://blockcast.it/2017/04/24/what-is-scalability-issue-and-segregated-witness/ bitcoin txæ€éº¼åŒ… https://medium.com/taipei-ethereum-meetup/mastering-bitcoin-ch5-transactions-38a387e3819a æ¯”ç‰¹ç¯€é»ä»‹ç´¹ https://academy.binance.com/zt/articles/what-are-nodes è¨»è¨˜è©èˆ‡BIP https://www.mdeditor.tw/pl/pCPM/zh-tw\n","id":34,"section":"posts","summary":"é€™æ¬¡ç­†è¨˜å…§å®¹æœƒåœç¹åœ¨æ¯”ç‰¹å¹£é€™å€‹å€å¡ŠéŠåŠ å¯†è²¨å¹£ç³»çµ± ç„¶å¾Œæ¯”ç‰¹å¹£æ˜¯ä¸€ç¨®è®“åŒ—æ¥µç†Šæ²’æœ‰å®¶ä½çš„æŠ€è¡“ (? å€å¡Šéˆçš„å®‰å…¨ å€å¡Šéˆéˆçš„æ¨¡å¼ï¼Œä¿è­‰æ–°çš„å€å¡Šæ¥çºŒå‰ä¸€å€‹å€","tags":null,"title":"æ–°ç±³ blockchain æ··äº‚ä¸­","uri":"https://blog.10oz.tw/20200919-blockchain-bitcoin-beginer/","year":"2020"},{"content":"wire æ˜¯å€‹å•¥ç±³ wire æ˜¯ä¸€å€‹éœæ…‹çš„æ³¨å…¥å·¥å…·ï¼Œä¸åƒæ˜¯å…¶ä»–çš„æ³¨å…¥å·¥å…·(uber/fx, facebook/inject)ä½¿ç”¨ reflect ä¾†é”æˆï¼Œä»–é¸æ“‡ä½¿ç”¨ gen code çš„æ–¹å¼ç”¢ç”Ÿå¯ä»¥ä½¿ç”¨çš„æ³¨å…¥ç¨‹å¼ç¢¼ã€‚\nèƒ½å¤ åœ¨ç·¨è­¯éšæ®µå°‡æ³¨å…¥çš„å‹•ä½œå®Œæˆï¼Œè€Œä¸æ˜¯åœ¨åŸ·è¡Œç¨‹å¼çš„ç•¶ä¸‹æ‰çŸ¥é“ç™¼ç”Ÿäº†ä»€éº¼éŒ¯èª¤\nQ: Should I use Wire for small applications?\nProbably not. Wire is designed to automate more intricate setup code found in larger applications. For small applications, hand-wiring dependencies is simpler. ä¸è¤‡é›œçš„å°å‹å°ˆæ¡ˆé‚„æ˜¯æ‰‹å‹•æ³¨å…¥æœƒæ›´ä¹¾æ·¨å–”~\ngo build tag èœé³¥å¦‚æˆ‘é€™æ™‚å€™æ‰çŸ¥é“ï¼Œåœ¨ .go æª”æ¡ˆæœ€å‰é¢åŠ å…¥ build tag çš„æª”æ¡ˆï¼Œåœ¨ç·¨è­¯çš„æ™‚å€™æ˜¯ä¸æœƒè¢«åŠ é€²å»çš„(ex: //+build foo ) æ‰€ä»¥å¯ä»¥æ”¾é‡è¤‡çš„ function åœ¨åŒä¸€å€‹ package è£¡é¢ï¼Œé€™å€‹æ“ä½œåœ¨ lorca é‚£ç¯‡ä¹Ÿæœ‰å‡ºç¾éï¼Œå¯ä»¥äº¤å‰æ¯”è¼ƒä¸€ä¸‹ï½\né€™æ˜¯ä¸€å€‹ wire.go æª”æ¡ˆ\n//+build wireinject package main import ( \u0026quot;learnGo/wire/repo\u0026quot; \u0026quot;learnGo/wire/service\u0026quot; \u0026quot;github.com/google/wire\u0026quot; ) func CreateService() (service.Service, error) { wire.Build(repo.NewRepo, service.NewService) panic(\u0026quot;never be triggered\u0026quot;) return nil, nil } é€™æ˜¯ä¸€å€‹ wire_gen.go æª”æ¡ˆï¼Œä»–å€‘åœ¨åŒä¸€å€‹ package ä¸‹ï¼Œå®šç¾©è‘—ç›¸åŒçš„å‡½å¼ï¼Œä½†æ˜¯ç·¨è­¯çš„æ™‚å€™åªæœƒçœ‹ wire_gen.goï¼Œå› ç‚º wire.go çš„æœ€å‰é¢æœ‰æ¨™è¨˜ build tag\n// Code generated by Wire. DO NOT EDIT. //go:generate wire //+build !wireinject package main import ( \u0026quot;learnGo/wire/repo\u0026quot; \u0026quot;learnGo/wire/service\u0026quot; ) import ( _ \u0026quot;github.com/google/wire\u0026quot; ) // Injectors from wire.go: func CreateService() (service.Service, error) { repoRepo := repo.NewRepo() serviceService := service.NewService(repoRepo) return serviceService, nil } å‡è¨­æˆ‘å€‘æœ‰å€‹ main.go ä¾†åŸ·è¡Œ\u0026hellip;\npackage main import ( _ \u0026quot;github.com/google/wire\u0026quot; ) func main() { svc, err := CreateService() if err != nil { panic(err) } svc.SayHello(\u0026quot;wire main package\u0026quot;) } åŸ·è¡Œ go build -tags wireinject é€™æ¨£æœƒä½¿ç”¨ wire.go ä¾†ç·¨è­¯ï¼Œé•·å‡ºä¾†çš„åŸ·è¡Œæª”å°±æœƒè·‘ wire.go:14 çš„ panic\næ ¹æ“šé€™æ¨£çš„ç¶“é©—ï¼Œé€²éšå¯ä»¥åˆ©ç”¨ golang build tag çš„åŠŸèƒ½ï¼Œä¾ç…§ä¸åŒçš„éœ€æ±‚ä¾†ç·¨è­¯å‡ºä¸åŒçš„åŸ·è¡Œæª”\nè¸©åˆ°å‘: å¦‚æœç”¨ go run *.go ä¾†è·‘ï¼Œé‚£éº¼ä½ æœƒå¾—åˆ° {function} redeclared in this blockï¼Œä½ çš„æ‰€æœ‰æª”æ¡ˆé‚„æ˜¯æœƒè¢«æ‹¿ä¾†ç”¨QQ\nWire çš„ä½¿ç”¨æ–¹æ³• ä½¿ç”¨ä¸Šä¸€æ®µè½çš„ç¯„ä¾‹ï¼Œ wire_gen.go æ˜¯æ€éº¼é•·å‡ºä¾†çš„å‘¢ï¼Ÿ é¦–å…ˆéœ€è¦å®‰è£ wire\ngo get github.com/google/wire/cmd/wire ç„¶å¾Œè¼¸å…¥\nwire å°±å¯ä»¥çœ‹è¦‹ wire_gen.go é•·å‡ºä¾†å›‰\nè©³ç´°çœ‹ä¸€ä¸‹å…§å®¹çš„å‰å¹¾è¡Œï¼Œ\n// æé†’ä½ å’Œç·¨è­¯å™¨é€™æ˜¯ä¸€å€‹ç”¢ç”Ÿå‡ºä¾†çš„æª”æ¡ˆï¼Œä¸æ˜¯çµ¦äººé¡ç›´æ¥ä¿®æ”¹çš„ // Code generated by Wire. DO NOT EDIT. // å¯ä»¥ä½¿ç”¨ `go generate` æŒ‡ä»¤ä¾†è§¸ç™¼å¾Œé¢çš„æŒ‡ä»¤ï¼Œ // åœ¨é€™è£¡æœƒå¹«ä½ è·‘ wire ä¾† gen code //go:generate wire // è¨»è¨˜ build tags ä¸å­˜åœ¨ wireinject ç”¨çš„ //+build !wireinject // ... æ³¨å…¥ Interface åœ¨ github çš„ document guide ä¸Šæœ‰å¯«ï¼Œå¾ˆå¯¦ç”¨ä¹Ÿå¯«ä¸€ä»½æ˜“è®€ç‰ˆ\nä»»å‹™: repo.NewRepo å›å‚³ *repo.DefaultRepo (ä»–å¯¦ä½œ repo.Repoer) svc.NewService éœ€è¦ä¸€å€‹ repo.Repoer å› æ­¤æˆ‘å€‘éœ€è¦å¤šåšä¸€å±¤å°‡ pointer è½‰æˆ interface\n// Repo ... type Repoer interface { // } // NewRepo ... func NewRepo(cfg *config.Config) *DefultRepo { return \u0026amp;DefultRepo{ Prefix: cfg.DBCfg.Prefix, } } // NewService ... func NewService(repo repo.Repoer) *DefultService { return \u0026amp;DefultService{ repo: repo, } } var Set = wire.NewSet( // ç”¢ç”Ÿ *DefaultRepo repo.NewRepo, // å°‡ *DefaultRepo è½‰æˆ Repoer wire.Bind(new(repo.Repo), new(*repo.DefultRepo)), // æ³¨å…¥éœ€è¦ Repoer service.NewService, ) Ref https://medium.com/@dche423/master-wire-cn-d57de86caa1b https://github.com/google/wire/blob/main/docs/guide.md\n","id":35,"section":"posts","summary":"wire æ˜¯å€‹å•¥ç±³ wire æ˜¯ä¸€å€‹éœæ…‹çš„æ³¨å…¥å·¥å…·ï¼Œä¸åƒæ˜¯å…¶ä»–çš„æ³¨å…¥å·¥å…·(uber/fx, facebook/inject)ä½¿ç”¨ reflect ä¾†é”æˆï¼Œä»–é¸æ“‡ä½¿ç”¨ gen code çš„æ–¹å¼ç”¢","tags":["golang","di","wire"],"title":"golang æ³¨å…¥å·¥å…· wire","uri":"https://blog.10oz.tw/20200908-golang-di-tool-wire/","year":"2020"},{"content":"ä»‹ç´¹ GitHub åœ¨ 2018 å¹´æ¨å‡ºçš„çŸ­ç¶²å€æœå‹™: git.io\nä»–å¯ä»¥æŠŠ GitHub çš„ç¶²å€ç¸®çŸ­~\nwith fish å…¶å¯¦æœƒç™¼ç¾ä»–çš„åŸå› ï¼Œæ˜¯å› ç‚ºåœ¨å°‹æ‰¾ fish çš„ plugin\nhttps://github.com/jorgebucaran/gitio.fish\nfisher æ˜¯ä¸€å€‹ fish çš„å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œæˆ‘å€‘ç”¨å®ƒä¾†å®‰è£ fish ç‰ˆ gitio\nfisher add jorgebucaran/gitio.fish ç”¨é€™å€‹å·¥å…·çš„è©±å¯ä»¥è‡ªå®šç¾©åç¨±å–”ï¼ ç¶²é ç‰ˆçš„ UI å¥½åƒå°±æ²’æœ‰é€™å€‹é¸é … QQ\nå®‰è£å®Œæˆå¾Œ gitio key=url å°±å¯ä»¥äº†\ngitio yamcha=https://github.com/XiaoXiaoSN/YamCha # https://git.io/yamcha without fish? ç›´æ¥è‡ªå·±çµ„ queryString æ‰“éå»ä¹Ÿæ˜¯å¯ä»¥çš„\nexport url=https://github.com/XiaoXiaoSN/YamCha export code=yamcha curl https://git.io/ --data-urlencode \u0026quot;url=$url\u0026quot; --data-urlencode code=\u0026quot;$code\u0026quot; ","id":36,"section":"posts","summary":"ä»‹ç´¹ GitHub åœ¨ 2018 å¹´æ¨å‡ºçš„çŸ­ç¶²å€æœå‹™: git.io ä»–å¯ä»¥æŠŠ GitHub çš„ç¶²å€ç¸®çŸ­~ with fish å…¶å¯¦æœƒç™¼ç¾ä»–çš„åŸå› ï¼Œæ˜¯å› ç‚ºåœ¨å°‹æ‰¾ fish çš„ plugin https://github.com/jorgebucaran/gitio.fish fisher æ˜¯ä¸€å€‹ fish çš„å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œæˆ‘å€‘ç”¨å®ƒä¾†å®‰è£ fish","tags":[],"title":"å·²çŸ¥ç”¨ç« - git.io çŸ­ç¶²å€","uri":"https://blog.10oz.tw/20200831-known-fire-gitio/","year":"2020"},{"content":"ç’°å¢ƒ æˆ‘å€‘å…ˆç”¨ macOS Catalina 10.15.2 ä¾†åšç­†è¨˜å–”\n1. è™›æ“¬æ©Ÿ ä¸€é–‹å§‹ç•¶ç„¶æ˜¯è™›æ“¬æ©Ÿå•¦ï¼Œè®“æˆ‘å€‘ç”¨ vagrant æ­é… virtual box å§ï½\n1.1 å®‰è£ vagrant è·Ÿ virtual box brew cask install vagrant vagrant version vagrant ä½¿ç”¨ç‰ˆæœ¬ 2.2.10\næ”¯æ´çš„ virtual box ç‰ˆæœ¬æ²’æœ‰åˆ°æœ€æ–°çš„ 6ï¼Œ æˆ‘å€‘åˆ°é€™é‚Šä¸‹è¼‰èˆŠç‰ˆå§\nhttps://www.virtualbox.org/wiki/\nå¦‚æœ mac ä¸çµ¦ä½ é–‹çš„è©±ï¼Œè¨˜å¾—å¯ä»¥åˆ° ç³»çµ±åå¥½è¨­å®š \u0026gt; å®‰å…¨æ€§èˆ‡éš±ç§ \u0026gt; ä¸€èˆ¬ é–‹å•Ÿæ¬Šé™\n1.2 è¨­å®š vagrant ç¬¬ä¸€æ­¥è¦å…ˆå»ºç«‹ä¸€å€‹ Vagrantfileï¼Œæˆ‘å€‘é¸ç”¨ ubuntu 16.04 TLS\né€™é‚Šä¹Ÿæœ‰æ›´å¤šé¸æ“‡ \u0026ndash;\u0026gt; https://app.vagrantup.com/boxes/search\n# å…ˆåœ¨ä½ å–œæ­¡çš„åœ°æ–¹é–‹å€‹è³‡æ–™å¤¾å§ mkdir -p ~/projects/vagrant/k8s-master cd ~/projects/vagrant/k8s-master vim Vagrantfile # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(2) do |config| # é¸ç”¨çš„æª”æ¡ˆï¼Œxenial æ˜¯ ubuntu16 çš„åå­— config.vm.box = \u0026quot;ubuntu/xenial64\u0026quot; # å°‡è™›æ“¬æ©Ÿå…§éƒ¨çš„ 6443 port å°å‡ºåˆ°æœ¬æ©Ÿçš„ 26443 port # config.vm.network \u0026quot;forwarded_port\u0026quot;, guest: 6443, host: 26443 config.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;172.16.16.100\u0026quot; # åˆ†é… 2GB çš„è¨˜æ†¶é«”çµ¦è™›æ“¬æ©Ÿ config.vm.provider \u0026quot;virtualbox\u0026quot; do |vb| v.name = \u0026quot;k8s-m1\u0026quot; vb.memory = 2048 vb.cpus = 2 end # è¨­å®šå¸³è™Ÿå¯†ç¢¼æ˜¯ ubuntu:ubuntu config.vm.provision 'shell', inline: \u0026lt;\u0026lt;-SHELL echo 'ubuntu:ubuntu' | sudo chpasswd SHELL end 1.3 ç”¨ vagrant å•Ÿå‹•è™›æ“¬æ©Ÿ è¨­å®šå¥½å¾Œå°±é–‹èµ·ä¾†é€£é€²å»å§\nvagrant up vagrant ssh 2. å®‰è£ kubernetes server 2.1 å®‰è£ container æœå‹™ æœ€é‡è¦çš„ï¼Œæˆ‘å€‘è¦å…ˆè£ docker \u0026raquo; æˆ‘æ˜¯æŒ‡å—\n## é€²å…¥ super user æ¨¡å¼ä¾†å®‰è£ sudo su ## ä»¥ä¸‹é–‹å§‹å®‰è£ Docker CE ## Set up the repository: ## Install packages to allow apt to use a repository over HTTPS apt-get update -y \u0026amp;\u0026amp; apt-get install -y \\ apt-transport-https ca-certificates curl software-properties-common ## Add Dockerâ€™s official GPG key curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - ## Add Docker apt repository. add-apt-repository \\ \u0026quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable\u0026quot; ## Install Docker CE. apt-get update -y \u0026amp;\u0026amp; apt-get install -y \\ containerd.io=1.2.10-3 \\ docker-ce=5:19.03.4~3-0~ubuntu-$(lsb_release -cs) \\ docker-ce-cli=5:19.03.4~3-0~ubuntu-$(lsb_release -cs) ## Setup daemon. cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt;EOF { \u0026quot;exec-opts\u0026quot;: [\u0026quot;native.cgroupdriver=systemd\u0026quot;], \u0026quot;log-driver\u0026quot;: \u0026quot;json-file\u0026quot;, \u0026quot;log-opts\u0026quot;: { \u0026quot;max-size\u0026quot;: \u0026quot;100m\u0026quot; }, \u0026quot;storage-driver\u0026quot;: \u0026quot;overlay2\u0026quot; } EOF mkdir -p /etc/systemd/system/docker.service.d # Restart docker. systemctl daemon-reload systemctl restart docker # If you want the docker service to start on boot, run the following command: sudo systemctl enable docker 2.2 å®‰è£ kubernetes æˆ‘å€‘éœ€è¦ kubeletã€ kubeadm å’Œ kubectl \u0026raquo; æŒ‡å—\nsudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add - cat \u0026lt;\u0026lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF sudo apt-get update sudo apt-get install -y kubelet kubeadm kubectl sudo apt-mark hold kubelet kubeadm kubectl # ç¦ç”¨ swap swapoff -a; sed -i '/swap/d' /etc/fstab # æ›´æ”¹ç¶²è·¯è¨­å®š cat \u0026gt;\u0026gt;/etc/sysctl.d/kubernetes.conf\u0026lt;\u0026lt;EOF net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system 2.3 kubernetes master ä¹‹ kubeadm é€£ç·šå›ä¾†å¾Œè¨˜å¾—åˆ‡æ›å› super user\nvagrant ssh # é€™æ™‚å€™å¯ä»¥çœ‹åˆ° hostname å·²ç¶“è®Šæˆ k8s-m1 sudo su é€™é‚Šç°¡å–®é¸ç”¨é»˜èªçš„ Flannel å¯¦ä½œ pod èˆ‡ pod é–“æºé€šçš„ä»‹é¢~\nkubeadm only supports Container Network Interface (CNI) based networks\nkubeadm init \\ --apiserver-advertise-address=172.16.16.100 \\ --pod-network-cidr=172.16.0.0/16 ç­‰å¾…å€‹ 2~3 åˆ†é˜\næˆåŠŸå¾Œæœƒæç¤ºä½ ä»¥ä¸‹è¨Šæ¯ï¼ å°±è¡¨ç¤ºæˆåŠŸäº†\nYour Kubernetes control-plane has initialized successfully! ## è®“ user å¯ä»¥é€£ç·šåˆ° k8s cluster To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config You should now deploy a pod network to the cluster. Run \u0026quot;kubectl apply -f [podnetwork].yaml\u0026quot; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ ## åŠ å…¥ node åˆ° clusterï¼Œè¤‡è£½èµ·ä¾†æ™šé»é–‹å¥½å…¶ä»– node å¾Œè¦ç”¨ Then you can join any number of worker nodes by running the following on each as root: kubeadm join 10.0.2.15:6443 --token 3vex22.6kqkhji310d3ckp0 \\ --discovery-token-ca-cert-hash sha256:cb8bb2fde074ba2a294413122a5a9208479b12a73ec316c01bd9a8b485add2fa å…ˆè·‘å€‹ä»–æç¤ºçš„è¨Šæ¯ï¼Œè®“ user å¯ä»¥é€£ç·šåˆ° cluster\nmkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config 2.4 å®‰è£ kubernetes ç¶²è·¯ä»‹é¢ æ¥ä¸‹ä¾†è¦ç‚ºæˆ‘å€‘çš„ k8s cluster å»ºç«‹ pod networkï¼Œä»–çš„å·¥ä½œæ˜¯è² è²¬è·Ÿ Container é€£ç·šï¼Œä»–å€‘å„è‡ªæœ‰å¯¦ä½œ CNI( Container Network Interface)ï¼Œè©³ç´°å¯ä»¥ä¾†åƒè€ƒKubernetesç¶²çµ¡æ¨¡å‹åˆ—è¡¨\né€™è£¡æˆ‘å€‘é¸æ“‡å®˜æ–¹å·å·æ¨è–¦çš„ Calico (CentOS çš„ Flannel ä¹Ÿå¾ˆå¤šäººç”¨)\nkubectl create -f https://docs.projectcalico.org/v3.14/manifests/calico.yaml 2.5 image å­˜èµ·ä¾†æ‰å¯ä»¥è¤‡è£½å¥½å¤šå€‹ å›åˆ°æœ¬åœ°ç«¯ vagrant çš„è³‡æ–™å¤¾ï¼ŒæŠŠç›®å‰çš„ç‹€æ…‹æ‰“åŒ…èµ·ä¾†\nçµ¦æƒ³è¦æœ‰å¾ˆå¤šå° master çš„ä½ ~~\nvagrant package --output k8s-master.box 2.6 è®“ master å¯ä»¥ç”¨æ–¼éƒ¨ç½² åœ¨é è¨­æƒ…æ³ä¸‹ï¼Œç‚ºäº†å®‰å…¨å’Œç©©å®šæ€§ï¼Œmaster node æœƒè¢«éš”é›¢é–‹ä¾†ï¼Œä¸å…è¨±éƒ¨ç½² Pod ä¸Šå»\nä½†æ˜¯å¦‚æœä½ è¦åšå–®ç¯€é»çš„è©±~~\nkubectl taint nodes --all node-role.kubernetes.io/master- 3. å®‰è£ kubernetes worker 3.1 Vagrant å•Ÿå‹•æª”æ¡ˆ # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(2) do |config| NodeCount = 4 (1..NodeCount).each do |i| config.vm.define \u0026quot;k8s-w#{i}\u0026quot; do |node| node.vm.box = \u0026quot;ubuntu/xenial64\u0026quot; node.vm.hostname = \u0026quot;k8s-w#{i}\u0026quot; node.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;172.16.16.10#{i}\u0026quot; node.vm.provider \u0026quot;virtualbox\u0026quot; do |v| v.name = \u0026quot;k8s-w#{i}\u0026quot; v.memory = 2048 v.cpus = 1 end node.vm.provision 'shell', inline: \u0026lt;\u0026lt;-SHELL echo 'ubuntu:ubuntu' | sudo chpasswd SHELL end end end 3.2 å®‰è£æ­¥é©Ÿ 2.1 2.2\nvagrant é–‹å¤šå°vmæ™‚ï¼Œé€£ç·šå›å»è¦åŠ ä¸Šåå­—:\nvagrant ssh k8s-w1\n3.3 åŠ å…¥ kubernetes cluster åˆ° master æ©Ÿå™¨ä¸Šæ‹¿åˆ°åŠ å…¥ cluster çš„æŒ‡ä»¤\nkubeadm token create --print-join-command å†å›ä¾† worker æ©Ÿå™¨ä¸Šï¼Œä½¿ç”¨ sudo åŠ å…¥ç¯€é»å¾Œè²¼ä¸Šå‰›æ‰æ‹¿åˆ°çš„æŒ‡ä»¤\nsudo su kubeadm join 172.16.16.100:6443 --token 7fz9ob.a6sno93d0zwcz3v9 --discovery-token-ca-cert-hash sha256:cb8bb2fde074ba2a294413122a5a9208479b12a73ec316c01bd9a8b485add2fa å›åˆ° master\nkubectl get nodes ä»¥ä¸Š k8s æ¶è¨­å°±å¤§åŠŸå‘Šæˆäº†ï¼ŒæŠŠ master çš„ ~/.kube/config è¤‡è£½ä¸€ä»½å›åˆ°æœ¬åœ°ç«¯å°±å¯ä»¥ç”¨ local ç«¯æ‹œè¨ªå›‰~\nReference https://rickhw.github.io/2019/03/17/Container/Install-K8s-with-Kubeadm/ https://zhuanlan.zhihu.com/p/31398416 https://www.vagrantup.com/docs/providers/virtualbox https://www.youtube.com/watch?v=mMmxMoprxiY æ›´æ› master IP https://github.com/kubernetes/kubeadm/issues/338\n","id":37,"section":"posts","summary":"ç’°å¢ƒ æˆ‘å€‘å…ˆç”¨ macOS Catalina 10.15.2 ä¾†åšç­†è¨˜å–” 1. è™›æ“¬æ©Ÿ ä¸€é–‹å§‹ç•¶ç„¶æ˜¯è™›æ“¬æ©Ÿå•¦ï¼Œè®“æˆ‘å€‘ç”¨ vagrant æ­é… virtual box å§ï½ 1.1 å®‰è£ vagrant è·Ÿ virtual box brew cask install vagrant vagrant version vagrant ä½¿ç”¨ç‰ˆæœ¬ 2.2.10 æ”¯æ´çš„ virtual box ç‰ˆæœ¬æ²’æœ‰åˆ°æœ€","tags":["kubernetes","vm","vagrant"],"title":"æˆ‘å€‘æƒ³åœ¨è™›æ“¬æ©Ÿä¸Šè·‘å€‹ K8s","uri":"https://blog.10oz.tw/20200830-run-kubernetes-on-vm/","year":"2020"},{"content":"å•é¡Œèµ·æº çœ‹çœ‹äººå®¶ï¼Œä¸€å€‹ latest æœ‰é€™éº¼å¤šç¨®æ¶æ§‹çš„ç‰ˆæœ¬ ç¾¨æ…•è€¶ æˆ‘ä¹Ÿæƒ³è¦ç·¨ä¸€å€‹çµ¦æˆ‘çš„æ¨¹è“æ´¾ åŸ·è¡Œç’°å¢ƒ Â» docker version Client: Docker Engine - Community Version: 19.03.12 API version: 1.40 Go version: go1.13.10 Git commit: 48a66213fe Built: Mon Jun 22 15:41:33 2020 OS/Arch: darwin/amd64 Experimental: true Server: Docker Engine - Community Engine: Version: 19.03.12 API version: 1.40 (minimum version 1.12) Go version: go1.13.10 Git commit: 48a66213fe Built: Mon Jun 22 15:49:27 2020 OS/Arch: linux/amd64 Experimental: true containerd: Version: v1.2.13 GitCommit: 7ad184331fa3e55e52b890ea95e65ba581ae3429 runc: Version: 1.0.0-rc10 GitCommit: dc9208a3303feef5b3839f4323d9beb36df0a9dd docker-init: Version: 0.18.0 GitCommit: fec3683 é–‹å§‹æ­£é¡Œ (buildx å¿«é€Ÿç‰ˆ) é€™æ˜¯å¯¦é©—æ€§åŠŸèƒ½~ Mac \u0026amp; Windows è«‹é€²ï¼Œlinux å…ˆä¾†é€™çœ‹çœ‹ \u0026gt; https://github.com/docker/buildx ï¼Œæˆ–æ˜¯ä¸‹æ»‘æ‡·èˆŠç‰ˆ\nè¨­å®šç’°ç¯€ é¦–å…ˆæˆ‘å€‘è¦é–‹å•Ÿ docker å¯¦é©—åŠŸèƒ½ vim ~/.docker/config.json åŠ ä¸Š 16 è¡Œçš„ experimental: \u0026quot;enabled\u0026quot;\n{ \u0026quot;auths\u0026quot;: { \u0026quot;474872403908.dkr.ecr.us-east-1.amazonaws.com\u0026quot;: {}, \u0026quot;917719776018.dkr.ecr.ap-northeast-1.amazonaws.com\u0026quot;: {}, \u0026quot;https://917719776018.dkr.ecr.ap-northeast-1.amazonaws.com\u0026quot;: {}, \u0026quot;https://index.docker.io/v1/\u0026quot;: {}, \u0026quot;https://registry.tenoz.tw\u0026quot;: {}, \u0026quot;registry.heroku.com\u0026quot;: {}, \u0026quot;registry.tenoz.tw\u0026quot;: {} }, \u0026quot;HttpHeaders\u0026quot;: { \u0026quot;User-Agent\u0026quot;: \u0026quot;Docker-Client/19.03.1 (darwin)\u0026quot; }, \u0026quot;credsStore\u0026quot;: \u0026quot;desktop\u0026quot;, \u0026quot;stackOrchestrator\u0026quot;: \u0026quot;swarm\u0026quot;, \u0026quot;experimental\u0026quot;: \u0026quot;enabled\u0026quot;, \u0026quot;debug\u0026quot;: true } é€™æ¨£å°±å¯ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹ image çš„ç›¸é—œè³‡æ–™ docker manifest inspect --verbose xiao4011/toolbox:latest å†ä¾†ä¸‹å€‹æŒ‡ä»¤çœ‹çœ‹åˆ¥äººçš„å¤šæ¶æ§‹ç‰ˆ docker manifest inspect --verbose redis:latest ä¸€çœ‹ä¸å¾—äº†ï¼Œäººå®¶æ˜¯ array é˜¿ï¼ï¼ å¸¥å§\nç·¨è­¯ Image æ‹¿å‡ºä½ çš„ Dockerfile åœ¨ From å‰é¢åŠ ä¸Šä½ è¦åŸ·è¡Œçš„ target åƒé€™æ¨£ --platform=$TARGETPLATFORM\n# Build code FROM --platform=$TARGETPLATFORM golang:alpine as builder ENV GO111MODULE=on WORKDIR /app COPY . . RUN apk add --update git ca-certificates RUN go mod download RUN go build -o app . # pull the binary file and service work really in the layer FROM --platform=$TARGETPLATFORM alpine:latest WORKDIR /srv/application COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ COPY --from=builder /app/app /srv/application/toolbox COPY --from=builder /app/public /srv/application/public ENTRYPOINT [\u0026quot;./toolbox\u0026quot;] æ”¹å¥½äº†ä¹‹å¾Œå‘¢ ç·¨è­¯çµ¦ä»–è·‘ä¸‹å»ï¼Œå¯ä»¥é¸æ“‡å¹¾å€‹ä½ å–œæ­¡çš„ \u0026ndash;platform å…§å®¹ä¾†è·‘\ndocker buildx build \\ --push \\ --platform linux/amd64,linux/arm64,linux/arm/v7,linux/arm/v6 --tag xiao4011/toolbox:latest . å¦‚æœä¸çŸ¥é“ä½ çš„ç’°å¢ƒæœ‰ä»€éº¼ platform å¯ä»¥ç·¨è­¯çš„è©± å¯ä»¥è¼¸å…¥docker buildx inspect --bootstrap å› ç‚ºæˆ‘å€‘æœ‰åŠ ä¸Š --push æ‰€ä»¥ç›´æ¥å‡ºç™¼åˆ° docker hub ä¸Šé¢çœ‹ä¸€ä¸‹ç‹€æ³ ç›´æ¥å®Œæˆï¼Œ484å¾ˆå¿«ï½ é–‹å§‹æ­£é¡Œ (æ‡·èˆŠç‰ˆ) æ–¹æ³•æ˜¯åˆ©ç”¨ docker manifest å°‡å¤šå€‹ docker images æ•´åˆåœ¨ä¸€èµ· å› æ­¤é¦–å…ˆæˆ‘å€‘è¦æº–å‚™ç·¨è­¯å¤šå€‹ images\nç·¨è­¯ Images æ–¹æ³•1ï¼š æŒ‡å®šæ¶æ§‹æ‹‰å– image é€™å€‹æ–¹æ³•æ˜¯å»ºç«‹åœ¨åˆ¥äººçš„ mutli-arch image ä¸Šçš„ï¼Œç”¨ä¸åŒæ¶æ§‹ç›´æ¥ä¾†ç·¨è­¯ # ç·¨è­¯ amd64 æ¶æ§‹ docker build --platform linux/amd64 --pull . -t xiao4011/toolbox:amd64 docker push xiao4011/toolbox:amd64 # ç·¨è­¯ armv7 æ¶æ§‹ docker build --platform linux/arm/v7 --pull . -t xiao4011/toolbox:armv7 docker push xiao4011/toolbox:armv7 æ–¹æ³•2ï¼š æ‰‹å‹•æ›´æ›ç·¨è­¯å¹³å°æ¶æ§‹ image åœ¨ Dockerfile ä¸­åŠ å…¥ ARG ARCH åŠ å…¥ä¸€å€‹ç·¨è­¯è®Šæ•¸å«åš ARCH ä¾†æŒ‡å®šç·¨è­¯çš„æ¶æ§‹ ARG ARCH FROM $ARCH/golang:alpine as builder // æ›´å¤šæ“ä½œ dockerfile... # åŸ·è¡Œç·¨è­¯ export ARCH=arm32v7; docker build --build-arg ARCH=$ARCH . -t xiao4011/toolbox:$ARCH docker push xiao4011/toolbox:$ARCH åŒ…è£ manifest æª”æ¡ˆ ç™¼å‡ºå»~~\ndocker manifest create xiao4011/toolbox:manifest \\ --amend xiao4011/toolbox:amd64 \\ --amend xiao4011/toolbox:armv7 docker manifest push xiao4011/toolbox:manifest ä¸€è¨€ä¸åˆå°± CI/CD (example for buildx) æ›´æ–° images é€™ç¨®äº‹æƒ…ç•¶ç„¶è¦è‡ªå‹•åŒ–ä¸€ä¸‹å•Šï¼é€™æ¬¡è·Ÿè‘— docker å®˜æ–¹ä»‹ç´¹ç¬¬ä¸€æ¬¡èªè­˜äº† github actionsï¼Œä»–æ˜¯ github å…§å»ºçš„ pipeline å·¥å…· æœ‰å€‹æœ‰è¶£çš„åœ°æ–¹æ˜¯å¯ä»¥æ’å…¥åˆ¥äººå¯«çš„ actionsï¼Œå¹¾ä¹æ¯å€‹æ­¥é©Ÿéƒ½æœ‰äººçµ¦ä½ åŒ…å¥½äº†ï¼Œåªè¦ call function å°±å°äº†\né¦–å…ˆæˆ‘å€‘å»ºç«‹æª”æ¡ˆ vim .github/workflows/cicd.yml\n# .github/workflows/cicd.yml name: build our image on: push: branches: - master jobs: build: runs-on: ubuntu-latest steps: - name: install Go uses: actions/setup-go@v1 with: go-version: ${{ matrix.go-version }} - name: check out path uses: actions/checkout@v2 - name: testing run: go test ./... - name: install buildx id: buildx uses: crazy-max/ghaction-docker-buildx@v1 with: version: latest - name: login to docker hub run: echo \u0026quot;${{ secrets.DOCKER_PASSWORD }}\u0026quot; | docker login -u \u0026quot;${{ secrets.DOCKER_USERNAME }}\u0026quot; --password-stdin - name: build the image run: | docker buildx build \\ --push \\ --tag xiao4011/toolbox:latest \\ --platform linux/amd64,linux/arm64,linux/arm/v7,linux/arm/v6 . æ¥ä¸‹ä¾†è¦å» github è¨­å®š Secretsï¼Œé–‹å•Ÿå°ˆæ¡ˆé é¢å¾Œé¸æ“‡ Setting \u0026gt; Secrets é¸æ“‡ New secret åŠ å…¥ docker çš„å¸³è™Ÿå¯†ç¢¼ï¼Œç­‰ä¸€ä¸‹ pipeline åœ¨ push image çš„æ™‚å€™æœƒä½¿ç”¨åˆ°\nä¹Ÿå¯ä»¥é¡å¤–è¨­å®šé™¤éŒ¯æ¨¡å¼ ACTIONS_RUNNER_DEBUG=true ACTIONS_STEP_DEBUG=true\nRef https://www.docker.com/blog/multi-arch-build-and-images-the-simple-way/\nhttps://hub.docker.com/r/ckulka/multi-arch-example\nhttps://docs.docker.com/buildx/working-with-buildx/\n","id":38,"section":"posts","summary":"å•é¡Œèµ·æº çœ‹çœ‹äººå®¶ï¼Œä¸€å€‹ latest æœ‰é€™éº¼å¤šç¨®æ¶æ§‹çš„ç‰ˆæœ¬ ç¾¨æ…•è€¶ æˆ‘ä¹Ÿæƒ³è¦ç·¨ä¸€å€‹çµ¦æˆ‘çš„æ¨¹è“æ´¾ åŸ·è¡Œç’°å¢ƒ Â» docker version Client: Docker Engine - Community Version: 19.03.12 API version: 1.40 Go version: go1.13.10 Git commit: 48a66213fe Built: Mon Jun 22 15:41:33 2020 OS/Arch: darwin/amd64 Experimental:","tags":["docker","multi-arch","buildx"],"title":"Docker å»ºç«‹ä¸åŒæ¶æ§‹çš„ Image","uri":"https://blog.10oz.tw/20200814-docker-mutli-arch-image/","year":"2020"},{"content":"\nCasbin æ˜¯ä»€éº¼ casbin æ˜¯ä¸€å€‹æ¬Šé™æ§ç®¡çš„æ¨¡çµ„ï¼Œå¯ä»¥å®šç¾©ä¸åŒçš„æ¬Šé™æ¨¡å‹ä¾†ç®¡ç†ä½¿ç”¨è€…çš„æ¬Šé™ï¼Œé è¨­åŒ…å«äº†å¾ˆå¤šçŸ¥åçš„æ¨¡å‹å¦‚ RBAC ABAC ä»–é›–ç„¶è¦å‰‡è¤‡é›œä½†ä»–å»æ”¯æŒè¨±å¤šèªè¨€ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ç’°å¢ƒä¸‹ä½¿ç”¨ï¼ŒåŒ…å« Go, Java, Node.js, php, python, c#, c++, rust\næ‰€ä»¥å­¸å­¸çœ‹æ‡‰è©²å¾ˆä¸éŒ¯å§ï¼\nModel, Policy èªæ³• é–‹å•Ÿç·¨è¼¯å™¨çš„ç•«é¢ https://casbin.org/editor/ å¯¦éš›æ“ä½œæ›´å¥½äº†è§£ï¼\né¦–å…ˆè¦äº†è§£ Model, Policy æ˜¯ä»€éº¼å‘¢?\nPolicy æ˜¯è¦å‰‡ï¼Œè£¡é¢å¯«äº†ä¸€ç³»åˆ—çš„æ¬Šé™åƒæ˜¯\n{å°æ˜} å¯ä»¥å° {æ–‡ä»¶} {æŸ¥çœ‹}\n{å°æ˜} å¯ä»¥å° {ç¨‹å¼} {æŸ¥çœ‹}\n{å°æ˜} å¯ä»¥å° {ç¨‹å¼} {ä¿®æ”¹}\nModel æ˜¯ç”¨ä¾†å®šç¾© Input çš„æ ¼å¼ï¼Œ Policy çš„æ ¼å¼ï¼Œ Policy çš„ä½¿ç”¨æ–¹æ³• åƒæ˜¯å‰é¢ Policy çš„å¯«æ³•å°±æ˜¯åœ¨é€™è£¡ä¾†å®šç¾©\nModel æ¬Šé™æ¨¡çµ„ r request_definition ç”¨ä¾†è¡¨ç¤ºè¼¸å…¥ï¼Œä¾‹å¦‚èªª r = sub, obj, act å°±æœ‰ 3 ç¨®è¼¸å…¥ï¼Œåˆ†åˆ¥è¡¨ç¤ºSubject(äºº) Object(è³‡æº) å‹•ä½œ(Action)\np policy_definition ç”¨ä¾†è¡¨ç¤ºè¦å‰‡çš„å½¢ç‹€ï¼Œç­‰ä¸€ä¸‹åœ¨è¨­å®š Policy çš„æ™‚å€™å°±è¦æŒ‰é€™é€™å€‹è¦å‰‡ ç¯„ä¾‹åƒæ˜¯ p = sub, act å°±å¯ä»¥è¨­å®šåªå’Œäººã€å‹•ä½œæœ‰é—œçš„è¦å‰‡ (alice å¯ä»¥ read) ä¹Ÿå¯ä»¥åŒæ™‚è¨­å®šç¬¬äºŒæ¢ Policy æ ¼å¼ p2 = sub, act, act2ï¼Œå°±å¯ä»¥æŠŠæ›´å¤šçš„è³‡è¨Šç´å…¥è¦å‰‡çš„å»ºç«‹ï¼Œå‰æç•¶ç„¶ä½ çš„ r(è¼¸å…¥)è¦æœ‰å¸¶å…¥ act2\ng (role_definition) ä¹Ÿå°±æ˜¯ RBAC è£¡é¢çš„ R(role)ï¼Œå¯ä»¥æƒ³åƒæˆæ˜¯ä¸€å€‹ç¾¤çµ„(group)è£¡é¢æœ‰å¾ˆå¤šçš„äººï¼Œç•¶ä½ å®šç¾©è©²ç¾¤çµ„æœ‰ä»€éº¼æ¬Šé™ï¼Œé‚£éº¼åœ¨è©²ç¾¤çµ„è£¡é¢çš„äººä¹Ÿå°±åŒæ™‚æ“æœ‰é€™äº›æ¬Šé™ã€‚\ne (policy_effect) å®šç¾©è¦å‰‡å…¬å¼çš„çµæœï¼Œæœ€å¸¸è¦‹çš„æ˜¯ e = some(where (p.eft == allow)) è¡¨ç¤ºåªè¦æœ‰ä¸€æ¢ match çµæœé€šéå°±é€šéäº† !some(where (p.eft == deny)) è¡¨ç¤ºåªè¦æœ‰ä¸€æ¢æ²’æœ‰é€šéï¼Œé‚£å°±ä¸é€šé é€™è£¡ casbin é‚„æœ‰é è¨­ä¸€äº›å‡½æ•¸å¯ä»¥ä½¿ç”¨ï¼Œåƒæ˜¯ç”¨ keyMatch ä¾†æ¯”å°ï¼Œ * è¡¨ç¤ºå…¨éï¼Œæˆ–æ˜¯é€²ä¸€æ­¥çš„ regexMatchï¼Œé‚„æœ‰ eval å¯ä»¥å‹•æ…‹çš„è¼¸å…¥è¦å‰‡ ç”šè‡³å¯ä»¥è‡ªå·±å¯« function ç¶å®šé€²å»ï¼Œéå¸¸æœ‰ç”¨ï¼å¯ä»¥å»å®˜ç¶²çœ‹çœ‹ æ›´å¤šfunction\nm (matchers) å°±æ˜¯ä½¿ç”¨å‰é¢è¨­å®šæª”ä¾†å¯«è¦å‰‡å…¬å¼çš„åœ°æ–¹\nä¾†çœ‹ä¸€å€‹ç¯„ä¾‹æ¨¡å‹ ACL (Access Control List) ä¹Ÿå°±æ˜¯ç™½åå–®æ¨¡å¼ çœ‹åˆ° matchers å¾ˆæ˜é¡¯èªªæ˜äº†ï¼Œä½ çš„ sub, obj, act äººã€ç‰©ã€å‹•ä½œ éƒ½è¦ç›¸åŒæ‰æœƒæ˜¯ allow\n[request_definition] r = sub, obj, act [policy_definition] p = sub, obj, act [policy_effect] e = some(where (p.eft == allow)) [matchers] m = r.sub == p.sub \u0026amp;\u0026amp; r.obj == p.obj \u0026amp;\u0026amp; r.act == p.act Policy æ¬Šé™è¦å‰‡ å®šç¾©å¥½æ¨¡å‹ä¹‹å¾Œï¼Œé‚„éœ€è¦è³‡æ–™æ‰å¯ä»¥é–‹å§‹è·‘ï¼Œè·Ÿä¸Šé¢çš„ Model æ¨¡å‹å¯ä»¥æ­é…è‘—çœ‹ é€™è£ Policy çš„å¯«æ³•éœ€ç¬¦åˆ model è£¡é¢ p(policy_definition) çš„è¦ç¯„\np, alice, data1, read p, bob, data2, write ä¾†çœ‹æ‰£ è¤‡è£½äº†ç¯„ä¾‹çš„ RBAC æ¨¡å¼ï¼Œå¯ä»¥åœ¨å‰›å‰›çš„ editor ä¸Šé¸æ“‡ RBAC with resource roles ä¾†çœ‹çœ‹åŸ·è¡Œçµæœæ˜¯å¦ç›¸åŒ\né€™é‚Šåœ¨çœ‹çš„æ™‚å€™å¯ä»¥å…ˆçœ‹ policy g å®šç¾©çš„ groupï¼Œ\nalice æ˜¯ admin\ndata1 æ˜¯ data_group\ndata2 æ˜¯ data_group\nç„¶å¾Œ admin å¯ä»¥ write data_group\né€™æ¨£æ‡‰è©²ç›¸ç•¶å®¹æ˜“ç†è§£äº†ï½\npackage main import ( \u0026quot;fmt\u0026quot; \u0026quot;github.com/casbin/casbin/v2\u0026quot; \u0026quot;github.com/casbin/casbin/v2/model\u0026quot; scas \u0026quot;github.com/qiangmzsx/string-adapter/v2\u0026quot; ) var modelStr = ` [request_definition] r = sub, obj, act [policy_definition] p = sub, obj, act [role_definition] g = _, _ g2 = _, _ [policy_effect] e = some(where (p.eft == allow)) [matchers] m = g(r.sub, p.sub) \u0026amp;\u0026amp; g2(r.obj, p.obj) \u0026amp;\u0026amp; r.act == p.act ` var policyStr = ` p, alice, data1, read p, bob, data2, write p, admin, data_group, write g, alice, admin g2, data1, data_group g2, data2, data_group ` func main() { // è¨­å®š Model æ¨¡å‹ // åƒè€ƒ https://casbin.org/docs/en/model-storage m, _ := model.NewModelFromString(modelStr) // è¨­å®š Policy å…·é«”è¦å‰‡ // å¯ä»¥åƒè€ƒ https://casbin.org/docs/en/adapters p := scas.NewAdapter(policyStr) // å»ºç«‹ Enforcer éœ€è¦è¼¸å…¥ Model å’Œ Policy // casbin æä¾›å¾ˆå¤šçš„ adapter è®“é–‹ç™¼è€…ç”¨è‡ªå·±é©åˆçš„æ–¹å¼å¡«å……è³‡æ–™ (file, db, redis, cloud...) // ç¯„ä¾‹é¸æ“‡äº†æœ€æ–¹ä¾¿çš„ç›´æ¥è®€æ–‡å­— XDD enforcer, _ := casbin.NewEnforcer(m, p) // å¯¦éš›æ¸¬è©¦æ™‚é–“: // åœ¨ model [request_definition] è¨­å®šäº†ä¸‰å€‹è®Šæ•¸è¼¸å…¥ sub, obj, act := \u0026quot;alice\u0026quot;, \u0026quot;data2\u0026quot;, \u0026quot;write\u0026quot; result, _ := enforcer.Enforce(sub, obj, act) fmt.Printf(\u0026quot;enforce1: %t\\n\u0026quot;, result) // true sub, obj, act = \u0026quot;alice\u0026quot;, \u0026quot;data2\u0026quot;, \u0026quot;read\u0026quot; result, _ = enforcer.Enforce(sub, obj, act) fmt.Printf(\u0026quot;enforce1: %t\\n\u0026quot;, result) // false (å› ç‚º admin å° data_group æ²’æœ‰ read) } å†ä¾†å·å·æ¨è–¦æ¯æ—¥ä¸€åº«çš„ casbin æ–‡ç«  https://darjun.github.io/2020/06/12/godailylib/casbin/ è£¡é¢æåˆ° ABACï¼ˆattribute base access listï¼‰æ¨¡å‹çš„ç”¨æ³•ï¼Œç›¸ç•¶æœ‰è¶£ éœ€æ±‚æ˜¯é€™æ¨£çš„ï¼š\næ­£å¸¸å·¥ä½œæ™‚é–“9:00-18:00æ‰€æœ‰äººéƒ½å¯ä»¥è®€å¯«dataï¼Œå…¶ä»–æ™‚é–“åªæœ‰æ•¸æ“šæ‰€æœ‰è€…èƒ½è®€å¯«ã€‚\nModel å¦‚ä¸‹\n[request_definition] r = sub, obj, act [policy_definition] p = sub, obj, act [matchers] m = r.sub.Hour \u0026gt;= 9 \u0026amp;\u0026amp; r.sub.Hour \u0026lt; 18 || r.sub.Name == r.obj.Owner [policy_effect] e = some(where (p.eft == allow)) è©²è¦å‰‡ä¸éœ€è¦ç­–ç•¥æ–‡ä»¶ï¼š\nå­˜é€²å» SQL è£¡é¢ å¯¦éš›ä¸Šåœ¨ä½¿ç”¨ casbin çš„æ™‚å€™æˆ‘å€‘ä¸æœƒç”¨å­—ä¸²ä¾†å¯« model, policy æ›´å¤šæœƒå­˜åœ¨ file æˆ–æ˜¯ db è£¡é¢ï¼Œé€™æ™‚å€™ adapter å°±æ´¾ä¸Šç”¨å ´å•¦~\npackage main import ( \u0026quot;fmt\u0026quot; \u0026quot;github.com/casbin/casbin/v2\u0026quot; xormadapter \u0026quot;github.com/casbin/xorm-adapter/v2\u0026quot; _ \u0026quot;github.com/lib/pq\u0026quot; ) func main() { // åˆå§‹åŒ– xorm adapterï¼Œåœ¨é€™è£¡èˆ‡ DB é€£ç·š // æ²’æœ‰æŒ‡å®š db çš„è©±æœƒå¹«ä½ å»ºç«‹ä¸€å€‹ casbin (åŠ å…¥ dbname=abc å¯ä»¥æŒ‡å®šä½¿ç”¨ DB abc) // é€²å»æœƒå¹«ä½ æª¢æŸ¥æœ‰æ²’æœ‰ casbin_rule çš„è³‡æ–™è¡¨ï¼Œæ²’æœ‰çš„è©±ä¹Ÿæœƒå¹«ä½ åŠ é€²å» driverName := \u0026quot;postgres\u0026quot; pgUser, pgPassWd := \u0026quot;root\u0026quot;, \u0026quot;root\u0026quot; dataSource := fmt.Sprintf(\u0026quot;user=%s password=%s host=127.0.0.1 port=5432 sslmode=disable\u0026quot;, pgUser, pgPassWd) a, _ := xormadapter.NewAdapter(driverName, dataSource) // Your driver and data source. // ç›´æ¥è®€æª”æ¡ˆæœ€å¿«å•¦ enforcer, _ := casbin.NewEnforcer(\u0026quot;model_rbac.conf\u0026quot;, a) // ç¬¬ä¸€æ¬¡è·‘çš„è©±æœƒéœ€è¦ Policy è³‡æ–™ï¼Œè®“ä»–å¹«å¿™å¯«é€²å»å§ // enforcer.EnableAutoSave(false) // é—œé–‰è‡ªå‹•åŒæ­¥ { // å¦‚æœæ˜¯ enforcer.AddPolicy çš„è©±æœƒå¹«ä½ å¡«ç¬¬ä¸€å€‹ \u0026quot;p\u0026quot; enforcer.AddNamedPolicy(\u0026quot;p\u0026quot;, \u0026quot;alice\u0026quot;, \u0026quot;data1\u0026quot;, \u0026quot;read\u0026quot;) enforcer.AddNamedPolicy(\u0026quot;p\u0026quot;, \u0026quot;bob\u0026quot;, \u0026quot;data2\u0026quot;, \u0026quot;write\u0026quot;) enforcer.AddNamedPolicy(\u0026quot;p\u0026quot;, \u0026quot;data_group_admin\u0026quot;, \u0026quot;data_group\u0026quot;, \u0026quot;write\u0026quot;) // enforcer.AddGroupingPolicies çš„è©±æœƒå¹«ä½ å¡«ç¬¬ä¸€å€‹ \u0026quot;g\u0026quot; enforcer.AddNamedGroupingPolicy(\u0026quot;g\u0026quot;, \u0026quot;alice\u0026quot;, \u0026quot;data_group_admin\u0026quot;) enforcer.AddNamedGroupingPolicy(\u0026quot;g2\u0026quot;, \u0026quot;data1\u0026quot;, \u0026quot;data_group\u0026quot;) enforcer.AddNamedGroupingPolicy(\u0026quot;g2\u0026quot;, \u0026quot;data2\u0026quot;, \u0026quot;data_group\u0026quot;) } // Load the policy from DB. enforcer.LoadPolicy() // å¯¦éš›æ¸¬è©¦æ™‚é–“: // åœ¨ model [request_definition] è¨­å®šäº†ä¸‰å€‹è®Šæ•¸è¼¸å…¥ sub, obj, act := \u0026quot;alice\u0026quot;, \u0026quot;data2\u0026quot;, \u0026quot;write\u0026quot; result, _ := enforcer.Enforce(sub, obj, act) fmt.Printf(\u0026quot;enforce1: %t\\n\u0026quot;, result) // true sub, obj, act = \u0026quot;alice\u0026quot;, \u0026quot;data2\u0026quot;, \u0026quot;read\u0026quot; result, _ = enforcer.Enforce(sub, obj, act) fmt.Printf(\u0026quot;enforce2: %t\\n\u0026quot;, result) // false (å› ç‚º data_group_admin å° data_group æ²’æœ‰ read) } Ref https://darjun.github.io/2020/06/12/godailylib/casbin/ https://github.com/casbin/xorm-adapter/tree/v2.0.1 https://casbin.org/docs/en/overview\n","id":39,"section":"posts","summary":"Casbin æ˜¯ä»€éº¼ casbin æ˜¯ä¸€å€‹æ¬Šé™æ§ç®¡çš„æ¨¡çµ„ï¼Œå¯ä»¥å®šç¾©ä¸åŒçš„æ¬Šé™æ¨¡å‹ä¾†ç®¡ç†ä½¿ç”¨è€…çš„æ¬Šé™ï¼Œé è¨­åŒ…å«äº†å¾ˆå¤šçŸ¥åçš„æ¨¡å‹å¦‚ RBAC ABAC ä»–é›–ç„¶è¦å‰‡è¤‡é›œä½†ä»–å»æ”¯æŒè¨±å¤šèªè¨€ï¼Œå¯","tags":["golang","casbin"],"title":"Casbin æ¬Šé™ç®¡ç†æ¨¡çµ„","uri":"https://blog.10oz.tw/20200813-casbin-the-access-control-model/","year":"2020"},{"content":"ä¸å›‰å”†ç›´æ¥ä¸Šåœ– é¦¬ä¸Šè©¦è©¦ pokesay\nbrew tap xiaoxiaosn/xiaoxiao brew install pokesay èµ·æº é€™å€‹æ•…äº‹æ˜¯é€™æ¨£çš„ï¼Œæœ‰ä¸€å¤©ç™¼ç¾äº†ä¸€å€‹æœ‰è¶£çš„ command pokemonsayä»–æ˜¯ cowsay çš„æ”¹ç·¨ç‰ˆï¼Œå®ƒå¯ä»¥è®“ pokemon å‡ºç¾èªªä½ æƒ³è¦ä»–èªªçš„è©± XDD\næˆ‘ç”¨å¾—å¾ˆå¿«æ¨‚çš„æ™‚å€™ç™¼ç¾ä¸€ä»¶äº‹å¾ˆä¸å¿«æ¨‚ï¼Œç•¶ä¸€è¡Œå¤ªå¤šå­—çš„æ™‚å€™æœƒæ›è¡Œ\nä½ çœ‹ï¼éƒ½æ“ åœ¨ä¸€èµ·äº† R\né€™æ™‚æˆ‘æƒ³åˆ° cowsay æ‡‰è©²æœ‰é€™å€‹åŠŸèƒ½æ‰å°å‘€ï¼ æŸ¥è©¢äº†ä¹‹å¾Œç™¼ç¾ åœ¨ pokemonsay è£¡é¢ -n è¢«ç”¨åœ¨ Do not tell the pokÃ©mon name. ä¹Ÿå°±æ˜¯æœ€åº•ä¸‹ä¸è¦ show pokemon çš„åå­—\nQQ æˆ‘ä¸ä¾ï¼Œæˆ‘è‡ªå·±æ”¹!\nä»‹ç´¹ Homebrew é¦–å…ˆå…ˆä»‹ç´¹ä¸€ä¸‹ homebrew é€™å€‹è»Ÿé«”ï½ ä»–æ˜¯ MacOS ä¸Šçš„å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œæ˜¯ mac æœ€é‡è¦çš„å¿…è£è»Ÿé«”ä¹‹ä¸€\nbrew é€™å€‹å­—æ˜¯é‡€é€ çš„æ„æ€ï¼Œhomebrew åœ¨å®¶é‡€é€ ä¹Ÿå°±æ˜¯è‡ªé‡€çš„æ„æ€ tap ç¬¬ä¸‰æ–¹å¥—ä»¶çš„å€‰åº«ï¼Œå°±ç›¸ç•¶æ–¼æ˜¯ apt çš„ ppa ä¸€æ¨£çš„è§’è‰² formula å…¬å¼ã€é…æ–¹ï¼Œä¸Šé¢å¯«è‘—è»Ÿé«”å®‰è£çš„æ­¥é©Ÿï¼Œä¹Ÿå°±æ˜¯é‡€è£½(brew)çš„æ–¹æ³• cellar é…’çª–å­˜æ”¾é‡€å¥½çš„é…’ï¼Œé è¨­å­˜åœ¨ /usr/local/Cellarï¼Œæ¯å€‹è³‡æ–™å¤¾è£¡é¢ä¹Ÿå­˜æœ‰ä¸åŒçš„ç‰ˆæœ¬ï¼Œç•¶ brew switch æŸå€‹å¥—ä»¶ç‰ˆæœ¬çš„æ™‚å€™å°±æ˜¯æŠŠ /usr/local/bin çš„ link æŒ‡éå» è£œå……: brew cask ç”¨ä¾†å®‰è£ macOS apps ä¹Ÿå°±æ˜¯å¯ä»¥ç›´æ¥åœ¨æ‡‰ç”¨ç¨‹å¼è£¡é¢çœ‹åˆ°çš„åœ–åƒåŒ–è»Ÿé«”ï¼Œåƒæ˜¯ Chrome, Firefox, 360Safe ä¹‹é¡çš„\näº†è§£å®ŒåŸºæœ¬æ¶æ§‹å¾Œï¼Œæˆ‘å€‘çŸ¥é“ç›®æ¨™å°±æ˜¯è£½ä½œè‡ªå·±çš„ tap å¥½è®“ brew å¯ä»¥å®‰è£æˆ‘å€‘é‡‹å‡ºçš„ç¬¬ä¸‰æ–¹å¥—ä»¶\né–‹å§‹é‡€é…’ æˆ‘å€‘åˆ†æˆå…©å€‹éƒ¨åˆ†ä¾†å®Œæˆï¼Œä¸€å€‹æ˜¯æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼å¦ä¸€å€‹æ˜¯ homebrew çš„å®‰è£è…³æœ¬\nç¨‹å¼æœ¬èº« åªè¦ä»»ä½•ä¸€å€‹å¯ä»¥åŸ·è¡Œçš„å‘½ä»¤éƒ½è¡Œï¼Œæ‰€ä»¥å…ˆä¸è‘—å¢¨æ–¼æ­¤ ç¯„ä¾‹æœƒç”¨ä¸‹é¢é€™å€‹ repoï¼Œå·²ç¶“æŠŠæˆ‘æƒ³è¦çš„ -n æŒ‡ä»¤åŠ å›ä¾†å•¦ï½ï½ https://github.com/XiaoXiaoSN/pokesay\nFormula å®‰è£æŒ‡å— æœ¬æ–‡çš„é‡é»ä¾†å•¦! é¦–å…ˆæˆ‘å€‘è¦åˆ° github ä¸Šé–‹ä¸€å€‹æ–°å°ˆæ¡ˆï¼Œå‘½åå«åš homebrew-{your-tap-name}ï¼Œä¾‹å¦‚æˆ‘çš„ homebrew-xiaoxiao\né€²å…¥å°ˆæ¡ˆåº•ä¸‹æ–°å¢ Formula è³‡æ–™å¤¾ï¼Œåœ¨åº•ä¸‹æ–°å¢ä½ çš„ formula\n# Formula/pokesay.rb # å®šç¾© Pokesay ç¹¼æ‰¿ Formula class Pokesay \u0026lt; Formula desc '\u0026quot;pokesay\u0026quot; is like \u0026quot;cowsay\u0026quot; but for pokÃ©mon.' homepage \u0026quot;https://github.com/XiaoXiaoSN/pokesay\u0026quot; # url èªªæ˜è¦å»å“ªè£¡ä¸‹è¼‰å°ˆæ¡ˆ # https://github.com/{username}/{repo}/{format}/{tag or branch} # format æˆ‘å€‘éƒ½å¯« tarball # tag or branch å°±çœ‹ä½ å–œæ­¡ç”¨å“ªå€‹å›‰ url \u0026quot;https://github.com/XiaoXiaoSN/pokesay/tarball/v1.0.1\u0026quot; # sha256 ç”¨ä¾†ç¢ºèªä½ ä¸Šé¢èªªçš„æª”æ¡ˆèº«ä»½ï¼Œç­‰ç­‰ä¸‹é¢æœƒèªªæ€éº¼é•·å‡ºä¾† sha256 \u0026quot;43511be3dbb52b380bf7501e3b06a0a17ee0349d0246601537481ca811753a4a\u0026quot; # ç‰ˆæœ¬è™Ÿ version \u0026quot;v1.0.1\u0026quot; # depends_on å®šç¾©å®‰è£ä½ çš„æ±è¥¿å‰ï¼Œæœƒç”¨åˆ°çš„ä¾è³´å¥—ä»¶ depends_on \u0026quot;cowsay\u0026quot; =\u0026gt; :recommended depends_on \u0026quot;coreutils\u0026quot; =\u0026gt; [:recommended, \u0026quot;with-default-names\u0026quot;] if not OS.linux? # å®šç¾©å®‰è£æ­¥é©Ÿ def install system \u0026quot;cp\u0026quot;, \u0026quot;-r\u0026quot;, \u0026quot;./cows\u0026quot;, \u0026quot;#{prefix}/cows\u0026quot; system \u0026quot;cp\u0026quot;, \u0026quot;pokemonsay.sh\u0026quot;, \u0026quot;pokesay\u0026quot; # å­—ä¸²å–ä»£ï¼Œè®“ pokesay åœ¨æœ¬åœ°ä¹Ÿå¯ä»¥æ‰¾å¾—åˆ°åƒè€ƒæª”æ¡ˆ inreplace \u0026quot;pokesay\u0026quot;, /^pokemon_path=.*$/, \u0026quot;pokemon_path=#{prefix}/cows\u0026quot; # æŠŠ pokesay è¤‡è£½åˆ°é€™å€‹ formula çš„ç›®éŒ„ (/usr/local/Cellar/{pkg}/0.1/bin) # ä¸¦è¨­å®šæˆå¯åŸ·è¡Œæª”æ¡ˆ (chmod 0555 foo) bin.install \u0026quot;pokesay\u0026quot; end # å®‰è£å®Œæˆå¾Œçš„é©—è­‰æ¸¬è©¦ï¼Œé€™é‚Šå·æ‡¶æ²’å¯« XD test do system \u0026quot;false\u0026quot; end end å¦‚ä½•ç”¢ç”Ÿ sha256\n# ç”¨ curl ä¸‹è¼‰å£“ç¸®æª”ä¸‹ä¾†ï¼Œ -L è·Ÿéš¨è·³è½‰ -o å„²å­˜è¼¸å‡ºåˆ°æª”æ¡ˆ curl -L https://github.com/XiaoXiaoSN/pokesay/tarball/v1.0.1 -o pokesay.tar.gz # è¨ˆç®— sha256 é›œæ¹Šå€¼ shasum -a 256 pokesay.tar.gz brew edit brew edit æœƒå«å‡ºä½ å®‰è£æ™‚ä¸‹è¼‰çš„ Formulaï¼Œè®“ä½ å¯ä»¥ç·¨è¼¯å†é‡æ–°å®‰è£\nä¹Ÿå¯ä»¥è—‰æ©Ÿå·å·åƒè€ƒåˆ¥äººçš„ Formula æ˜¯å¦‚ä½•ç·¨å¯«çš„ï½ï½\nbrew edit wget # æœƒä½¿ç”¨é è¨­ç·¨è¼¯å™¨é–‹å•Ÿ Ref homebrew æ•…äº‹ https://www.onejar99.com/mac-homebrew-homebrew-cask-mac/ Formula-Cookbook https://docs.brew.sh/Formula-Cookbook\n","id":40,"section":"posts","summary":"ä¸å›‰å”†ç›´æ¥ä¸Šåœ– é¦¬ä¸Šè©¦è©¦ pokesay brew tap xiaoxiaosn/xiaoxiao brew install pokesay èµ·æº é€™å€‹æ•…äº‹æ˜¯é€™æ¨£çš„ï¼Œæœ‰ä¸€å¤©ç™¼ç¾äº†ä¸€å€‹æœ‰è¶£çš„ command pokemonsayä»–æ˜¯ cowsay çš„æ”¹ç·¨ç‰ˆï¼Œå®ƒå¯ä»¥è®“ pokemon å‡ºç¾èªªä½ æƒ³è¦","tags":["homebrew","ruby","pokesay","pokemon"],"title":"Homebrew è‡ªå·±å¯«é…æ–¹ä¸€èµ·ä¾†é‡€é…’","uri":"https://blog.10oz.tw/20200811-homebrew-create-app/","year":"2020"},{"content":"æ­¥é©Ÿèªªæ˜æ™‚é–“ ç¢ºèª Windows ç‰ˆæœ¬ é¦–å…ˆæŒ‰ä¸€ä¸‹ Windows éµè¼¸å…¥ winver ä¾†ç¢ºèªç›®å‰ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å¿…é ˆæ˜¯ 19041 æˆ–æ˜¯ 2004 æ‰å¯ä»¥å–” å¦‚æœç‰ˆæœ¬ä¸å¤ çš„è©±ï¼Œæ›´æ–°å™¨ä¸‹è¼‰ \u0026raquo; https://www.microsoft.com/en-us/software-download/windows10\né–‹å•Ÿç’°å¢ƒè¨­å®š ç”¨ç³»çµ±ç®¡ç†å“¡èº«åˆ†é–‹å•Ÿ PowerShell å¾Œï¼Œè¼¸å…¥æŒ‡ä»¤é–‹å•Ÿ Linux Subsystem çš„æ”¯æ´å’Œ HyperV çš„è™›æ“¬æ©Ÿå™¨å¹³å° ç”¨ HyperV è¦è¨˜å¾—åˆ° BIOS é–‹å•Ÿè™›æ“¬æ©Ÿå™¨çš„æ”¯æ´å–”\ndism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart é€™æ™‚å€™ä½ éœ€è¦é‡å•Ÿä¸€ä¸‹é›»è…¦~\nç„¶å¾Œè¦æ›´æ–° linux subsystem kernel https://docs.microsoft.com/nl-nl/windows/wsl/wsl2-kernel\nå®‰è£ Linux ç™¼è¡Œç‰ˆ æŒ‰ä¸€ä¸‹ Windows éµè¼¸å…¥ Microsoft Store å¾Œé–‹å•Ÿå•†åº—é¸æ“‡ä½ è¦çš„ Linux ç‰ˆæœ¬ï¼Œåœ¨é€™è£¡æˆ‘é¸æ“‡ Ubuntu1804 å¦å¤–å·å·ä¸‹è¼‰äº† windows terminalï¼Œæœ‰æ¯”è¼ƒæ¼‚äº®R çœ‹ä¸€çœ‹ WSL2 çš„è¨­å®š æ›´æ–°å®Œå¾Œé–‹å•Ÿ PowerShell å°‡ WSL é è¨­ç‰ˆæœ¬æ”¹ç‚º 2\nwsl --set-default-version 2 å¯ä»¥ç”¨ wsl -l ä¾†åˆ—å‡ºä½ çš„ Linux å€‘ï¼ŒæŠŠåŸæœ¬å­˜åœ¨çš„ WSL å‡ç´šæˆ WSL2\nwsl --set-version Ubuntu-18.04 2 è¼¸å…¥ wsl -l -v æ‡‰è©²å¯ä»¥çœ‹è¦‹ Version 2ï¼Œé‚£é€™æ¨£å°±å°å•¦~ Docker Time é¦–å…ˆåœ¨ Win10 ä¸‹è¼‰æ¡Œé¢ç‰ˆ Dockerï¼Œ https://docs.docker.com/docker-for-windows/wsl/\nä¸‹è¼‰å¥½äº†å—? æ‰“é–‹ä¾†é¸æ“‡ WSL2 ä½œç‚º backend å®‰è£å¥½ä¹‹å¾Œä»–æœƒè«‹ä½ é‡æ–°ç™»å…¥ä½ çš„ Win10ï¼Œ å®Œæˆå¾Œé¸æ“‡ Settings(ä¸Šæ–¹çš„å°é½’è¼ª) \u0026gt; General ä¾†ç¢ºèªä¸€ä¸‹ Use the WSL2 based engine é¸é … å†ä¾†åˆ° Resources \u0026gt; WSL Integartionï¼ŒæŠŠä½ çš„ WSL linux ç™¼è¡Œç‰ˆé¸èµ·ä¾† é»å³ä¸‹è§’çš„ Apply \u0026amp; Restart\né–‹å•Ÿä½ çš„ terminalï¼Œè¼¸å…¥ wsl -d \u0026lt;ä½ çš„ç³»çµ±\u0026gt; é€²å…¥ WSL çš„ç³»çµ±å…§ è¼¸å…¥ docker ps ç¢ºèªæœ‰æŠ“åˆ° docker ~ é–‹å€‹æœå‹™å§\n-d åœ¨èƒŒæ™¯åŸ·è¡Œ -p port å°å‡º --name å¹« container å–åå­— docker run -d -p 8080:80 --name docker_time docker/getting-started çœ‹çœ‹ä½ çš„ http://localhost:8080 æœå‹™é–‹èµ·ä¾†å›‰ æ¸¬è©¦å®Œ docker å¯ä»¥å·¥ä½œäº†ï¼Œæ‰€ä»¥åˆªæ‰\ndocker kill docker_time ä»»æ€§çš„å€‹äººåŒ–æ™‚é–“ # æ›´æ–°ä¸€ä¸‹ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y # git è¨­å®š git config --global core.ignorecase false git config --global alias.co 'checkout' git config --global alias.chekcout 'checkout' git config --global alias.log1 'log --oneline -n 10' git config --global alias.logg 'log --oneline --graph' git config --global alias.cm 'commit -m' git config --global alias.cmamend '!git add $1 \u0026amp;\u0026amp; git commit --amend --no-edit' # shell è¨­å®š sudo apt install fish -y curl -L https://get.oh-my.fish | fish omf install godfather # é–‹å°ˆæ¡ˆè³‡æ–™å¤¾ mkdir projects ln -s (pwd)/projects ~/projects Golang ç’°å¢ƒ (gvm) ä¸å›‰å—¦ç›´æ¥æŠ„ \u0026raquo; https://blog.miniasp.com/post/2020/07/27/Build-Golang-Dev-Box-in-Windows?utm_source=Facebook_PicSee\nsudo apt install binutils bison gcc make build-essential -y curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer | bash -E source ~/.gvm/scripts/gvm set GOVER go1.14 gvm install go1.14 --binary gvm use go1.14 --default # ç¢ºèªæˆ‘å€‘çš„å·¥ä½œ~~ go version ç´€éŒ„ä¸€é»å•é¡Œ [time=Sat, Aug 8, 2020 1:07 PM]\né–‹å•Ÿå·¥ä½œç®¡ç†å“¡æ™‚ç™¼ç¾ï¼Œæœ‰ä¸€å€‹å«åš vmmem çš„ä½”ç”¨äº†å¾ˆå¤šçš„ memory å’Œ CPU ç™¼ç¾å¾ˆå¤šäººéƒ½æœ‰é€™æ¨£çš„å•é¡Œï¼Œç´€éŒ„ä¸€ä¸‹è§£æ±ºæ–¹æ³• ç§»é§•åˆ° c:\\users\\{{your profile name}} é–‹å•Ÿæˆ–æ–°å¢ .wslconfig\n{%gist lewcianci/d09ef5e6741fe0eff61935d39e9667ee %}\nä½¿ç”¨ç³»çµ±ç®¡ç†å“¡èº«åˆ†é–‹å•Ÿ PowerShell\nRestart-Service LxssManager åƒè€ƒæ–‡ç« \nMicroK8s Time (è«‹å‹¿åƒè€ƒ) ç›´æ¥é‡åˆ°å•é¡Œäº†ï¼Œsnapd æ˜¯ä¸å¯ç”¨çš„ç‹€æ…‹ sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -yqq daemonize dbus-user-session fontconfig sudo daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target exec sudo nsenter -t $(pidof systemd) -a su - $LOGNAME snap version é‚„éœ€è¦é–‹å•Ÿ Systemd æŠŠé€™ä¸€æ®µè²¼ä¸Šå»å¾Œé—œæ‰è¦–çª—é‡é–‹\n## /etc/profile.d/00-wsl2-systemd.sh # Create the starting script for SystemD SYSTEMD_PID=$(ps -ef | grep '/lib/systemd/systemd --system-unit=basic.target$' | grep -v unshare | awk '{print $2}') if [ -z \u0026quot;$SYSTEMD_PID\u0026quot; ]; then sudo /usr/bin/daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target SYSTEMD_PID=$(ps -ef | grep '/lib/systemd/systemd --system-unit=basic.target$' | grep -v unshare | awk '{print $2}') fi if [ -n \u0026quot;$SYSTEMD_PID\u0026quot; ] \u0026amp;\u0026amp; [ \u0026quot;$SYSTEMD_PID\u0026quot; != \u0026quot;1\u0026quot; ]; then exec sudo /usr/bin/nsenter -t $SYSTEMD_PID -a su - $LOGNAME fi å¥½ï¼Œå•é¡Œè§£æ±ºä¾†å®‰è£å§\n# å®‰è£ microk8s sudo snap install microk8s --classic # å˜—è©¦ä¸€ä¸‹æŒ‡ä»¤ï¼Œä»–æœƒæé†’ä½ è¦çµ¦æ¬Šé™ç…§è‘—åšå§~è¨˜å¾—è¦æŠŠ user æ›æ‰å–” microk8s.status sudo usermod -a -G microk8s arios sudo chown -f -R arios ~/.kube å®Œæˆå¾Œé›¢é–‹é‡æ–°ç™»å…¥ï¼Œå°±å¯ä»¥é–‹å§‹é–‹æœå‹™å›‰\nmicrok8s.enable dns dashboard for Win10 2004 ä½ å„ä½é˜¿~!é€™å€‹ä¸­æ–‡è¼¸å…¥é˜¿ï¼Œå¾ˆä¸oké˜¿ ç•¶è¼¸å…¥ä¸­æ–‡çš„æ™‚å€™éœ€è¦åˆ‡æ›æˆè‹±æ–‡å°±æœƒçˆ†ç‚¸?\nå¾€å³ä¸‹è§’çš„ ä¸­/A é»ä¸€ä¸‹å³éµ ä¸€èˆ¬ \u0026gt; è¼¸å…¥è¨­å®š \u0026gt; \u0026ldquo;è‡ªå‹•å°‡ä¸­æ–‡æ¨¡å¼ä¸­çš„æŒ‰éµé †åºåˆ‡æ›ç‚ºè‹±æ•¸å­—å…ƒ\u0026rdquo; é–‹èµ·ä¾† æ©~æ˜¯ç¨å¾®å¥½é»äº†ï¼Œä¸éé€™å€‹é¸é …ä¹Ÿæœ‰æ¯›ç—…\u0026hellip;\u0026hellip; ä½ ä¸€æŒ‰éŒ¯æ³¨éŸ³ä»–çµ¦ä½ æ”¹æˆè‹±æ–‡é˜¿QQ å“ªå€‹æ¯”è¼ƒå›°æ“¾éœ€è¦å€‹äººè©•ä¼°äº†\nRef https://docs.microsoft.com/zh-tw/windows/wsl/install-win10\nhttps://pureinfotech.com/install-windows-subsystem-linux-2-windows-10/\nhttps://blog.miniasp.com/post/2020/07/26/Multiple-Linux-Dev-Environment-build-on-WSL-2\nhttps://docs.docker.com/docker-for-windows/wsl/\nhttps://github.com/microsoft/WSL/issues/5126#issuecomment-653715201\nhttps://wsl.dev/wsl2-microk8s\n","id":41,"section":"posts","summary":"æ­¥é©Ÿèªªæ˜æ™‚é–“ ç¢ºèª Windows ç‰ˆæœ¬ é¦–å…ˆæŒ‰ä¸€ä¸‹ Windows éµè¼¸å…¥ winver ä¾†ç¢ºèªç›®å‰ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å¿…é ˆæ˜¯ 19041 æˆ–æ˜¯ 2004 æ‰å¯ä»¥å–” å¦‚æœç‰ˆæœ¬ä¸å¤ çš„è©±ï¼Œæ›´æ–°å™¨ä¸‹è¼‰ \u0026raquo; https://www.microsoft.com/en-us/software-download/windows10 é–‹å•Ÿç’°å¢ƒè¨­å®š ç”¨ç³»çµ±ç®¡ç†å“¡","tags":["wsl2","windows"],"title":"å‡ºç™¼å°‹æ‰¾ WSL2 çš„æ—…ç¨‹","uri":"https://blog.10oz.tw/20200728-journey-in-wsl2/","year":"2020"},{"content":"å¶çˆ¾åœ¨ debug çš„æ™‚å€™ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯ä¸€æ•´è¡Œå¯¦åœ¨ä¸å¤ªå¿«æ¨‚å‘€ï¼\næˆ‘éœ€è¦æ’ç‰ˆï¼ï¼è¶•å¿«ç­†è¨˜ä¸€ä¸‹\nä¸€ã€æˆ‘æœ‰ä¸€å€‹ struct stack overflow ä¸Šæœ‰é‡é»ï¼ï¼ func prettyPrint(data interface{}) { jsonByte, err := json.MarshalIndent(data, \u0026quot;\u0026quot;, \u0026quot; \u0026quot;) if err != nil { fmt.Println(\u0026quot;\u0026quot;) } fmt.Printf(\u0026quot;%s\\n\u0026quot;, jsonByte) } äºŒã€æˆ‘æœ‰ä¸€å€‹ json byte func prettyPrintByte(jsonByte []byte) { var buf bytes.Buffer err := json.Indent(\u0026amp;buf, jsonByte, \u0026quot;\u0026quot;, \u0026quot; \u0026quot;) if err == nil { jsonByte = buf.Bytes() } fmt.Printf(\u0026quot;%s\\n\u0026quot;, jsonByte) } åƒè€ƒ https://stackoverflow.com/questions/19038598/how-can-i-pretty-print-json-using-go/42426889\n","id":42,"section":"posts","summary":"å¶çˆ¾åœ¨ debug çš„æ™‚å€™ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯ä¸€æ•´è¡Œå¯¦åœ¨ä¸å¤ªå¿«æ¨‚å‘€ï¼ æˆ‘éœ€è¦æ’ç‰ˆï¼ï¼è¶•å¿«ç­†è¨˜ä¸€ä¸‹ ä¸€ã€æˆ‘æœ‰ä¸€å€‹ struct stack overflow ä¸Šæœ‰é‡é»ï¼ï¼ func prettyPrint(data interface{}) { jsonByte, err := json.MarshalIndent(data, \u0026quot;\u0026quot;, \u0026quot; \u0026quot;) if err != nil { fmt.Println(\u0026quot;\u0026quot;) }","tags":["golang","json","pretty"],"title":"Golang æ¼‚äº®çš„è¼¸å‡º JSON","uri":"https://blog.10oz.tw/20200229-golang-pretty-print/","year":"2020"},{"content":"json æ ¼å¼ç°¡å–®æ˜“è®€ï¼Œç¶“å¸¸å‡ºç¾åœ¨å„ç¨® APIã€è¨­å®šæª”è£¡ï¼Œgolang ä¹Ÿæœ‰å…§å»ºè™•ç†çš„ packageï¼Œå¯«æ‰£çš„æ™‚å€™ä¹Ÿæœƒç¶“å¸¸é‡åˆ°ä»–å–”ï¼Œä¾†ç­†è¨˜ä¸€ä¸‹ï¼ å…§æ–‡æœƒåˆ†æˆå¸¸ç”¨è™•ç†jsonã€è‡ªå®šç¾©è™•ç† jsonå’Œå¤šå±¤è™•ç† ä¸‰å€‹ partï¼Œ GOGO\nä¸€ã€å¸¸ç”¨æ–¹æ³• package main import ( \u0026quot;encoding/json\u0026quot; \u0026quot;fmt\u0026quot; ) // Box æ˜¯å€‹ç®±å­ type Box struct { Name string `json:\u0026quot;name\u0026quot;` Color string `json:\u0026quot;color\u0026quot;` } func main() { jsonStr := ` { \u0026quot;name\u0026quot;: \u0026quot;å–µå–µ\u0026quot;, \u0026quot;color\u0026quot;: \u0026quot;blue\u0026quot; }` box := new(Box) // æŠŠ bytes å¯«é€²å» Box ç‰©ä»¶è£¡é¢ _ = json.Unmarshal([]byte(jsonStr), box) fmt.Printf(\u0026quot;%+v\\n\u0026quot;, box) // {Name:å–µå–µ Color:blue} // å†æŠŠç‰©ä»¶å¯«å›å» binary json box.Color = \u0026quot;é»ƒè‰²çš„\u0026quot; byteJSON, _ := json.Marshal(box) fmt.Printf(\u0026quot;%s\\n\u0026quot;, string(byteJSON)) // {\u0026quot;name\u0026quot;:\u0026quot;å–µå–µ\u0026quot;,\u0026quot;color\u0026quot;:\u0026quot;é»ƒè‰²çš„\u0026quot;} } äºŒã€æ›´å¤šæ–¹æ³• ç•¶æˆ‘å‚»å‚»çš„ä»¥ç‚ºï¼Œjson å°±é€™éº¼çµæŸäº†çš„æ™‚å€™\nç‡ˆæ„£ï¼ï¼ é‚„æœ‰å…©å€‹ interface å¯ä»¥å¯¦ä½œ\n// Unmarshaler is the interface implemented by types // that can unmarshal a JSON description of themselves. // The input can be assumed to be a valid encoding of // a JSON value. UnmarshalJSON must copy the JSON data // if it wishes to retain the data after returning. // // By convention, to approximate the behavior of Unmarshal itself, // Unmarshalers implement UnmarshalJSON([]byte(\u0026quot;null\u0026quot;)) as a no-op. type Unmarshaler interface { UnmarshalJSON([]byte) error } // Marshaler is the interface implemented by types that // can marshal themselves into valid JSON. type Marshaler interface { MarshalJSON() ([]byte, error) } ç•¶ä½ å‚³é€²å»çš„ç‰©ä»¶æœ‰å¯¦ä½œäº†é€™å…©å€‹ function æ™‚ï¼Œä»–æœƒæ”¹ç”¨ç‰©ä»¶è‡ªå·±çš„æ–¹æ³• çœ‹çœ‹ä¸‹é¢çš„ç¯„ä¾‹ä»–å·²ç¶“å®Œå…¨åœ°æŒæ¡äº† json.Marshal çš„è¼¸å‡ºå•¦\n// Box æ˜¯å€‹ç®±å­ type Box struct { Name string `json:\u0026quot;name\u0026quot;` Color string `json:\u0026quot;color\u0026quot;` } // UnmarshalJSON å¯¦ä½œç®±å­çš„ json.Unmarshaler func (b *Box) UnmarshalJSON(byteData []byte) (err error) { // è‡¨æ™‚è®Šæ•¸ï¼Œä¸ç›´æ¥ç”¨ Box ç‰©ä»¶ï¼Œæœƒéè¿´ type _box Box newBox := \u0026amp;struct{ *_box }{ _box: (*_box)(b), } newBox.Color = \u0026quot;æœƒè¢«è“‹æ‰\u0026quot; return json.Unmarshal(byteData, newBox) } // MarshalJSON å¯¦ä½œç®±å­çš„ json.Marshaler func (b *Box) MarshalJSON() (byteData []byte, err error) { // è‡¨æ™‚è®Šæ•¸ï¼Œä¸ç›´æ¥ç”¨ Box ç‰©ä»¶ï¼Œæœƒéè¿´ type _box Box newBox := \u0026amp;struct{ *_box }{ _box: (*_box)(b), } newBox.Name = b.Name + \u0026quot;~~â­ï¸\u0026quot; return json.Marshal(newBox) } func main() { jsonStr := ` { \u0026quot;name\u0026quot;: \u0026quot;å–µå–µ\u0026quot;, \u0026quot;color\u0026quot;: \u0026quot;blue\u0026quot; }` box := new(Box) _ = json.Unmarshal([]byte(jsonStr), box) fmt.Printf(\u0026quot;%+v\\n\u0026quot;, box) // \u0026amp;{Name:å–µå–µ Color:ä½ åªèƒ½æ˜¯é»‘è‰²} box.Color = \u0026quot;é»ƒè‰²çš„\u0026quot; byteJSON, _ := json.Marshal(box) fmt.Printf(\u0026quot;%s\\n\u0026quot;, string(byteJSON)) // {\u0026quot;name\u0026quot;:\u0026quot;å–µå–µ~~â­ï¸\u0026quot;,\u0026quot;color\u0026quot;:\u0026quot;é»ƒè‰²çš„\u0026quot;} } ä¸‰ã€å¤šå±¤çš„æ–¹æ³• å†ä¾†å°±æ˜¯æ··åˆè¡¨æ¼”å•¦ï¼Œè¦æ ¹æ“šä¸åŒçš„æ ¼å¼å›å‚³ä¸åŒçš„ struct é¡å‹\nä¾‹å­æ˜¯ç®±å­è£¡é¢é‚„å¯ä»¥å†è£ç®±å­ï¼Œé‚„å¯ä»¥è£å„ç¨®ä¸åŒçš„ç®±å­ï½\npackage main import ( \u0026quot;encoding/json\u0026quot; \u0026quot;errors\u0026quot; \u0026quot;fmt\u0026quot; ) type iBox interface{} // Box æ˜¯å€‹ç®±å­ type Box struct { Type string `json:\u0026quot;type\u0026quot;` Name string `json:\u0026quot;name\u0026quot;` Color string `json:\u0026quot;color\u0026quot;` Box iBox `json:\u0026quot;box,omitempty\u0026quot;` } // UnmarshalJSON å¯¦ä½œç®±å­çš„ json.Unmarshaler func (b *Box) UnmarshalJSON(byteData []byte) (err error) { // è‡¨æ™‚è®Šæ•¸ï¼Œä¸è¦ç›´æ¥ç”¨ Box ç‰©ä»¶ï¼Œæœƒéè¿´ type _box Box newBox := \u0026amp;struct{ *_box }{ _box: (*_box)(b), } err = json.Unmarshal(byteData, \u0026amp;newBox) if err != nil { return } // ä¸Šé¢è™•ç†å®Œäº†å…¶ä»–è®Šæ•¸ï¼Œå†ä¾†ä¾ç…§ newBox çš„ type ä¾†\u0008åŒ…è£è£¡é¢çš„ box if newBox.Box != nil { switch newBox.Type { case \u0026quot;box\u0026quot;: innerBox := \u0026amp;struct { InnerBox Box `json:\u0026quot;box\u0026quot;` }{} err = json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return } newBox.Box = innerBox.InnerBox case \u0026quot;xbox\u0026quot;: innerBox := \u0026amp;struct { InnerBox xBox `json:\u0026quot;box\u0026quot;` }{} err = json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return } newBox.Box = innerBox.InnerBox } } return } // xBox æ˜¯ç‰¹åˆ¥çš„ç®±å­ type xBox struct { Type string `json:\u0026quot;type\u0026quot;` Name string `json:\u0026quot;xName\u0026quot;` Foo string `json:\u0026quot;foo\u0026quot;` Box iBox `json:\u0026quot;box,omitempty\u0026quot;` } // UnmarshalJSON å¯¦ä½œ xç®±å­çš„ json.Unmarshaler func (b *xBox) UnmarshalJSON(byteData []byte) (err error) { type _box xBox newBox := \u0026amp;struct{ *_box }{ _box: (*_box)(b), } err = json.Unmarshal(byteData, \u0026amp;newBox) if err != nil { return } if newBox.Box != nil { switch newBox.Type { case \u0026quot;box\u0026quot;: innerBox := \u0026amp;struct { InnerBox Box `json:\u0026quot;box\u0026quot;` }{} err = json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return } newBox.Box = innerBox.InnerBox case \u0026quot;xbox\u0026quot;: innerBox := \u0026amp;struct { InnerBox xBox `json:\u0026quot;box\u0026quot;` }{} err = json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return } newBox.Box = innerBox.InnerBox } } return } func getInnerBox(boxType string, byteData []byte) (iBox, error) { switch boxType { case \u0026quot;box\u0026quot;: innerBox := \u0026amp;struct { InnerBox Box `json:\u0026quot;box\u0026quot;` }{} err := json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return nil, err } return innerBox.InnerBox, nil case \u0026quot;xbox\u0026quot;: innerBox := \u0026amp;struct { InnerBox xBox `json:\u0026quot;box\u0026quot;` }{} err := json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return nil, err } return innerBox.InnerBox, nil } return nil, errors.New(\u0026quot;unknown type of box\u0026quot;) } func main() { jsonStr := ` { \u0026quot;type\u0026quot;: \u0026quot;box\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;å–µå–µ\u0026quot;, \u0026quot;color\u0026quot;: \u0026quot;è—è‰²\u0026quot;, \u0026quot;box\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;xbox\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;è£¡é¢çš„\u0026quot;, \u0026quot;foo\u0026quot;: \u0026quot;bar\u0026quot;, \u0026quot;box\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;box\u0026quot;, \u0026quot;color\u0026quot;: \u0026quot;æ›´è£¡é¢çš„\u0026quot;, \u0026quot;box\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;box\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;æœ€è£¡é¢\u0026quot; } } } }` box := new(Box) _ = json.Unmarshal([]byte(jsonStr), box) // ç„¶å¾Œä½ å¯ä»¥é€™æ¨£! // layer 1 å…¨éƒ¨ fmt.Printf(\u0026quot;layer 1:\\n%#v\\n\\n\u0026quot;, box) // layer 2 \u0026quot;name=å–µå–µ\u0026quot; fmt.Printf(\u0026quot;layer 2:\\n%#v\\n\\n\u0026quot;, box.Box.(Box)) // layer 3 \u0026quot;name=è£¡é¢çš„\u0026quot; fmt.Printf(\u0026quot;layer 3:\\n%#v\\n\\n\u0026quot;, box.Box.(Box).Box.(xBox)) // layer 4 \u0026quot;name=\u0026quot;æ›´è£¡é¢çš„\u0026quot; fmt.Printf(\u0026quot;layer 4:\\n%#v\\n\\n\u0026quot;, box.Box.(Box).Box.(xBox).Box) // layer 5 \u0026quot;name=æœ€è£¡é¢\u0026quot; é€™å±¤æ²’æœ‰ boxï¼Œæ‰€ä»¥æ˜¯ nil fmt.Printf(\u0026quot;layer 5:\\n%#v\\n\\n\u0026quot;, box.Box.(Box).Box.(xBox).Box.(Box).Box) } ä¹Ÿå¯ä»¥æŠŠé‡è¤‡çš„éƒ¨ä»½æŠ½å‡ºä¾†ï¼Œä¸ç„¶è±ˆä¸æ˜¯æ¯æ¬¡æ–°å¢æ–°çš„ box æ™‚éƒ½è¦æ”¹ä»¥å‰çš„ codeï¼Ÿ\n// UnmarshalJSON å¯¦ä½œ xç®±å­çš„ json.Unmarshaler func (b *xBox) UnmarshalJSON(byteData []byte) (err error) { type _box xBox newBox := \u0026amp;struct{ *_box }{ _box: (*_box)(b), } err = json.Unmarshal(byteData, \u0026amp;newBox) if err != nil { return } // ä¸Šé¢è™•ç†å®Œäº†å…¶ä»–è®Šæ•¸ï¼Œå†ä¾†ä¾ç…§ newBox çš„ type ä¾†\u0008åŒ…è£è£¡é¢çš„ box if newBox.Box != nil { newBox.Box, err = getInnerBox(newBox.Type, byteData) if err != nil { return } } return } func getInnerBox(boxType string, byteData []byte) (iBox, error) { switch boxType { case \u0026quot;box\u0026quot;: innerBox := \u0026amp;struct { InnerBox Box `json:\u0026quot;box\u0026quot;` }{} err := json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return nil, err } return innerBox.InnerBox, nil case \u0026quot;xbox\u0026quot;: innerBox := \u0026amp;struct { InnerBox xBox `json:\u0026quot;box\u0026quot;` }{} err := json.Unmarshal(byteData, \u0026amp;innerBox) if err != nil { return nil, err } return innerBox.InnerBox, nil } return nil, errors.New(\u0026quot;unknown type of box\u0026quot;) } çµè«– åŸæœ¬å‚»å‚»çš„ä¸æœƒç”¨ Unmarshaler Marshalerï¼Œå¾ˆé›£å»åšåˆ°å¤šå±¤çš„å¯¦ä½œï¼Œç¾åœ¨æœƒæƒ¹QQ\nåƒè€ƒè³‡æ–™ https://medium.com/@xfstart07/go-json-%E7%9A%84%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81-e689522a1f1f\nhttps://github.com/line/line-bot-sdk-go/blob/362880a2e613ce24eb32e1b72cd345370578b6df/linebot/flex_unmarshal.go#L23\n","id":43,"section":"posts","summary":"json æ ¼å¼ç°¡å–®æ˜“è®€ï¼Œç¶“å¸¸å‡ºç¾åœ¨å„ç¨® APIã€è¨­å®šæª”è£¡ï¼Œgolang ä¹Ÿæœ‰å…§å»ºè™•ç†çš„ packageï¼Œå¯«æ‰£çš„æ™‚å€™ä¹Ÿæœƒç¶“å¸¸é‡åˆ°ä»–å–”ï¼Œä¾†ç­†è¨˜ä¸€ä¸‹ï¼ å…§æ–‡æœƒåˆ†æˆ","tags":["golang","json"],"title":"Golang æ€éº¼è™•ç† JSON","uri":"https://blog.10oz.tw/20200228-golang-json-marshal/","year":"2020"},{"content":"æ­¥é©Ÿæ•™å­¸ ä¸€ã€é–‹å§‹ä¹‹å‰ ç›®æ¨™æ˜¯ç”¨ hugo å”åŠ©æˆ‘å€‘ä½¿ç”¨ markdown è¼•é¬†è£½é€ éœæ…‹ç¶²é ï¼Œå†æŠŠé€™å€‹éœæ…‹ç¶²é åˆ©ç”¨ Github Page éƒ¨ç½²å‡ºå»ï¼\næ‰€ä»¥æˆ‘å€‘éœ€è¦:\nä¸€äººä»½çš„ github å¸³è™Ÿ å®‰è£ hugo é»æˆ‘çœ‹æ•™å­¸ æŒ‘é¸å–œæ­¡çš„ hugo æ¨¡æ¿ é»æˆ‘åƒè§€ $ hugo version Hugo Static Site Generator v0.62.2/extended darwin/amd64 BuildDate: unknown äºŒã€é–‹è·‘å›‰ é–‹å•Ÿä¸€å€‹æ–°çš„ hugo å°ˆæ¡ˆï¼Œé€™é‚Šçš„ xiaoxiao å¯ä»¥æ›æˆä½ å–œæ­¡çš„å°ˆæ¡ˆåå­—\n$ hugo new site xiaoxiao $ cd xiaoxiao æœƒçœ‹åˆ°ç›®éŒ„é•·é€™æ¨£:\nâ”œâ”€â”€ archetypes â”‚Â â””â”€â”€ default.md # ç”¢ç”Ÿæ–°æ–‡ç« æ™‚çš„æ¨¡æ¿ â”œâ”€â”€ config.toml # æœ€ä¸»è¦çš„è¨­å®šæª”æ¡ˆ â”œâ”€â”€ content # Markdown çš„æ–‡ç« åœ¨é€™é‚Š â”œâ”€â”€ data â”œâ”€â”€ layouts â”œâ”€â”€ resources â”‚Â â””â”€â”€ _gen â”œâ”€â”€ static â””â”€â”€ themes # å¥—ç”¨çš„ä¸»é¡ŒåŒ…å€‘ â””â”€â”€ hugo-theme-m10c æ¥è‘—æŒ‘é¸ä¸€å€‹æ¼‚äº®çš„ hugo æ¨¡æ¿ä¾†ä¸‹è¼‰ï¼Œæˆ‘ç”¨äººå®¶æ•™å­¸ç¤ºç¯„çš„æ¨¡æ¿\n$ git clone https://github.com/vaga/hugo-theme-m10c.git themes/hugo-theme-m10c å†ä¾†ï¼Œé–‹å•Ÿæ–‡å­—ç·¨è¼¯å™¨ä¿®æ”¹ config.tomlï¼Œ æœ€ä¸»è¦æ˜¯ç¬¬å…­è¡Œçš„ theme å’Œç¬¬å››è¡Œçš„ publishDir = \u0026quot;docs\u0026quot;ï¼Œdocs æ˜¯ GithubPage è¦å®šçš„å–”ä¸èƒ½æ”¹\næˆ‘çš„æ”¹å®Œé•·é€™æ¨£:\nbaseURL = \u0026quot;https://xiaoxiaosn.github.io\u0026quot; languageCode = \u0026quot;en-us\u0026quot; title = \u0026quot;XiaoXiao Notes\u0026quot; publishDir = \u0026quot;docs\u0026quot; theme = \u0026quot;hugo-theme-m10c\u0026quot; paginate = 10 [params] author = \u0026quot;Xiao Xiao\u0026quot; description = \u0026quot;XiaoXiao çš„ç­†è¨˜æ›¸\u0026quot; è·‘è·‘çœ‹ï¼Œæ˜¯ä¸æ˜¯èƒ½çœ‹åˆ°é é¢å•¦? æœå‹™æœƒåœ¨ http://localhost:1313\n$ hugo server -D # -D è¡¨ç¤ºæˆ‘å€‘æƒ³çœ‹åˆ°è‰ç¨¿æ–‡ç« (draft) çœ‹åˆ°æœ‰å®‰æå°±å°äº†! ä¸‰ã€ä¾†å¯«æ–‡ç« r é€™é‚Šçš„ make-a-hugo-blog å¯ä»¥æ›æˆä½ æƒ³è¦çš„æ–‡ç« åå­—ï¼Œç­‰ç­‰æœƒè¢«ç”¨åœ¨ç¶²å€ä¸Šå–”\n$ hugo new make-a-hugo-blog é€™å€‹æŒ‡ä»¤æœƒå¹«ä½ åœ¨ content ç›®éŒ„ä¸‹æ–°å¢ä¸€å€‹ make-a-hugo-blog.md æª”æ¡ˆï¼Œ æ¥è‘—æˆ‘å€‘å¯«é»å…§å®¹ä¸Šå»ï¼Œåƒé€™æ¨£: è¦æ³¨æ„çš„æ˜¯ draft: true é€™è¡Œåœ¨æ­£å¼ä¸Šç·šçš„æ™‚å€™è¨˜å¾—åˆªæ‰å–”~\n--- title: \u0026quot;è£½é€ ä¸€å€‹ hugo éƒ¨è½æ ¼\u0026quot; date: 2020-01-24T23:02:16+08:00 tags: [\u0026quot;hugo\u0026quot;] --- ## é–‹å§‹ä¹‹å‰ ç›®æ¨™æ˜¯ç”¨ hugo å”åŠ©æˆ‘å€‘ä½¿ç”¨ markdown è¼•é¬†è£½é€ éœæ…‹ç¶²é ï¼Œå†æŠŠé€™å€‹éœæ…‹ç¶²é åˆ©ç”¨ Github Page éƒ¨ç½²å‡ºå»ï¼ æ‰€ä»¥æˆ‘å€‘éœ€è¦: 1. ä¸€äººä»½çš„ github å¸³è™Ÿ 2. å®‰è£ hugo [é»æˆ‘çœ‹æ•™å­¸](https://gohugo.io/getting-started/installing#quick-install) 3. æŒ‘é¸å–œæ­¡çš„ hugo æ¨¡æ¿ [é»æˆ‘åƒè§€](https://themes.gohugo.io/tags/blog/) è¼¸å…¥ hugo æŒ‡ä»¤ï¼Œè®“ä»–è·‘ç·¨è­¯å›‰\n$ hugo å››ã€ä¾†éƒ¨ç½²r æ‰“é–‹ä½ çš„ github æŒ‰ä¸‹ new ä¾†æ–°å¢ä¸€å€‹ repo\næ¥ä¸‹ä¾†æœƒé€²åˆ°é€™å€‹ç•«é¢ï¼Œå…ˆä¸æ€¥è‘—è·Ÿä»–æ“ä½œ æˆ‘å€‘è¦å…ˆåˆ° config.toml ä¿®æ”¹åŸŸå é€™é‚Šçš„è¦å‰‡æ˜¯ https://å¸³è™Ÿ.github.io/å°ˆæ¡ˆ\n# ä¿®æ”¹ config.toml çš„é€™ä¸€è¡Œ baseURL = \u0026quot;https://xiaoxiaosn.github.io/XiaoXiaoBlog\u0026quot; ç„¶å¾Œä¸‹æŒ‡ä»¤é‡æ–°ç”¢ç”Ÿä¸€ä¸‹\n$ hugo å›åˆ°å°ˆæ¡ˆï¼Œæ˜¯æ™‚å€™è©²è®“ git åŠ å…¥äº† ç¬¬äºŒè¡Œé€™é‚Šè¨˜å¾—æ›æˆä½ è‡ªå·±çš„ github å°ˆæ¡ˆå–”\n$ git init $ git remote add origin git@github.com:XiaoXiaoSN/XiaoXiaoBlog.git $ git add --all $ git commit -m \u0026quot;init my hugo blog\u0026quot; $ git push origin master åœ¨ add çš„æ™‚å€™å‡ºç¾ warn ä¸æ“”å¿ƒï¼Œä»–åªæ˜¯æé†’ä½ åœ¨é€™å€‹ git å°ˆæ¡ˆä¸‹é‚„æœ‰åŒ…å«äº†å¦ä¸€å€‹ git å°ˆæ¡ˆ (themeè£¡é¢é‚£å€‹) æ›´æ–°ä¸Šå»å¾Œï¼Œæˆ‘å€‘å›åˆ° githubï¼Œé¸æ“‡ Setting å¾Œå¾€ä¸‹æ‹‰æ‰¾åˆ° Github Page\né¸é‚£å€‹ master branch /docs folder\näº”ã€æ”¶å‰²å›‰~~ ç­‰å¾… 10 ç§’ï¼Œç„¶å¾Œå¸¶è‘—ä¸€é¡†èª æ‘¯çš„æ–°æŠŠé€£çµçµ¦æŒ‰ä¸‹å» XD https://å¸³è™Ÿ.github.io/å°ˆæ¡ˆ\né¸ä¿® - ä½¿ç”¨è‡ªå·±çš„ domain å›åˆ°å‰é¢éƒ¨ç½²æ™‚å€™çš„é é¢ï¼ŒSetting å¾€ä¸‹æ»‘åˆ° GitHub Pages å¡«å¯« Custom domain çš„é€™å€‹æ¬„ä½\né€™è£¡æˆ‘å·²ç¶“æœ‰ domainï¼Œç„¶å¾Œæ˜¯äº¤çµ¦ cloudflare ç®¡ç†ï¼Œå› æ­¤æ¥ä¸‹ä¾†æœƒä»¥æ­¤ä»‹ç´¹ é–‹å•Ÿ cloudflare é¸åˆ° DNS å¾Œï¼Œè¨­å®š CNAME æŠŠä½ çš„ç¶²å€å°å¼•åˆ° githubPage æ¥ä¸‹ä¾†åˆ° Page Rules æ–°å¢ä¸€ç­†å¼·åˆ¶ä½¿ç”¨ https çš„é¸é … é€™æ¨£å°±è¨­å®šå¥½å›‰ï½ è¨˜å¾—è¦å›åˆ°å°ˆæ¡ˆçš„ config.toml è¨­å®šæ–°çš„ url å–”\nbaseURL = \u0026quot;https://blog.10oz.tw\u0026quot; è£œå……è¨­å®š md æ›è¡Œæ ¼å¼ ç”±æ–¼å¾ˆå¤šäººå¾ hackmd æˆ–æ˜¯å…¶ä»–çš„å¹³å°è½‰éä¾† ç™¼ç¾ä»–å€‘åŸä¾†çš„ md è²¼éä¾†æ›è¡Œç¬¦è™Ÿæ²’æœ‰è¢«ä¿ç•™åœ¨ html ä¸Šï¼Œä¹Ÿå°±æ˜¯å…©è¡Œé€£èµ·ä¾†å•¦\n[blackfriday] extensions = [\u0026quot;hardLineBreak\u0026quot;] References hugo\nhttps://gohugo.io/documentation/ https://siddharam.com.tw/post/20190418/ github page\nhttps://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-docs-folder-on-master-branch https://blog.cloudflare.com/secure-and-fast-github-pages-with-cloudflare/ ","id":44,"section":"posts","summary":"æ­¥é©Ÿæ•™å­¸ ä¸€ã€é–‹å§‹ä¹‹å‰ ç›®æ¨™æ˜¯ç”¨ hugo å”åŠ©æˆ‘å€‘ä½¿ç”¨ markdown è¼•é¬†è£½é€ éœæ…‹ç¶²é ï¼Œå†æŠŠé€™å€‹éœæ…‹ç¶²é åˆ©ç”¨ Github Page éƒ¨ç½²å‡ºå»ï¼ æ‰€ä»¥æˆ‘å€‘éœ€è¦: ä¸€äººä»½çš„ github å¸³è™Ÿ å®‰è£ hugo é»æˆ‘çœ‹æ•™å­¸","tags":["hugo"],"title":"è£½é€ ä¸€å€‹ hugo éƒ¨è½æ ¼","uri":"https://blog.10oz.tw/20200124-make-a-hugo-blog/","year":"2020"},{"content":" ** 2019.08 æ›´æ–°** https://www.php.net/manual/en/mongodb.installation.homebrew.php mac php72 è«‹ä½¿ç”¨ pecl install mongodb å®‰è£ mongodb driver å› ç‚º mongodb, xdebug å¾ homebrew è¢«ç§»é™¤äº†\n[time=Thu, Aug 15, 2019 7:59 PM]\nå•é¡Œæè¿° æƒ³åœ¨ Laravel ç”¨ MongoDB\ncomposer require jenssegers/mongodb éŒ¯èª¤ï¼š\nthe requested PHP extension mongodb is missing from your system. =\u0026gt; æ²’æœ‰è£ php çš„æ“´å±•\nè§£æ±ºæ–¹æ¡ˆ å…ˆä¾†å€‹æ‚²åŠ‡ï¼Œ homebrew æ‹¿æ‰ php-mongodb çš„æ“´å±•äº†QQ\nåªå¥½å»è£äººå®¶çš„ï¼Œæˆ‘çš„ php ç‰ˆæœ¬æ˜¯ 7.1 æ‰€ä»¥è£ php71-mongodb å¿˜è¨˜ç‰ˆæœ¬çš„è©±å¯ä»¥ç”¨ php --version æŸ¥çœ‹\nbrew tap kyslik/php brew install phpxx-mongodb {xx = 71,72} è£å®Œæƒ¹ï¼ ä½†æ˜¯ç•¶æˆ‘è¼¸å…¥ php -i æª¢æŸ¥çš„æ™‚å€™ dyld: Library not loaded: /usr/local/opt/readline/lib/libreadline.7.dylib\nå“å‘€QQ ä¾†å» Google çœ‹çœ‹\nln -s /usr/local/opt/readline/lib/libreadline.8.0.dylib /usr/local/opt/readline/lib/libreadline.7.dylib ä¹‹å¾Œå¯ä»¥è¼¸å…¥ä¾†æª¢æŸ¥æœ‰æ²’æœ‰æˆåŠŸ\nÂ» php -m | grep mongodb mongodb link æˆ‘æ‰‹ä¸Šæœ‰çš„ç‰ˆæœ¬éå»ä¹‹å¾Œï¼Œä¸€åˆ‡é †åˆ©å‘¢ï¼ï¼\ncomposer require jenssegers/mongodb å¾Œè¨˜ - å°è¸©é›· è¦æ˜¯php -i | grep mongodbä»€éº¼éƒ½æ²’æœ‰çš„è©±å¯èƒ½æ˜¯ç•¶åˆåœ¨å®‰è£phpçš„æ™‚å€™æ²’æœ‰å®‰è£å®Œå…¨\nç§»é™¤phpé‡è£ä¸€æ¬¡ ç„¶å¾Œ brew link phpxx ä½ çš„ /usr/local/æœ‰å¯èƒ½æœƒæ²’æœ‰sbiné€™å€‹è³‡æ–™å¤¾æ‰€ä»¥å°±mkdir sbinä»– ç„¶å¾ŒæˆåŠŸé€£çµä»–æ‡‰è©²å°±å¯ä»¥æƒ¹ â€»å°ç§˜è¨£ï¼šä½ å¯ä»¥è·‘ brew doctor å«é†«ç”Ÿå¹«ä½ è¨ºæ–·ï½ è·‘èµ·ä¾†é‡åˆ°\nSymfony\\Component\\Debug\\Exception\\FatalThrowableError : Call to a member function prepare() on null å¯ä»¥æŠŠåŸæœ¬ extend çš„ Model æ›æˆ \\Jenssegers\\Mongodb\\Eloquent\\Model\n","id":45,"section":"posts","summary":"** 2019.08 æ›´æ–°** https://www.php.net/manual/en/mongodb.installation.homebrew.php mac php72 è«‹ä½¿ç”¨ pecl install mongodb å®‰è£ mongodb driver å› ç‚º mongodb, xdebug å¾ homebrew è¢«ç§»é™¤äº† [time=Thu, Aug 15, 2019 7:59 PM] å•é¡Œæè¿° æƒ³åœ¨ Laravel ç”¨ MongoDB composer require jenssegers/mongodb éŒ¯èª¤ï¼š the requested PHP extension mongodb is missing from your system. =\u0026gt; æ²’æœ‰è£ php çš„æ“´å±• è§£æ±º","tags":["php","laravel","mongodb"],"title":"ç­†è¨˜ Install php MongoDB driver on MacOS","uri":"https://blog.10oz.tw/20190815-install-php-mongodb-driver-on-macos/","year":"2019"},{"content":" @elasticsearch version 6.8\nSTRUCTURE å¯ä»¥é€™æ¨£æƒ³åƒ\nRelational DB -\u0026gt; Databases -\u0026gt; Tables -\u0026gt; Rows -\u0026gt; Columns\nElasticsearch -\u0026gt; Indices -\u0026gt; Types -\u0026gt; Documents -\u0026gt; Fields\nä¸éå•Šï¼Œtype è¦è¢«äººå®¶ä¸Ÿæ‰äº†ï¼ˆç¾åœ¨æ˜¯é™åˆ¶åªèƒ½æœ‰ä¸€å€‹ typeï¼Œç­‰åŒæ–¼é€™å±¤æ²’æ„ç¾©ï¼‰\nIndices created in 6.x only allow a single-type per index. 6.x å¾Œå»ºè­° type ä½¿ç”¨ _docï¼Œ\nç„¶å¾Œ 8.x: Specifying types in requests is no longer supported.\næˆ‘ç™¼ç¾æˆ‘ç™¼ç¾ çœ‹ä¸€çœ¼ reindex å°±å¾ˆæ¸…æ¥šä»–æ”¹äº†ä»€éº¼äº†å–”ï¼\nPOST _reindex { \u0026quot;source\u0026quot;: { \u0026quot;index\u0026quot;: \u0026quot;twitter\u0026quot; }, \u0026quot;dest\u0026quot;: { \u0026quot;index\u0026quot;: \u0026quot;new_twitter\u0026quot; }, \u0026quot;script\u0026quot;: { \u0026quot;source\u0026quot;: \u0026quot;\u0026quot;\u0026quot; ctx._source.type = ctx._type; ctx._id = ctx._type + '-' + ctx._id; ctx._type = '_doc'; \u0026quot;\u0026quot;\u0026quot; } } é€™æ˜¯ä¸€å€‹æ–°å¢ç¯„ä¾‹ï¼Œä¾ç…§ /Index/Type/ID æ–°å¢ä¸€ç­† Document\nPUT /employee/_doc/1 { \u0026quot;first_name\u0026quot; : \u0026quot;John\u0026quot;, \u0026quot;last_name\u0026quot; : \u0026quot;Smith\u0026quot;, \u0026quot;age\u0026quot; : 25, \u0026quot;about\u0026quot; : \u0026quot;I love to go rock climbing\u0026quot;, \u0026quot;interests\u0026quot;: [\u0026quot;sports\u0026quot;, \u0026quot;music\u0026quot;] } USAGE åˆ—å‡ºæ‰€æœ‰ index\nGET /_cat/indices?v æ‰€æœ‰åœ¨ index ä¸­çš„ type\nGET /_mapping?pretty=true Search - ES DSL Query DSL(Domain Specific Language)\næ¶æ§‹ä»‹ç´¹ ä¾†è‡ªé€™é‚Š\nGET /_search { \u0026quot;query\u0026quot;: { \u0026quot;bool\u0026quot;: { \u0026quot;must\u0026quot;: [ { \u0026quot;match\u0026quot;: { \u0026quot;title\u0026quot;: \u0026quot;Search\u0026quot; }}, { \u0026quot;match\u0026quot;: { \u0026quot;content\u0026quot;: \u0026quot;Elasticsearch\u0026quot; }} ], \u0026quot;filter\u0026quot;: [ { \u0026quot;term\u0026quot;: { \u0026quot;status\u0026quot;: \u0026quot;published\u0026quot; }}, { \u0026quot;range\u0026quot;: { \u0026quot;publish_date\u0026quot;: { \u0026quot;gte\u0026quot;: \u0026quot;2015-01-01\u0026quot; }}} ] } } } åœ¨ bool è£¡é¢ï¼Œ must match è¡¨ç¤ºæª¢ç´¢çš„è©•åˆ†é …ç›®\nè€Œ filter ä¸­çš„å…©å€‹ term å’Œ range è¡¨ç¤ºéæ¿¾æ¢ä»¶ï¼Œä¸æœƒå½±éŸ¿åˆ°è©•åˆ†\nç”± index ä¾†æœå°‹\nGET users/_search { \u0026quot;query\u0026quot;: { \u0026quot;match_all\u0026quot;: { } } } å¤šå€‹ index æœå°‹æ˜¯é€™æ¨£çš„ GET /kimchy,elasticsearch/_search?q=tag:wow MatchAll GET /_search { \u0026quot;query\u0026quot;: { \u0026quot;match_all\u0026quot;: {} } } match_none æ˜¯ä»–çš„ç›¸å\nRollover Index å¯åƒè€ƒ æ–‡ä»¶ã€‚ç•¶æª”æ¡ˆå¤§æ™‚ï¼Œå¯ä»¥åˆ©ç”¨ rollover index ä¾†åˆ†æª”æ¡ˆï¼Œä¸¦ä¸”åˆ©ç”¨ alias çµ±ä¸€æœå°‹\nPUT /logs-000001 { \u0026quot;aliases\u0026quot;: { \u0026quot;logs_write\u0026quot;: {} } } # Add \u0026gt; 1000 documents to logs-000001 POST /logs_write/_rollover { \u0026quot;conditions\u0026quot;: { \u0026quot;max_age\u0026quot;: \u0026quot;7d\u0026quot;, \u0026quot;max_docs\u0026quot;: 1000, \u0026quot;max_size\u0026quot;: \u0026quot;5gb\u0026quot; } } ä¹Ÿå¯ä»¥ä½¿ç”¨æ—¥æœŸä¾†åš\n# PUT /\u0026lt;logs-{now/d}-1\u0026gt; with URI encoding: PUT /%3Clogs-%7Bnow%2Fd%7D-1%3E { \u0026quot;aliases\u0026quot;: { \u0026quot;logs_write\u0026quot;: {} } } Mapping Mapping å¯ä»¥è¨­å®šé€™å€‹ Index è£¡é¢çš„ Fields çš„ type\nref\nå¦‚æœä½ æ˜¯ 7.x è¨˜å¾—çœ‹åˆ° _doc å°±çµ¦å®ƒæ‹¿æ‰\nPUT twitter {} PUT twitter/_mapping/_doc { \u0026quot;properties\u0026quot;: { \u0026quot;email\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;keyword\u0026quot; } } } GET /twitter/_mapping/_doc ILM (Index Lifecycle Management) rollover çš„æ¢ä»¶æ˜¯ç•¶ä½  call API çš„æ™‚å€™æ‰æœƒæª¢æŸ¥ï¼Œä¹Ÿå°±æ˜¯èªªä»–ä¸æœƒè‡ªå‹•ç”Ÿæ•ˆ è€Œ ILM çš„åŠŸèƒ½å°±æ˜¯è®“ elasticsearch æ’ç¨‹å¹«ä½ åš rollover\nå…ˆé–‹ä¸€å€‹ policy PUT _ilm/policy/mylogs_policy { \u0026quot;policy\u0026quot;: { \u0026quot;phases\u0026quot;: { \u0026quot;hot\u0026quot;: { \u0026quot;actions\u0026quot;: { \u0026quot;rollover\u0026quot;: { \u0026quot;max_docs\u0026quot;: \u0026quot;4\u0026quot;, \u0026quot;max_age\u0026quot;: \u0026quot;30d\u0026quot;, \u0026quot;max_size\u0026quot;: \u0026quot;5gb\u0026quot; } } } } } } é–‹ä¸€å€‹ template ç¶å®šé€™å€‹ policy PUT /_template/mylogs_template { \u0026quot;index_patterns\u0026quot;: [\u0026quot;mylogs-*\u0026quot;], \u0026quot;settings\u0026quot;: { \u0026quot;number_of_shards\u0026quot;: 1, \u0026quot;number_of_replicas\u0026quot;: 1, \u0026quot;index.lifecycle.name\u0026quot;: \u0026quot;mylogs_policy\u0026quot;, \u0026quot;index.lifecycle.rollover_alias\u0026quot;: \u0026quot;mylogs\u0026quot; } } å»ºç«‹ alias # PUT /\u0026lt;mylogs-000001\u0026gt; PUT %3Cmylogs-000001%3E { \u0026quot;aliases\u0026quot;:{ \u0026quot;mylogs\u0026quot;: { \u0026quot;is_write_index\u0026quot;:true } } } ç•¶é€™å€‹ alias æœƒè¢«ç”¨æ–¼å¯«å…¥æ™‚ï¼Œè¦å°‡ is_write_index è¨­å®šæˆ trueï¼ŒåŒæ™‚é–“ is_write_index=true åªæœƒæœ‰ä¸€ç­†\nä¸€ç›´æ‰“è³‡æ–™é€²å» mylogsï¼Œä»–æœƒä¾ç…§ä¸Šé¢çš„è¨­å®š rollover å¯é€éåˆ¥åæŸ¥è©¢æ‰€æœ‰ index\nPOST /prod_vpn_event/_refresh GET /prod_vpn_event/_search { \u0026quot;query\u0026quot;: { \u0026quot;match_all\u0026quot;: {} } } REFERENCE https://es.xiaoleilu.com https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-dsl.html ILM https://elasticsearch.cn/article/6358\n","id":46,"section":"posts","summary":"@elasticsearch version 6.8 STRUCTURE å¯ä»¥é€™æ¨£æƒ³åƒ Relational DB -\u0026gt; Databases -\u0026gt; Tables -\u0026gt; Rows -\u0026gt; Columns Elasticsearch -\u0026gt; Indices -\u0026gt; Types -\u0026gt; Documents -\u0026gt; Fields ä¸éå•Šï¼Œtype è¦è¢«äººå®¶ä¸Ÿæ‰äº†ï¼ˆç¾åœ¨æ˜¯é™åˆ¶åªèƒ½æœ‰ä¸€å€‹ typeï¼Œç­‰åŒæ–¼é€™å±¤æ²’æ„ç¾©ï¼‰ Indices","tags":["es","elasticsearch","ilm"],"title":"Learning Elasticsearch","uri":"https://blog.10oz.tw/20190814-learning-elasticsearch/","year":"2019"},{"content":" laravel version: 5.8 [time=Wed, Jul 3, 2019 1:27 PM]\né–‹å§‹ä¹‹å‰ test çš„è¨­å®šæª”åœ¨ ./phpunit.xml ï¼Œ\n\u0026lt;!-- phpunit.xml --\u0026gt; \u0026lt;phpunit\u0026gt; \u0026lt;php\u0026gt; \u0026lt;!-- laravel ç’°å¢ƒè¨­å®šæª”æ¡ˆä½¿ç”¨ .emv.testing --\u0026gt; \u0026lt;server name=\u0026quot;APP_ENV\u0026quot; value=\u0026quot;testing\u0026quot;/\u0026gt; \u0026lt;!-- æ¸¬è©¦ç’°å¢ƒçš„è³‡æ–™åº«é€£ç·šè¨­å®šï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ sqlite --\u0026gt; \u0026lt;server name=\u0026quot;DB_CONNECTION\u0026quot; value=\u0026quot;sqlite_for_testing\u0026quot;/\u0026gt; \u0026lt;env name=\u0026quot;DB_DATABASE\u0026quot; value=\u0026quot;:memory:\u0026quot;/\u0026gt; \u0026lt;/php\u0026gt; \u0026lt;/phpunit\u0026gt; php ä¹Ÿè¦åŠ åœ¨ Config/dataset.php\n/* Config/dataset.php */ \u0026lt;?php 'connections' =\u0026gt; [ // ...other db connection configuration // ç‚ºäº†æ–¹ä¾¿æ¸¬è©¦ï¼Œä½¿ç”¨ memory sqlite åšç‚ºæˆ‘å€‘çš„è³‡æ–™åº« 'sqlite_for_testing' =\u0026gt; [ 'driver' =\u0026gt; 'sqlite', 'database' =\u0026gt; ':memory:', 'prefix' =\u0026gt; '', 'foreign_key_constraints' =\u0026gt; true, ], ] ç¢ºèªå¥½è¨­å®šå¾Œï¼Œæˆ‘å€‘åŸ·è¡Œèµ·ä¾†\n# -v ä»£è¡¨ --verbose é¡¯ç¤ºæ›´è©³ç´°çš„è³‡è¨Š ./vendor/bin/phpunit -v --debug å¯«å€‹æ¸¬è©¦ä¾†è·‘è·‘ æœ€è¿‘è¦é‡æ§‹ä¸€å€‹ functionï¼Œè¦ºå¾—è£¡é¢çš„é‚è¼¯æœ‰é»è¤‡é›œï¼Œæ±ºå®šå…ˆå¯«å€‹æ¸¬è©¦å†ä¾†é–‹å·¥\né€™æ¬¡çš„ç›®æ¨™æ˜¯ app/Http/Services/ScheduleService.php è£¡é¢çš„ checkScheduleAvailable é€™å€‹ function\næ‰€ä»¥æˆ‘å€‘å…ˆä¾†æº–å‚™æ¸¬è©¦æª”æ¡ˆ:\nphp artisan make:test Schedule/availableTest --unit ç”¢ç”Ÿäº†ä¸€å€‹ tests/Unit/Schedule/availableTest.php ï¼Œä¾†çœ‹çœ‹è£¡é¢æœ‰ä»€éº¼å§\n\u0026lt;?php // test é–‹é ­çš„ function æœƒè¢«æ¸¬è©¦ public function testExample() { // assertTrue æŒ‡å®šçµæœè¦æ˜¯ true, // å› ç‚º (true === true) ï¼Œæ‰€ä»¥æˆ‘å€‘å°‡æœƒé€šéæ¸¬è©¦ $this-\u0026gt;assertTrue(true); } è£½é€ å‡è³‡æ–™ ç‚ºäº†æ¸¬è©¦ function èƒ½å¤ é †åˆ©å›å‚³ï¼Œç¸½è¦çµ¦é»è³‡æ–™æ‰èƒ½æ¸¬å§?\n\u0026lt;?php class availableTest extends TestCase { // è³‡æ–™åº«æ¯æ¬¡ç”¨å®Œè¦å¾©åŸï¼Œæ‰ä¸æœƒè®“æ¸¬è©¦è³‡æ–™ä¸€ç›´ç•™åœ¨è³‡æ–™åº«ä¸­ use RefreshDatabase; public function testQueryUnAvailable(): void { // inject some fake data into database factory(User::class)-\u0026gt;create(); factory(Project::class)-\u0026gt;create(); factory(Pole::class, 5)-\u0026gt;create(); $ad = factory(Ad::class)-\u0026gt;make([ 'ad_status_id' =\u0026gt; 4, // ad_status_id: 4 is depolyed 'ad_types_id' =\u0026gt; 1, // ad_types_id: 1 is slideshow ]); factory(Ad::class)-\u0026gt;create($ad-\u0026gt;toArray()); // æ¸¬è©¦ä¸€æ³¢ï¼Œè³‡æ–™æ˜¯ä¸æ˜¯æœ‰å¥½å¥½çš„å¡é€²è³‡æ–™åº«äº† $this-\u0026gt;assertCount(5, Pole::all()); $this-\u0026gt;assertDatabaseHas('ads', [ 'ad_status_id' =\u0026gt; 4, 'ad_types_id' =\u0026gt; 1, ]); } } Ref https://blog.goodjack.tw/2018/07/laravel-phpunit.html https://gist.github.com/jaceju/c415c1b42daf4c589f2a https://laravel.com/docs/5.8/database-testing\n","id":47,"section":"posts","summary":"laravel version: 5.8 [time=Wed, Jul 3, 2019 1:27 PM] é–‹å§‹ä¹‹å‰ test çš„è¨­å®šæª”åœ¨ ./phpunit.xml ï¼Œ \u0026lt;!-- phpunit.xml --\u0026gt; \u0026lt;phpunit\u0026gt; \u0026lt;php\u0026gt; \u0026lt;!-- laravel ç’°å¢ƒè¨­å®šæª”æ¡ˆä½¿ç”¨ .emv.testing --\u0026gt; \u0026lt;server name=\u0026quot;APP_ENV\u0026quot; value=\u0026quot;testing\u0026quot;/\u0026gt; \u0026lt;!-- æ¸¬è©¦ç’°å¢ƒçš„è³‡æ–™åº«é€£ç·šè¨­å®šï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ sqlite --\u0026gt; \u0026lt;server name=\u0026quot;DB_CONNECTION\u0026quot; value=\u0026quot;sqlite_for_testing\u0026quot;/\u0026gt; \u0026lt;env name=\u0026quot;DB_DATABASE\u0026quot; value=\u0026quot;:memory:\u0026quot;/\u0026gt; \u0026lt;/php\u0026gt; \u0026lt;/phpunit\u0026gt;","tags":["php","laravel","test"],"title":"ç­†è¨˜ laravel test - æˆ‘å€‘ä¹Ÿä¾†å¯«æ¸¬è©¦","uri":"https://blog.10oz.tw/20190703-laravel-testing/","year":"2019"},{"content":" Laravel 5.8\n$kernel = $app-\u0026gt;make(Illuminate\\Contracts\\Console\\Kernel::class); $output = new Symfony\\Component\\Console\\Output\\ConsoleOutput; $output-\u0026gt;getFormatter() -\u0026gt;setStyle('error', new \\Symfony\\Component\\Console\\Formatter\\OutputFormatterStyle('yellow')); $status = $kernel-\u0026gt;handle( $input = new Symfony\\Component\\Console\\Input\\ArgvInput, $output ); ä¿®æ”¹çš„è©±åœ¨ line:37 å¯ä»¥å¸¶ä¸‰ç¨®åƒæ•¸\npublic function __construct( string $foreground = null, string $background = null, array $options = []){ /****/ } ä¸‰ç¨®åƒæ•¸å¯ä»¥åƒè€ƒ\nprivate static $availableForegroundColors = [ 'black' =\u0026gt; ['set' =\u0026gt; 30, 'unset' =\u0026gt; 39], 'red' =\u0026gt; ['set' =\u0026gt; 31, 'unset' =\u0026gt; 39], 'green' =\u0026gt; ['set' =\u0026gt; 32, 'unset' =\u0026gt; 39], 'yellow' =\u0026gt; ['set' =\u0026gt; 33, 'unset' =\u0026gt; 39], 'blue' =\u0026gt; ['set' =\u0026gt; 34, 'unset' =\u0026gt; 39], 'magenta' =\u0026gt; ['set' =\u0026gt; 35, 'unset' =\u0026gt; 39], 'cyan' =\u0026gt; ['set' =\u0026gt; 36, 'unset' =\u0026gt; 39], 'white' =\u0026gt; ['set' =\u0026gt; 37, 'unset' =\u0026gt; 39], 'default' =\u0026gt; ['set' =\u0026gt; 39, 'unset' =\u0026gt; 39], ]; private static $availableBackgroundColors = [ 'black' =\u0026gt; ['set' =\u0026gt; 40, 'unset' =\u0026gt; 49], 'red' =\u0026gt; ['set' =\u0026gt; 41, 'unset' =\u0026gt; 49], 'green' =\u0026gt; ['set' =\u0026gt; 42, 'unset' =\u0026gt; 49], 'yellow' =\u0026gt; ['set' =\u0026gt; 43, 'unset' =\u0026gt; 49], 'blue' =\u0026gt; ['set' =\u0026gt; 44, 'unset' =\u0026gt; 49], 'magenta' =\u0026gt; ['set' =\u0026gt; 45, 'unset' =\u0026gt; 49], 'cyan' =\u0026gt; ['set' =\u0026gt; 46, 'unset' =\u0026gt; 49], 'white' =\u0026gt; ['set' =\u0026gt; 47, 'unset' =\u0026gt; 49], 'default' =\u0026gt; ['set' =\u0026gt; 49, 'unset' =\u0026gt; 49], ]; private static $availableOptions = [ 'bold' =\u0026gt; ['set' =\u0026gt; 1, 'unset' =\u0026gt; 22], 'underscore' =\u0026gt; ['set' =\u0026gt; 4, 'unset' =\u0026gt; 24], 'blink' =\u0026gt; ['set' =\u0026gt; 5, 'unset' =\u0026gt; 25], 'reverse' =\u0026gt; ['set' =\u0026gt; 7, 'unset' =\u0026gt; 27], 'conceal' =\u0026gt; ['set' =\u0026gt; 8, 'unset' =\u0026gt; 28], ]; ","id":48,"section":"posts","summary":"Laravel 5.8 $kernel = $app-\u0026gt;make(Illuminate\\Contracts\\Console\\Kernel::class); $output = new Symfony\\Component\\Console\\Output\\ConsoleOutput; $output-\u0026gt;getFormatter() -\u0026gt;setStyle('error', new \\Symfony\\Component\\Console\\Formatter\\OutputFormatterStyle('yellow')); $status = $kernel-\u0026gt;handle( $input = new Symfony\\Component\\Console\\Input\\ArgvInput, $output ); ä¿®æ”¹çš„è©±åœ¨ line:37 å¯ä»¥å¸¶ä¸‰ç¨®åƒæ•¸ public function __construct( string $foreground = null, string $background = null, array $options = []){ /****/ } ä¸‰ç¨®åƒæ•¸å¯ä»¥åƒè€ƒ private static $availableForegroundColors = [ 'black' =\u0026gt; ['set' =\u0026gt; 30,","tags":["php","laravel","artisan"],"title":"ç­†è¨˜ artisan çš„å¤§ç´…è‰²å¥½åˆºçœ¼å•Šå•Šå•Šå•Š","uri":"https://blog.10oz.tw/20190523-laravel-artisan-change-color-style/","year":"2019"},{"content":" å¾ golang 1.13 release(2019/09/03) å¾Œï¼Œgomodule è®Šæˆé è¨­ï¼Œå¤§å®¶éƒ½ç”¨å®˜æ–¹çš„ gomodule äº†å–” åœ¨é€™ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ GOMODULE111=true ä¾†åšç®¡ç†\nå®‰è£ golang (on Mac) 1. ç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯æ‹¿åˆ° golnag å›‰ brew install go 2. ç’°å¢ƒè¨­å®š è©¦è‘—åœ¨ terminal è¼¸å…¥ go envï¼Œèƒ½å¤ æ‹¿åˆ° golang ç”¨åˆ°çš„ç’°å¢ƒè®Šæ•¸ ç‰¹åˆ¥æ³¨æ„ä¸€ä¸‹å¹¾å€‹ç’°å¢ƒè®Šæ•¸\nGOROOT: æ˜¯ä½  golang åŸ·è¡Œç’°å¢ƒä½çš„åœ°æ–¹ GOPATH: æ˜¯ä½ çš„ golang ç¨‹å¼ å’Œ ç”¨åˆ°çš„å¥—ä»¶å€‘æ‰€ä½çš„åœ°æ–¹ GOBIN: å› ç‚º golang æ˜¯ç·¨è­¯å¼çš„èªè¨€ï¼Œä»–å¯ä»¥æŠŠç›¸ä¾å¥—ä»¶äº‹å…ˆbuild å¥½ï¼Œè£½ä½œæˆ .a çš„äºŒé€²ä½æª”ï¼Œå­˜åœ¨ GOBIN è£¡é¢ # create GOPATH dir mkdir $HOME/gocode æ°¸ä¹…è¨­å®š~~ å¦‚æœä½ çš„ shell æ˜¯ bash çš„è©± (é è¨­) é–‹å•Ÿç·¨è¼¯å™¨ä¿®æ”¹ $HOME/.bashrc æª”æ¡ˆï¼Œbash åœ¨ç™»å…¥å¾Œæœƒåšä¸Šé¢çš„äº‹æƒ…\n# edit $HOME/.bashrc vim $HOME/.bashrc æŒ‰ä¸‹ G åˆ°æœ€åº•éƒ¨å¾Œ i é€²å…¥ç·¨è¼¯æ¨¡å¼ï¼ŒæŠŠç’°å¢ƒè®Šæ•¸è¨­å®šè²¼ä¸Šå»\nexport GOPATH=$HOME/gocode export GOBIN=$GOPATH/bin export PATH=$PATH:$GOBIN æŒ‰ä¸‹escé€€å‡ºç·¨è¼¯æ¨¡å¼ï¼Œè¼¸å…¥:wqå­˜æª”ä¸¦é›¢é–‹\nor you are using fish vim ~/.config/fish/config.fish\n# GOLANG configurations set -x GOPATH $HOME/gocode set -x GOBIN $GOPATH/bin set -x GOROOT /usr/local/opt/go/libexec set PATH $GOPATH/bin $GOROOT/bin $PATH é‡æ–°å†é–‹ä¸€å€‹å°é»‘çª—è·‘ä¸€ä¸‹æ–°çš„è¨­å®šï¼Œ å†ä¸€æ¬¡ go env çœ‹çœ‹å¹¾å€‹åƒæ•¸æœ‰æ²’æœ‰ä¸åŒå§\n3. ä¸‹è¼‰å°ˆæ¡ˆ åœ¨ä¸‹è¼‰å‰ï¼Œæœ‰äº›äº‹æƒ…æ˜¯æˆ‘å€‘è¦çŸ¥é“çš„ Golang çš„è³‡æ–™å¤¾ä¸‹æœ‰ src pkg bin ä¸‰å€‹ç›®éŒ„\nsrc: ç•¶ä½ æ‰¾ç›¸ä¾å¥—ä»¶æ™‚ï¼Œæœƒä¾†æ‹œè¨ªé€™è£¡ pkg: ç·¨è­¯å¥½çš„ go æª”æ¡ˆ(*.a)ï¼Œä½¿ç”¨ç›¸ä¾å¥—ä»¶æ™‚ï¼Œå¯ä»¥ç›´æ¥å–ç”¨ bin: è£¡é¢æ˜¯ç·¨è­¯å¥½çš„äºŒé€²ä½æª”æ¡ˆï¼ˆgolangå·¥å…·ï¼‰å€‘ å…ˆè¨­å®š ssh ä¸‹è¼‰æˆ‘å€‘çš„ repoï¼Œè€Œä¸æ˜¯ https\ngit config --global url.\u0026quot;git+ssh://git@gitlab.tenoz.tw/\u0026quot;.insteadOf \u0026quot;https://repo.tenoz.tw/\u0026quot; go get repo.tenoz.tw/leotek/pelipper è¶•å¿«ä¾†ç¢ºèªä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯æˆåŠŸä¸‹è¼‰å›ä¾†äº†å‘¢ï¼Ÿ\ncd $GOPATH/src/repo.tenoz.tw/leotek/pelipper 4. å¥—ä»¶ç®¡ç†å·¥å…· go modules æ¨è–¦ç”¨é€™å€‹\nå…ˆä¾†çœ‹çœ‹ go modules ä»‹ç´¹) å§\ngo vendor å‰ç½®ä»»å‹™ï¼šä¸‹è¼‰ govendor\ngo get -u github.com/kardianos/govendor å¥½ï¼Œå›ä¾†çœ‹ä¸€ä¸‹\npelipper é€™å€‹å°ˆæ¡ˆå°±æ˜¯ç”¨ govendor ä¾†å°ä»–çš„å¥—ä»¶åšç®¡ç†\nçœ‹ä¸€ä¸‹ vendor/vendor.json è£¡é¢å¯«äº†ä»–ä½¿ç”¨çš„å¥—ä»¶å’Œç‰ˆæœ¬\nä¸€å€‹æŒ‡ä»¤ä¸‹è¼‰ç›¸ä¾å¥—ä»¶\ngovendor sync è·‘è·‘çœ‹~~\ngo build ./pelipper é›–ç„¶è·‘èµ·ä¾†äº†ï¼Œ ä¸éä»–å¯èƒ½æœƒè·Ÿä½ èªªä»–éœ€è¦è¨­å®šæª”å–”\né™„éŒ„ã€é‚„æœ‰å…¶ä»–ç®¡ç†å·¥å…· é€™è£¡æœ‰è©³ç´°è³‡è¨Š\ndep å®˜æ–¹æ¨è–¦çš„ç®¡ç†åŒ…ï¼Œä¸éæœ‰è¦è¢«äººå®¶å–ä»£æ‰çš„è¶¨å‹¢\nGo Modules 94Jå€‹ï¼Œçª©çœ‹å¥½niå•¦ \u0026raquo; ä»‹ç´¹\nåƒè€ƒè³‡æ–™ https://github.com/golang/go/wiki/PackageManagementTools https://ieevee.com/tech/2017/07/10/go-import.html\n","id":49,"section":"posts","summary":"å¾ golang 1.13 release(2019/09/03) å¾Œï¼Œgomodule è®Šæˆé è¨­ï¼Œå¤§å®¶éƒ½ç”¨å®˜æ–¹çš„ gomodule äº†å–” åœ¨é€™ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ GOMODULE111=true ä¾†åšç®¡ç† å®‰è£ golang (on Mac) 1. ç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯æ‹¿åˆ° golnag å›‰ brew install go 2. ç’°å¢ƒè¨­","tags":["golang"],"title":"ç­†è¨˜ å®‰è£ Golang èˆ‡ä»–å€‘çš„å¥—ä»¶ç®¡ç†å·¥å…·","uri":"https://blog.10oz.tw/20190501-golang-getting-start-and-package-manager/","year":"2019"},{"content":"ç°¡ä»‹ Golang å®˜æ–¹åœ¨ 1.11 ç‰ˆæ¨å‡ºçš„ç›¸ä¾å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œé‚„æ˜¯åœ¨æ¸¬è©¦éšæ®µ(æœƒåœ¨1.13æ­£å¼ç™»å ´) ä»–åœ¨ 2018/3/20 æäº¤ï¼Œä¸¦æ–¼ 2018/5/21 è¢«æ¥å— æƒ³ä½¿ç”¨ä»–çš„è©±ï¼Œè¦é–‹å€‹é–‹é—œï¼š ç’°å¢ƒè®Šæ•¸ GO111MODULE æ§åˆ¶è¡Œç‚ºï¼š\noff: go command ä¸ä½¿ç”¨ modules åŠŸèƒ½ï¼Œè€Œæ˜¯æ²¿ç”¨èˆŠæœ‰çš„ GOPATH æ¨¡å¼ on: å¼·åˆ¶ä½¿ç”¨ modules åŠŸèƒ½ï¼Œåªæ ¹æ“š go.mod ä¸‹è¼‰ dependency è€Œå®Œå…¨å¿½ç•¥ GOPATH ä»¥åŠ vendor ç›®éŒ„ auto: Golang 1.11 é è¨­å€¼ï¼Œgo command æ ¹æ“šç•¶å‰å·¥ä½œç›®éŒ„ç‹€æ…‹æ±ºå®šæ˜¯å¦å•Ÿç”¨ modules åŠŸèƒ½ï¼Œæ»¿è¶³ä»»ä¸€æ¢ä»¶æ™‚æ‰å•Ÿå‹•æ­¤åŠŸèƒ½: ç•¶å‰ç›®éŒ„ä½æ–¼ GOPATH/src ä¹‹å¤–ä¸¦ä¸”åŒ…å« go.mod æ–‡ä»¶ ç•¶å‰ç›®éŒ„ä½æ–¼åŒ…å« go.mod æ–‡ä»¶çš„ç›®éŒ„ä¸‹ å› æ­¤ï¼Œæˆ‘å€‘çš„ç¬¬ä¸€æ­¥å°±æ˜¯é–‹å•Ÿä»–\nexport GO111MODULE=on ä¾†å§ï¼Œæ–°å°ˆæ¡ˆ mkdir goModTest cd goModTest main.go // at goModTest/main.go package main import ( \u0026quot;net/http\u0026quot; \u0026quot;github.com/gin-gonic/gin\u0026quot; ) func main() { router := gin.Default() router.GET(\u0026quot;/health\u0026quot;, GetHealthHandler) s := \u0026amp;http.Server{ Addr: \u0026quot;:8000\u0026quot;, Handler: router, } s.ListenAndServe() } // GetHealthHandler - GET /health to expose service health func GetHealthHandler(c *gin.Context) { c.JSON(http.StatusOK, gin.H{ \u0026quot;code\u0026quot;: 0, \u0026quot;message\u0026quot;: \u0026quot;Service is alive!\u0026quot;, }) } æˆ‘å€‘åœ¨ main.go è£¡é¢ç”¨äº† gin é€™å€‹ web framework\ngo mod init # ç”¢ç”Ÿ go.mod go build # ç·¨è­¯æ™‚æœƒå»ä¸‹è¼‰ç¼ºå°‘çš„ç›¸ä¾å¥—ä»¶ åŸ·è¡Œå®Œå¾Œç™¼ç¾ go.mod ä¸­å¤šäº†å¹¾å€‹ç›¸ä¾å¥—ä»¶ é‚„å¤šäº†ä¸€å€‹ go.sumï¼Œ ä»–å°±åƒæ˜¯å…¶ä»–èªè¨€çš„ .lock ä¸€æ¨£ï¼Œæ˜¯ç”¨ä¾†è¨˜éŒ„å®‰è£çš„ç‰ˆæœ¬\ntidy è‡ªå‹•å¹«ä½ æª¢æŸ¥ä½ çš„ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨åˆ°çš„å¤–éƒ¨å¼•ç”¨ï¼Œ å¹«ä½ åŠ å…¥ä½ éœ€è¦çš„ä¹Ÿå¹«ä½ ç§»é™¤ä½ ç”¨ä¸åˆ°çš„\ngo mod tidy Vendor é è¨­çš„æƒ…æ³ä¸‹ï¼Œgo mod å¹«ä½ æŠŠç›¸ä¾å¥—ä»¶ä¸‹è¼‰åˆ° $GOPATH ä¸éä½ å¸Œæœ›æœ‰æ”¾åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹çš„è©±\u0026hellip;\ngo mod tidy # å…ˆåšå€‹æ•´ç†ï¼Œæ‰ä¸æœƒå¤šä¸‹è¼‰ go mod vendor import local package å¯ä»¥ç›´æ¥ import å°ˆæ¡ˆä¸‹çš„æ¨¡çµ„ï¼Œgo.mod çŸ¥é“ä½ ç›®å‰çš„ä½ç½®åœ¨ goModTest ä¹Ÿå°±æ˜¯å¯«åœ¨ go.mod çš„ç¬¬ä¸€è¡Œ module goModTest\n// ç¨‹å¼è£¡é¢é€™æ¨£å¼•ç”¨è‡ªå·±å°ˆæ¡ˆçš„package import dataapi \u0026quot;goModTest/pkg/myapi\u0026quot; Reference å®˜æ–¹é€£çµ https://github.com/golang/go/wiki/Modules ä½ çœ‹äººå®¶ Drone ä¹Ÿç”¨äº† https://github.com/drone/drone https://www.lightblue.asia/golang-1-11-new-festures-modules https://www.lightblue.asia/go-modules-with-insecure-git/\n","id":50,"section":"posts","summary":"ç°¡ä»‹ Golang å®˜æ–¹åœ¨ 1.11 ç‰ˆæ¨å‡ºçš„ç›¸ä¾å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œé‚„æ˜¯åœ¨æ¸¬è©¦éšæ®µ(æœƒåœ¨1.13æ­£å¼ç™»å ´) ä»–åœ¨ 2018/3/20 æäº¤ï¼Œä¸¦æ–¼ 2018/5/21 è¢«æ¥å— æƒ³ä½¿ç”¨ä»–çš„è©±ï¼Œè¦é–‹å€‹é–‹é—œï¼š ç’°å¢ƒè®Šæ•¸ GO111MODULE æ§","tags":["golang","gomod"],"title":"ç­†è¨˜ æˆ‘æ˜¯å€‹ go module çš„èœé³¥","uri":"https://blog.10oz.tw/20190501-a-new-in-go-module/","year":"2019"},{"content":" laravel version: 5.8\nä¸€ã€å®‰è£ç¯‡ è£é€™å€‹ï¼Œè·Ÿè‘—ä»–çš„æ­¥é©Ÿåš https://github.com/robsontenorio/laravel-keycloak-guard\näºŒã€ä½¿ç”¨ç¯‡ æˆ‘å€‘å‡è¨­ Keycloak Server æœ‰å¤§å¤§å¹«ä½ é–‹å¥½äº† (æ²’æœ‰è«‹é»æˆ‘)\nå–å¾— Keycloak é‡‘é‘° https://auth.leotekiot.com é è¨­å¸³è™Ÿ: admin é è¨­å¯†ç¢¼: Pa55w0rd\nç™»å…¥å¾Œï¼Œä¾åºæ“ä½œå¾—åˆ°é‡‘é‘° Realm Setting \u0026gt; Keys \u0026gt; RS256 Public key æ”¾åˆ° laravel çš„ .env è¨­å®šä¸­\nKEYCLOAK_REALM_PUBLIC_KEY=ä½ çš„å…¬é–‹é‡‘é‘° ç™»å…¥ Keycloak Clients \u0026gt; {{ é¸å€‹Client }} \u0026gt; Credentials Secret é‚£é‚Šå°±æ˜¯æˆ‘å€‘çš„ Client Secret äº† User \u0026gt; View all users \u0026gt; {{ é¸å€‹User }} æˆ–æ˜¯ä½ è¦æ–°å‰µä¸€å€‹ä¹Ÿå¯ä»¥ï¼Œ ç¸½ä¹‹è¦è¨˜å¾—ä½ çš„å¸³è™Ÿå¯†ç¢¼å–”\nç§»é§•åˆ° Postman ä¾†å˜—è©¦ç™»å…¥ ç”¨é€™å€‹ API å–å¾— tokenï¼Œ auth_realm å¡«ä¸Šç¾åœ¨ä½¿ç”¨çš„ Realm é è¨­æ˜¯ Master\n/auth/realms/{{auth_realm}}/protocol/openid-connect/token éœ€è¦çš„åƒæ•¸å‰é¢æœ‰ä»‹ç´¹éäº†ï¼ŒæŒ‰ç…§åœ–ç‰‡å¡«æ»¿å®ƒå§ï¼\né€å‡ºå°±æœ‰ AccessToken äº† æ‡‰ç”¨ä»–!! è¤‡è£½å‰›æ‰çš„ access_token è²¼åˆ°é‚£å€‹éœ€è¦ç™»å…¥çš„ API è£¡é¢ Authorization \u0026gt; Type: Bearer Token \u0026gt; æˆåŠŸç™»å…¥ï½\nä¸‰ã€æª¢æŸ¥æ¬Šé™ç¯‡ // import Auth use Illuminate\\Support\\Facades\\Auth; // è§£æ JWT ä¸¦å–å¾— token $tokenString = Auth::token(); return [ 'token' =\u0026gt; json_decode($tokenString) ]; // å¾ token ä¾†æª¢æŸ¥æ¬Šé™(è§’è‰²) $Role = 'admin'; $isAdmin = Auth::hasRole($CLIENT, $Role); ","id":51,"section":"posts","summary":"laravel version: 5.8 ä¸€ã€å®‰è£ç¯‡ è£é€™å€‹ï¼Œè·Ÿè‘—ä»–çš„æ­¥é©Ÿåš https://github.com/robsontenorio/laravel-keycloak-guard äºŒã€ä½¿ç”¨ç¯‡ æˆ‘å€‘å‡è¨­ Keycloak Server æœ‰å¤§å¤§å¹«ä½ é–‹å¥½äº† (æ²’æœ‰è«‹é»æˆ‘) å–å¾— Keycloak é‡‘é‘° https://auth.leotekiot.com é è¨­å¸³è™Ÿ: admin é è¨­å¯†ç¢¼: Pa55w0rd ç™»å…¥å¾Œï¼Œä¾åº","tags":["php","laravel","keycloak","oauth"],"title":"ç­†è¨˜ Laravel with Keycloak","uri":"https://blog.10oz.tw/20190424-laravel-with-keycloak/","year":"2019"},{"content":" ç‰ˆæœ¬ Larael 5.7\nç¯„ä¾‹æ¨¡å‹ accounts\nCREATE TABLE `accounts` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `website_id` int(10) unsigned NOT NULL, `account` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `password` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `created_at` timestamp NULL DEFAULT NULL, `updated_at` timestamp NULL DEFAULT NULL, `deleted_at` timestamp NULL DEFAULT NULL, PRIMARY KEY (`id`) ); websites\nCREATE TABLE `websites` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `created_at` timestamp NULL DEFAULT NULL, `updated_at` timestamp NULL DEFAULT NULL, PRIMARY KEY (`id`) ) accounts table åº•ä¸‹æœ‰å€‹ column website_id ç”¨ä¾†é—œè¯ websites é€™å¼µè¡¨ã€‚\næ­£ç‰‡é–‹å§‹ - Model Account æ˜¯ä¸€å€‹ Modelï¼Œè·Ÿ websites å±¬æ–¼å¤šå°ä¸€çš„é—œä¿‚ ä¸€å€‹ website åº•ä¸‹å¯ä»¥æœ‰å¾ˆå¤š account\næ–¹æ¡ˆä¸€ã€åŠ å…¥åƒæ•¸ $with åœ¨ Account.php ä¸­\u0026hellip;\n// Account.php Account Model // will call getWebsiteAttribute and append to the model object protected $with = ['website']; public function website() { return $this-\u0026gt;belongsTo('App\\Website'); // ç­‰æ–¼ $this-\u0026gt;belongsTo('App\\Website', 'website_id', 'id'); } public function getWebsiteAttribute() { return $this-\u0026gt;website()-\u0026gt;first(); } ä»–æœƒè‡ªå‹•å¹«ä½ æ‰¾åˆ° $with å…§çš„ relation\nè¼¸å‡ºçœ‹èµ·ä¾†åƒé€™æ¨£ï¼Œå¤šäº† website\n{ \u0026quot;id\u0026quot;: 1, \u0026quot;website_id\u0026quot;: 1, \u0026quot;account\u0026quot;: \u0026quot;ditto\u0026quot;, \u0026quot;password\u0026quot;: \u0026quot;niguai.tenoz.1006\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;meow\u0026quot;, \u0026quot;created_at\u0026quot;: \u0026quot;2019-01-28 06:58:44\u0026quot;, \u0026quot;updated_at\u0026quot;: \u0026quot;2019-01-28 06:58:44\u0026quot;, \u0026quot;website\u0026quot;: { \u0026quot;id\u0026quot;: 1, \u0026quot;name\u0026quot;: \u0026quot;meo.tw\u0026quot;, \u0026quot;created_at\u0026quot;: null, \u0026quot;updated_at\u0026quot;: null } } æ–¹æ¡ˆäºŒã€ åŠ å…¥åƒæ•¸ $appends åªæ˜¯æŠŠ $with æ›æˆ $appendsï¼Œå¯ä»¥é”åˆ°ä¸€æ¨£çš„æ•ˆæœ\n// Account.php Account Model // will call getWebsiteAttribute and append to the model object protected $appends = ['website']; public function website() { return $this-\u0026gt;belongsTo('App\\Website'); } public function getWebsiteAttribute() { return $this-\u0026gt;website()-\u0026gt;first(); } ä¸éç‚ºä»€éº¼è¦é‡è¤‡åšé€™æ¨£çš„åŠŸèƒ½å‘¢? æˆ‘èªç‚º appends è·Ÿ $with çš„ä½¿ç”¨æ™‚æ©Ÿä¸åŒï¼ $with æ›´ç”¨åœ¨ é—œè¯å¦å¤–çš„è³‡æ–™è¡¨ æ™‚ $appends å‰‡æ˜¯å¯ä»¥ç”¨æ–¼åŠ å…¥å…¶ä»–è³‡è¨Šï¼Œåƒæ˜¯:\n// Account.php Account Model protected $appends = ['uniqName']; public function getUniqNameAttribute() { return \u0026quot;{$this-\u0026gt;name}#{$this-\u0026gt;id}\u0026quot;; } è¼¸å‡ºçœ‹èµ·ä¾†åƒé€™æ¨£ï¼Œå¤šäº† uniqName\n{ \u0026quot;id\u0026quot;: 1, \u0026quot;website_id\u0026quot;: 1, \u0026quot;account\u0026quot;: \u0026quot;ditto\u0026quot;, \u0026quot;password\u0026quot;: \u0026quot;niguai.tenoz.1006\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;meow\u0026quot;, \u0026quot;created_at\u0026quot;: \u0026quot;2019-01-28 06:58:44\u0026quot;, \u0026quot;updated_at\u0026quot;: \u0026quot;2019-01-28 06:58:44\u0026quot;, \u0026quot;uniqName\u0026quot;: \u0026quot;meow#1\u0026quot;, \u0026quot;website\u0026quot;: { \u0026quot;id\u0026quot;: 1, \u0026quot;name\u0026quot;: \u0026quot;meo.tw\u0026quot;, \u0026quot;created_at\u0026quot;: null, \u0026quot;updated_at\u0026quot;: null } } :::info å°Hint: belongsTo é€™å€‹ function æœƒå¹«ä½ çŒœä½  relate çš„ key column nameï¼Œ ä»–ç”¨çš„æ˜¯ä½ å‘¼å«ä»–çš„é‚£å€‹ function name\nå› æ­¤ï¼Œ function website() ä¸­çš„ belongsTo å¯ä»¥çœç•¥æ‰å¾Œé¢å…©å€‹åƒæ•¸ :::\n","id":52,"section":"posts","summary":"ç‰ˆæœ¬ Larael 5.7 ç¯„ä¾‹æ¨¡å‹ accounts CREATE TABLE `accounts` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `website_id` int(10) unsigned NOT NULL, `account` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `password` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `created_at` timestamp NULL DEFAULT NULL, `updated_at` timestamp NULL DEFAULT NULL, `deleted_at` timestamp NULL DEFAULT NULL, PRIMARY KEY (`id`) ); websites CREATE TABLE `websites` ( `id` int(10) unsigned NOT","tags":["php","laravel","eloquent","orm"],"title":"ç­†è¨˜ Laravel Eloquent Model çš„ relation","uri":"https://blog.10oz.tw/20190416-relation-of-laravel-eloquent-model/","year":"2019"},{"content":"ä½¿ç”¨ JWT ç‰ˆæœ¬ (2018/09 æ›´æ–°) å‰é¢å¹¾å€‹æ­¥é©ŸåŒå®˜æ–¹å®‰è£æ•™å­¸\næ­¥é©Ÿèªªæ˜ 1. composer è¼‰å›ä¾† composer require laravel/passport\n2. é–‹è³‡æ–™è¡¨ php artisan migrate ç„¶å¾Œä½ æœƒå¤š 5 å¼µè¡¨ (ä¸»è¦ä½¿ç”¨åˆ° oauth_access_token)\n3.å‰µé€  key php artisan passport:install\nä»–æœƒå¹«ä½ çš„ OAuth Server æº–å‚™ä¸€å° Key (storage/oauth-private.key, storage/outhpublic.key)\nåŒæ™‚ä¹Ÿæº–å‚™ 2 å€‹ Client Key åœ¨ oauth_clients è³‡æ–™è¡¨å…§\nPersonal access client created successfully. Client ID: 1 Client Secret: ETOhMRq7faRSnb1jN2F168jlbYFcf25MOHj0cOxt Password grant client created successfully. Client ID: 2 Client Secret: fibc50RiIjAiYSLR7xceQyoxQE3oGWtIXpCLj9Co 4. é™„åŠ  passport è‡³ auth ç³»çµ± åœ¨ app\\User.php æ–°å¢ Laravel\\Passport\\HasApiTokens line:5,11 \u0026lt;?php namespace App; use Laravel\\Passport\\HasApiTokens; use Illuminate\\Notifications\\Notifiable; use Illuminate\\Foundation\\Auth\\User as Authenticatable; class User extends Authenticatable { use HasApiTokens, Notifiable; // ... åœ¨ app/Providers/AuthServiceProvider.php æ–°å¢ passport çš„ route (æˆ‘å€‘ jwt ç‰ˆæœ¬å¯ä»¥ä¸ç”¨) line:29 \u0026lt;?php namespace App\\Providers; use Laravel\\Passport\\Passport; use Illuminate\\Support\\Facades\\Gate; use Illuminate\\Foundation\\Support\\Providers\\AuthServiceProvider as ServiceProvider; class AuthServiceProvider extends ServiceProvider { /** * The policy mappings for the application. * * @var array */ protected $policies = [ 'App\\Model' =\u0026gt; 'App\\Policies\\ModelPolicy', ]; /** * Register any authentication / authorization services. * * @return void */ public function boot() { $this-\u0026gt;registerPolicies(); Passport::routes(); // set when access tokens expire Passport::tokensExpireIn(now()-\u0026gt;addDays(15)); } } åœ¨ config/auth.php\nä¿®æ”¹ guard ä½¿ç”¨ passport 'guards' =\u0026gt; [ 'web' =\u0026gt; [ 'driver' =\u0026gt; 'session', 'provider' =\u0026gt; 'users', ], 'api' =\u0026gt; [ 'driver' =\u0026gt; 'passport', 'provider' =\u0026gt; 'users', ], ], ä¿®æ”¹ app/Http/Kernel.php\nåŠ é€² web middleware ä¸­ (æ­¤æ­¥é©Ÿ JWT æ‰éœ€è¦) 'web' =\u0026gt; [ // Other middleware... \\Laravel\\Passport\\Http\\Middleware\\CreateFreshApiToken::class, ], 5. ä¿®æ”¹ç™»å…¥æ­¥é©Ÿ ç•¶æˆ‘å€‘ç™»å…¥æˆåŠŸçš„æ™‚å€™ï¼Œå›å‚³åŠ å¯†éçš„ jwt\nåœ¨ app/Http/Controllers/Auth/LoginController.php override æ‰ authenticated function\nç•¶ç™»å…¥æˆåŠŸçš„æ™‚å€™æœƒé€²å…¥é€™å€‹function\ncreateToken ç¬¬ä¸€å€‹åƒæ•¸æ˜¯ tokençš„åç¨± ç¬¬äºŒå€‹æ˜¯æ¬Šé™é ˜åŸŸ(Scopes)ï¼Œå»ºç«‹å¾Œå¯ä»¥åœ¨oauth_xxx è³‡æ–™è¡¨ä¸­ç¢ºèª\n/** * The user has been authenticated. * Do not use the origin response of success login with 302, create access token * and return json format * * @param Request $request * @param User $user * @return \\Illuminate\\Http\\JsonResponse|\\Symfony\\Component\\HttpFoundation\\Response * @throws \\Illuminate\\Validation\\ValidationException */ protected function authenticated(Request $request, $user) { if (!is_null($user)) { // create persionalAccessToken for authrizate API $token = $user-\u0026gt;createToken('access_token', ['guard', 'employee'])-\u0026gt;accessToken ?: ''; return response()-\u0026gt;json([ 'access_token' =\u0026gt; $token ], 200); } // throw error return $this-\u0026gt;sendFailedLoginResponse($request); } // åŠ å…¥ scope middleware\n// åœ¨ app/Http/Kernel.php è£¡é¢çš„ $routeMiddleware\nscopes æ˜¯ä½ æŒ‡å®šçš„ scope å€‘éƒ½è¦é€šé (AND)\nscope å‰‡æ˜¯ä½ æŒ‡å®šçš„ scope å€‘å…¶ä¸­ä¹‹ä¸€é€šé (OR)\nå¯ä»¥æŒ‘éœ€è¦ç”¨çš„(æˆ‘æ˜¯å…©ç¨®éƒ½åŠ é€²å»äº†å•¦)\n'scopes' =\u0026gt; \\Laravel\\Passport\\Http\\Middleware\\CheckScopes::class, 'scope' =\u0026gt; \\Laravel\\Passport\\Http\\Middleware\\CheckForAnyScope::class, å›åˆ° app/Providers/AuthServiceProvider.php æˆ‘å€‘å¯ä»¥åœ¨é€™è£¡è¨­å®š scpoe å€‘ line:35 \u0026lt;?php namespace App\\Providers; use Laravel\\Passport\\Passport; use Illuminate\\Support\\Facades\\Gate; use Illuminate\\Foundation\\Support\\Providers\\AuthServiceProvider as ServiceProvider; class AuthServiceProvider extends ServiceProvider { /** * The policy mappings for the application. * * @var array */ protected $policies = [ 'App\\Model' =\u0026gt; 'App\\Policies\\ModelPolicy', ]; /** * Register any authentication / authorization services. * * @return void */ public function boot() { $this-\u0026gt;registerPolicies(); // set when access tokens expire Passport::tokensExpireIn(now()-\u0026gt;addDays(15)); // set when refresh tokens expire Passport::refreshTokensExpireIn(now()-\u0026gt;addDays(30)); Passport::tokensCan([ 'admin' =\u0026gt; 'system admin', 'guard' =\u0026gt; 'a good guy', 'employee' =\u0026gt; 'just a poor engineer' ]); } } 6. è£å‚™ä¸Šå» åœ¨ routes/api.php åŠ ä¸Š middleware auth ä¸¦æŒ‡å®š guard æ˜¯ api é€™æ¨£æœ‰åŠ ä¸Š middleware çš„ API å€‘ï¼Œ æ²’æœ‰ token å°±é€²ä¸å»å›‰ï¼\nRoute::apiResource('report', 'API\\ReportController') -\u0026gt;middleware('auth:api')-\u0026gt;middleware('scope:employee,guard'); Route::post('/report/multi_assign', 'API\\ReportController@assignReports') -\u0026gt;middleware('auth:api')-\u0026gt;middleware('scope:guard'); 7. å‰ç«¯æ¥æ”¶ åœ¨é€™è£¡æˆ‘å°‡tokenå­˜åœ¨local storageè£¡é¢\nç‚ºäº†æ¥æ”¶å…§å®¹ï¼Œæ‰€ä»¥å°‡ make:authç”¢ç”Ÿçš„æ¨¡æ¿ä¿®æ”¹æˆ vue component äº†\nç¯„ä¾‹ä½¿ç”¨ ajax åšç™»å…¥\naxios.post('/login', { 'email': this.email, 'password': this.password }) .then(res =\u0026gt; { window.localStorage.setItem('accessToken', res.data.access_token) window.location.href = this.redirect_to }) .catch(err =\u0026gt; { console.error('login failed') // è™•ç†å›å‚³çš„éŒ¯èª¤è¨Šæ¯ }) åœ¨ resources/assets/js/bootstrap.js\nç‚ºäº†ä¸ç”¨æ¯ä¸€æ¬¡é€ API è«‹æ±‚éƒ½è¦æ‰‹å‹•åŠ ä¸Š tokenï¼Œ æˆ‘å€‘ä¿®æ”¹ axios çš„é è¨­\n/** * We will use laravel/passport JWT to verify API permission. * Once user success to login, get a access token. The access token will be * stored in the Local Storage of browser. */ let accessToken = JSON.parse(window.localStorage.getItem('accessToken')|| null); if (accessToken) { window.axios.defaults.headers.common['Authorization'] = accessToken; } è£œå……\nå¯ä»¥åœ¨ app/Exceptions/Handler.php åš error handle\nåœ¨é€™è£¡æŠŠå…¨éƒ¨çš„ api error éƒ½å›å‚³ 401 æœªé©—è­‰ï¼Œ ä¸è‰¯ç¤ºç¯„XDD /** * Convert an authentication exception into an unauthenticated response. * * @param \\Illuminate\\Http\\Request $request * @param \\Illuminate\\Auth\\AuthenticationException $exception * @return \\Illuminate\\Http\\Response */ protected function unauthenticated($request, AuthenticationException $exception) { if ($request-\u0026gt;expectsJson()) { return response()-\u0026gt;json(['error' =\u0026gt; 'Unauthenticated.'], 401); } $guard = array_get($exception-\u0026gt;guards(), 0); switch ($guard) { case 'web': $login = 'login'; break; case 'api': return response()-\u0026gt;json(['error' =\u0026gt; 'API Unauthenticated.'], 401); break; } return redirect()-\u0026gt;guest(route($login)); } åƒè€ƒ Laravel å®˜æ–¹ Laravel Passport JWT Authentication\nOAuth2 ä»€éº¼æ˜¯ OAuth? ä¾‹å¦‚èªªä½ å¾ä½ çš„æœå‹™è¦è·Ÿ google æ‹¿å–ä½¿ç”¨è€…çš„è³‡è¨Š\n- - Resource Owner ä½¿ç”¨è€… Client ä½ çš„æœå‹™ Authorization Server æˆæ¬Šè€…ï¼Œæœå‹™è·Ÿé€™é‚Šæ‹¿token å¦‚: google Resource Server æœå‹™æœƒè·Ÿé€™è£¡æ‹¿è³‡æ–™ é–‹å§‹å®‰è£ - å¯¦æˆ°æ™‚é–“ å‰å¹¾å€‹æ­¥é©ŸåŒå®˜æ–¹æ•™å­¸\n1. composer è¼‰å›ä¾† composer require laravel/passport\n2. é–‹è¡¨ php artisan migrate\nç„¶å¾Œä½ æœƒå¤š 5 å¼µè¡¨ (ä¸»è¦ä½¿ç”¨åˆ° oauth_access_token)\n$ php artisan migrate Migrating: 2016_06_01_000001_create_oauth_auth_codes_table Migrated: 2016_06_01_000001_create_oauth_auth_codes_table Migrating: 2016_06_01_000002_create_oauth_access_tokens_table Migrated: 2016_06_01_000002_create_oauth_access_tokens_table Migrating: 2016_06_01_000003_create_oauth_refresh_tokens_table Migrated: 2016_06_01_000003_create_oauth_refresh_tokens_table Migrating: 2016_06_01_000004_create_oauth_clients_table Migrated: 2016_06_01_000004_create_oauth_clients_table Migrating: 2016_06_01_000005_create_oauth_personal_access_clients_table Migrated: 2016_06_01_000005_create_oauth_personal_access_clients_table 3. å‰µé€  key php artisan passport:install\nä»–æœƒå¹«ä½ çš„ OAuth Server æº–å‚™ä¸€å° Key (storage/oauth-private.key, storage/outhpublic.key)\nåŒæ™‚ä¹Ÿæº–å‚™ä¸€çµ„ Client Key åœ¨ oauth_clients è³‡æ–™è¡¨å…§\n$ php artisan passport:install Encryption keys generated successfully. Personal access client created successfully. Client ID: 1 Client secret: VJZEYfTpsHBkNCv9ULUyHvGBbJvYiD1ZVP86cbYu Password grant client created successfully. Client ID: 2 Client secret: l4kh71C2DpdUsNmJFipi0hiDnhdgj6VfF5lGGDam 4. é™„åŠ  passport è‡³ auth ç³»çµ± åœ¨ app\\User.php æ–°å¢ä¸€å€‹ trait Laravel\\Passport\\HasApiTokens line:5,11 \u0026lt;?php namespace App; use Laravel\\Passport\\HasApiTokens; use Illuminate\\Notifications\\Notifiable; use Illuminate\\Foundation\\Auth\\User as Authenticatable; class User extends Authenticatable { use HasApiTokens, Notifiable; // other code... åœ¨ app/Providers/AuthServiceProvider.php æ–°å¢ passport çš„ route line:5 import passport line:29 add passport routes \u0026lt;?php namespace App\\Providers; use Laravel\\Passport\\Passport; use Illuminate\\Support\\Facades\\Gate; use Illuminate\\Foundation\\Support\\Providers\\AuthServiceProvider as ServiceProvider; class AuthServiceProvider extends ServiceProvider { /** * The policy mappings for the application. * * @var array */ protected $policies = [ 'App\\Model' =\u0026gt; 'App\\Policies\\ModelPolicy', ]; /** * Register any authentication / authorization services. * * @return void */ public function boot() { $this-\u0026gt;registerPolicies(); Passport::routes(); // set when access tokens expire Passport::tokensExpireIn(now()-\u0026gt;addDays(15)); } } åœ¨ config/auth.php\nä¿®æ”¹ guard ä½¿ç”¨ passport 'guards' =\u0026gt; [ 'web' =\u0026gt; [ 'driver' =\u0026gt; 'session', 'provider' =\u0026gt; 'users', ], 'api' =\u0026gt; [ 'driver' =\u0026gt; 'passport', 'provider' =\u0026gt; 'users', ], ], ","id":53,"section":"posts","summary":"ä½¿ç”¨ JWT ç‰ˆæœ¬ (2018/09 æ›´æ–°) å‰é¢å¹¾å€‹æ­¥é©ŸåŒå®˜æ–¹å®‰è£æ•™å­¸ æ­¥é©Ÿèªªæ˜ 1. composer è¼‰å›ä¾† composer require laravel/passport 2. é–‹è³‡æ–™è¡¨ php artisan migrate ç„¶å¾Œä½ æœƒå¤š 5 å¼µè¡¨ (ä¸»è¦ä½¿ç”¨åˆ° oauth_access_token) 3.å‰µé€  key php artisan passport:install ä»–æœƒå¹«ä½ çš„","tags":["php","laravel","passport","jwt"],"title":"ç­†è¨˜ Laravel API æ¬Šé™ (Passport)","uri":"https://blog.10oz.tw/20190217-laravel-api-permission-by-passport/","year":"2019"},{"content":"æ–°æ‰‹å…¥é–€ çµæ§‹ä»‹ç´¹ æˆ‘å€‘ç¾åœ¨åœ¨ laravel v5.7\nä¸€èµ·ä¾†çœ‹ä¸€ä¸‹ laravel å°ˆæ¡ˆçš„çµæ§‹å§\napp å¤§éƒ¨ä»½çš„ç¶²é å¾Œç«¯ä¸»è¦ç¨‹å¼ç¢¼ ä¹Ÿå°±æ˜¯èªªä»–å¾ˆé‡è¦\n(Model)æ”¾åœ¨å¤–é¢çš„å¤§å¯«é–‹é ­å€‘ï½\nä¾‹å¦‚èªª User.php å°±æ˜¯ï¼Œ ä»–å€‘æ˜¯ Modelï¼Œå®šç¾©äº†è³‡æ–™åº«çš„ç‰©ä»¶æ¨¡å¼\nHttp/\nControllers/\ncontrollerå¯ä»¥ä½œç‚ºè·¯ç”±é€²ä¾†å¾Œçš„æµç¨‹æ§åˆ¶å™¨ï¼Œå¯ä»¥æƒ³åƒå®ƒè² è²¬å‘Šè¨´å¤§å®¶è¦åšä»€éº¼ Middleware/\nmiddlewareå«åšä¸­é–“å±¤ï¼Œç”¨ä¾†åŒ…è‘—ä½ çš„ç¨‹å¼å…§å®¹ï¼Œrequest é€²å‡ºéƒ½æœƒç¶“é bootstrap ç¨‹å¼å•Ÿå‹•ç¬¬ä¸€å€‹åŸ·è¡Œçš„å¥—ä»¶\nconfig æ‰€æœ‰æ‡‰ç”¨çš„è¨­å®šæª”å€‘\ndatabase é¡§åæ€ç¾©ï¼šè³‡æ–™åº«ï½\nmigrations/\nç´€éŒ„äº†è³‡æ–™åº«çš„å¿ƒè·¯æ­·ç¨‹\nå…¶ä¸­å®šç¾©äº†upè·Ÿdownï¼Œæ¨¡æ“¬å»ºç«‹è³‡æ–™é‚„æœ‰éœ€è¦rollbackå›å»æ™‚çš„å‹•ä½œ fatories/\nå®šç¾©äº†ä¸€äº›è³‡æ–™çš„æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨seederæ‰¹é‡è£½é€  seeds/\nä»–æ˜¯ä¸€é¡†æœƒé•·å‡ºè³‡æ–™çš„ç¨®å­ï¼Œç•¶ä½ éœ€è¦ç”¢ç”Ÿæ¸¬è©¦ç”¨çš„è³‡æ–™çš„æ™‚å€™å¾ˆå¸¸é‡åˆ°ä»– public å°å¤–å…¬é–‹çµ¦ä½¿ç”¨è€…çœ‹å¾—åˆ°çš„è³‡æº\nEx: åœ–ç‰‡ã€webpackåŒ…è£éçš„æª”æ¡ˆ resources æœ¬åœ°è³‡æº\nEx: jsçš„åŸå§‹ç¢¼ã€CSS\u0026hellip;\n/assets\n/js/components\nè£¡é¢å¯«äº†å¥½å¤š vue component å€‘ï¼Œä»–å€‘æ˜¯å‰ç«¯ä¸»åŠ›! /views\né€™é‚Šæ”¾äº† blade ï¼Œä»–æ˜¯ laravelé¸ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œå¹«ä½ æ›´æ™ºæ…§çš„å¯«ä½ çš„html\nroutes api.php è£¡é¢è¨»å†ŠAPI web.php è£¡é¢è¨»å†Šç¶²é  ä»–å€‘æœ€å¤§çš„å·®åˆ¥å°±æ˜¯å¥—ç”¨äº†ä¸åŒçš„middleware\nstorage ç¶²é è¢«å„²å­˜çš„è³‡æº\nEx: logæ—¥èªŒæª”æ¡ˆ(ç´€éŒ„æª”)ã€æª”æ¡ˆå¿«å– tests æ¸¬è©¦å–®å…ƒã€æ•´åˆæ¸¬è©¦\nå¤§å®¶éƒ½èªªç”¨TDDæ¯”è¼ƒå¿«ã„›\nvendor æ”¾åˆ¥äººcodeçš„åœ°æ–¹\næ‹¿åˆ¥äººçš„codeä¾†ç”¨\nlaradock å®ƒå¹«åŠ©æˆ‘å€‘ä½¿ç”¨dockerä¾†å»ºåˆ¶æœå‹™\nlaradock/.env å­˜æ”¾ laradockçš„è¨­å®šåƒæ•¸ å…¶ä»–æª”æ¡ˆ .env åœ¨é€™å€‹ç¶²é æœƒç”¨åˆ°çš„åƒæ•¸ï¼Œåƒæ˜¯è³‡æ–™åº«çš„å¯†ç¢¼ artisan æ”¾äº†äº› laravel çš„å·¥ä½œæŒ‡ä»¤ composer.json composer ç”¨åœ¨ php çš„å¥—ä»¶ç®¡ç† ç•¶ä½ éœ€è¦å¹«ä½ çš„ php ç¨‹å¼è£é»åˆ¥äººçš„å¥—ä»¶çš„æ™‚å€™ï¼Œä½ æœƒé€²ä¾†é€™é‚Šçœ‹çœ‹ package.json javascript çš„å¥—ä»¶ç‰ˆæœ¬ç®¡ç†ï¼Œé‚„æœ‰ npm æŒ‡ä»¤å–” webpack.min.js webpack æœƒå¹«ä½ æ‰“åŒ…å‰ç«¯çš„è³‡æºå€‘ ç°¡å–®æ“ä½œ (by Xiao \u0026amp; Andrew \u0026amp; Dagg) è¨»å†Šè·¯ç”± å¯«åœ¨ routes/web.php\né€™é‚Šå¯ä»¥è©¦è‘—ç”¨ä½ çš„è·¯ç”±é€£ä¸Šé è¨­çš„welcomeé¦–é äº†\nä½ è¦åœ¨postmanæ¸¬è©¦çš„è©± è¦é—œæ‰csrfé˜²ç¦¦ app/Http/Middleware/VerifyCsrfToken.php\nmigrate - é–‹å€‹è³‡æ–™è¡¨ php artisan make:migration crete_todoList_table æª”æ¡ˆæœƒåœ¨ ./database/migration/ æª”åç¯„ä¾‹: 2018_01_22_170244_crete_todoList_table\ncolumn å»ºç«‹èªªæ˜ https://laravel.com/docs/5.5/migrations#creating-columns\nå¯«å€‹Controller php artisan make:controller TodoListController åœ¨ ./app/Http/Controller/ æœƒé•·å‡ºä¾†\nresource å¦‚æœä½ åŠ ä¸Š \u0026ndash;resource çš„è©±,å®ƒæœƒé•·å‡ºé è¨­çš„å¹¾å€‹åŠŸèƒ½æ¡†æ¡† è€Œä½ å¯ä»¥åœ¨routeè£¡é¢ Route::resource() ä¾†ç®¡ç†ä»–å€‘ https://laravel.com/docs/5.5/controllers#resource-controllers\nä¸å¾—å·²ç”¨ç®€ä½“ä¸­æ–‡è¾“å…¥æ³•çš„è¡¥å……ï¼š å…³äºcontroller: ä¸­å±‚çš„classï¼Œç®¡ç†httpä¹‹é—´çš„è¡Œç‚ºï¼ˆ ex: get and post method ï¼‰ å¦ä¸€ç§åˆ™æ˜¯ç®¡ç†èµ„æºçš„class,ç®¡ç†å¯¹äºèµ„æºçš„äº‹ä»¶ï¼ˆex: å›¾ç‰‡çš„æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰, ç§°ç‚ºresource controller æ¯ä¸€ä¸ªcontrolleréƒ½å¯ä»¥æ³¨å†Œä¸€ä¸ªè·¯ç”±æ–¹ä¾¿ç®¡ç† å¦‚æœæƒ³è¦resourcecontrollerç»§æ‰¿ç‰¹å®šmodelç‰¹æ€§çš„è¯, å¯ä»¥åœ¨æŒ‡ä»¤åæ–¹åŠ ä¸Š --model=[model name] æ‰€ä»¥æˆ‘å€‘çš„çµè«–:\nAPI Controller + Model çš„ç”¢ç”Ÿæ–¹æ³•\nphp artisan make:controller TodoListController --resource --model=TodoList å¦‚æœä¸éœ€è¦é é¢çš„è©±ã€€--resource å¯ä»¥æ›æˆåŠ ä¸Š --api å–”\nphp artisan make:controller API/TodoListController --api ç”¨å€‹modelè£èµ·ä¾† php artisan make:model TodoList æœƒé•·å‡º ./app/TodoList.php\nåœ¨è£¡é¢å¯«ä½ è·Ÿè³‡æ–™åº«çš„äº’å‹•ç­‰ç­‰(static function)\nç„¶å¾Œä½ å¯ä»¥åœ¨controllerè£¡é¢å‘¼å«ä»–å€‘\nResource æ‰“åŒ…ä½ çš„è³‡æ–™ php artisan make:resource TodoList :::info app/Providers/AppServiceProvider è£¡é¢çš„ boot() å¯ä»¥åŠ ä¸Š use Illuminate\\Http\\Resources\\Json\\Resource; Resource::withoutWrapping(); å®ƒæœƒä¸åŒ…è£ä½ çš„response :::\nCollection æ‰“åŒ…ä½ çš„è³‡æ–™å€‘ php artisan make:resource TodoListCollection ä¾†çŒäº›å‡è³‡æ–™ factoryè£½é€ å‡ºå‡çš„è³‡æ–™ã€è³‡æ–™å‹æ…‹, seederæŠŠä»–å€‘å¯«èµ·ä¾†\nphp artisan make:seeder TodoListSeeder php artisan make:factory TodoListFactory é¦–å…ˆå»DatabaseSeeder çš„ run è£¡é¢, æŠŠä½ è¦è·‘çš„seederè¨»å†Šå€‹\n$this-\u0026gt;call([ TodoListSeeder::class, //other seeder ]); å†ä¾†æ˜¯ç›®æ¨™çš„TodoListSeeder æœƒç”¨åˆ°factoryå›å‚³è³‡æ–™, åˆ° TodoListFactory è¨­è¨ˆ é€™æ¨£å®ƒæœƒå›å‚³5ç­† fake è³‡æ–™åˆ°è³‡æ–™åº«\n//call factory to fake data factory(App\\TodoList::class, 5)-\u0026gt;create(); åŸ·è¡Œ DatabaseSeeder ä¸­è¢«æŒ‡å®šçš„ seeder å€‘\n./artisan db:seed BLOG - å¯¦ä½œæ™‚é–“ (by Dagg) å»ºç«‹Articleçš„Model ç‚ºäº†å»ºç«‹å­˜æ”¾æ–‡ç« çš„Modelè¼¸å…¥æŒ‡ä»¤: php artisan make:model 'Article' --migration åŒæ™‚å»ºç«‹è©²modelçš„migration\nç®¡ç†Articleçš„Model class Article extends Model { protected $table = 'articles'; // $fillable ç‚ºå¯ä»¥å¡«å…¥çš„table protected $fillable = [ 'content' ]; } å»ºç«‹Migrationæ–‡ä»¶ä¸­è³‡æ–™è¡¨çš„æ¬„ä½æ ¼å¼ $table-\u0026gt;increment(\u0026rsquo;_\u0026rsquo;); // è‡ªå‹•ç”¢ç”Ÿçš„key $table-\u0026gt;longText(\u0026rsquo;_\u0026rsquo;); // æ”¾ç½®ç„¡é™å­—å…ƒçš„æ¬„ä½ ä¾‹å¦‚:æ–‡ç« å…§å®¹ $table-\u0026gt;string(\u0026rsquo;_\u0026rsquo;); // æ”¾ç½®255å­—å…ƒå…§çš„å­—ä¸²æ¬„ä½ $table-\u0026gt;softDeletes(); // å»ºç«‹ä¸€å€‹åˆ¤åˆ¥è»Ÿåˆªé™¤çš„æ¬„ä½ $table-\u0026gt;timestamps(); // å»ºç«‹æ™‚é–“æ¨™è¨˜çš„æ¬„ä½(æœƒå»ºç«‹å…©å€‹æ¬„ä½ï¼Œä¸€å€‹æ”¾å»ºç«‹æ™‚é–“ä¸€å€‹æ”¾æ›´æ–°æ™‚é–“) èª¿æ•´å®Œä½ è¦ç”¢ç”Ÿçš„æ¬„ä½è¡Œåˆ¥ä¹‹å¾Œåœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥: $ php artisan migrate\nController public function store(Request $request) // å»ºç«‹ä¸€å€‹storeçš„å‡½å¼ æœƒæ¥æ”¶Request { $article = $request-\u0026gt;input('article'); //æŠŠRequestçš„inputä¸Ÿé€²å»$articleé€™å€‹è®Šæ•¸è£¡é¢ $show = new Article(); // å»ºç«‹ä¸€å€‹æ–°çš„Articleç‰©ä»¶ $show-\u0026gt;content = $article; // è®“æ–°å»ºçš„Articleç‰©ä»¶è½‰æˆRequestçš„input $show-\u0026gt;user_id = 1; // ç´€éŒ„user_id $show-\u0026gt;save(); // æŠŠé€™å€‹Articleé€™å€‹ç‰©ä»¶save return 'Hi'; // æ¸¬è©¦ç”¨å¯«çˆ½çš„ æƒ³ä¸åˆ°å§ } ","id":54,"section":"posts","summary":"æ–°æ‰‹å…¥é–€ çµæ§‹ä»‹ç´¹ æˆ‘å€‘ç¾åœ¨åœ¨ laravel v5.7 ä¸€èµ·ä¾†çœ‹ä¸€ä¸‹ laravel å°ˆæ¡ˆçš„çµæ§‹å§ app å¤§éƒ¨ä»½çš„ç¶²é å¾Œç«¯ä¸»è¦ç¨‹å¼ç¢¼ ä¹Ÿå°±æ˜¯èªªä»–å¾ˆé‡è¦ (Model)æ”¾åœ¨å¤–é¢çš„å¤§å¯«é–‹é ­å€‘ï½ ä¾‹å¦‚","tags":["php","laravel"],"title":"ç­†è¨˜ laravel çœŸæ–°æ‰‹æ™‚é–“","uri":"https://blog.10oz.tw/20190123-a-new-in-laravel/","year":"2019"},{"content":"Step by Step å®‰è£æŒ‡å— äº‹å‰æº–å‚™ HomeBrew é¦–å…ˆå®‰è£ HomeBrewï¼Œä»–æ˜¯ Mac ä¸Šçš„å¥—ä»¶ç®¡ç†å·¥å…·\nåœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œä»–ï¼š (è£éäº†å¯ä»¥è·³é)\n/usr/bin/ruby -e \u0026quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\u0026quot; ï¼Š Docker å®‰è£ Dockerï¼Œ ä»¥æœƒéœ€è¦ä»–å¤šå¤šç…§é¡§\nä¸æƒ³ç™»å…¥å¯ä»¥ç›´æ¥é» ä¸‹è¼‰é€£çµ ä¸‹è¼‰ .dmg ä¸¦å®‰è£\nå®‰è£ python3 ç”¨ brew è£ï¼Œå·²ç¶“è£å¥½äº†ï¼Œè·³é\nå®‰è£ docker-compose å°±æ˜¯æŠŠ docker çµ„éšŠï¼Œä¸€æ¬¡æŠŠä¸€ç¾¤ä¸åŒ docker çµ¦é–‹èµ·ä¾†çš„å·¥å…·\npip3 install docker-compose ï¼Š å®‰è£ PHP (7.1.3ä»¥ä¸Š) brew install php@7.2 ï¼Š ä¸‹è¼‰ Composer composer æ˜¯ php çš„å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œæƒ³åƒä»–è·Ÿ pip, npm é€™äº›çš„å‚¢ä¼™æ˜¯ä¸€æ¨£çš„\nå¯ä»¥ç›´æ¥è·‘ä¸‹é¢çš„æŒ‡ä»¤ï¼Œæˆ–æ˜¯åˆ°ä¸‹è¼‰é é¢ä¸‹è¼‰ php -r \u0026quot;copy('https://getcomposer.org/installer', 'composer-setup.php');\u0026quot; php -r \u0026quot;if (hash_file('sha384', 'composer-setup.php') === '93b544968e392c0362774670ac182b134cd3b3a09695e5dca5e53c3728f1a9f115f20b3b754bf9a1be329d521bdaa8b26ac6a13e9a62d6444cdb0dc8a1da0806156398a5cbe587c3f0fe57a54d8f5') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\u0026quot; php composer-setup.php php -r \u0026quot;unlink('composer-setup.php');\u0026quot; è£å®Œå¾Œæœƒå¤šå‡ºä¸€å€‹ composer.pharï¼Œæˆ‘å€‘æŠŠå®ƒæ”¾åˆ°å¯ä½¿ç”¨æŒ‡ä»¤å€ sudo mkdir /usr/local/bin -p sudo mv composer.phar /usr/local/bin/composer ï¼Š å®‰è£ NodeJS ä¾†é€™é‚Šå®‰è£ https://nodejs.org/en/download/ ç›®å‰æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 8.12 ï¼Œä¸éä¸‹è¼‰åˆ° 10ç‰ˆçš„æ‡‰è©²ä¹Ÿä¸æœƒæœ‰å•é¡Œå•¦ \u0026gt; \u0026lt;\nä¸‹è¼‰ Laravel æ¡†æ¶ ç§»å‹•åˆ°è¦å®‰è£çš„è³‡æ–™å¤¾ï¼Œä¾‹å¦‚ï¼š cd ~/project åˆ©ç”¨ git ä¸‹è¼‰ï¼Œ å®Œæˆå¾Œæœƒå¤šä¸€å€‹ practice è³‡æ–™å¤¾ git clone https://github.com/laravel/laravel.git practice å®‰è£ Laravel ç›¸ä¾å¥—ä»¶ ç§»å‹•åˆ°å°ˆæ¡ˆè³‡æ–™å¤¾ cd practice åˆ©ç”¨ composer å®‰è£ php çš„ç›¸ä¾å¥—ä»¶ composer install æ›´æ–°ä¸€ä¸‹ js å¥—ä»¶ npm install æ›´æ”¹æ¬Šé™ sudo chmod -R 777 storage/ bootstrap/cache/ è©¦è©¦çœ‹èƒ½ä¸èƒ½é–‹æœå‹™å•¦ï½ï½ï½ php artisan serve ç”¨ä½ çš„ç€è¦½å™¨é–‹é€™å€‹ http://127.0.0.1:8000\næ•²æ£’derï½ï½ï½ é–‹éå¾Œï¼Œæ›´æ”¹æ¬Šé™2 sudo chmod -R 777 storage/ å¥½åƒ\u0026hellip;é‚„ç¼ºäº†äº›æ±è¥¿ï¼Ÿ é‚£æˆ‘çš„è³‡æ–™åº«å‘¢ï¼Ÿ æˆ‘å€‘æ‰¾ Laradockä¾†å¹«æˆ‘å€‘å§!\nï¼Š åœ¨ project è£¡é¢å®‰è£ laradock # cd ~/project/practice git submodule add https://github.com/Laradock/laradock.git è£å¥½ä¹‹å¾Œ, æˆ‘å€‘è¤‡è£½ä¸€ä»½ laravel çš„è¨­å®šæª” cp .env.example .env ç”¢ç”Ÿ app key php artisan key:generate ç„¶å¾Œä¿®æ”¹ä¸€ä¸‹ MySQL é€£ç·šçš„è¨­å®š # at ~/project/practice/.env # line 9 DB_CONNECTION=mysql DB_HOST=mysql DB_PORT=3306 DB_DATABASE=default DB_USERNAME=default DB_PASSWORD=secret é‚„æœ‰ laradock çš„ä¹Ÿæ˜¯ cd laradock cp env-example .env æœ€å¾Œæˆ‘å€‘è¦å°æ”¹ä¸€ä¸‹ï¼Œæ”¹è®Š laradock å­˜æª”çš„ä½ç½® # line 14 DATA_PATH_HOST=~/.laradock/practice-data ä¸‹è¼‰ docker image docker pull xiao4011/laradock_mysql docker tag xiao4011/laradock_mysql:latest laradock_mysql:latest çœ‹èµ·ä¾†è¨­å®šå¥½äº†ï¼Œè·‘è·‘çœ‹ï¼Ÿ laradock ä¹Ÿå¯ä»¥å¹«ä½ é–‹å¾ˆå¤šä¸åŒçš„æœå‹™ï¼Œé€™è£¡æˆ‘å€‘å…ˆé–‹å¥½æˆ‘å€‘éœ€è¦ç”¨çš„\ndocker-compose up -d mysql phpmyadmin è©¦è©¦çœ‹é€£ç·š å›åˆ°å¤–å±¤ï¼Œä¹Ÿå°±æ˜¯ ~/project/practice\nåŸ·è¡Œä¸€ä¸‹é€™å€‹æŒ‡ä»¤\nphp artisan migrate ä»–å¹«ä½ å»ºäº†å¹¾å¼µ table ä½ å°±æˆåŠŸäº†\nBonus æ‰¾å€‹è¦–çª—é–‹å•Ÿæœå‹™ php artisan serve åŸ·è¡Œä¸€ä¸‹é€™å€‹æŒ‡ä»¤ï¼Œçœ‹çœ‹å¤šäº†äº›ä»€éº¼\nphp artisan make:auth å°±è‡ªå‹•å¹«ä½ å»ºå¥½æœƒå“¡ç™»å…¥ç³»çµ±äº†ï¼Œå¾ˆæ–¹ä¾¿ã„…\nTo Be Continue\u0026hellip; ä¸‹é›†å¾…çºŒ\n","id":55,"section":"posts","summary":"Step by Step å®‰è£æŒ‡å— äº‹å‰æº–å‚™ HomeBrew é¦–å…ˆå®‰è£ HomeBrewï¼Œä»–æ˜¯ Mac ä¸Šçš„å¥—ä»¶ç®¡ç†å·¥å…· åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œä»–ï¼š (è£éäº†å¯ä»¥è·³é) /usr/bin/ruby -e \u0026quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\u0026quot; ï¼Š Docker å®‰è£ Dockerï¼Œ ä»¥","tags":["php","laravel"],"title":"ç­†è¨˜ å®‰è£ Laravel on MacOS","uri":"https://blog.10oz.tw/20190117-install-laravel-on-macos/","year":"2019"},{"content":"éœ€æ±‚ è®“ console log å¯ä»¥æ­£ç¢ºé¡¯ç¤ºä¾†æº ip è€Œä¸æ˜¯è¢« web server è½‰ç™¼çš„ ip\nå¯¦ä½œä¿®æ”¹ è¦†è“‹æ‰ address_string é€™å€‹ function line:8 è¦†è“‹æ‰ log function line:9\nimport logging # get werkzeug_logger werkzeug_logger = logging.getLogger('werkzeug') # Override the built-in werkzeug logging function in order to change the log line format. from werkzeug.serving import WSGIRequestHandler WSGIRequestHandler.address_string = lambda self: \\ self.headers.get('X-Forwarded-For') if self.headers.get('X-Forwarded-For') else self.client_address[0] WSGIRequestHandler.log = lambda self, type, message, *args: \\ getattr(werkzeug_logger, type)('%s %s' % (self.address_string(), message % args)) ","id":56,"section":"posts","summary":"éœ€æ±‚ è®“ console log å¯ä»¥æ­£ç¢ºé¡¯ç¤ºä¾†æº ip è€Œä¸æ˜¯è¢« web server è½‰ç™¼çš„ ip å¯¦ä½œä¿®æ”¹ è¦†è“‹æ‰ address_string é€™å€‹ function line:8 è¦†è“‹æ‰ log function line:9 import logging # get werkzeug_logger werkzeug_logger = logging.getLogger('werkzeug') # Override the built-in werkzeug logging function in order to change the log line format. from werkzeug.serving import WSGIRequestHandler WSGIRequestHandler.address_string","tags":["python","flask"],"title":"ç­†è¨˜ è‡ªå®šç¾© flask çš„ console log ä¹‹è·¯","uri":"https://blog.10oz.tw/20181128-custom-flask-console-log/","year":"2018"},{"content":"å•é¡Œæè¿° åŒæ™‚é–‹å¤ªå¤šé€£ç·šå•¦\nç’°å¢ƒ Ubuntu 16.04\nè§£æ±ºæ–¹æ³• https://blog.csdn.net/qq_23926575/article/details/76619827\né–‹å•Ÿé€™å€‹æª”æ¡ˆ sudo vim /etc/security/limits.conf\nåœ¨æœ€åº•ä¸‹æ–°å¢å…©è¡Œ\n* soft nofile 10000 * hard nofile 10000 è¨˜å¾—é‡é–‹Server\n","id":57,"section":"posts","summary":"å•é¡Œæè¿° åŒæ™‚é–‹å¤ªå¤šé€£ç·šå•¦ ç’°å¢ƒ Ubuntu 16.04 è§£æ±ºæ–¹æ³• https://blog.csdn.net/qq_23926575/article/details/76619827 é–‹å•Ÿé€™å€‹æª”æ¡ˆ sudo vim /etc/security/limits.conf åœ¨æœ€åº•ä¸‹æ–°å¢å…©è¡Œ * soft nofile 10000 * hard nofile 10000 è¨˜å¾—é‡é–‹Server","tags":["python"],"title":"ç­†è¨˜ python: Error 24: too many open files","uri":"https://blog.10oz.tw/20181120-python-error24-too-many-open-files/","year":"2018"},{"content":"éŒ¯èª¤: ç›®æ¨™æ˜¯æˆåŠŸåŸ·è¡Œå®ƒï¼š\npip3 install mysqlclient arios@AriosMac: pymysql_pool Â» pip3 install mysqlclient Collecting mysqlclient Using cached https://files.pythonhosted.org/packages/ec/fd/83329b9d3e14f7344d1cb31f128e6dbba70c5975c9e57896815dbb1988ad/mysqlclient-1.3.13.tar.gz Complete output from command python setup.py egg_info: /bin/sh: mysql_config: command not found Traceback (most recent call last): File \u0026quot;\u0026lt;string\u0026gt;\u0026quot;, line 1, in \u0026lt;module\u0026gt; File \u0026quot;/private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/setup.py\u0026quot;, line 18, in \u0026lt;module\u0026gt; metadata, options = get_config() File \u0026quot;/private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/setup_posix.py\u0026quot;, line 53, inget_config libs = mysql_config(\u0026quot;libs_r\u0026quot;) File \u0026quot;/private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/setup_posix.py\u0026quot;, line 28, inmysql_config raise EnvironmentError(\u0026quot;%s not found\u0026quot; % (mysql_config.path,)) OSError: mysql_config not found ---------------------------------------- Command \u0026quot;python setup.py egg_info\u0026quot; failed with error code 1 in /private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/ è§£æ±ºæ–¹æ³• for ubuntu 16 LTSï¼š\napt install -y libmysqlclient-dev for mac:\nbrew install mysql ","id":58,"section":"posts","summary":"éŒ¯èª¤: ç›®æ¨™æ˜¯æˆåŠŸåŸ·è¡Œå®ƒï¼š pip3 install mysqlclient arios@AriosMac: pymysql_pool Â» pip3 install mysqlclient Collecting mysqlclient Using cached https://files.pythonhosted.org/packages/ec/fd/83329b9d3e14f7344d1cb31f128e6dbba70c5975c9e57896815dbb1988ad/mysqlclient-1.3.13.tar.gz Complete output from command python setup.py egg_info: /bin/sh: mysql_config: command not found Traceback (most recent call last): File \u0026quot;\u0026lt;string\u0026gt;\u0026quot;, line 1, in \u0026lt;module\u0026gt; File \u0026quot;/private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/setup.py\u0026quot;, line 18, in \u0026lt;module\u0026gt; metadata, options = get_config() File \u0026quot;/private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/setup_posix.py\u0026quot;, line 53, inget_config libs = mysql_config(\u0026quot;libs_r\u0026quot;) File \u0026quot;/private/var/folders/xf/g7567kgs05vf5t8zfrnfh9th0000gn/T/pip-install-pqr5axvg/mysqlclient/setup_posix.py\u0026quot;, line","tags":["python","mysql","mysqlclient"],"title":"ç­†è¨˜ mysqlclient å®‰è£, error: python setup.py egg_info ","uri":"https://blog.10oz.tw/20181117-install-mysqlclient/","year":"2018"},{"content":"å•é¡Œ ç•¶ä½ çš„å‡½ç¤ºåº«åº•å±¤ä½¿ç”¨ Cèªè¨€ è€Œä¸æ˜¯ç´” python ç·¨å¯«æ™‚ pylint å¯èƒ½æœƒç„¡æ³•æ­£ç¢ºçš„æ‰¾åˆ°ä»–ï¼Œæ­¤å•é¡Œå¯èƒ½å‡ºç¾åœ¨numpyæˆ–æ˜¯æœ¬ä¾‹çš„mysqlclientä¸Š\nè§£æ±ºæ–¹æ³• åŠ å…¥ä»¥ä¸‹è‡³ç™½åå–® $vim ~/.pylintrc\nextension-pkg-whitelist=MySQLdb ","id":59,"section":"posts","summary":"å•é¡Œ ç•¶ä½ çš„å‡½ç¤ºåº«åº•å±¤ä½¿ç”¨ Cèªè¨€ è€Œä¸æ˜¯ç´” python ç·¨å¯«æ™‚ pylint å¯èƒ½æœƒç„¡æ³•æ­£ç¢ºçš„æ‰¾åˆ°ä»–ï¼Œæ­¤å•é¡Œå¯èƒ½å‡ºç¾åœ¨numpyæˆ–æ˜¯æœ¬ä¾‹çš„mysqlclientä¸Š è§£æ±ºæ–¹æ³•","tags":["python","vscode"],"title":"ç­†è¨˜ è§£æ±º VSCode ä¸Š pylint ç„¡æ³•è§£æ c å‡½å¼åº«çš„å…§å®¹","uri":"https://blog.10oz.tw/20181108-run-pylint-clib-on-vscode/","year":"2018"}],"tags":[{"title":"apt","uri":"https://blog.10oz.tw/tags/apt/"},{"title":"argo","uri":"https://blog.10oz.tw/tags/argo/"},{"title":"artisan","uri":"https://blog.10oz.tw/tags/artisan/"},{"title":"aws","uri":"https://blog.10oz.tw/tags/aws/"},{"title":"blockchain","uri":"https://blog.10oz.tw/tags/blockchain/"},{"title":"buildx","uri":"https://blog.10oz.tw/tags/buildx/"},{"title":"casbin","uri":"https://blog.10oz.tw/tags/casbin/"},{"title":"cd","uri":"https://blog.10oz.tw/tags/cd/"},{"title":"chromedp","uri":"https://blog.10oz.tw/tags/chromedp/"},{"title":"chromium","uri":"https://blog.10oz.tw/tags/chromium/"},{"title":"crd","uri":"https://blog.10oz.tw/tags/crd/"},{"title":"de","uri":"https://blog.10oz.tw/tags/de/"},{"title":"di","uri":"https://blog.10oz.tw/tags/di/"},{"title":"docker","uri":"https://blog.10oz.tw/tags/docker/"},{"title":"ecr","uri":"https://blog.10oz.tw/tags/ecr/"},{"title":"elasticsearch","uri":"https://blog.10oz.tw/tags/elasticsearch/"},{"title":"eloquent","uri":"https://blog.10oz.tw/tags/eloquent/"},{"title":"es","uri":"https://blog.10oz.tw/tags/es/"},{"title":"ethereum","uri":"https://blog.10oz.tw/tags/ethereum/"},{"title":"flask","uri":"https://blog.10oz.tw/tags/flask/"},{"title":"future","uri":"https://blog.10oz.tw/tags/future/"},{"title":"geographic","uri":"https://blog.10oz.tw/tags/geographic/"},{"title":"geth","uri":"https://blog.10oz.tw/tags/geth/"},{"title":"gfw","uri":"https://blog.10oz.tw/tags/gfw/"},{"title":"git","uri":"https://blog.10oz.tw/tags/git/"},{"title":"github","uri":"https://blog.10oz.tw/tags/github/"},{"title":"gitlab","uri":"https://blog.10oz.tw/tags/gitlab/"},{"title":"golang","uri":"https://blog.10oz.tw/tags/golang/"},{"title":"golnag","uri":"https://blog.10oz.tw/tags/golnag/"},{"title":"gomod","uri":"https://blog.10oz.tw/tags/gomod/"},{"title":"gql","uri":"https://blog.10oz.tw/tags/gql/"},{"title":"graphql","uri":"https://blog.10oz.tw/tags/graphql/"},{"title":"ha","uri":"https://blog.10oz.tw/tags/ha/"},{"title":"helm","uri":"https://blog.10oz.tw/tags/helm/"},{"title":"homebrew","uri":"https://blog.10oz.tw/tags/homebrew/"},{"title":"hugo","uri":"https://blog.10oz.tw/tags/hugo/"},{"title":"ilm","uri":"https://blog.10oz.tw/tags/ilm/"},{"title":"index","uri":"https://blog.10oz.tw/tags/index/"},{"title":"istio","uri":"https://blog.10oz.tw/tags/istio/"},{"title":"javascript","uri":"https://blog.10oz.tw/tags/javascript/"},{"title":"json","uri":"https://blog.10oz.tw/tags/json/"},{"title":"jwt","uri":"https://blog.10oz.tw/tags/jwt/"},{"title":"keycloak","uri":"https://blog.10oz.tw/tags/keycloak/"},{"title":"kind","uri":"https://blog.10oz.tw/tags/kind/"},{"title":"kops","uri":"https://blog.10oz.tw/tags/kops/"},{"title":"kubernetes","uri":"https://blog.10oz.tw/tags/kubernetes/"},{"title":"laravel","uri":"https://blog.10oz.tw/tags/laravel/"},{"title":"linux","uri":"https://blog.10oz.tw/tags/linux/"},{"title":"location","uri":"https://blog.10oz.tw/tags/location/"},{"title":"log","uri":"https://blog.10oz.tw/tags/log/"},{"title":"macos","uri":"https://blog.10oz.tw/tags/macos/"},{"title":"mongodb","uri":"https://blog.10oz.tw/tags/mongodb/"},{"title":"multi-arch","uri":"https://blog.10oz.tw/tags/multi-arch/"},{"title":"mysql","uri":"https://blog.10oz.tw/tags/mysql/"},{"title":"mysqlclient","uri":"https://blog.10oz.tw/tags/mysqlclient/"},{"title":"neovim","uri":"https://blog.10oz.tw/tags/neovim/"},{"title":"nix","uri":"https://blog.10oz.tw/tags/nix/"},{"title":"nixos","uri":"https://blog.10oz.tw/tags/nixos/"},{"title":"oauth","uri":"https://blog.10oz.tw/tags/oauth/"},{"title":"operator","uri":"https://blog.10oz.tw/tags/operator/"},{"title":"orm","uri":"https://blog.10oz.tw/tags/orm/"},{"title":"passport","uri":"https://blog.10oz.tw/tags/passport/"},{"title":"php","uri":"https://blog.10oz.tw/tags/php/"},{"title":"pokemon","uri":"https://blog.10oz.tw/tags/pokemon/"},{"title":"pokesay","uri":"https://blog.10oz.tw/tags/pokesay/"},{"title":"postgres","uri":"https://blog.10oz.tw/tags/postgres/"},{"title":"pretty","uri":"https://blog.10oz.tw/tags/pretty/"},{"title":"python","uri":"https://blog.10oz.tw/tags/python/"},{"title":"raycast","uri":"https://blog.10oz.tw/tags/raycast/"},{"title":"ruby","uri":"https://blog.10oz.tw/tags/ruby/"},{"title":"rust","uri":"https://blog.10oz.tw/tags/rust/"},{"title":"service-mesh","uri":"https://blog.10oz.tw/tags/service-mesh/"},{"title":"subgroup","uri":"https://blog.10oz.tw/tags/subgroup/"},{"title":"terraform","uri":"https://blog.10oz.tw/tags/terraform/"},{"title":"test","uri":"https://blog.10oz.tw/tags/test/"},{"title":"typescript","uri":"https://blog.10oz.tw/tags/typescript/"},{"title":"ubuntu","uri":"https://blog.10oz.tw/tags/ubuntu/"},{"title":"vagrant","uri":"https://blog.10oz.tw/tags/vagrant/"},{"title":"vim","uri":"https://blog.10oz.tw/tags/vim/"},{"title":"vm","uri":"https://blog.10oz.tw/tags/vm/"},{"title":"vpn","uri":"https://blog.10oz.tw/tags/vpn/"},{"title":"vrrp","uri":"https://blog.10oz.tw/tags/vrrp/"},{"title":"vscode","uri":"https://blog.10oz.tw/tags/vscode/"},{"title":"windows","uri":"https://blog.10oz.tw/tags/windows/"},{"title":"wire","uri":"https://blog.10oz.tw/tags/wire/"},{"title":"wsl2","uri":"https://blog.10oz.tw/tags/wsl2/"}]}